# ğŸš€ å¿«é€Ÿå…¥é—¨ - æ—¥ç¨‹å±‚çº§ä½“ç³»

## ğŸ“– æ¦‚è¿°

æˆ‘å·²ç»ä¸ºä½ çš„è‡ªå¾‹åŠ©æ‰‹ App å®ç°äº†å®Œæ•´çš„**æ—¥ç¨‹å±‚çº§ä½“ç³»**å’Œ**è‡ªç„¶è¯­è¨€å‘½ä»¤ç³»ç»Ÿ**ã€‚è¿™ä¸ªç³»ç»Ÿå¯ä»¥ï¼š

1. âœ… æ”¯æŒå››å±‚ä¼˜å…ˆçº§çš„æ—¥ç¨‹ç®¡ç†
2. âœ… æä¾›å¯å¤ç”¨çš„æ—¥ç¨‹æ¨¡æ¿ï¼ˆå·¥ä½œæ—¥ã€ä¼‘æ¯æ—¥ã€å¤§å°å‘¨ï¼‰
3. âœ… æ”¯æŒè‡ªç„¶è¯­è¨€å‘½ä»¤æ“ä½œæ—¥ç¨‹
4. âœ… ä¸º GPT é›†æˆåšå¥½å‡†å¤‡
5. âœ… æœ¬åœ° SQLite å­˜å‚¨ï¼Œè·¨å¹³å°æ”¯æŒ

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä¼˜å…ˆçº§å±‚çº§

```
ç‰¹æ®Šæ—¥ç¨‹ (4) â† æœ€é«˜ï¼Œä¸å¯è¦†ç›–
    â†“
å¤§å°å‘¨æ¨¡æ¿ (3)
    â†“
å·¥ä½œæ—¥/ä¼‘æ¯æ—¥æ¨¡æ¿ (2)
    â†“
é»˜è®¤æ—¥ç¨‹ (1) â† æœ€ä½ï¼Œå¯è¢«è¦†ç›–
```

### ä½¿ç”¨åœºæ™¯

- **å·¥ä½œæ—¥æ¨¡æ¿**: è®¾ç½®å‘¨ä¸€åˆ°å‘¨äº”çš„å›ºå®šæ—¥ç¨‹
- **ä¼‘æ¯æ—¥æ¨¡æ¿**: è®¾ç½®å‘¨æœ«å’ŒèŠ‚å‡æ—¥çš„æ—¥ç¨‹
- **å¤§å°å‘¨æ¨¡æ¿**: é€‚ç”¨äºåŒå‘¨è½®æ¢å·¥ä½œåˆ¶
- **ç‰¹æ®Šæ—¥ç¨‹**: ç”¨äºé‡è¦äº‹ä»¶ã€çªå‘æƒ…å†µ

---

## ğŸ“ è‡ªç„¶è¯­è¨€å‘½ä»¤

### åŸºæœ¬æ“ä½œ

```dart
// 1. åˆ›å»ºæ—¥ç¨‹
"åˆ›å»º ä»Šå¤© æ™¨è·‘ åœ¨ 06:00-07:00"
"åˆ›å»º æ˜å¤© å›¢é˜Ÿä¼šè®® åœ¨ 14:00-15:30 æè¿°:è®¨è®ºQ4ç›®æ ‡"

// 2. ä¿®æ”¹æ—¥ç¨‹
"ä¿®æ”¹ ä»Šå¤© çš„ æ™¨è·‘ æ—¶é—´ä¸º 06:30-07:30"
"ä¿®æ”¹ æ˜å¤© çš„ ä¼šè®® ä¸º çº¿ä¸Šä¼šè®®"

// 3. åˆ é™¤æ—¥ç¨‹
"åˆ é™¤ ä»Šå¤© çš„ æ™¨è·‘"

// 4. å®Œæˆæ—¥ç¨‹
"å®Œæˆ æ™¨è·‘"

// 5. æŸ¥è¯¢æ—¥ç¨‹
"æŸ¥è¯¢ ä»Šå¤© çš„æ—¥ç¨‹"
"æŸ¥è¯¢ 2024-11-25 çš„æ—¥ç¨‹"
```

### æ¨¡æ¿è®¾ç½®

```dart
// è®¾ç½®å·¥ä½œæ—¥æ¨¡æ¿
"è®¾ç½®å·¥ä½œæ—¥æ¨¡æ¿: 06:00-07:00 æ™¨è·‘, 09:00-18:00 å·¥ä½œ, 19:00-21:00 å­¦ä¹ "

// è®¾ç½®ä¼‘æ¯æ—¥æ¨¡æ¿
"è®¾ç½®ä¼‘æ¯æ—¥æ¨¡æ¿: 08:00-09:00 æ™¨ç»ƒ, 10:00-12:00 ä¸ªäººé¡¹ç›®, 15:00-17:00 è¿åŠ¨"

// è®¾ç½®å¤§å°å‘¨æ¨¡æ¿
"è®¾ç½®å¤§å‘¨æ¨¡æ¿: 06:30-07:30 æ™¨è·‘, 09:00-19:00 å·¥ä½œ(åŠ ç­), 20:00-21:00 å­¦ä¹ "
"è®¾ç½®å°å‘¨æ¨¡æ¿: 07:00-08:00 æ™¨ç»ƒ, 09:00-18:00 å·¥ä½œ, 19:00-21:00 ä¼‘é—²"
```

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### åˆå§‹åŒ–æœåŠ¡

```dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import 'services/database_service.dart';
import 'services/holiday_service.dart';
import 'services/day_service.dart';
import 'services/template_service.dart';
import 'services/nlp_command_parser.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // åˆå§‹åŒ–æœåŠ¡
  final dbService = DatabaseService();
  final holidayService = HolidayService();
  final dayService = DayService(dbService, holidayService);
  final templateService = TemplateService(dbService, dayService);
  final nlpParser = NLPCommandParser(dbService, templateService);
  
  runApp(
    MultiProvider(
      providers: [
        Provider.value(value: dbService),
        Provider.value(value: holidayService),
        Provider.value(value: dayService),
        Provider.value(value: templateService),
        Provider.value(value: nlpParser),
      ],
      child: const MyApp(),
    ),
  );
}
```

### ä½¿ç”¨è‡ªç„¶è¯­è¨€å‘½ä»¤

```dart
// åœ¨ Widget ä¸­ä½¿ç”¨
class ScheduleWidget extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    final nlpParser = Provider.of<NLPCommandParser>(context);
    
    return FutureBuilder<String>(
      future: nlpParser.parseAndExecute('åˆ›å»º ä»Šå¤© æ™¨è·‘ åœ¨ 06:00-07:00'),
      builder: (context, snapshot) {
        if (snapshot.hasData) {
          return Text(snapshot.data!);
        }
        return CircularProgressIndicator();
      },
    );
  }
}
```

### è®¾ç½®å·¥ä½œæ—¥æ¨¡æ¿

```dart
final nlpParser = Provider.of<NLPCommandParser>(context, listen: false);

final result = await nlpParser.parseAndExecute(
  'è®¾ç½®å·¥ä½œæ—¥æ¨¡æ¿: 06:00-07:00 æ™¨è·‘, 09:00-18:00 å·¥ä½œ, 19:00-21:00 å­¦ä¹ '
);

print(result); // è¾“å‡º: å·²è®¾ç½®å·¥ä½œæ—¥: 3ä¸ªæ—¥ç¨‹
```

### æŸ¥è¯¢æ—¥ç¨‹

```dart
final nlpParser = Provider.of<NLPCommandParser>(context, listen: false);

final result = await nlpParser.parseAndExecute('æŸ¥è¯¢ ä»Šå¤© çš„æ—¥ç¨‹');

print(result);
// è¾“å‡º:
// 2024-11-24 çš„æ—¥ç¨‹:
// â—‹ 06:00 - 07:00 æ™¨è·‘
// â—‹ 09:00 - 18:00 å·¥ä½œ
// â—‹ 19:00 - 21:00 å­¦ä¹ 
```

---

## ğŸ”§ é›†æˆåˆ°ç°æœ‰é¡¹ç›®

### æ­¥éª¤ 1: æ›´æ–° main.dart

åœ¨ä½ ç°æœ‰çš„ `main.dart` ä¸­æ·»åŠ æ–°æœåŠ¡ï¼š

```dart
// æ·»åŠ å¯¼å…¥
import 'services/template_service.dart';
import 'services/nlp_command_parser.dart';

void main() async {
  // ... ç°æœ‰ä»£ç  ...
  
  // æ·»åŠ æ–°æœåŠ¡
  final templateService = TemplateService(dbService, dayService);
  final nlpParser = NLPCommandParser(dbService, templateService);
  
  runApp(
    MultiProvider(
      providers: [
        // ... ç°æœ‰ providers ...
        Provider.value(value: templateService),
        Provider.value(value: nlpParser),
      ],
      child: const MyApp(),
    ),
  );
}
```

### æ­¥éª¤ 2: åˆ›å»ºèŠå¤©ç•Œé¢ï¼ˆå¾…å®ç°ï¼‰

```dart
// lib/screens/chat_screen.dart
class ChatScreen extends StatefulWidget {
  @override
  State<ChatScreen> createState() => _ChatScreenState();
}

class _ChatScreenState extends State<ChatScreen> {
  final _controller = TextEditingController();
  final _messages = <String>[];
  
  @override
  Widget build(BuildContext context) {
    final nlpParser = Provider.of<NLPCommandParser>(context, listen: false);
    
    return Scaffold(
      appBar: AppBar(title: Text('æ—¥ç¨‹åŠ©æ‰‹')),
      body: Column(
        children: [
          // æ¶ˆæ¯åˆ—è¡¨
          Expanded(
            child: ListView.builder(
              itemCount: _messages.length,
              itemBuilder: (context, index) {
                return ListTile(title: Text(_messages[index]));
              },
            ),
          ),
          
          // è¾“å…¥æ¡†
          Padding(
            padding: EdgeInsets.all(8.0),
            child: Row(
              children: [
                Expanded(
                  child: TextField(
                    controller: _controller,
                    decoration: InputDecoration(
                      hintText: 'ä¾‹å¦‚: åˆ›å»º ä»Šå¤© æ™¨è·‘ åœ¨ 06:00-07:00',
                    ),
                  ),
                ),
                IconButton(
                  icon: Icon(Icons.send),
                  onPressed: () async {
                    final command = _controller.text;
                    final result = await nlpParser.parseAndExecute(command);
                    setState(() {
                      _messages.add('å‘½ä»¤: $command');
                      _messages.add('ç»“æœ: $result');
                    });
                    _controller.clear();
                  },
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

---

## ğŸ¤– å‡†å¤‡é›†æˆ GPT

### æ·»åŠ ä¾èµ–

åœ¨ `pubspec.yaml` ä¸­æ·»åŠ ï¼š

```yaml
dependencies:
  http: ^1.1.0
  flutter_dotenv: ^5.1.0
```

### åˆ›å»º GPT æœåŠ¡

```dart
// lib/services/gpt_service.dart
import 'package:http/http.dart' as http;
import 'dart:convert';

class GPTService {
  final String apiKey;
  final NLPCommandParser nlpParser;
  
  GPTService(this.apiKey, this.nlpParser);
  
  Future<String> chat(String userMessage, String context) async {
    final response = await http.post(
      Uri.parse('https://api.openai.com/v1/chat/completions'),
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer $apiKey',
      },
      body: jsonEncode({
        'model': 'gpt-4',
        'messages': [
          {
            'role': 'system',
            'content': _getSystemPrompt(),
          },
          {
            'role': 'user',
            'content': '$context\n\nç”¨æˆ·: $userMessage',
          },
        ],
      }),
    );
    
    if (response.statusCode == 200) {
      final data = jsonDecode(response.body);
      final gptResponse = data['choices'][0]['message']['content'];
      
      // æå–å‘½ä»¤å¹¶æ‰§è¡Œ
      final commands = _extractCommands(gptResponse);
      for (final cmd in commands) {
        await nlpParser.parseAndExecute(cmd);
      }
      
      return gptResponse;
    }
    
    throw Exception('Failed to get GPT response');
  }
  
  String _getSystemPrompt() {
    return '''
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—¥ç¨‹ç®¡ç†åŠ©æ‰‹ã€‚ä½ å¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†æ—¥ç¨‹ã€‚

ä½ å¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ ‡å‡†å‘½ä»¤æ ¼å¼æ¥æ“ä½œæ—¥ç¨‹ï¼š
1. åˆ›å»ºæ—¥ç¨‹: åˆ›å»º [æ—¥æœŸ] [æ ‡é¢˜] åœ¨ [æ—¶é—´]
2. ä¿®æ”¹æ—¥ç¨‹: ä¿®æ”¹ [æ—¥æœŸ] çš„ [æ ‡é¢˜] ä¸º [æ–°å†…å®¹]
3. åˆ é™¤æ—¥ç¨‹: åˆ é™¤ [æ—¥æœŸ] çš„ [æ ‡é¢˜]
4. å®Œæˆæ—¥ç¨‹: å®Œæˆ [æ ‡é¢˜]
5. è®¾ç½®æ¨¡æ¿: è®¾ç½®[æ¨¡æ¿ç±»å‹]: [æ—¥ç¨‹åˆ—è¡¨]
6. æŸ¥è¯¢æ—¥ç¨‹: æŸ¥è¯¢ [æ—¥æœŸ] çš„æ—¥ç¨‹

æ—¥ç¨‹ä¼˜å…ˆçº§ï¼š
- ç‰¹æ®Šæ—¥ç¨‹ï¼ˆPriority 4ï¼‰æœ€é«˜ï¼Œä¸å¯è¦†ç›–
- å¤§å°å‘¨æ¨¡æ¿ï¼ˆPriority 3ï¼‰
- å·¥ä½œæ—¥/ä¼‘æ¯æ—¥æ¨¡æ¿ï¼ˆPriority 2ï¼‰
- é»˜è®¤æ—¥ç¨‹ï¼ˆPriority 1ï¼‰æœ€ä½

è¯·åœ¨å›å¤ä¸­æ˜ç¡®åˆ—å‡ºä½ è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚
''';
  }
  
  List<String> _extractCommands(String gptResponse) {
    // æå– GPT å›å¤ä¸­çš„å‘½ä»¤
    // å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…
    final commands = <String>[];
    final lines = gptResponse.split('\n');
    
    for (final line in lines) {
      if (line.trim().startsWith('åˆ›å»º') ||
          line.trim().startsWith('ä¿®æ”¹') ||
          line.trim().startsWith('åˆ é™¤') ||
          line.trim().startsWith('å®Œæˆ') ||
          line.trim().startsWith('è®¾ç½®') ||
          line.trim().startsWith('æŸ¥è¯¢')) {
        commands.add(line.trim());
      }
    }
    
    return commands;
  }
}
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
lib/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schedule.dart                 âœ… å·²æ‰©å±•
â”‚   â”œâ”€â”€ schedule_template.dart        âœ… æ–°å¢
â”‚   â”œâ”€â”€ schedule_priority.dart        âœ… æ–°å¢
â”‚   â”œâ”€â”€ day_type.dart                 âœ“ å·²æœ‰
â”‚   â””â”€â”€ holiday.dart                  âœ“ å·²æœ‰
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ database_service.dart         âœ… å·²å‡çº§
â”‚   â”œâ”€â”€ template_service.dart         âœ… æ–°å¢
â”‚   â”œâ”€â”€ nlp_command_parser.dart       âœ… æ–°å¢
â”‚   â”œâ”€â”€ day_service.dart              âœ“ å·²æœ‰
â”‚   â””â”€â”€ holiday_service.dart          âœ“ å·²æœ‰
â”‚
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ schedule_screen.dart          âœ“ å·²æœ‰
â”‚   â”œâ”€â”€ calendar_screen.dart          âœ“ å·²æœ‰
â”‚   â””â”€â”€ chat_screen.dart              ğŸ”œ å¾…åˆ›å»º
â”‚
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ schedule_system_example.dart  âœ… æ–°å¢
â”‚
â””â”€â”€ main.dart                         ğŸ”§ éœ€è¦æ›´æ–°
```

---

## ğŸ“‹ å¾…åŠäº‹é¡¹

### ç«‹å³å¯åš

1. âœ… ~~å®ç°æ—¥ç¨‹å±‚çº§ä½“ç³»~~ (å·²å®Œæˆ)
2. âœ… ~~å®ç°è‡ªç„¶è¯­è¨€å‘½ä»¤è§£æå™¨~~ (å·²å®Œæˆ)
3. ğŸ”œ æ›´æ–° `main.dart` æ·»åŠ æ–°æœåŠ¡
4. ğŸ”œ åˆ›å»ºèŠå¤©ç•Œé¢ `chat_screen.dart`

### ä¸‹ä¸€æ­¥

5. ğŸ”œ é›†æˆ OpenAI API
6. ğŸ”œ å®ç°æ™ºèƒ½è°ƒæ•´ç®—æ³•
7. ğŸ”œ æ·»åŠ æ—¥ç¨‹å†²çªæ£€æµ‹
8. ğŸ”œ å®ç°æœ¬åœ°é€šçŸ¥æé†’

### å¯é€‰åŠŸèƒ½

9. ğŸ”œ äº‘ç«¯åŒæ­¥
10. ğŸ”œ æ•°æ®å¯¼å‡º/å¯¼å…¥
11. ğŸ”œ ç»Ÿè®¡åˆ†æé¢æ¿
12. ğŸ”œ ä¹ æƒ¯è¿½è¸ª

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **è®¾è®¡æ–‡æ¡£**: `æ—¥ç¨‹å±‚çº§ä½“ç³»ä¸è‡ªç„¶è¯­è¨€è§„èŒƒ.md`
- **å®ç°æ€»ç»“**: `æ—¥ç¨‹ç³»ç»Ÿå®ç°æ€»ç»“.md`
- **ä»£ç ç¤ºä¾‹**: `lib/examples/schedule_system_example.dart`

---

## ğŸ‰ æ€»ç»“

ä½ ç°åœ¨æ‹¥æœ‰äº†ï¼š

1. âœ… **å®Œæ•´çš„æ—¥ç¨‹å±‚çº§ä½“ç³»** - æ”¯æŒå››å±‚ä¼˜å…ˆçº§
2. âœ… **æ¨¡æ¿ç³»ç»Ÿ** - å¯å¤ç”¨çš„æ—¥ç¨‹æ¨¡æ¿
3. âœ… **è‡ªç„¶è¯­è¨€å‘½ä»¤** - æ˜“äºé›†æˆ GPT
4. âœ… **æœ¬åœ°å­˜å‚¨** - SQLite æ•°æ®åº“
5. âœ… **è·¨å¹³å°æ”¯æŒ** - Flutter å®ç°

ä¸‹ä¸€æ­¥åªéœ€è¦ï¼š
- åˆ›å»ºèŠå¤©ç•Œé¢
- é›†æˆ GPT API
- å®Œå–„ç”¨æˆ·ä½“éªŒ

ç¥ä½ å¼€å‘é¡ºåˆ©ï¼ğŸš€

---

**åˆ›å»ºæ—¶é—´**: 2024-11-24  
**ä½œè€…**: GitHub Copilot  
**ç‰ˆæœ¬**: 1.0
