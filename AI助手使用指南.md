# AI 助手使用指南

## 🎯 核心特性

### 1. **智能上下文感知**
AI 助手会主动获取以下信息来给出建议：
- 当前时间和日期
- 今天/明天的日程安排
- 你的工作制（单休/双休/大小周）
- 是否工作日/休息日

### 2. **对话式交互**
不需要使用固定命令格式，像朋友一样聊天：

**示例对话：**

```
你: "还没睡呢"

AI: 现在都凌晨2点了！我看了下你明天8点有晨会，建议你赶紧睡觉😴
    
    要不要我帮你把明天8点的晨会改到10点？这样你可以多睡2小时。
    
    [审批卡片会弹出]
```

```
你: "明天干什么"

AI: 明天是周六，你设置的是双休，可以好好休息！
    
    我看你明天的日程：
    • 9:00 晨跑
    • 14:00 学习
    
    要不要把晨跑时间改晚一点？周末可以睡个懒觉~
```

### 3. **审批机制**
所有日程修改都需要你的批准：

1. AI 提出建议后，会在聊天界面**上方**弹出审批卡片
2. 卡片显示操作详情：
   - 创建：绿色 + 加号图标
   - 修改：橙色 + 编辑图标
   - 删除：红色 + 删除图标
3. 你可以选择"批准"或"拒绝"
4. 批准后立即执行，拒绝则取消操作

### 4. **界面布局**

```
┌─────────────────────────────┐
│      AI 助手    [清空]      │
├─────────────────────────────┤
│ ╔═══════════════════════╗   │  ← 审批卡片区（有待审批时显示）
│ ║ 📝 创建明天8点的晨跑  ║   │
│ ║ 明天 08:00 - 晨跑     ║   │
│ ║     [拒绝] [批准]     ║   │
│ ╚═══════════════════════╝   │
├─────────────────────────────┤
│                             │
│  🤖 嗨！我是你的智能助手   │  ← 聊天消息区
│                             │
│          还没睡呢 👤        │
│                             │
│  🤖 都凌晨2点了...          │
│                             │
├─────────────────────────────┤
│ [随便聊聊...      ] [发送]  │  ← 输入区
└─────────────────────────────┘
```

## 💡 使用场景

### 场景 1：深夜未睡
```
你: "还在刷手机"
AI: 
- 获取当前时间 → 凌晨1点
- 查询明天日程 → 8点有会议
- 建议：赶紧睡觉，或调整明天日程
```

### 场景 2：周末安排
```
你: "明天是周末吗"
AI:
- 获取明天日期和工作制
- 判断是否休息日
- 建议：晚点起床，调整早晨日程
```

### 场景 3：日程规划
```
你: "下周要做什么"
AI:
- 查询下周所有日程
- 列出日程清单
- 发现冲突或建议优化
```

## 🔧 技术实现

### Function Calling 流程

1. **用户输入** → "还没睡"
2. **GPT 分析** → 需要获取上下文
3. **调用函数** → `get_current_context()` + `query_schedules('tomorrow')`
4. **获取数据** → 当前2点，明天8点有会议
5. **GPT 回复** → 建议睡觉，提出调整方案
6. **调用函数** → `propose_action(...)` 提交审批
7. **用户审批** → 批准/拒绝
8. **执行操作** → 修改数据库

### 可用函数

| 函数 | 功能 | 参数 |
|------|------|------|
| `get_current_context` | 获取当前时间、日期、工作制等 | 无 |
| `query_schedules` | 查询日程 | `start_date`, `end_date?` |
| `propose_action` | 提交审批操作 | `action_type`, `description`, `schedule_data` |

## 🎨 自定义配置

在 `lib/services/gpt_service.dart` 中可以调整：

- **API 配置**：`_apiKey`, `_endpoint`, `_model`
- **System Prompt**：修改 AI 的行为风格
- **睡眠建议逻辑**：`_getSleepSuggestion()` 函数

## 🚀 下一步计划

- [ ] 添加语音输入
- [ ] 支持批量操作审批
- [ ] 记忆用户偏好（几点起床、喜欢的运动时间等）
- [ ] 主动提醒（"该睡了"、"该起床了"）
