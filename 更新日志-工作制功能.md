# æ›´æ–°æ—¥å¿— - 2024-11-24

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ—¥å†ç•Œé¢ä¼˜åŒ–

#### 1.1 ä»…æ˜¾ç¤ºæœˆè§†å›¾
- âŒ ç§»é™¤äº†å‘¨è§†å›¾å’Œä¸¤å‘¨è§†å›¾é€‰é¡¹
- âœ… æ—¥å†ç°åœ¨åªæ˜¾ç¤ºæœˆè§†å›¾ï¼Œç•Œé¢æ›´ç®€æ´
- âœ… éšè—äº†æ ¼å¼åˆ‡æ¢æŒ‰é’®

**ä¿®æ”¹æ–‡ä»¶ï¼š** `lib/screens/calendar_screen.dart`
```dart
// ç§»é™¤äº† _calendarFormat å­—æ®µ
// è®¾ç½®ä¸ºå›ºå®šæœˆè§†å›¾
calendarFormat: CalendarFormat.month,
availableCalendarFormats: const {
  CalendarFormat.month: 'æœˆ',
},
```

---

### 2. ä¿®å¤æ—¥ç¨‹æ·»åŠ åŠŸèƒ½

#### 2.1 ä¿®å¤ Schedule æ„é€ å‡½æ•°
- âœ… ä¿®å¤äº†æ·»åŠ æ—¥ç¨‹æ—¶çš„å¤±è´¥é—®é¢˜
- âœ… åœ¨åˆ›å»ºæ–°æ—¥ç¨‹æ—¶æ·»åŠ äº†å¿…éœ€çš„é»˜è®¤å‚æ•° `isCompleted: false`

**ä¿®æ”¹æ–‡ä»¶ï¼š** `lib/screens/schedule_screen.dart`
```dart
Schedule(
  title: _titleController.text.trim(),
  description: ...,
  date: widget.date,
  startTime: startTime,
  endTime: endTime,
  isCompleted: false,  // æ·»åŠ äº†é»˜è®¤å‚æ•°
)
```

---

### 3. UI ä¼˜åŒ–

#### 3.1 åˆ é™¤æ—¥ç¨‹å±å¹•çš„ FAB
- âŒ ç§»é™¤äº†å³ä¸‹è§’çš„åœ†å½¢æ·»åŠ æŒ‰é’®
- âœ… ç•Œé¢æ›´åŠ ç®€æ´ï¼Œç¬¦åˆæ—¥ç¨‹è§„åˆ™åŒ–ç®¡ç†çš„ç†å¿µ

**ä¿®æ”¹æ–‡ä»¶ï¼š** `lib/screens/schedule_screen.dart`
```dart
// åˆ é™¤äº† floatingActionButton
```

---

### 4. å·¥ä½œåˆ¶ç®¡ç†ç³»ç»Ÿ ğŸ†•

#### 4.1 æ–°å¢å·¥ä½œåˆ¶ç±»å‹æšä¸¾

**æ–°å»ºæ–‡ä»¶ï¼š** `lib/models/work_schedule.dart`

æ”¯æŒä¸‰ç§å·¥ä½œåˆ¶ï¼š
- **å•ä¼‘**ï¼šåªæœ‰å‘¨æ—¥ä¼‘æ¯
- **åŒä¼‘**ï¼šå‘¨å…­å‘¨æ—¥éƒ½ä¼‘æ¯
- **å¤§å°å‘¨**ï¼šå¤§å‘¨2å¤©ä¼‘æ¯ï¼ˆå‘¨å…­å‘¨æ—¥ï¼‰ï¼Œå°å‘¨1å¤©ä¼‘æ¯ï¼ˆå‘¨æ—¥ï¼‰

```dart
enum WorkScheduleType {
  singleRest,   // å•ä¼‘
  doubleRest,   // åŒä¼‘
  biweekly,     // å¤§å°å‘¨
}

enum BiweeklyType {
  bigWeek,      // å¤§å‘¨ï¼ˆ2ä¼‘ï¼‰
  smallWeek,    // å°å‘¨ï¼ˆ1ä¼‘ï¼‰
}
```

#### 4.2 å·¥ä½œåˆ¶ç®¡ç†æœåŠ¡

**æ–°å»ºæ–‡ä»¶ï¼š** `lib/services/work_schedule_service.dart`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- âœ… æŒä¹…åŒ–å­˜å‚¨å·¥ä½œåˆ¶è®¾ç½®ï¼ˆä½¿ç”¨ SharedPreferencesï¼‰
- âœ… è‡ªåŠ¨åˆ¤æ–­å¤§å°å‘¨ï¼ˆæ ¹æ®å‘¨å…­æ—¥æœŸæ˜¯å¦ä¸ºå¶æ•°ï¼‰
- âœ… æ”¯æŒæ‰‹åŠ¨è®¾ç½®æŸå‘¨ä¸ºå¤§å‘¨æˆ–å°å‘¨
- âœ… æ ¹æ®å·¥ä½œåˆ¶åˆ¤æ–­æŸå¤©æ˜¯å¦ä¸ºä¼‘æ¯æ—¥

```dart
class WorkScheduleService {
  // è®¾ç½®å·¥ä½œåˆ¶ç±»å‹
  Future<void> setWorkScheduleType(WorkScheduleType type);
  
  // è®¾ç½®æŸå‘¨ä¸ºå¤§å‘¨æˆ–å°å‘¨
  Future<void> setBiweeklyType(DateTime weekStart, BiweeklyType type);
  
  // åˆ¤æ–­æŸå¤©æ˜¯å¦ä¸ºä¼‘æ¯æ—¥
  bool isRestDay(DateTime date);
  
  // è·å–å‘¨çš„æ—¥æœŸèŒƒå›´
  String getWeekRangeText(DateTime date);
}
```

#### 4.3 æ—¥å†å³ä¸Šè§’èœå•

**ä¿®æ”¹æ–‡ä»¶ï¼š** `lib/screens/calendar_screen.dart`

- âœ… æ·»åŠ äº†ä¸‰ç‚¹èœå•æŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼‰
- âœ… èœå•é€‰é¡¹ï¼šå•ä¼‘ã€å¤§å°å‘¨ã€åŒä¼‘

```dart
PopupMenuButton<WorkScheduleType>(
  icon: const Icon(Icons.more_vert),
  onSelected: (type) => _handleWorkScheduleChange(type),
  itemBuilder: (context) => [
    const PopupMenuItem(value: WorkScheduleType.singleRest, child: Text('å•ä¼‘')),
    const PopupMenuItem(value: WorkScheduleType.biweekly, child: Text('å¤§å°å‘¨')),
    const PopupMenuItem(value: WorkScheduleType.doubleRest, child: Text('åŒä¼‘')),
  ],
)
```

#### 4.4 å¤§å°å‘¨è®¾ç½®å¯¹è¯æ¡†

å½“ç”¨æˆ·é€‰æ‹©"å¤§å°å‘¨"æ—¶ï¼Œä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼š
- âœ… æ˜¾ç¤ºæœ¬å‘¨æ—¥æœŸèŒƒå›´ï¼ˆä¾‹å¦‚ï¼š11æœˆ18æ—¥ æ˜ŸæœŸä¸€ - 11æœˆ24æ—¥ æ˜ŸæœŸå¤©ï¼‰
- âœ… æä¾›ä¸¤ä¸ªæŒ‰é’®ï¼šå¤§å‘¨ï¼ˆ2ä¼‘ï¼‰ã€å°å‘¨ï¼ˆ1ä¼‘ï¼‰
- âœ… ç”¨æˆ·é€‰æ‹©åç«‹å³ç”Ÿæ•ˆ

```dart
AlertDialog(
  title: const Text('è®¾ç½®æœ¬å‘¨'),
  content: Column(
    children: [
      Text('æœ¬å‘¨æ—¥æœŸèŒƒå›´'),
      Text('11æœˆ18æ—¥ æ˜ŸæœŸä¸€ - 11æœˆ24æ—¥ æ˜ŸæœŸå¤©'),
      Text('æœ¬å‘¨æ˜¯ï¼š'),
    ],
  ),
  actions: [
    TextButton(child: Text('å–æ¶ˆ')),
    OutlinedButton(child: Text('å¤§å‘¨ï¼ˆ2ä¼‘ï¼‰')),
    FilledButton(child: Text('å°å‘¨ï¼ˆ1ä¼‘ï¼‰')),
  ],
)
```

---

### 5. ä¾èµ–æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶ï¼š** `pubspec.yaml`

æ·»åŠ äº†æ–°ä¾èµ–ï¼š
```yaml
dependencies:
  shared_preferences: ^2.3.3  # ç”¨äºæŒä¹…åŒ–å·¥ä½œåˆ¶è®¾ç½®
```

---

### 6. æœåŠ¡åˆå§‹åŒ–

**ä¿®æ”¹æ–‡ä»¶ï¼š** `lib/main.dart`

- âœ… æ·»åŠ äº† `WorkScheduleService` åˆ° Provider
- âœ… åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–å·¥ä½œåˆ¶æœåŠ¡

```dart
void main() async {
  // ...
  final workScheduleService = WorkScheduleService();
  await workScheduleService.init();
  
  runApp(
    MultiProvider(
      providers: [
        // ...
        Provider.value(value: workScheduleService),
      ],
      child: const MyApp(),
    ),
  );
}
```

---

## ğŸ“Š å·¥ä½œåˆ¶é€»è¾‘è¯´æ˜

### å¤§å°å‘¨è‡ªåŠ¨åˆ¤æ–­è§„åˆ™

**æ ¸å¿ƒé€»è¾‘**ï¼šå‘¨å…­çš„æ—¥æœŸæ˜¯å¶æ•°ä¸ºå¤§å‘¨

ä¾‹å¦‚ï¼š
- 2024å¹´11æœˆ23æ—¥ï¼ˆå‘¨å…­ï¼‰â†’ 23æ˜¯å¥‡æ•° â†’ **å°å‘¨**ï¼ˆåªä¼‘å‘¨æ—¥ï¼‰
- 2024å¹´11æœˆ30æ—¥ï¼ˆå‘¨å…­ï¼‰â†’ 30æ˜¯å¶æ•° â†’ **å¤§å‘¨**ï¼ˆä¼‘å‘¨å…­å‘¨æ—¥ï¼‰

```dart
BiweeklyType getBiweeklyType(DateTime date) {
  final saturday = weekStart.add(const Duration(days: 5));
  return saturday.day % 2 == 0 ? BiweeklyType.bigWeek : BiweeklyType.smallWeek;
}
```

### ä¼‘æ¯æ—¥åˆ¤æ–­é€»è¾‘

æ ¹æ®ä¸åŒå·¥ä½œåˆ¶åˆ¤æ–­ï¼š

**å•ä¼‘**ï¼š
```dart
return weekday == 7;  // åªæœ‰å‘¨æ—¥
```

**åŒä¼‘**ï¼š
```dart
return weekday == 6 || weekday == 7;  // å‘¨å…­å‘¨æ—¥
```

**å¤§å°å‘¨**ï¼š
```dart
if (biweeklyType == BiweeklyType.bigWeek) {
  return weekday == 6 || weekday == 7;  // å‘¨å…­å‘¨æ—¥
} else {
  return weekday == 7;  // åªæœ‰å‘¨æ—¥
}
```

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### åˆ‡æ¢å·¥ä½œåˆ¶

1. æ‰“å¼€æ—¥å†é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’çš„ä¸‰ç‚¹èœå•
3. é€‰æ‹©å·¥ä½œåˆ¶ç±»å‹ï¼š
   - **å•ä¼‘**ï¼šè‡ªåŠ¨åº”ç”¨ï¼Œå‘¨æ—¥ä¼‘æ¯
   - **åŒä¼‘**ï¼šè‡ªåŠ¨åº”ç”¨ï¼Œå‘¨å…­å‘¨æ—¥ä¼‘æ¯
   - **å¤§å°å‘¨**ï¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼Œé€‰æ‹©æœ¬å‘¨æ˜¯å¤§å‘¨è¿˜æ˜¯å°å‘¨

### è®¾ç½®å¤§å°å‘¨

1. é€‰æ‹©"å¤§å°å‘¨"èœå•é¡¹
2. æŸ¥çœ‹å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºæœ¬å‘¨æ—¥æœŸèŒƒå›´
3. é€‰æ‹©ï¼š
   - **å¤§å‘¨ï¼ˆ2ä¼‘ï¼‰**ï¼šæœ¬å‘¨å‘¨å…­å‘¨æ—¥éƒ½ä¼‘æ¯
   - **å°å‘¨ï¼ˆ1ä¼‘ï¼‰**ï¼šæœ¬å‘¨åªæœ‰å‘¨æ—¥ä¼‘æ¯
4. ä¸‹æ¬¡æ‰“å¼€æ—¶ä¼šè®°ä½è®¾ç½®

---

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- âœ… `lib/models/work_schedule.dart` - å·¥ä½œåˆ¶æ¨¡å‹
- âœ… `lib/services/work_schedule_service.dart` - å·¥ä½œåˆ¶ç®¡ç†æœåŠ¡

### ä¿®æ”¹æ–‡ä»¶
- âœ… `lib/screens/calendar_screen.dart` - æ·»åŠ å·¥ä½œåˆ¶èœå•
- âœ… `lib/screens/schedule_screen.dart` - åˆ é™¤FABï¼Œä¿®å¤æ·»åŠ æ—¥ç¨‹
- âœ… `lib/main.dart` - åˆå§‹åŒ–å·¥ä½œåˆ¶æœåŠ¡
- âœ… `pubspec.yaml` - æ·»åŠ  shared_preferences ä¾èµ–

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®æŒä¹…åŒ–

ä½¿ç”¨ `SharedPreferences` å­˜å‚¨å·¥ä½œåˆ¶é…ç½®ï¼š

```dart
// ä¿å­˜é…ç½®
final jsonStr = jsonEncode(_config.toMap());
await prefs.setString(_keyWorkSchedule, jsonStr);

// åŠ è½½é…ç½®
final jsonStr = prefs.getString(_keyWorkSchedule);
_config = WorkScheduleConfig.fromMap(jsonDecode(jsonStr));
```

### å‘¨è®¡ç®—é€»è¾‘

```dart
// è·å–å‘¨ä¸€æ—¥æœŸ
DateTime _getWeekStart(DateTime date) {
  final weekday = date.weekday;
  return DateTime(date.year, date.month, date.day)
    .subtract(Duration(days: weekday - 1));
}

// è·å–å‘¨æ—¥æ—¥æœŸ
DateTime getWeekEnd(DateTime date) {
  final weekday = date.weekday;
  return DateTime(date.year, date.month, date.day)
    .add(Duration(days: 7 - weekday));
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **é›†æˆåˆ°æ—¥ç¨‹ç”Ÿæˆ**
   - æ ¹æ®å·¥ä½œåˆ¶è‡ªåŠ¨ç”Ÿæˆå·¥ä½œæ—¥/ä¼‘æ¯æ—¥çš„æ—¥ç¨‹æ¨¡æ¿
   - åœ¨ `TemplateService` ä¸­ä½¿ç”¨ `WorkScheduleService` åˆ¤æ–­ä¼‘æ¯æ—¥

2. **UI å¢å¼º**
   - åœ¨æ—¥å†ä¸Šç”¨ä¸åŒé¢œè‰²æ ‡è®°å¤§å‘¨/å°å‘¨
   - æ˜¾ç¤ºå½“å‰å·¥ä½œåˆ¶çŠ¶æ€

3. **æ•°æ®åŒæ­¥**
   - æ”¯æŒäº‘ç«¯åŒæ­¥å·¥ä½œåˆ¶è®¾ç½®
   - è·¨è®¾å¤‡ä¿æŒä¸€è‡´

---

**æ›´æ–°æ—¶é—´**ï¼š2024-11-24  
**ç‰ˆæœ¬**ï¼š1.1.0
