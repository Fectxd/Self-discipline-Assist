# MSN å°æ—¶çº§å¤©æ°”æ•°æ®æå–

## æ¦‚è¿°

æˆåŠŸå®ç°äº†ä»MSNè·å–å°æ—¶çº§ï¼ˆé€å°æ—¶ï¼‰å¤©æ°”é¢„æŠ¥æ•°æ®çš„åŠŸèƒ½ã€‚MSNçš„å°æ—¶çº§å¤©æ°”æ•°æ®ä¸æ˜¯é€šè¿‡å•ç‹¬çš„APIè¿”å›ï¼Œè€Œæ˜¯åµŒå…¥åœ¨å°æ—¶é¢„æŠ¥é¡µé¢çš„HTMLä¸­ã€‚

## æ•°æ®æ¥æº

### é¡µé¢URL
```
https://www.msn.cn/zh-cn/weather/hourlyforecast/in-{latitude},{longitude}
```

ä¾‹å¦‚ï¼š
```
https://www.msn.cn/zh-cn/weather/hourlyforecast/in-39.103,117.158
```

### æ•°æ®ä½ç½®
æ•°æ®ä»¥JSONæ ¼å¼åµŒå…¥åœ¨HTMLé¡µé¢çš„ `<script>` æ ‡ç­¾ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š
```javascript
{
  "WeatherData": {
    "_@STATE@_": {
      "forecast": [
        {
          "hourly": [
            { /* å°æ—¶çº§å¤©æ°”æ•°æ® */ }
          ]
        }
      ]
    }
  }
}
```

## æ•°æ®ç»“æ„

### å°æ—¶çº§æ•°æ®å­—æ®µ

æ¯ä¸ªå°æ—¶çš„å¤©æ°”æ•°æ®åŒ…å«ï¼š

```javascript
{
  "time": "2025-12-18T14:00:00.000+08:00",  // æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰
  "temperature": 5,                          // æ¸©åº¦ï¼ˆÂ°Cï¼‰
  "feelsLike": 7,                           // ä½“æ„Ÿæ¸©åº¦ï¼ˆÂ°Cï¼‰
  "condition": "å¤§éƒ¨æ™´æœ—",                   // å¤©æ°”çŠ¶å†µ
  "symbol": "d100",                         // å¤©æ°”ç¬¦å·ä»£ç 
  "icon": "2",                              // å›¾æ ‡ä»£ç 
  "humidity": 52,                           // æ¹¿åº¦ï¼ˆ%ï¼‰
  "dewPoint": "-4Â°",                        // éœ²ç‚¹æ¸©åº¦
  "windSpeed": "13",                        // é£é€Ÿï¼ˆkm/hï¼‰
  "windDirection": 225,                     // é£å‘ï¼ˆåº¦æ•°ï¼‰
  "windDesc": "è¥¿å—é£",                     // é£å‘æè¿°
  "windGust": "21 å…¬é‡Œ/å°æ—¶",                // é˜µé£
  "airPressure": "1016",                    // æ°”å‹ï¼ˆhPaï¼‰
  "visibility": 3.4,                        // èƒ½è§åº¦ï¼ˆkmï¼‰
  "cloudCover": "18%",                      // äº‘é‡
  "rainAmount": 0,                          // é™é›¨é‡ï¼ˆmmï¼‰
  "snowAmount": 0,                          // é™é›ªé‡ï¼ˆmmï¼‰
  "uv": 1,                                  // ç´«å¤–çº¿æŒ‡æ•°
  "aqi": 133                                // ç©ºæ°”è´¨é‡æŒ‡æ•°
}
```

### æ•°æ®ç‰¹ç‚¹

- **æ—¶é—´è·¨åº¦**: çº¦226å°æ—¶ï¼ˆ9.4å¤©ï¼‰
- **æ—¶é—´é—´éš”**: æ¯å°æ—¶
- **æ•°æ®æ¥æº**: AccuWeather
- **æ›´æ–°é¢‘ç‡**: æ¯å°æ—¶æ›´æ–°

## ä½¿ç”¨æ–¹æ³•

### 1. ç›´æ¥ä½¿ç”¨æå–å™¨

```javascript
const { getHourlyWeather } = require('./msn-api');

// è·å–æŒ‡å®šåæ ‡çš„å°æ—¶çº§å¤©æ°”
const hourlyData = await getHourlyWeather(39.103, 117.158);

console.log(`æ€»å°æ—¶æ•°: ${hourlyData.totalHours}`);
console.log(`ä½ç½®: ${hourlyData.location.displayName}`);
console.log(`æœªæ¥24å°æ—¶:`, hourlyData.hourly.slice(0, 24));
```

### 2. è·å–å®Œæ•´å¤©æ°”ï¼ˆæ—¥çº§ + å°æ—¶çº§ï¼‰

```javascript
const { getCompleteWeather } = require('./complete-weather');

const weather = await getCompleteWeather();

// åŒ…å«:
// - weather.current: å½“å‰å¤©æ°”
// - weather.daily: æ—¥çº§é¢„æŠ¥ï¼ˆ5å¤©ï¼‰
// - weather.hourly: å°æ—¶çº§é¢„æŠ¥ï¼ˆ226å°æ—¶ï¼‰
// - weather.location: ä½ç½®ä¿¡æ¯
// - weather.airQuality: ç©ºæ°”è´¨é‡
```

## å®ç°ç»†èŠ‚

### æå–æµç¨‹

1. **è¯·æ±‚HTMLé¡µé¢**
   ```javascript
   const response = await axios.get(url);
   const html = response.data;
   ```

2. **æŸ¥æ‰¾æ•°æ®è„šæœ¬**
   ```javascript
   const scripts = html.match(/<script[^>]*>[\s\S]*?<\/script>/g);
   const dataScript = scripts.find(s => 
       s.includes('WeatherData') && 
       s.includes('forecast')
   );
   ```

3. **æå–JSON**
   ```javascript
   const jsonStart = dataScript.indexOf('{');
   const jsonEnd = dataScript.lastIndexOf('}');
   const jsonStr = dataScript.substring(jsonStart, jsonEnd + 1);
   const stateData = JSON.parse(jsonStr);
   ```

4. **è®¿é—®å¤©æ°”æ•°æ®**
   ```javascript
   const weatherData = stateData.WeatherData['_@STATE@_'];
   const allHourlyData = weatherData.forecast.flatMap(day => day.hourly || []);
   ```

### å…³é”®å‘ç°

1. **æ•°æ®ä¸åœ¨Feed APIä¸­**: MSNçš„Feed APIè¿”å›çš„å¤©æ°”æ•°æ®ä¸­ï¼Œ`hourly` å­—æ®µå§‹ç»ˆä¸ºç©ºæ•°ç»„ `[]`

2. **éœ€è¦è®¿é—®ä¸“é—¨é¡µé¢**: å¿…é¡»è®¿é—® `/hourlyforecast/` é¡µé¢æ‰èƒ½è·å–å°æ—¶çº§æ•°æ®

3. **æ•°æ®åœ¨HTMLä¸­**: æ•°æ®ä»¥æœåŠ¡ç«¯æ¸²æŸ“çš„æ–¹å¼åµŒå…¥HTMLï¼Œä¸æ˜¯é€šè¿‡å•ç‹¬çš„APIè°ƒç”¨è·å–

4. **ç‰¹æ®Šæ•°æ®é”®å**: å®é™…æ•°æ®å­˜å‚¨åœ¨ `WeatherData['_@STATE@_']` ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªReactçŠ¶æ€ç®¡ç†çš„ç‰¹æ®Šç»“æ„

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

- **`extract-hourly-weather.js`**: ç‹¬ç«‹çš„å°æ—¶çº§å¤©æ°”æå–å™¨
- **`msn-api.js`**: é›†æˆäº†æ—¥çº§å’Œå°æ—¶çº§å¤©æ°”çš„ç»Ÿä¸€API
- **`complete-weather.js`**: ç»¼åˆç¤ºä¾‹ï¼ŒåŒæ—¶è·å–æ‰€æœ‰å¤©æ°”æ•°æ®
- **`test-hourly-weather.js`**: æµ‹è¯•è„šæœ¬

### æ•°æ®æ–‡ä»¶

- **`data/hourly_weather_data.json`**: å°æ—¶çº§å¤©æ°”æ•°æ®ç¤ºä¾‹
- **`data/complete_weather.json`**: å®Œæ•´å¤©æ°”æ•°æ®ï¼ˆæ—¥çº§+å°æ—¶çº§ï¼‰

## ç¤ºä¾‹è¾“å‡º

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              å¤©æ°”ä¿¡æ¯æ‘˜è¦                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å½“å‰å¤©æ°”ã€‘
ä½ç½®: å¤©æ´¥å¸‚, å—å¼€åŒº
æ¸©åº¦: 5Â°C (ä½“æ„Ÿ 7Â°C)
å¤©æ°”: å¤§éƒ¨æ™´æœ—
æ¹¿åº¦: 52%
é£é€Ÿ: 13 (225)
ç©ºæ°”è´¨é‡: AQI 130 - è½»åº¦æ±¡æŸ“

ã€æœªæ¥3å¤©é¢„æŠ¥ã€‘
2025-12-18: 6Â°/0Â° æ™´æœ—
2025-12-19: 8Â°/1Â° å¤§éƒ¨æ™´æœ—
2025-12-20: 6Â°/-6Â° å±€éƒ¨æ™´æœ—

ã€ä»Šå¤©å‰©ä½™æ—¶é—´é¢„æŠ¥ã€‘
15:00 - 6Â° æ™´æœ— (ä½“æ„Ÿ6Â°)
16:00 - 5Â° æ™´æœ— (ä½“æ„Ÿ3Â°)
17:00 - 4Â° æ™´æœ— (ä½“æ„Ÿ3Â°)
18:00 - 3Â° æ™´æœ— (ä½“æ„Ÿ1Â°)
19:00 - 2Â° æ™´æœ— (ä½“æ„Ÿ1Â°)
20:00 - 2Â° æ™´æœ— (ä½“æ„Ÿ1Â°)

ã€ç»Ÿè®¡ä¿¡æ¯ã€‘
æ—¥çº§é¢„æŠ¥: 5 å¤©
å°æ—¶é¢„æŠ¥: 226 å°æ—¶
æœªæ¥24å°æ—¶æ¸©åº¦èŒƒå›´: 0Â° ~ 6Â°
```

## æŠ€æœ¯è¦ç‚¹

### ä¸ºä»€ä¹ˆä¸ç”¨Puppeteer

åˆæœŸå°è¯•ä½¿ç”¨PuppeteeræŠ“å–é¡µé¢ï¼Œä½†é‡åˆ°é—®é¢˜ï¼š
- é¡µé¢åŠ è½½è¶…æ—¶ï¼ˆ>60ç§’ï¼‰
- èµ„æºå ç”¨é«˜
- é€Ÿåº¦æ…¢

æ”¹ç”¨ç›´æ¥HTTPè¯·æ±‚ + HTMLè§£æåï¼š
- é€Ÿåº¦å¿«ï¼ˆ<2ç§’ï¼‰
- èµ„æºå ç”¨ä½
- æ›´ç¨³å®š

### è§£æç­–ç•¥

1. **å®½æ¾åŒ¹é…**: ä½¿ç”¨ `includes('WeatherData')` è€Œä¸æ˜¯ç²¾ç¡®çš„å…³é”®è¯ç»„åˆï¼Œæé«˜å…¼å®¹æ€§
2. **JSONæå–**: ä½¿ç”¨ `indexOf/lastIndexOf` è€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œé¿å…å¤æ‚çš„è½¬ä¹‰é—®é¢˜
3. **å®¹é”™å¤„ç†**: ä½¿ç”¨å¯é€‰é“¾ `?.` å’Œé»˜è®¤å€¼ï¼Œå¤„ç†æ•°æ®ç»“æ„å˜åŒ–

## åº”ç”¨åœºæ™¯

1. **å¤©æ°”é¢„æŠ¥åº”ç”¨**: æä¾›è¯¦ç»†çš„é€å°æ—¶å¤©æ°”å˜åŒ–
2. **å‡ºè¡Œè§„åˆ’**: æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„å¤©æ°”æƒ…å†µ
3. **æ•°æ®åˆ†æ**: åˆ†ææ¸©åº¦ã€æ¹¿åº¦ã€AQIçš„å°æ—¶çº§å˜åŒ–è¶‹åŠ¿
4. **è­¦æŠ¥ç³»ç»Ÿ**: ç›‘æµ‹æœªæ¥å‡ å°æ—¶çš„æ¶åŠ£å¤©æ°”
5. **APIæœåŠ¡**: ä½œä¸ºåç«¯æœåŠ¡æä¾›ç»™å‰ç«¯åº”ç”¨

## é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

1. **åæ ‡å¿…éœ€**: å¿…é¡»æä¾›å‡†ç¡®çš„ç»çº¬åº¦åæ ‡
2. **è¯·æ±‚é¢‘ç‡**: å»ºè®®ç¼“å­˜æ•°æ®ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
3. **HTMLè§£æ**: ä¾èµ–HTMLç»“æ„ï¼ŒMSNæ›´æ–°é¡µé¢ç»“æ„æ—¶å¯èƒ½éœ€è¦è°ƒæ•´
4. **æ•°æ®æ—¶æ•ˆ**: å°æ—¶çº§æ•°æ®å»ºè®®æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡

## ä¸‹ä¸€æ­¥æ”¹è¿›

1. âœ… é›†æˆIPå®šä½åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
2. âœ… æ”¯æŒæ—¥çº§å’Œå°æ—¶çº§æ•°æ®åŒæ—¶è·å–ï¼ˆå·²å®Œæˆï¼‰
3. ğŸ”² æ·»åŠ æ•°æ®ç¼“å­˜æœºåˆ¶
4. ğŸ”² å®ç°æ•°æ®å˜åŒ–ç›‘æ§
5. ğŸ”² å¢åŠ æ›´å¤šå¤©æ°”æŒ‡æ ‡åˆ†æ
6. ğŸ”² æ”¯æŒå¤šè¯­è¨€è¾“å‡º

## ç›¸å…³æ–‡æ¡£

- [IPå®šä½APIæ–‡æ¡£](./IP_LOCATION_API.md)
- [MSNå®šä½ä¿®æ­£](./MSN_LOCATION_CORRECTION.md)
- [é¡¹ç›®æ€»ç»“](./PROJECT_SUMMARY.md)
