"use strict";(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["money-info-service"],{25647:function(t,e,n){const r=n(47841),i=Symbol("max"),s=Symbol("length"),o=Symbol("lengthCalculator"),a=Symbol("allowStale"),u=Symbol("maxAge"),c=Symbol("dispose"),l=Symbol("noDisposeOnSet"),h=Symbol("lruList"),f=Symbol("cache"),d=Symbol("updateAgeOnGet"),w=()=>1;const m=(t,e,n)=>{const r=t[f].get(e);if(r){const e=r.value;if(y(t,e)){if(v(t,r),!t[a])return}else n&&(t[d]&&(r.value.now=Date.now()),t[h].unshiftNode(r));return e.value}},y=(t,e)=>{if(!e||!e.maxAge&&!t[u])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[u]&&n>t[u]},p=t=>{if(t[s]>t[i])for(let e=t[h].tail;t[s]>t[i]&&null!==e;){const n=e.prev;v(t,e),e=n}},v=(t,e)=>{if(e){const n=e.value;t[c]&&t[c](n.key,n.value),t[s]-=n.length,t[f].delete(n.key),t[h].removeNode(e)}};class g{constructor(t,e,n,r,i){this.key=t,this.value=e,this.length=n,this.now=r,this.maxAge=i||0}}const b=(t,e,n,r)=>{let i=n.value;y(t,i)&&(v(t,n),t[a]||(i=void 0)),i&&e.call(r,i.value,i.key,t)};t.exports=class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[i]=t.max||1/0;const e=t.length||w;if(this[o]="function"!=typeof e?w:e,this[a]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[u]=t.maxAge||0,this[c]=t.dispose,this[l]=t.noDisposeOnSet||!1,this[d]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[i]=t||1/0,p(this)}get max(){return this[i]}set allowStale(t){this[a]=!!t}get allowStale(){return this[a]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[u]=t,p(this)}get maxAge(){return this[u]}set lengthCalculator(t){"function"!=typeof t&&(t=w),t!==this[o]&&(this[o]=t,this[s]=0,this[h].forEach(t=>{t.length=this[o](t.value,t.key),this[s]+=t.length})),p(this)}get lengthCalculator(){return this[o]}get length(){return this[s]}get itemCount(){return this[h].length}rforEach(t,e){e=e||this;for(let n=this[h].tail;null!==n;){const r=n.prev;b(this,t,n,e),n=r}}forEach(t,e){e=e||this;for(let n=this[h].head;null!==n;){const r=n.next;b(this,t,n,e),n=r}}keys(){return this[h].toArray().map(t=>t.key)}values(){return this[h].toArray().map(t=>t.value)}reset(){this[c]&&this[h]&&this[h].length&&this[h].forEach(t=>this[c](t.key,t.value)),this[f]=new Map,this[h]=new r,this[s]=0}dump(){return this[h].map(t=>!y(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[h]}set(t,e,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,a=this[o](e,t);if(this[f].has(t)){if(a>this[i])return v(this,this[f].get(t)),!1;const o=this[f].get(t).value;return this[c]&&(this[l]||this[c](t,o.value)),o.now=r,o.maxAge=n,o.value=e,this[s]+=a-o.length,o.length=a,this.get(t),p(this),!0}const d=new g(t,e,a,r,n);return d.length>this[i]?(this[c]&&this[c](t,e),!1):(this[s]+=d.length,this[h].unshift(d),this[f].set(t,this[h].head),p(this),!0)}has(t){if(!this[f].has(t))return!1;const e=this[f].get(t).value;return!y(this,e)}get(t){return m(this,t,!0)}peek(t){return m(this,t,!1)}pop(){const t=this[h].tail;return t?(v(this,t),t.value):null}del(t){v(this,this[f].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const r=t[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const t=i-e;t>0&&this.set(r.k,r.v,t)}}}prune(){this[f].forEach((t,e)=>m(this,e,!1))}}},47841:function(t,e,n){function r(t){var e=this;if(e instanceof r||(e=new r),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach(function(t){e.push(t)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}function i(t,e){t.tail=new o(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function s(t,e){t.head=new o(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function o(t,e,n,r){if(!(this instanceof o))return new o(t,e,n,r);this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}t.exports=r,r.Node=o,r.create=r,r.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null},r.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},r.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},r.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)i(this,arguments[t]);return this.length},r.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)s(this,arguments[t]);return this.length},r.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},r.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},r.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,r=0;null!==n;r++)t.call(e,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,r=this.length-1;null!==n;r--)t.call(e,n.value,r,this),n=n.prev},r.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},r.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},r.prototype.map=function(t,e){e=e||this;for(var n=new r,i=this.head;null!==i;)n.push(t.call(e,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(t,e){e=e||this;for(var n=new r,i=this.tail;null!==i;)n.push(t.call(e,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(t,e){var n,r=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=t(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(t,e){var n,r=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=t(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},r.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},r.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,s=this.head;null!==s&&i<t;i++)s=s.next;for(;null!==s&&i<e;i++,s=s.next)n.push(s.value);return n},r.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,s=this.tail;null!==s&&i>e;i--)s=s.prev;for(;null!==s&&i>t;i--,s=s.prev)n.push(s.value);return n},r.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=e,this.tail=t,this};try{n(79417)(r)}catch(t){}},79417:function(t){t.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}},82486:function(t,e,n){n.d(e,{ChartPropsHelper:function(){return Ot},addToWatchlist:function(){return Mt},enableDisableMoneyCard:function(){return It},getAnalystRecommendation:function(){return Lt},getAutoSuggest:function(){return Dt},getChart:function(){return Z},getMarketMovers:function(){return Tt},getQuoteSummary:function(){return bt},getStockDueDiligence:function(){return St}});var r=n(65022),i=n(93468),s=n(81725),o=n(88294);class a{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}async function u(t,e){let{action:n,ids:r,cacheStore:i,getCacheId:s,fetchData:u,getItemId:c,transformer:l}=t;const h=performance.now(),{results:f,uncached:d}=function(t,e,n){const r=[],i=new Map;return t.forEach(t=>{const s=n(t),o=e.get(s);if(o)r.push(o);else{const n=new a;i.set(t,n),e.set(s,n.promise),r.push(n.promise)}}),{results:r,uncached:i}}(r,i,s);o.v.logSingleObject({FinanceServiceRawCached:{action:n,usage:i.itemCount,cached:r.length-d.size,missed:d.size}},!0),await async function(t,e,n,r,i,s){const o=[...t.keys()];if(o.length>0){try{(await r(o)).forEach(e=>{const n=i(e);var r;n&&(null===(r=t.get(n))||void 0===r||r.resolve(e),t.delete(n))})}catch(t){}for(const[r,i]of t.entries())i&&(i.resolve(null),s||e.del(n(r)))}}(d,i,s,u,c,e);const w=(await Promise.all(f)).filter(Boolean).map(l),m=(performance.now()-h).toFixed(2);return o.v.logSingleObject({FinanceSsrApiLatency:{duration:m,requestName:n,cache:!0,idLen:r.length}},!0),w}const c=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.__cache=new Map(Object.entries(t))}get(t){return this.__cache.get(t)}set(t,e){this.__cache.set(t,e)}keys(){return Array.from(this.__cache.keys())}has(t){return this.__cache.has(t)}clear(){this.__cache.clear()}delete(t){this.__cache.delete(t)}};var l=n(77246),h=n(17720);const f="r6dwop",d={"mr-in":"r6dwoq","es-xl":"r6dwrs","ar-eg":"r6dwo2","pl-pl":"r6dwpf","tr-tr":"r6dwoe","nl-nl":"r6dwnt","cs-cz":"r6dwok","fr-fr":"r6dwov","en-ie":"r6dwo7","de-de":"r6dwo8","es-cl":"r6dwoz","fr-be":"r6dwny","nb-no":"r6dwot","fi-fi":"r6dwoa","el-gr":"r6dwnv","nl-be":"r6dwny","en-au":"r6dwnu","en-sa":"r6dwpd","th-th":"r6dwnw","en-sg":"r6dwoy","en-nz":"r6dwos","en-us":"r6dwrs","de-at":"r6dwpg","hu-hu":"r6dwok","es-mx":"r6dwon","en-za":"r6dwof","da-dk":"r6dwo4","he-il":"r6dwp7","it-it":"r6dwoo","fr-ch":"r6dwp6","fr-ca":"r6dwpb","es-es":"r6dwnm","es-pe":"r6dwrs","es-co":"r6dwrs","ar-sa":"r6dwpd","id-id":"r6dwod","zh-cn":"r6dwp2","hi-in":"r6dwoq","zh-tw":"r6dwp8","ru-ru":"r6dwnp","ru-xl":"r6dwnp","ja-jp":"r6dwpa","pt-pt":"r6dwoi","en-ae":"r6dwns","pt-br":"r6dwnn","en-gb":"r6dwok","vi-vn":"r6dwp3","es-ve":"r6dwrs","bn-in":"r6dwoq","en-ca":"r6dwpb","zh-hk":"r6dwob","es-us":"r6dwrs","ar-xl":"r6dwpd","en-ph":"r6dwow","de-ch":"r6dwp6","en-xl":"r6dwoq","es-ar":"r6dwo1","ar-ae":"r6dwns","en-my":"r6dwog","sv-se":"r6dwp4","ko-kr":"r6dwoh","en-in":"r6dwoq","te-in":"r6dwoq"},w="GetMarketMovers_",m=["zh-cn"],y=/^c[1-9a-z]{4}$/;var p=n(17254),v=n(36090),g=n(19548),b=n(76166),T=n(12870),S=n(57759),k=n(19993),$=n(74326),C=n(25647),D=n.n(C);let E="",x="";function N(t,e,n,r){if("number"!=typeof t||Number.isNaN(t))return"-";const i=function(){if(x===p.T3.CurrentMarket&&E)return E;let t=p.T3.CurrentMarket??v.DX.ENUS;return["ar","bn","fa","mr","ne"].some(e=>t.startsWith(e))&&(t=v.DX.ENUS),"es-pe"===t&&(t="es"),E=t,x=p.T3.CurrentMarket,t}();let s={};if("object"==typeof e)s=e;else{if("number"==typeof e)s.minimumFractionDigits=e;else{if(!r&&Math.abs(t)<2)return R(t,i);s.minimumFractionDigits=2}s.maximumFractionDigits="number"==typeof n?n:s.minimumFractionDigits}return new Intl.NumberFormat(i,s).format(t)}const I=t=>(e,n,r)=>{if("number"!=typeof e||Number.isNaN(e))return"-";let i=t(e,n,r);return e>0&&(i="+"+i),i},A=N,M=I(A),q=I((t,e,n)=>{if("number"!=typeof t||Number.isNaN(t))return"-";return N(t,e,n,!0)+"%"});const R=(t,e)=>{let n="";const r=t.toFixed(20).match(/^-?\d*\.?0*\d{0,4}/);if(!r||!r[0])return n;const i=(n[0]/1).toLocaleString(e,{useGrouping:!1,maximumSignificantDigits:4}),s=(n[0]/1).toLocaleString(e,{useGrouping:!1,minimumFractionDigits:2});return n=t<1?i:"1"==i?s:i,n};function L(t){const e=new Date(t);if(isNaN(e.getTime()))return"";const n=e.getDate(),r=e.getMonth()+1,i=e.getUTCFullYear(),s=e.getUTCHours(),o=s<10?"0"+s:s.toString(),a=e.getUTCMinutes();return`${n}/${r}/${i} ${o}:${a<10?"0"+a:a.toString()} WEST`}const O="Finance/Charts",F="Finance/Cryptocurrency/chart",G="Finance/Quotes",P="Finance/ExchangeStatistics",z="Finance/Indices",Q="Finance/Cryptocurrency/quote",j="msn/v0/pages/finance/insights",U=100;async function W(t,e,n){const i=t&&t.filter(t=>t&&""!=t);if(!i||0===i.length)return[];const s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e=Math.max(e,0);const n=null==t?0:t.length;if(!n||e<1)return[];let r=0,i=0;const s=new Array(Math.ceil(n/e));for(;r<n;)s[i]=t.slice(r,r+e),r+=e,i++;return s}(Array.from(new Set(i)),U),o=await et("GET");o.cache="no-store";const a="getQuoteDetails";return(await Promise.all(s.map(async t=>{const i=ot(G);i.search=g._3.keyValueArrayToQueryString([...g._3.getParams(p.T3.ContentServiceUrlBase.search),...nt(),...rt(),{key:"ids",value:t.join(",")},{key:"wrapodata",value:"false"}]);const s=(0,S.w)(()=>K(i.href,o),a,e,n),u=await tt(s,a,i.href,r.vqE,r.TQI,r.TYe,Y);if(!u)return[];return X(u)}))).reduce((t,e)=>t.concat(e),[])}function J(t){return t.instrumentId}const H=new(D())({maxAge:12e4,max:5e4,length:()=>50});async function Z(t,e,n,r){if(e===s.NB.OneDayOneMinute)return _(t,e,r);const i=[],o=[];t.forEach(t=>{n.includes(t)?o.push(t):i.push(t)});return(await Promise.allSettled([_(i,e,r),V(o,e,r)])).reduce((t,e)=>"fulfilled"===e.status&&e.value?[...t,...e.value]:t,[])}async function _(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Y;return u({action:"getChart",ids:t,cacheStore:H,getCacheId:t=>`${p.T3.CurrentMarket}-${t}-${e}`,fetchData:t=>B(t,e),getItemId:J,transformer:at},arguments.length>2?arguments[2]:void 0)}async function V(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Y;return u({action:"getCryptoChart",ids:t,cacheStore:H,getCacheId:t=>`${p.T3.CurrentMarket}-${t}-${e}`,fetchData:t=>B(t,e,!0),getItemId:J,transformer:ut},arguments.length>2?arguments[2]:void 0)}const K=(()=>{if((0,l.S)())return window.fetch.bind(window);{const t=800;return(e,n)=>(0,b.hv)(e,t,n)}})();async function B(t,e,n){if(!t.length)return[];const i=ot(n?F:O),o=[...nt(),...rt(),{key:"ids",value:t.join(",")},{key:"type",value:e},{key:"wrapodata",value:"false"},{key:"chartflag",value:wt.toString()}];e===s.NB.OneDayOneMinute&&o.push({key:"allowempty",value:"true"}),i.search=g._3.keyValueArrayToQueryString(o);const a=await et("GET"),u=n?"getCryptoChart":"getChart",c=(0,S.w)(()=>K(i.href,a),u),l=await tt(c,u,i.href,n?r.F3o:r.zZP,n?r.vGW:r.vnd,n?r.T4B:r.TJS,Array.isArray);return null==l?[]:X(l)}function X(t){return Array.isArray(t[0])?t.map(t=>t[0]):t}function Y(t){return!!function(t){return null!=t}(t)&&(t.constructor===Array&&t.length>0)}const tt=async(t,e,n,r,s,o,a)=>{let u;try{u=await t}catch(t){return(0,i.vV)(r,`${e} fetch failed`,`${e}, fetch failed: ${t?t.message:""}`),null}if(!u.ok)return(0,i.vV)(s,`${e} http status not ok`,`${u.url}, http headers: ${JSON.stringify(u.headers)}, http status: ${u.statusText}`),null;const c=await u.json();return a(c)?c:((0,i.vV)(o,`${e} response json invalid`,`${u.url}, http headers: ${JSON.stringify(u.headers)}, response json invalid, response: ${JSON.stringify(c)}`),null)};function et(t){return k.WR.getBaseRequestData(t,{skipDualAuthHeader:!0})}function nt(){const t=(0,T.Th)().CurrentFlights;let e=t;t&&(e=t.split(",").filter(t=>t.includes("1s")).join(","));let n="finance-utils-peregrine";return["windowsNewsPlus","winWidgets","webWidgets"].includes(p.T3.AppType)&&(n="winp2"),k.WR.getOneServiceParamsWithoutAuth("",n,!1,e,!0)}function rt(){const t=h.vv.get("afdprotocol");return t?[{key:"afdprotocol",value:t}]:[]}const it="https://api.msn.com",st="https://api.msn.cn";function ot(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=(0,$.pN)();let r;return r=(0,l.S)()?e?n:p.T3.CurrentMarket===v.DX.ZHCN?st:it:it,new URL(t+n.search,r)}function at(t){Array.isArray(t)&&(t=t[0]);const e={...t};return t.preHoursSeries&&(e.preHoursSeries=ct(t.preHoursSeries)),t.afterHoursSeries&&(e.afterHoursSeries=ct(t.afterHoursSeries)),t.series&&(e.series=ct(t.series),e.changePcntNumber=function(t,e,n){const r=t.items||[],i=r[r.length-1].close,o=n===s.NB.OneDayOneMinute&&void 0!==e?e:r[0].close;if(0===o)return 0;return 100*(i/o-1)}(e.series,e.pricePreviousClose,e.chartType),e.changePcnt=q(e.changePcntNumber,2),e.pricePreviousCloseLoc=function(t,e,n){const r=pt(t,e,n);return A(t,r)}(e.pricePreviousClose,e.currency,e.securityType)),e.displayName=lt(t),e}function ut(t){var e;const n=at(t);return n.securityType=s.tr.Cryptocurrency,n.shortName=t.name,n.pricePreviousClose=null===(e=n.series.items[0])||void 0===e?void 0:e.open,n}function ct(t){const e=[];for(let n=0;n<t.timeStamps.length;n++)e.push({date:t.timeStamps&&ft(t.timeStamps[n]),open:t.openPrices&&dt(t.openPrices[n]),close:t.prices&&dt(t.prices[n]),high:t.pricesHigh&&dt(t.pricesHigh[n]),low:t.pricesLow&&dt(t.pricesLow[n]),volume:t.volumes&&dt(t.volumes[n])});return{priceHigh:t.priceHigh,priceLow:t.priceLow,startTime:ft(t.startTime),endTime:ft(t.endTime),items:e}}function lt(t){return t.securityType==s.tr.Cryptocurrency?(null==t?void 0:t.name)||(null==t?void 0:t.displayName):t.securityType==s.tr.Currency?(null==t||null===(e=t.localizedAttributes)||void 0===e||null===(e=e[p.T3.CurrentMarket])||void 0===e?void 0:e.symbolName)??t.displayName:(null==t||null===(n=t.localizedAttributes)||void 0===n||null===(n=n[p.T3.CurrentMarket])||void 0===n?void 0:n.displayName)??t.displayName;var e,n}function ht(t){return t.securityType==s.tr.Cryptocurrency?(null==t?void 0:t.name)||(null==t?void 0:t.shortName):t.securityType==s.tr.Currency?(null==t||null===(e=t.localizedAttributes)||void 0===e||null===(e=e[p.T3.CurrentMarket])||void 0===e?void 0:e.symbolName)??t.shortName:null==t||null===(n=t.localizedAttributes)||void 0===n||null===(n=n[p.T3.CurrentMarket])||void 0===n?void 0:n.shortName;var e,n}function ft(t){return t?t.endsWith("Z")?new Date(t):new Date(t+"Z"):new Date}function dt(t){if(!("number"!=typeof t||t<0))return t}const wt=7;function mt(t){return t.map(t=>t.instrumentId)}async function yt(t){const e=ot(P),n=p.T3.CurrentMarket;let i=null;if(t&&(i=await async function(t){if(!t||0===t.length)return[];const e=ot(z);e.search=g._3.keyValueArrayToQueryString([...g._3.getParams(p.T3.ContentServiceUrlBase.search),...nt(),...rt(),{key:"ids",value:t.join(",")},{key:"wrapodata",value:"false"}]);const n=await et("GET");n.cache="no-store";const i="getIndices",s=(0,S.w)(()=>K(e.href,n),i),o=await tt(s,i,e.href,r.CYA,r.GPf,r.ok3,Y);if(!o)return[];return X(o)}([t])),!i||!i[0]||!i[0].active&&!i[0].gainers&&!i[0].losers){const t=d[n]||f;e.search=g._3.keyValueArrayToQueryString([...g._3.getParams(p.T3.ContentServiceUrlBase.search),...nt(),...rt(),{key:"ids",value:t},{key:"wrapodata",value:"false"}]);const s="getMostActiveQuotes",o=await et("GET");o.cache="no-store";const a=(0,S.w)(async()=>K(e.href,o),s);i=await tt(a,s,e.href,r.$u$,r.vce,r.zSi,t=>Y(t)&&Y(t[0].active))}return null==i?{active:[],gainers:[],losers:[]}:{active:mt(i[0].active),gainers:mt(i[0].gainers),losers:mt(i[0].losers)}}function pt(t,e,n){if("KRW"===e)return 0;if(t>=1)return 2;const r=n===s.tr.Currency?3:2,i=t>=.01?r:2+((o=t)>=1?0:-1*Math.floor(Math.log(o)/Math.log(10)+1));var o;return Math.max(r,i)}function vt(t){const e="KRW"===t.currency?0:2,n=pt(t.price,t.currency,t.securityType);return{id:t.instrumentId,quoteId:t.instrumentId,symbol:t.symbol,price:A(t.price,n),priceNumber:t.price,changeValue:M(t.priceChange,e),changeValueNumber:t.priceChange,changePcnt:q(t.priceChangePercent),changePcntNumber:t.priceChangePercent,displayName:lt(t),exchangeName:t.exchangeName,exchangeId:t.exchangeId,quoteHref:t.quoteHref,formatedUpdateTime:L(t.timeLastUpdated),timeLastUpdated:new Date(t.timeLastUpdated),timeLastTraded:t.timeLastTraded,gain:t.priceChangePercent>0,unchanged:void 0===t.priceChangePercent||0===t.priceChangePercent,securityType:t.securityType,currency:t.currency,icon:t.icon,shortName:ht(t)}}const gt=new(D())({maxAge:3e4,max:5e4,length:()=>50});async function bt(t){return u({action:"getQuoteDetails",ids:t,cacheStore:gt,getCacheId:t=>`${p.T3.CurrentMarket}-${t}`,fetchData:t=>W(t),getItemId:J,transformer:vt})}function Tt(t){const e=t?`${w}${t}`:w;return c.get(e)||c.set(e,yt(t)),c.get(e)}async function St(t){if(null==t||!t.length)return[];const e=ot(j);e.search=g._3.keyValueArrayToQueryString([...g._3.getParams(p.T3.ContentServiceUrlBase.search),...nt(),...rt(),{key:"ids",value:t},{key:"wrapodata",value:"false"}]);const n=await et("GET"),i="getStockDueDiligence",s=(0,S.w)(()=>K(e.href,n),i),o=await tt(s,i,e.href,r.$6m,r.ver,r.ne8,Y);return o||[]}var kt=n(84665),$t=n(27261);class Ct{get __type_mapping(){return{RT00S:"realTimeSymbol",OS001:"equitySymbol",OS01W:"companyName",RT0SN:"shortName",FullInstrument:"fullInstrument",OS0LN:"longName",OS010:"entityType",OS01V:"languageCode",RT00T:"realTimeSecurityType",RT0EC:"realTimeCountryCode",ExMicCode:"realTimeMsListingExchangeCode",OS05J:"realTimeIsin",AC040:"exchangeName",RT00E:"realTimeExchange",LS01Z:"exchangeCode",FriendlyName:"friendlyName",DisplayName:"displayName",SecId:"quoteId"}}}async function Dt(t,e){const n=p.T3.CurrentMarket||"en-us",i=`/api/v1/Query?query=${encodeURIComponent(t)}&market=${n}&count=${e}`;let s;try{s=await K(function(t,e,n){let r;return r=(0,$t.ou)().startsWith("localhost.msn.com")?`https://${t}.${e}.microsoft-testing-falcon.io`:`https://services.bingapis.com/${e}.${t}`,r+n}("csautosuggest","contentservices-finance",i),{method:"GET"})}catch(i){return kt.aC.logExceptionWithFormat(i,r.c98,"Error fetching finance auto suggest data v2","MoneyInfoService",`query: ${t}, market: ${n}, count: ${e}`),[]}if(!s||!s.ok)return[];let o=(await s.json()).data.stocks.map(t=>JSON.parse(t));return m.includes(n)&&(o=o.filter(t=>"CR"!==t.OS010)),o.map(t=>function(t,e){const n="string"==typeof t?JSON.parse(t):t,r=new e;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r.__type_mapping[t]?Reflect.set(r,r.__type_mapping[t],n[t]):Reflect.set(r,t,n[t]));return r}(t,Ct))}var Et=n(69089),xt=n(86948),Nt=n(48622);async function It(t){try{return await Nt.d.updateSegmentCardsEnableStatus([{cardType:Et.s.FinanceCard,enabled:t}]),!0}catch(t){return kt.aC.logExceptionWithFormat(t,r.xco,"Finance user settings update failed","MoneyInfoService"),!1}}async function At(t){const e=null!=(n=t)&&y.test(n)?await async function(t,e){const n=t&&t.filter(t=>t&&""!=t);if(!n||0===n.length)return[];const i=e||"",s=ot(Q);s.search=g._3.keyValueArrayToQueryString([...g._3.getParams(p.T3.ContentServiceUrlBase.search),...nt(),...rt(),{key:"ids",value:n.join(",")},{key:"wrapodata",value:"false"},{key:"currency",value:i}]);const o=await et("GET");o.cache="no-store";const a="getQuoteDetails",u=(0,S.w)(()=>K(s.href,o),a),c=await tt(u,a,s.href,r.jKP,r.z2i,r.R$T,Y);return c?X(c):[]}([t]):await W([t]);var n;return e[0]&&e[0].securityType?function(t){switch(t){case s.tr.Stocks:return 0;case s.tr.ETF:return 1;case s.tr.Indices:return 3;case s.tr.Funds:return 4;case s.tr.Currency:return 5;case s.tr.Commodity:return 6;default:return 0}}(e[0].securityType):0}async function Mt(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(2===await(0,xt.XK)())&&!i)return!1;if(!t)return kt.aC.logErrorWithFormat(r.PzM,"Error adding to watchlist","QuoteId is undefined"),!1;const s=await Nt.d.addToWatchList(t,await At(t),e,n);return s||kt.aC.logErrorWithFormat(r.PzM,"Error adding to watchlist","Add to watchlist request failed"),s}function qt(t){const e=t&&t.analysis&&t.analysis.estimate;return e&&{...e,recommendation:s.O3[e.recommendation],dateLastUpdated:Rt(t.analysis.estimate.dateLastUpdated),analystRecommendationNumber:e.analystRecommendation,numberOfPriceTargets:e.numberOfPriceTargets,pricevolatilityDateLastUpdated:Rt(t.analysis.estimate.pricevolatilityDateLastUpdated),industryDateLastUpdated:Rt(t.analysis.estimate.industryDateLastUpdated)}}function Rt(t){return t?new Date(function(t){return t?(t.toLowerCase().endsWith("z")||(t+="Z"),Date.parse(t)):0}(t)):new Date}async function Lt(t){return(await async function(t){if(!t||0===t.length)return Promise.resolve([]);const e=ot("Finance/Equities");e.search=g._3.keyValueArrayToQueryString([...nt(),{key:"ids",value:t.join(",")},{key:"wrapodata",value:"false"}]);const n=await et("GET"),i="getEquities",s=(0,S.w)(()=>K(e.href,n),i),o=await tt(s,i,e.href,r._gF,r.IEz,r.kyM,Y);return null==o?[]:X(o)}([t])).map(qt)[0]}class Ot{static aggregateChart(t,e,n,r){const{startTime:i,endTime:o,chartEndTime:a}=this.calculateTimes(t);let u=i.time;const c=this.generateTimeSpan(n);let l=[];const h=t.filter(t=>{var e;return(null===(e=t.series)||void 0===e||null===(e=e.items)||void 0===e?void 0:e.length)>0}).map(t=>{const e=t.series.items.filter(t=>t.date.getTime()>=i.time.getTime()).map(t=>({...t,timestamp:t.date.getTime()}));return{...t,series:{...t.series,startTimestamp:t.series.startTime.getTime(),endTimestamp:t.series.endTime.getTime(),items:e,sortedItems:[...e].sort((t,e)=>e.timestamp-t.timestamp)}}});for(;u.getTime()<=o.time.getTime();){if(!this.isCloseTime(t,u,n,c)){const t={date:u,close:0,open:0,high:0,low:0,volume:0,total:0},e=u.getTime();h.map(r=>{if(r.series.startTimestamp<=e&&(r.series.endTimestamp>=e||e-r.series.endTimestamp<=c)){let i=r.series.items[0].close;n!==s.NB.OneDayOneMinute&&n!==s.NB.OneDayFiveMinute||(i=r.pricePreviousClose);const o=r.series.sortedItems.find(t=>t.timestamp<=e);o&&(t.close+=o.close/i,t.total+=1)}}),t.total>0&&l.push({date:t.date,close:100*t.close/t.total-100})}const e=u.getTime();u=n!==s.NB.All?new Date(u.getTime()+c):this.nextMonthLastDay(u),e<o.time.getTime()&&u.getTime()>o.time.getTime()&&(u=o.time)}const f=l.map(t=>t.close),d=Math.max(...f),w=Math.min(...f);if(r){const t=l[l.length-1],e=l.filter(e=>e.date.getFullYear()!==t.date.getFullYear()),n=l.filter(e=>e.date.getFullYear()===t.date.getFullYear());if(e.length>0&&n.length>0){const t=e[e.length-1];l=n.map(e=>({date:e.date,close:e.close-t.close}))}}const m={startTime:i.time,endTime:a.time,items:l,priceHigh:d,priceLow:w};return{...t[0],pricePreviousClose:0,series:m,symbol:e,instrumentId:e}}static calculateTimes(t){const e=[],n=[],r=[];t.forEach(t=>{var i,s;if(null!=t&&null!==(i=t.series)&&void 0!==i&&i.endTime){const n=e.find(e=>e.time.getTime()===t.series.endTime.getTime());n?n.total+=1:e.push({time:t.series.endTime,total:1}),e.sort((t,e)=>e.time.getTime()-t.time.getTime())}if((null==t||null===(s=t.series)||void 0===s||null===(s=s.items)||void 0===s?void 0:s.length)>0){const e=t.series.items,i=n.find(t=>t.time.getTime()===e[0].date.getTime());i?i.total+=1:n.push({time:e[0].date,total:1}),n.sort((t,e)=>e.time.getTime()-t.time.getTime());const s=r.find(t=>t.time.getTime()===e[e.length-1].date.getTime());s?s.total+=1:r.push({time:e[e.length-1].date,total:1}),r.sort((t,e)=>e.time.getTime()-t.time.getTime())}});let i={...n[0]};n.forEach(t=>{t.total>i.total&&(i={...t})});let s={...r[0]};r.forEach(t=>{t.total>=s.total&&(s={...t})});let o={...e[0]};return e.forEach(t=>{t.total>=o.total&&(o={...t})}),{startTime:i,endTime:s,chartEndTime:o}}static generateTimeSpan(t){const e=6e4;switch(t){case s.NB.OneDayOneMinute:return e;case s.NB.OneDayFiveMinute:return 3e5;case s.NB.FiveDays:return 9e5;case s.NB.OneMonth:case s.NB.OneYear:return 864e5;case s.NB.FiveYear:return 6048e5;default:return e}}static isCloseTime(t,e,n,r){if(n===s.NB.OneDayFiveMinute||n==s.NB.OneDayOneMinute)return!1;let i=!1;if(n===s.NB.FiveDays){const n=[],s=[];if(t.forEach(t=>{var r;if((null==t||null===(r=t.series)||void 0===r?void 0:r.items.length)>0){const r=[...t.series.items],i=r.find(t=>t.date.getTime()>=e.getTime()),o=r.reverse().find(t=>t.date.getTime()<=e.getTime());if(o){const t=n.find(t=>t.time.getTime()===o.date.getTime());t?t.total+=1:n.push({time:o.date,total:1}),n.sort((t,e)=>e.time.getTime()-t.time.getTime())}if(i){const t=s.find(t=>t.time.getTime()===i.date.getTime());t?t.total+=1:s.push({time:i.date,total:1}),s.sort((t,e)=>e.time.getTime()-t.time.getTime())}}}),n&&0!==n.length&&s&&0!==s.length){let t=n[0];n.forEach(e=>{e.total>=t.total&&(t={...e})});let o=s[0];s.forEach(t=>{t.total>o.total&&(o={...t})}),(e.getTime()-t.time.getTime()>r||o.time.getTime()-e.getTime()>r)&&(i=!0)}else i=!0}return i}static nextMonthLastDay(t){let e=t.getFullYear(),n=t.getMonth()+2;return n>12&&(n-=12,e+=1),new Date(e,n,0,t.getHours(),t.getMinutes(),t.getSeconds())}}}}]);