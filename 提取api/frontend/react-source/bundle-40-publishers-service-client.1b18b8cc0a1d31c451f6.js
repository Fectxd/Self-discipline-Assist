"use strict";(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["msnews/publishers-service-client"],{57863:function(e,t,i){i.d(t,{al:function(){return d},XN:function(){return u},No:function(){return l}});var n=i(28868),r=i(1350);function s(e,t){if(function(e){try{return(null==e?void 0:e.needHeader)??!1}catch(e){a(`Failed to get feed needHeader Failed with exception : ${e}`)}}(e))try{const e=JSON.parse(t),i=JSON.parse((null==e?void 0:e.header)??null),n=(null==i?void 0:i["ddd-activityid"])??null;n&&async function(e){const t=window.localStorage.getItem(o);if(void 0!==t&&""!==t&&null!==t){const i=t.split(",");return void(i.length<10&&!i.includes(e)&&window.localStorage.setItem(o,`${t},${e}`))}window.localStorage.setItem(o,e)}(n)}catch(e){a(`Failed to get feed needHeader Failed with exception : ${e}`)}}const o="activityIds";function a(e){(0,n.RH)()&&function(e){new Promise((t,i)=>{!function(e,t){(0,n.lA)("logEvent",e,t)}(e,e=>{t(e)})})}({appId:r.H7,type:"Debug",name:"HP_WEBVIEW_SERVER_LOG",data:{message:e}})}function u(e){return new Promise((t,i)=>{!function(e,t){(0,n.lA)("getHttp",e,t)}(e,i=>{t(i),s(e,i)})})}function l(e){return new Promise((t,i)=>{!function(e,t){(0,n.lA)("postHttp",e,t)}(e,e=>{t(e)})})}function d(e){return new Promise((t,i)=>{!function(e,t){(0,n.lA)("deleteHttp",e,t)}(e,e=>{t(e)})})}},69023:function(e,t,i){var n;i.d(t,{y:function(){return n},PublisherServiceClient:function(){return v}}),function(e){e.More="More",e.Mute="Mute",e.Read="Read"}(n||(n={}));var r=i(85889),s=i(12870),o=i(17254),a=i(74326),u=i(19993),l=i(57759),d=i(56639),c=i(28868),h=i(64405),w=i(57863),f=i(29252),y=i(86948);class v{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.fetchImpl=e,this.addPageInfoToOcid=t,this.followedPublishersEndpoint="v1/News/Users/Me/PreferredProviders",this.followedSourcesEndpoint="msn/sources",this.publishersServiceEndpoint="Msn/Providers",this.actionsServiceEndpoint="Graph/Actions",this.followActionSourceEndpoint="community/follows",this.ocid="feeds"}getOcid(){return this.ocid}async getUserMutedPublishers(){const e=await this.getUserActions(n.Mute);if(!e||!e.value)return null;if(!e.value.length)return[];const t=e.value.reduce((e,t)=>(e[t.targetId]=t,e),{}),i=await this.getPublisherDetails(Object.keys(t));if(!i||!i.value||!i.value.length)return null;return i.value.map(e=>{const i={createdDateTime:t[e.id].createdDateTime};return{...e,...i}})}async getUserFollowedPublishers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const t=await this.getRequestInit(),i=[...await this.getCommonParams(),{key:"$top",value:`${e}`}],n=(0,a.nI)(this.followedPublishersEndpoint);this.appendQs(i,n),(0,r.Iv)()||(0,f.P7)(n);const s=await this.sendRequest(decodeURIComponent(n.href),t,"getFollowedPublishers");return null==s?void 0:s.value}async getUserFollowedSources(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const n=await this.getRequestInit(),s=[...await this.getCommonParams(),{key:"$top",value:`${i}`},{key:"queryType",value:"MyFeed"}],o=(0,a.nI)(this.followedSourcesEndpoint);let u;this.appendQs(s,o),(0,r.Iv)()||(0,f.P7)(o);try{u=await this.sendRequest(decodeURIComponent(o.href),n,"getFollowedSources")}catch(e){throw new Error(`{url: ${o.href}}`)}return(null===(e=u)||void 0===e||null===(e=e.value)||void 0===e?void 0:e.length)>0?null===(t=u)||void 0===t||null===(t=t.value[0])||void 0===t?void 0:t.subCards.map(e=>{var t;const i=e.intAttributes&&1==e.intAttributes.disableProfile;return{...e,profileId:i?null:e.profileId,displayName:e.name,logos:[{imageLink:{href:null===(t=e.image)||void 0===t?void 0:t.url}}]}}):[]}async publisherUserAction(e,t,i){if(!e||!t)return null;const n=await this.getRequestInit();n.method=i;let r=await this.getCommonParams();"POST"===i?n.body=JSON.stringify({actionType:t,targetId:e,targetType:"SourceProvider"}):"DELETE"===i&&(r=[...r,{key:"$filter",value:`actionType eq '${t}' and targetId eq '${e}'`}]);const s=(0,a.nI)(this.actionsServiceEndpoint);this.appendQs(r,s);const o=await this.sendRequest(decodeURIComponent(s.href),n,`deleteUserAction ${t}`,!0,!0);if(o.status>=400){const i=`OneService returned error response. Status: ${o.status} for actionType: ${t}, targetId: ${e}`;throw new Error(i)}return o}async updateSourceFollowState(e,t,i){if(!e)return null;const n=await this.getRequestInit();let r=await this.getCommonParams();r=[...r],t?(n.method="POST",n.body=JSON.stringify({targetId:e})):(n.method="DELETE",r=[...r,{key:"targetId",value:e}]),i&&s.Rb.CurrentFlightSet.has("prg-followdata-t")&&r.push({key:"communitymetadata",value:`itemid:${(null==i?void 0:i.contentId)||"undefined"},lineage:${(null==i?void 0:i.actionPosition)||`${o.T3.AppType}>PublisherServiceClient>UndefinedLineage`}`});const u=(0,a.nI)(this.followActionSourceEndpoint);this.appendQs(r,u);const l=t?"follow":"unfollow";try{return await this.sendRequest(decodeURIComponent(u.href),n,`updateSourceFollowState ${l}`,!0,!0)}catch(t){throw new Error(`OneService returned error response. Community follow service  for targetId: ${e}, action: ${l}`)}}async updatePublisherReadTime(e,t,i){if(!e)return null;const r=await this.getRequestInit(),s=await this.getCommonParams(),o=n.Read;r.method="POST",r.body=JSON.stringify({actionType:o,targetType:i,targetId:e,updatedDateTime:t});const u=(0,a.nI)(this.actionsServiceEndpoint);this.appendQs(s,u);try{return await this.sendRequest(decodeURIComponent(u.href),r,`updateSourceReadTime ${o}`,!0,!0)}catch(t){throw new Error(`OneService returned error response for actionType: ${o}, targetId: ${e}`)}}async getUserPublishersReadTimes(){try{const e=await this.generatePublisherStatusRequest(void 0,n.Read);return null==e?void 0:e.value}catch(e){throw new Error("OneService returned error response for fetching followed sources read times.")}}async getUserPublisherStatus(e,t){var i;return!(null===(i=(await this.generatePublisherStatusRequest(e,t)).value)||void 0===i||!i.length)}async generatePublisherStatusRequest(e,t){const i=await this.getRequestInit();i.method="GET";const n=e?`and targetId eq '${e}'`:"";let s=await this.getCommonParams();s=[...s,{key:"$filter",value:`actionType eq '${t}' ${n} `}];const o=(0,a.nI)(this.actionsServiceEndpoint);return this.appendQs(s,o),(0,r.Iv)()||(0,f.P7)(o),await this.sendRequest(decodeURIComponent(o.href),i,`getUserPublisherStatus ${t}`)}async getUserActions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const i=await this.getRequestInit(),n=[...await this.getCommonParams(),{key:"$filter",value:`actionType eq '${e}' and deleted eq false and targetType eq 'SourceProvider'`},{key:"$top",value:`${t}`}],s=(0,a.nI)(this.actionsServiceEndpoint);return this.appendQs(n,s),(0,r.Iv)()||(0,f.P7)(s),await this.sendRequest(decodeURIComponent(s.href),i,`getUserActions ${e}`)}async getPublisherFromProfileIds(e){const t=await this.getRequestInit(),i=(0,a.nI)(this.followedSourcesEndpoint),n=[...u.WR.getOneServiceParamsWithoutAuth(null,this.ocid,this.addPageInfoToOcid),{key:"ids",value:e.join(",")}];return this.appendQs(n,i),await this.sendRequest(decodeURIComponent(i.href),t,"getSourcesFromProfileIds")}async getPublisherDetails(e){const t=await this.getRequestInit(),i=(0,a.nI)(this.publishersServiceEndpoint),n=[...u.WR.getOneServiceParamsWithoutAuth(null,this.ocid,this.addPageInfoToOcid),{key:"ids",value:e.join(",")}];return this.appendQs(n,i),await this.sendRequest(decodeURIComponent(i.href),t,"getPublisherDetails")}async getCommonParams(){var e;"winWidgets"===o.T3.AppType&&("startfeed"===(null===(e=o.T3.CurrentRequestTargetScope)||void 0===e?void 0:e.pageType)&&"ruby"===o.T3.UxMode?(this.ocid="rubyprong2",this.addPageInfoToOcid=!1):(this.ocid="winp2",this.addPageInfoToOcid=!1));if("windowsShell"===o.T3.AppType&&(this.ocid="windows-windowsshellhp-feeds",this.addPageInfoToOcid=!1),(0,r._v)()&&(this.addPageInfoToOcid=!1,this.ocid="emmx-mmx-feeds"),(0,r.Iv)())return this.getSapphireQueryParams();this.forcedApiKey&&(this.addPageInfoToOcid=!1),(0,r.tl)()&&(this.ocid="swiftkey-umf",this.addPageInfoToOcid=!1),(0,r.V8)()&&(this.ocid="bing-dhp-mobile",this.addPageInfoToOcid=!1),"bingHomepage"===o.T3.AppType&&(this.ocid="bing-widgetfeed-Peregrine",this.addPageInfoToOcid=!1);const t=await this.isUserSignedIn()?u.WR.getOneServiceParamsWithAuth(o.T3.UserId||o.T3.ActivityId,this.ocid,this.addPageInfoToOcid):u.WR.getOneServiceParamsWithoutAuth(o.T3.UserId||o.T3.ActivityId,this.ocid,this.addPageInfoToOcid);if(this.forcedApiKey){t.find(e=>"apikey"==e.key).value=this.forcedApiKey}return t}getSapphireQueryParams(){const e=u.WR.getOneServiceNonDynamicParamsWithoutAuth(this.ocid,this.addPageInfoToOcid,o.T3.UserId||o.T3.ActivityId),t=(0,d.cE)();return t&&(e.push({key:o.T3.OneServiceContentMarketQspKey,value:t.market}),o.T3.ShouldUseFdheadQsp&&e.push({key:"fdhead",value:t.features}),e.push({key:"activityId",value:t.activityId}),t.latitude&&t.longitude&&e.push({key:"location",value:`${t.latitude}|${t.longitude}`})),e}async getRequestInit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==e&&(e={method:"GET"}),e.credentials="include",e.headers=(0,c.RH)()?await(0,h.U)():await u.WR.getOneServiceHeaders(),e}async isUserSignedIn(){const e=(0,s.Th)().UserIsSignedIn;if(void 0!==e)return e;return 2===await(0,y.XK)()}async sendRequest(e,t,i,n,s){return(0,r.Iv)()?await this.sapphireRequest(decodeURIComponent(e),t):await this.networkRequest(decodeURIComponent(e),t,i,n,s)}async sapphireRequest(e,t){const i={url:e,headers:t.headers,body:t.body,refresh:!0,needHeader:!0,needCookie:!0};let n;switch(t.method){case"POST":n=await(0,w.No)(i);break;case"DELETE":n=await(0,w.al)(i);break;default:n=await(0,w.XN)(i)}return JSON.parse(n||"{}")}async networkRequest(e,t,i,n,r){return(0,l.w)(async()=>{const i=await this.fetchImpl(e,t);if(!i.ok)throw Error(i.statusText);return n&&(0,f.r8)(),r?i:i.json()},i)}appendQs(e,t){e.forEach(e=>{e.value&&t.searchParams.set(e.key,e.value)})}setForcedApiKey(e){this.forcedApiKey=e}}}}]);