"use strict";(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["sports-info-utils"],{25159:function(t,n,o){o.d(n,{addFollowSportsForFre:function(){return Y},addRecommendationsFromSkinnyData:function(){return Q},cardFailed:function(){return Bt},checkAndInitForPreviewImpl:function(){return B},followClickEntityHandler:function(){return yt},goToNextTabIfExists:function(){return St},goToPersonalizeSettingsHandler:function(){return Dt},hideClickHandler:function(){return $t},hidePopupToggleHandler:function(){return xt},interestMenuItemClickEntityHandler:function(){return ft},onDashboardClosed:function(){return Et},onDismissInterestManagerHandler:function(){return Mt},openSearchViewHandler:function(){return dt},paginationDotClickHandler:function(){return bt},paginationFlipperClickHandler:function(){return Ct},recordUserVote:function(){return gt},searchInterestsHandler:function(){return kt},setTmplTelemetry:function(){return F},showDefaultRecommendation:function(){return _t},showExplorationBanner:function(){return Ft},updateActionHistory:function(){return ct},updateDataForPreview:function(){return P}});var e=o(84665),i=o(15221),a=o(38346),r=o(93468),s=o(65022),l=(o(58965),o(89151)),c=o(53685),u=o(89980),d=o(17254),v=o(5044),p=o(94425),f=o(12870),w=o(50180),y=o(7187);const T=async(t,n,e,i)=>{try{const{SportsDataService:r}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474));await r.updateHistory(n,[e]),i===a._n.UsabilityFeedbackToast&&function(t){const n=(0,u.Lg)().getObject("isShowCFStatus")||{};n[t]=(new Date).toString(),(0,u.Lg)().setObject("isShowCFStatus",n)}(t.experienceType)}catch{(0,r.vV)(s.QkA,`updating action history: ${e} failed`,`market:${(0,d.rA)().CurrentMarket}, entityId:${n}, response:updating action histories: ${e} failed`)}},m=async(t,n,e)=>{let a=[];if(n&&n.length>0){const r=(0,w.GP)(t.state.get(i.kA.sportsConfig).fetchSearchSuggestionUrl,n,(0,d.rA)().CurrentMarket||"en-us"),{SportsDataService:s}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474));a=await s.fetchSuggestions(n,r,t.state.get(i.kA.sportsConfig).ocid),e&&(a=a.filter(t=>-1===e.indexOf(t.id)))}0===a.length&&(a=t.state.get(i.kA.allRecommendations).slice(0,8)),t.state.set(i.kA.searchSuggestions,a)},h=t=>!t||!t.trim();function S(t,n){var o;return!(0,y.isNullOrUndefined)(null===(o=t.state.get(i.kA.followedSports))||void 0===o?void 0:o.get(n))}const C=["TeamVsTeamExploration","CricketExploration","TennisExploration"],g=t=>Boolean(t&&C.includes(t)),b=async(t,n)=>{var o,e;const a=t.getCurrentTabEntityId(),r=t.getEntityDataMap();let s=t.state.get(i.kA.sportsData);const l=r.get(j(t,n.id)),c=!g(null==l||null===(o=l.Model)||void 0===o||null===(o=o.Tabs)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.tabType)||t.state.get(i.kA.isExplorationCard);if(t.updateCurrentPageIndex(1),l&&c)s=l;else{var u;const o=r.get(j(t,a))||{},e=n.type===i.XR.Team?"Recommendation_Team":"Recommendation_League",l={version:"3",tabContentType:n.tabContentType||e,tabContentReason:n.tabContentReason||"Popular",explorationReason:n.explorationReason};s=await V(t,n.id,o,l),t.pushAdditionalTabs(null===(u=s)||void 0===u||null===(u=u.Model)||void 0===u?void 0:u.Tabs)}t.state.set(i.kA.currentTabEntityId,(null===(e=s)||void 0===e||null===(e=e.Model)||void 0===e||null===(e=e.Tabs)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.primaryEntityId)||n.id),t.state.set(i.kA.sportsFeedDataParsed,s),t.onSportsMatchupDataReady(s),U(t,s,n.id)},$=(t,n)=>!(!t||!n)&&(t.id&&t.id===n.id||t.yId&&t.yId===n.yId),D=async function(t,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;const r=t.state.get(i.kA.allRecommendations),s=t.state.get(i.kA.sportsConfig);let l;if(n&&n.id&&n.name&&n.type){const{SportsDataService:e}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474));if(l=await e.postActionRequest(n.id,n.name,i.X2.Follow,n.type,s.ocid,!1),l){let o=!1;if(null==r||r.forEach(t=>$(t,n)&&(t.hasExplicitInterest=!0)&&(o=!0)),!o){n.hasExplicitInterest=!0;const o=Z(t);n.id&&o.set(n.id,n),t.state.set(i.kA.sportsSuggestIDMap,o),N(t,n,a)}x(t,n,!0)}}return e&&n&&n.id&&await b(t,n),l},M=async function(t,n){const e=t.state.get(i.kA.allRecommendations),a=t.state.get(i.kA.sportsConfig),{SportsDataService:r}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474));await r.deleteActionRequest(n.yId,i.X2.Follow,"TagBase",a.ocid,!1)&&(null==e||e.forEach(t=>$(t,n)&&(t.hasExplicitInterest=!1)),x(t,n,!1))};function x(t,n,o){const e=t.state.get(i.kA.followedSports);h(n.id)||(o&&!e.get(n.id)&&e.set(n.id,!0),!o&&e.get(n.id)&&e.set(n.id,null)),h(n.yId)||(o&&!e.get(n.yId)&&e.set(n.yId,!0),!o&&e.get(n.yId)&&e.set(n.yId,null))}const _=async(t,n)=>{var o;const e=t.getCurrentTabEntityId(),a=t.state.get(i.kA.sportsData)||{},l=(null==a||null===(o=a.Model)||void 0===o?void 0:o.Tabs)||[],{tabContent:c,previewType:u}=l[n]||{};if(c)return;if(!u)return void(0,r.vV)(s.KbD,"No previewType found in the additionalTabs.",JSON.stringify({entityId:e,newTabIndex:n,tabData:l[n]}));const d={version:"3",tabContentType:"Recommendation_League",tabContentReason:"Popular",previewType:u},v=await V(t,e,a,d);v.Model&&(l[n]={...v.Model.Tabs[0],previewType:u},t.state.set(i.kA.sportsFeedDataParsed,a),t.onSportsMatchupDataReady(a),U(t,v,e))},I=async t=>{const{SportsDataService:n}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474)),e=await n.hideSportsCard();return e&&t&&t(),e},k=async(t,n)=>{const e=t.getCurrentTab();if(!e||h(e.primaryEntityId||""))return!1;const i={id:e.primaryEntityId,name:e.primaryEntityName,type:e.primaryEntityType},{SportsDataService:a}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474)),r=await a.notInterestedSportsCard(i);return r&&n&&n(),r};function E(t){var n;if(!t||"SportsMatch"===t)return i.JH;const o={};return null===(n=Object.entries(i.JH))||void 0===n||n.forEach(n=>{let[e,i]=n;e&&i&&(o[e]=`${t}_${i}`)}),o}function F(t){var n,o,a,r;const s=t.state.get(i.kA.sportsData),l=t.getCurrentTab(),c=E(null==s||null===(n=s.Model)||void 0===n?void 0:n.CardType);if((0,e.h9)([c.ChannelStoreLaunched,c.TaskbarRotation,c.Badge,c.SportsDefaultLeagueShown,c.SportsUserFollowsDefaultLeague,c.SportsUserFollowsOtherteams,c.SportsReasonShown,c.SportsRecommendationPopupShown,c.SportsExplorationPopupShown,c.SportsCardType,c.SportsExplorationCardShown,c.SportsDataV2,c.SportsCardCurrentTabId,c.SportsCardCopilotCurrentTabId,c.SportsTabType]),!l)return;const u=l.primaryEntityName||"",d=l.primaryEntityId||"",v=l.hasExplicitInterest,p=null===(o=s.sportsSkinnyData)||void 0===o?void 0:o.some(t=>t.id!==d&&t.hasExplicitInterest),f=l.reason||"0";(0,e.ao)(c.SportsDefaultLeagueShown,u),(0,e.ao)(c.SportsUserFollowsDefaultLeague,v?"1":"0"),(0,e.ao)(c.SportsUserFollowsOtherteams,p?"1":"0"),(0,e.ao)(c.SportsReasonShown,f),(0,e.ao)(c.SportsCardType,t.experienceType),(0,e.ao)(c.SportsCardCurrentTabId,d),(0,e.ao)(c.SportsUserGroup,(null===(a=s.Model)||void 0===a?void 0:a.SportsUserGroup)||""),(0,e.ao)(c.SportsExplorationReason,l.explorationReason||""),(0,e.ao)(c.SportsTabType,l.tabType||"");const w=(null===(r=l.tabContent)||void 0===r?void 0:r.notifications)||[];if(w.length>0){const t=w.filter(t=>t.type===i.jx.Badge).map(t=>`${t.gameId||""}-${t.gameState||""}`).join("+"),n=w.filter(t=>{var n;return null===(n=t.type)||void 0===n?void 0:n.includes(i.jx.Preview)}).map(t=>`${t.gameId||""}-${t.gameState||""}`).join("+");h(n)||(0,e.ao)(c.TaskbarRotation,n),h(t)||(0,e.ao)(c.Badge,t)}"FRE"===l.tabType&&(0,e.ao)(c.SportsFrePresent,"1"),t.state.get(i.kA.isCopilotTheme)&&(0,e.ao)(c.SportsCardCopilotCurrentTabId,d),t.state.get(i.kA.IsRubyPill)&&(0,e.ao)(c.SportsRubyPillShown,"1"),(0,e.ao)(c.SportsExplorationCardShown,g(l.tabType)?"1":"0"),(0,e.ao)(c.SportsDataV2,"1")}const B=async(t,n)=>{const{feedDataParsed:o,previewType:e,previewTypeInfo:a}=n,{teamId:r,leagueId:s,scenario:l}=a||{},c=r||s;if(c){const n=l&&l.toLowerCase()===i.rq.toLowerCase();return t.updatePreviewTypeInfo(a),await P(t,c,e,!!n,!1,o)}return H(t),!1},P=async(t,n,o,e,a,r)=>{var s;const{state:l}=t,{isSpotlightInFeedData:c}=z(l);H(t);const u=t.getCurrentTabEntityId();l.set(i.kA.currentSpotlightEntityId,n);const d=t.getEntityDataMap();let v=l.get(i.kA.sportsData),p=d.get(j(t,n)),f=1;if(c&&r&&!p){var w;const t=null===(w=r.Model)||void 0===w?void 0:w.Tabs.findIndex(t=>["Spotlight","SpotlightCricket"].includes(t.tabType));"number"==typeof t&&-1!==t&&(f=t+1,p=r)}if(!p||e){var y;const i=d.get(u)||{},r={version:"3",tabContentType:"Recommendation_League",tabContentReason:"Popular",forceFre:e,previewType:o,appendCommonParams:a};if(v=await V(t,n,i,r),!v||0===Object.keys(v).length)return!1;t.pushAdditionalTabs(null===(y=v.Model)||void 0===y?void 0:y.Tabs)}else v=p;l.set(i.kA.currentTabEntityId,n),t.updateCurrentPageIndex(f);const T=null===(s=A(v))||void 0===s?void 0:s[0];return T&&N(t,T),l.set(i.kA.sportsFeedDataParsed,v),l.set(i.kA.feedDataTimestamp,null),l.set(i.kA.pollOptionId,""),t.onSportsMatchupDataReady(v),Y(t,v),U(t,v,n),H(t,{previewType:o,entityId:n}),!0};function N(t,n,o){const e=t.state.get(i.kA.allRecommendations);o||e.find(t=>n.id===t.id)||(e.push(n),t.state.set(i.kA.allRecommendations,e))}const R=t=>({id:t.primaryEntityId,yId:t.yId,name:t.primaryEntityName,displayText:t.primaryEntityName,imageId:t.primaryEntityImage,hasExplicitInterest:t.hasExplicitInterest,isLive:t.isLive,tabContentUrl:t.tabContentUrl,tabContentType:t.tabContentType,tabContentReason:t.tabContentReason,clickThroughUrl:t.clickThroughUrl,explorationReason:t.explorationReason,webSearchUrl:t.clickThroughUrl?(0,v.g2)((0,p.t7)(t.clickThroughUrl)):"",type:t.primaryEntityType}),A=t=>t.Model?t.Model.Tabs.map(t=>R(t)):[];function H(t,n){var o;const a=t.state.get(i.kA.sportsData),r=E(null==a||null===(o=a.Model)||void 0===o?void 0:o.CardType);if((0,e.h9)([r.SportsTabType,r.SpotlightCardPreviewType,r.SpotlightCardEntityId,r.SportsNewSpotlightCard,r.SportsCardType,r.SportsVideoSpotlightShown,r.SportsNewSpotlightCountdown,r.SportsNewSpotlightExploration,r.SportsEventBriefShown,r.SportsNewSpotlightTennis,r.SportsNewSpotlightRace,r.SportsNewSpotlightGolf,r.SportsFrePresent,r.SportsNewSpotlightCricket]),n&&n.previewType&&n.entityId){var s,l,c;(0,e.ao)(r.SpotlightCardPreviewType,n.previewType),(0,e.ao)(r.SpotlightCardEntityId,n.entityId),(0,e.ao)(r.SportsNewSpotlightCard,"0"),(0,e.ao)(r.SportsCardType,t.experienceType);const o=t.getCurrentTab();null!=o&&o.tabType&&(0,e.ao)(r.SportsTabType,o.tabType),null!=o&&null!==(s=o.tabContent)&&void 0!==s&&s.sportsSpotLightData&&(0,e.ao)(r.SportsNewSpotlightCard,"1"),null!=o&&null!==(l=o.tabContent)&&void 0!==l&&null!==(l=l.sportsSpotLightData)&&void 0!==l&&l.video&&(0,e.ao)(r.SportsVideoSpotlightShown,"1"),null!=o&&null!==(c=o.tabContent)&&void 0!==c&&null!==(c=c.sportsSpotLightData)&&void 0!==c&&c.countdown&&(0,e.ao)(r.SportsNewSpotlightCountdown,"1"),"EventBrief"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsEventBriefShown,"1"),"SpotlightTennis"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsNewSpotlightTennis,"1"),"SpotlightGolf"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsNewSpotlightGolf,"1"),"SpotlightRace"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsNewSpotlightRace,"1"),"FRE"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsFrePresent,"1"),"SpotlightCricket"===(null==o?void 0:o.tabType)&&(0,e.ao)(r.SportsNewSpotlightCricket,"1"),(0,e.ao)(r.SportsNewSpotlightExploration,g(null==o?void 0:o.tabType)?"1":"0")}}function U(t,n,o){var a,r,s,l;const c=E(null==n||null===(a=n.Model)||void 0===a?void 0:a.CardType);(0,e.h9)([c.SportsDropdownChangedLeague,c.SportsUserFollowsDropdownChangedLeague,c.SportsDropdownChangedViewShown,c.SportsRecommendationPopupShown,c.SportsExplorationPopupShown,c.SportsCardCopilotCurrentTabId,c.SportsCardCurrentTabId,c.SportsTabType]);const u=t.getCurrentTab(),d=null==u?void 0:u.primaryEntityName,v=null===(r=n.sportsSkinnyData)||void 0===r?void 0:r.find(t=>t.id===o),p=null==v?void 0:v.hasExplicitInterest,f=(null===(s=n.Model)||void 0===s||null===(s=s.Tabs)||void 0===s||null===(s=s[0])||void 0===s?void 0:s.tabType)||"";(0,e.ao)(c.SportsDropdownChangedLeague,d),(0,e.ao)(c.SportsUserFollowsDropdownChangedLeague,p?"1":"0"),(0,e.ao)(c.SportsDropdownChangedViewShown,f),(0,e.ao)(c.SportsCardCurrentTabId,(null==u?void 0:u.primaryEntityId)||""),(0,e.ao)(c.SportsUserGroup,(null===(l=n.Model)||void 0===l?void 0:l.SportsUserGroup)||""),(0,e.ao)(c.SportsExplorationReason,(null==u?void 0:u.explorationReason)||""),(0,e.ao)(c.SportsTabType,(null==u?void 0:u.tabType)||""),t.state.get(i.kA.isCopilotTheme)&&(0,e.ao)(c.SportsCardCopilotCurrentTabId,(null==u?void 0:u.primaryEntityId)||"")}function j(t,n){const o=t.state.get(i.kA.currentSpotlightEntityId);return n===o&&o?`Spotlight_${n}`:n}const V=async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return await e.aC.safeExecuteAsync(async()=>{const e=await L(t,n,i);if(!e)return Promise.resolve(o);const a=await O(t,e,o,n,i);return a?(a.logMessage=a.logMessage||(null==o?void 0:o.logMessage),a.notifications=a.notifications||(null==o?void 0:o.notifications),a.sportsSkinnyData=a.sportsSkinnyData||(null==o?void 0:o.sportsSkinnyData),Promise.resolve(a)):Promise.resolve(o)},o,s.Ax6,"SportsInfo - Fetch sports feed get error response")},L=async(t,n,e)=>{let i=W(t,n);const{fetchEntityUrl:a,fetchEntityApiUrl:r,enableptw:s,ocid:l}=z(t.state),c=!0,{forceFre:u,previewType:v,version:p,explorationReason:f,tabContentReason:w,tabContentType:y,appendCommonParams:T}=e||{};s&&(i=G(i)),u&&(i=`${i}&forceFre=true`),v&&(i=`${i}&signature=${v}`),p&&(i=`${i}&version=${p}&tabtype=${w}&cardType=${y}`),f&&(i=`${i}&explorationReason=${f}`),J("SportsCardWC.FetchStart");const{SportsDataService:m}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474));let S=await m.fetchSportsFeed(i,l,!1,T,c);if(S||h(n)||!r||"3"===p||(i=a.replace("{entityId}",n),s&&(i=G(i)),S=await m.fetchSportsFeed(i,l,!1,T,c)),!S){let t=`market:${(0,d.rA)().CurrentMarket}, entityId:${n}, Url:${i}, ocid:${l}`;throw u&&(t=`${t}, forceFre:${u}`),v&&(t=`${t}, previewType:${v}`),new Error(t)}return J("SportsCardWC.FetchEnd"),Promise.resolve(S)},O=async function(t,n,o){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;const{sportsTypesForWidget:a,sportsDataTypesForWidget:r,maxNumberOfMatches:s}=z(t.state);let l;J("SportsCardWC.ParseStart");let c=!1;if(Array.isArray(n)&&n.length)l=n.find(t=>a&&a.includes(t.type)&&r&&r.includes(t.dataType));else if(n.value&&Array.isArray(n.value)&&n.value.length){if(n.value[0].blendedResponse)try{l=JSON.parse(n.value[0].blendedResponse)}catch{throw new Error(`market:${(0,d.rA)().CurrentMarket}, entityId:${e}, response:${n.value[0].blendedResponse}`)}else l=n.value[0];c=!0}if(!l)throw new Error(`market:${(0,d.rA)().CurrentMarket}, entityId:${e}`);const u=new Map;u.set("teamImageSize",X(o.sportsMatchupCardData)),u.set("previewType",null==i?void 0:i.previewType);const v="string"==typeof l?t.getV2SportsMatchupData(JSON.parse(l)):t.getV2SportsMatchupData(l,{isBlended:!0});if(!v)throw new Error(`market:${(0,d.rA)().CurrentMarket}, entityId:${e}, response:${l}`);return J("SportsCardWC.ParseEnd"),Promise.resolve(v)},W=(t,n)=>{var o;const e=null===(o=(0,d.rA)().CurrentRequestTargetScope)||void 0===o?void 0:o.pageExperiments,i=(null==e?void 0:e.filter(t=>t.startsWith("prg-1sw-")||t.startsWith("prg-pr2-ptw")).join(","))||"";let a="";const{fetchEntityUrl:r,fetchEntityApiUrl:s}=z(t.state);return h(s)?a=r.replace("{entityId}",n):(a=s.replace("{entityId}",n),!h(i)&&(a=`${a}&fdhead=${i}`)),a},z=t=>t.get(i.kA.sportsConfig),G=t=>{const n=(0,d.rA)().UserId,o=new URL(t);return o?(o.searchParams.set("flights","prg-1sw-spptw"),o.searchParams.set("userGuid",n.split("-")[1]),n.startsWith("m-")?o.searchParams.set("userGuidType","MUID"):o.searchParams.set("userGuidType","ANID"),o.toString()):t},J=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:performance.now();const o=!0===f.Rb.IsPrerender?n-(0,l.W4)(c.xF):n;(0,l.tD)(t,o)},X=t=>t&&t.dataType&&q(t.dataType)?{width:20,height:20}:{width:40,height:40},q=t=>!!t&&"cricket"===t.toLowerCase(),K=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:864e5;const o=new Date,e=new Date(t),i=o.getTime()-e.getTime();return Math.floor(i/n)},Q=(t,n)=>{if(!n||!n.sportsSkinnyData)return;const o=[],e=t.state.get(i.kA.followedSports)||new Map,a=Z(t);n.sportsSkinnyData.length>0&&n.sportsSkinnyData.forEach(t=>{t.id&&a.set(t.id,t),t&&(o.push({...t}),t.hasExplicitInterest&&t.id&&!e.has(t.id)&&e.set(t.id,!0))}),t.state.set(i.kA.followedSports,e).set(i.kA.allRecommendations,o).set(i.kA.sportsSuggestIDMap,a)},Y=(t,n)=>{var o;const e=t.state.get(i.kA.followedSports)||new Map,{freTeams:a}=(null==n||null===(o=n.Model)||void 0===o||null===(o=o.Tabs)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.tabContent)||{};a&&a.length>0&&a.forEach(t=>{const n=t.id||t.satoriId;t.hasExplicitInterest&&n&&!e.has(n)&&e.set(n,!0)}),t.state.set(i.kA.followedSports,e)},Z=t=>t.state.get(i.kA.sportsSuggestIDMap)||new Map,tt=t=>{var n;const o=t.getCurrentTabEntityId(),e=t.state.get(i.kA.sportsFeedDataParsed),a=null==e||null===(n=e.Model)||void 0===n?void 0:n.Tabs.find(t=>t.primaryEntityId===o);return Boolean(null==a?void 0:a.additionalTabs)};function nt(){(0,e.h9)([i.JH.SportsUsabilityPopupShown,i.JH.SportsDfltRecoPopupShown,i.JH.SportsRecommendationPopupShown])}function ot(t,n){const o=t.appStateConnector.getCurrentTab(),{shouldShowExplorationUX:e,heading:i,explorationReason:a}=o||{};let l=t.config.enableExplorationReco&&Boolean(e);return l=l&&!S(t.appStateConnector,n),l=l&&!t.entityIdsWithShownPopup.has(n),!l||i&&a?!!l:((0,r.vV)(s.dSi,"Invalid tab data for exploration recommendation",JSON.stringify({shouldShowExplorationUX:e,heading:i,explorationReason:a,entityId:n})),!1)}function et(t){var n,o;const e=null===(n=t.view)||void 0===n?void 0:n.sdCardData;return(null==e||null===(o=e.headerData)||void 0===o?void 0:o.titleNavigationLink)||""}function it(t,n){t.config.skipToastTimeout||(clearTimeout(t.notificationCloseTimer),t.notificationCloseTimer=window.setTimeout(()=>{at(t)},n||t.config.notificationPopupTimeout))}function at(t){if(clearTimeout(t.notificationCloseTimer),t.view&&t.view.feedsNotificationToastViewModel){const n={...t.view.feedsNotificationToastViewModel,shouldShowNotification:!1};t.view={...t.view,feedsNotificationToastViewModel:n}}}const rt=async function(t,n,o,e){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if([a.iD.usefulTipHistoryNo,a.iD.usefulTipHistoryYes].includes(o)){const n={telemetryTag:"",shouldShowNotification:!0,notificationType:a._n.DefaultNotification,notificationToastHeader:t.strings.usabilityFeedbackConfirmation,onClickDismissButton:()=>at(t),onMouseEnterToast:()=>st(t),onMouseLeaveToast:()=>lt(t)};t.view&&(t.view={...t.view,feedsNotificationToastViewModel:n},it(t,t.config.feedbackToastTimeout))}else at(t);r&&dt(t,!0).catch(()=>{}),await T(t.appStateConnector,n,o,e);const s=e===a._n.ExplorationReco;s&&o===a.iD.suppressHistory&&function(t){const n=t.appStateConnector.getCurrentState(),o=n.get(i.kA.interestOptions),e=function(t,n){const o=t.appStateConnector.getEntityDataMap(),e=t.appStateConnector.getCurrentTabEntityId();return n.findIndex(t=>!o.get(t.id)&&!t.isFollowed&&t.id!==e)}(t,o),r=-1!==e,s={telemetryTag:"",...t.view&&t.view.feedsNotificationToastViewModel,shouldShowNotification:!0,notificationType:a._n.DefaultNotification,isShowButtonTemplate:!1,notificationToastHeader:t.strings.thanksForYourFeedback,notificationToastActionText:r?t.strings.seeAnotherLeague:t.strings.seeOtherLeaguesToFollow,onClickActionText:async()=>{r?await(null==ft?void 0:ft(t,o[e])):(at(t),dt(t,!0).catch(()=>{}))},onClickDismissButton:()=>at(t),onMouseEnterToast:()=>st(t),onMouseLeaveToast:()=>lt(t)};t.view&&(t.view={...t.view,feedsNotificationToastViewModel:s},it(t,t.config.explFeedbackToastTimeout))}(t),[a.iD.usefulTipHistoryNo,a.iD.suppressHistory].includes(o)&&!s&&ut(t)},st=t=>{!t.config.skipMouseEnterCooldown&&clearTimeout(t.notificationCloseTimer)},lt=t=>{!t.config.skipMouseEnterCooldown&&it(t)},ct=async(t,n,o,e)=>T(t.appStateConnector,n,o,e);function ut(t,n){(0,e.ao)(i.JH.ChannelStoreLaunched,"1"),t.config.useChannelStoreAll&&window.dispatchEvent(vt(t,n))}const dt=async(t,n,o,a)=>{if((0,e.ao)(i.JH.ChannelStoreLaunched,"1"),t.config.useChannelStoreAll)return window.dispatchEvent(vt(t)),void pt(t);t.appStateConnector.toggleInterestManager(n),n&&(pt(t),await m(t.appStateConnector,o||"",a)),t.updateView().catch(()=>{})};function vt(t,n){var o,e;const i=t.appStateConnector.getCurrentTab();return new CustomEvent("launchChannelStore",{detail:n?{openSportsChannelStore:!0}:{openSportsChannelStore:!0,sportWithLeagueName:(null==i||null===(o=i.tabContent)||void 0===o||null===(o=o.league)||void 0===o?void 0:o.id)||(null==i||null===(e=i.tabContent)||void 0===e?void 0:e.id),title:null==i?void 0:i.primaryEntityName,yId:null==i?void 0:i.yId}})}function pt(t){t.config.isDynamicFeed&&t.sdCardActionClickHandler&&t.dismissActionMenu&&t.dismissActionMenu()}const ft=async(t,n)=>{t.hideExplorationBanner(),clearTimeout(t.recommendationDelayTimer);const o=await(async(t,n)=>{const o=t.getCurrentTabEntityId();t.state.get(i.kA.sportsConfig),n.id&&o!==n.id&&await b(t,n),t.updateCurrentPageIndex(1),t.state.set(i.kA.toggleInterestManager,!1)})(t.appStateConnector,n);await t.updateView(),o&&await Tt(t,o,!0,o.webSearchUrl||""),ot(t,n.id)?await mt(t,n.id,a._n.ExplorationReco).catch(()=>{}):ht(t,n.id,a._n.DropdownRecommendation)&&await mt(t,n.id,a._n.DropdownRecommendation).catch(()=>{}),(0,e.j8)(t.tabElement)};function wt(t,n,o,e){let i=o?t.strings.isFollowedString:t.strings.sportsUnfollowingToast;return e&&(i=t.strings.youAreNowFollowing),(i||"").replace("{0}",`${n}`)}const yt=async(t,n,o,e,a,r,s)=>{await(async(t,n,o,e)=>{const a=t.state.get(i.kA.followedSports);o&&!0!==a.get(n.id)?await D(t,n,!1,e&&t.state.get(i.kA.isExplorationCard)):o||!0!==a.get(n.id)||await M(t,n)})(t.appStateConnector,n,o,a),await t.updateView(),Tt(t,n,o,e,s),r&&ut(t)},Tt=async(t,n,e,r,l)=>{if(t.config.enableExplorationBanner)return t.explorationSettings={explorationId:n.id,graphActionCallAppError:s.r6X,skipDismissesCountCheck:!0,cardBannerViewModelBase:{bannerType:"header-only",bannerNameForTelemetry:i.BP.SportsAfterFollowDismiss,bannerTitle:wt(t,n.name||"",e),autoDismissTimeoutMs:3e3,delayShowTimeoutMs:0,bannerFromClick:!0}},void await o.e("exploration-banner").then(o.bind(o,95231));await o.e("feeds-notification-toast").then(o.bind(o,38925));const c=t.appStateConnector.getCurrentState(),u=l===a._n.ExplorationReco;if(n.name&&(r||u)){const o=wt(t,n.name,e,u),s=function(t,n,o,e){let i=o?t.strings.seeInformationOf:t.strings.sportsUnfollowingToastLink;if(o){const n=t.appStateConnector.getCurrentTab();if(q((null==n?void 0:n.tabType)??""))return t.strings.seeMore}return e&&(i=t.strings.seeTeamsToFollow),(i||"").replace("{0}",`${n}`)}(t,n.name,e,u),d={telemetryTag:"",...t.view&&t.view.feedsNotificationToastViewModel,isShowButtonTemplate:!1,shouldShowNotification:!0,notificationType:a._n.DefaultNotification,notificationToastHeader:o,notificationToastActionText:s,interestManagerOpen:c.get(i.kA.toggleInterestManager),cardSize:t.cardSize,actionTextUrl:e&&!u?r:"",onClickActionText:()=>(async(t,n,o,e)=>{e===a._n.ExplorationReco?dt(t,!0,n.name||"",[n.id]).catch(()=>{}):n.name&&o&&await yt(t,n,!0,o)})(t,n,r,l),onClickDismissButton:()=>at(t),onMouseEnterToast:()=>st(t),onMouseLeaveToast:()=>lt(t)};t.view&&(t.view={...t.view,feedsNotificationToastViewModel:d},it(t,u?t.config.explFeedbackToastTimeout:t.config.notificationPopupTimeout))}},mt=async function(t,n,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;await o.e("feeds-notification-toast").then(o.bind(o,38925));const l=t.appStateConnector.getCurrentTab();if(!l)return;const c=R(l),u=(null==c?void 0:c.webSearchUrl)||"",d=function(t,n,o){const e=t.appStateConnector.getCurrentTab();switch(o){case a._n.ExplorationReco:return(null==e?void 0:e.heading)||"";case a._n.DefaultRecommendation:return t.strings.suggestedForYou}return`${t.strings.wantToFollow||""}`.replace("{0}",`${n.name}`)}(t,c,r),v=function(t,n){const o=t.appStateConnector.getCurrentTab(),e=(null==o?void 0:o.reason)||"-1";switch(n){case a._n.DefaultRecommendation:return function(t,n){switch(+n){case 2:return t.strings.recommendedBasedInterests||"";case 3:return t.strings.recommendedBasedPopularity||"";case 4:return t.strings.recommendedDueToLiveGame||"";case 5:return t.strings.recommendedDueToMITEvent||"";case 6:return t.strings.recommendedLocalPopularity||"";default:return t.strings.recommendedLeagueToFollow||""}}(t,e);case a._n.DropdownRecommendation:return t.strings.stayUpToDate||"";case a._n.ExplorationReco:return t.strings.followToGetUpdates;default:return""}}(t,r),p=function(t,n,o){return o===a._n.ExplorationReco?t.strings.follow:`${t.strings.yesFollowTeam||""}`.replace("{0}",`${n.name||""}`)}(t,c,r),f=function(t,n){return n===a._n.ExplorationReco?t.strings.noThanks:t.strings.notInterested||""}(t,r),w=r!==a._n.ExplorationReco,y={telemetryTag:"",...t.view&&t.view.feedsNotificationToastViewModel,shouldShowNotification:!0,isShowButtonTemplate:!0,disableNoButton:r===a._n.DropdownRecommendation,notificationType:r,notificationToastHeader:d,notificationToastContentText:v,notificationToastActionText:p,notificationToastDismissText:f,blankSpaceClickUrl:et(t),onClickActionText:()=>yt(t,c,!0,u,!1,!1,r),onClickDismissButton:()=>rt(t,n,a.iD.dismissHistory,r),onClickRejectButton:()=>rt(t,n,a.iD.suppressHistory,r,w),onMouseEnterToast:()=>st(t),onMouseLeaveToast:()=>lt(t)};nt(),t.recommendationDelayTimer=window.setTimeout(()=>{if(t.view){if(nt(),t.view={...t.view,feedsNotificationToastViewModel:y},r===a._n.ExplorationReco)clearTimeout(t.notificationCloseTimer);else{const n=r===a._n.DefaultRecommendation?t.config.dftRecommendationPopupTimeout:t.config.dwnRecommendationPopupTimeout;it(t,n)}t.entityIdsWithShownPopup.add(n);const o=function(t){switch(t){case a._n.DropdownRecommendation:return i.JH.SportsRecommendationPopupShown;case a._n.ExplorationReco:return i.JH.SportsExplorationPopupShown;default:return i.JH.SportsDfltRecoPopupShown}}(r);(0,e.ao)(o,"1")}},s)},ht=(t,n,o)=>{let e=o===a._n.DefaultRecommendation?t.config.enableRecommendationDefault:t.config.enableRecommendationDropdown;const i=t.appStateConnector.getCurrentTab();var r;i&&(e=e&&Boolean(null===(r=i.tabContent)||void 0===r?void 0:r.shouldShowRecommendation));return e=e&&!S(t.appStateConnector,n),o===a._n.DropdownRecommendation&&(e=e&&!t.entityIdsWithShownPopup.has(n)),!!e};function St(t){clearTimeout(t.goToNextTabTimer);const n=t.appStateConnector.getCurrentState(),o=n.get(i.kA.tabCurrentPageIndex)||1;n.get(i.kA.interestOptions).length!==o&&(t.goToNextTabTimer=window.setTimeout(async()=>{await Ct(t,!0)},t.config.goToNextTabDelay))}const Ct=async(t,n)=>{clearTimeout(t.goToNextTabTimer);const o=t.appStateConnector.getCurrentState(),a=o.get(i.kA.cardSize),r=t.appStateConnector.getCurrentTab();if(((null==r?void 0:r.tabType)||"").toLowerCase().includes("exploration")||t.config.enableFlipper&&"_1x_1y"!==o.get(a)){const e=o.get(i.kA.interestOptions),a=function(t,n,o){const e=t.appStateConnector.getCurrentState().get(i.kA.currentTabEntityId),a=n.findIndex(t=>t.id===e);let r=o?a+1:a-1;return-1===r?r=n.length-1:r===n.length&&(r=0),r}(t,e,n);null==ft||ft(t,e[a])}else{!function(t,n){var o;const e=(null===(o=t.state.get(i.kA.sportsData).Model)||void 0===o?void 0:o.Tabs.length)||1;let a=t.state.get(i.kA.tabCurrentPageIndex)||1;a=n?a<e?a+1:1:a>1?a-1:e,t.updateCurrentPageIndex(a)}(t.appStateConnector,n);if(tt(t.appStateConnector)){const n=t.appStateConnector.getCurrentState().get(i.kA.tabCurrentPageIndex)-1;await _(t.appStateConnector,n)}t.updateView().catch(()=>{}),(0,e.j8)(t.tabElement)}t.hideExplorationBanner()};const gt=async(t,n,e,a)=>{await(async(t,n,e,a)=>{try{const r=t.appStateConnector.getCurrentState(),s=(0,w.GP)(r.get(i.kA.sportsConfig).submitPollApiUrl,n,e,a),{SportsDataService:l}=await Promise.all([o.e("libs_sports-data-service_dist_SportsDataMapper_js"),o.e("sports-data-service")]).then(o.bind(o,27474)),c=await l.sendVote(n,e,a,s,r.get(i.kA.sportsConfig).ocid);return r.set(i.kA.pollOptionId,a),c}catch{(0,r.vV)(s.Xqh,`Failed to submit user vote for game: ${n} for optionId: ${a}`)}})(t,n,e,a)},bt=async(t,n)=>{const o=n+1;t.appStateConnector.updateCurrentPageIndex(o);tt(t.appStateConnector)&&await _(t.appStateConnector,n),t.updateView().catch(()=>{})},$t=async(t,n,o,e)=>{const a=n&&t.config.useChannelStoreAll&&!e;await(async(t,n,o)=>{const e=h(n)?await I(o):await k(t,o),a=t.state.get(i.kA.dislikedEntities);return null==a||a.add(n),t.state.set(i.kA.dislikedEntities,a),e})(t.appStateConnector,n,o?void 0:t.refreshFeed),a&&ut(t,!0)};function Dt(t){t.goToPersonalizeCallback?t.goToPersonalizeCallback():t.$emit("goToPersonalizeCallback")}function Mt(t){at(t),dt(t,!1).catch(()=>{})}const xt=async(t,n)=>{t.appStateConnector.setIsHidePopupOpen(n),await t.updateView(),t.isHidePopupOpen=n},_t=async t=>{var n;if(t.isDefaultRecoChecked)return;clearTimeout(t.recommendationDelayTimer),nt();const o=t.appStateConnector.getCurrentState(),r=o.get(i.kA.currentTabEntityId);return!((null===(n=o.get(i.kA.wpoMetadata))||void 0===n?void 0:n.isGA)??!1)&&r?await e.aC.safeExecuteAsync(async()=>{const n=t.appStateConnector.getCurrentTab();if(!n)return;const o=Boolean(n.showCF),e=n.primaryEntityType;ot(t,r)?await mt(t,r,a._n.ExplorationReco,t.config.explorationRecoDelay):o&&t.config.enableUsabilityToast&&e?await It(t,r,e,a._n.UsabilityFeedbackToast):ht(t,r,a._n.DefaultRecommendation)&&await mt(t,r,a._n.DefaultRecommendation)},void 0,s.Y_G,"SportsInfo - error showing default tab popup"):void 0},It=async(t,n,r,s)=>{if(!t.config.skipUsabilityToastCooldown&&(((t,n)=>{const o=(0,u.Lg)().getObject("isShowCFStatus");return!(!o||!o[t])&&K(o[t])<=n})(t.cardType,t.config.usabilityToastShownIntervalDy??7)||((t,n,o)=>{const e=(0,u.Lg)().getObject("isShowCF");if(!e)return!1;const i=e[`${t}Count`],a=K(e[t]);return!(!i||i<n||i===n&&a>o)})(t.cardType,t.config.usabilityToastShownCount??2,t.config.usabilityToastShownIntervalDy??7)))return;await o.e("feeds-notification-toast").then(o.bind(o,38925));const l=(0,w.GP)(t.strings.usabilityFeedbackTitle,r.toLowerCase()),c={telemetryTag:"",...t.view&&t.view.feedsNotificationToastViewModel,shouldShowNotification:!0,isShowButtonTemplate:!0,notificationType:s,notificationToastHeader:l,notificationToastActionText:t.strings.usabilityFeedbackYes,notificationToastDismissText:t.strings.usabilityFeedbackNo,blankSpaceClickUrl:et(t),onClickActionText:()=>rt(t,n,a.iD.usefulTipHistoryYes,s),onClickRejectButton:()=>rt(t,n,a.iD.usefulTipHistoryNo,s),onClickDismissButton:()=>rt(t,n,a.iD.usefulTipHistoryDismiss,s),onMouseEnterToast:()=>st(t),onMouseLeaveToast:()=>lt(t)};t.view&&(nt(),t.view={...t.view,feedsNotificationToastViewModel:c},it(t,t.config.usabilityToastTimeout),function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const o=(0,u.Lg)().getObject("isShowCF")||{},e=K(o[t],36e5);o[t]=(new Date).toString(),o&&o[t+"Count"]?e>n&&(o[t+"Count"]=2):o[t+"Count"]=1,(0,u.Lg)().setObject("isShowCF",o)}(t.cardType),(0,e.ao)(i.JH.SportsUsabilityPopupShown,"1"))},kt=async(t,n)=>{await m(t.appStateConnector,n),t.updateView().catch(()=>{})};function Et(t){t.appStateConnector.clearViewsCache(),function(t){var n;const o=null===(n=t.view)||void 0===n?void 0:n.feedsNotificationToastViewModel;return Boolean(o&&o.shouldShowNotification&&o.notificationType===a._n.ExplorationReco)}(t)&&t.resetShownPopupForCurrentTab(),at(t)}function Ft(t){var n,e,i,a;if(!t.config.enableExplorationBanner||null!==(n=t.wpoMetadata)&&void 0!==n&&n.isGA)return;const l=function(t){var n;const o=null===(n=t.feedDataParsed)||void 0===n||null===(n=n.Model)||void 0===n?void 0:n.ExplorationSettings;if(!t.isSportsSpotlight||!o)return null;const[e,i]=Object.entries(o).find(n=>{let[o,e]=n;return e.previews.includes(t.previewType||"")})||[];if(e&&i)return{explorationId:e,data:i};return null}(t);if(l){if(null===(e=l.data)||void 0===e||!e.title)return(0,r.vV)(s.r6X,"Sports exploration banner data missing",`exploration id: ${l.explorationId}`,l.data),void t.hideExplorationBanner();t.explorationSettings={explorationId:l.explorationId,positiveAction:l.data.optIn,negativeAction:l.data.optOut,graphActionCallAppError:s.r6X,forceShow:"boolean"==typeof l.data.forceShow?l.data.forceShow:"true"===(null===(i=l.data.forceShow)||void 0===i||null===(a=i.toLowerCase)||void 0===a?void 0:a.call(i)),cardBannerViewModelBase:{bannerTitle:l.data.title,postActionToastViewModel:{toastMessage:t.strings.thankYouForYourFeedback}}},o.e("exploration-banner").then(o.bind(o,95231))}else t.hideExplorationBanner()}function Bt(t){t.isCopilotTheme&&t.wpoId&&t.$emit("card-failed",{wpoId:t.wpoId})}}}]);