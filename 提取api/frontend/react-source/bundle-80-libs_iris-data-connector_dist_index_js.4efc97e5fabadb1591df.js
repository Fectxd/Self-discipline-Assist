(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["libs_iris-data-connector_dist_index_js"],{3642:function(){},10610:function(t,e,i){"use strict";i.d(e,{K:function(){return S}});var r=i(55457),s=i(65022),n=i(88294),a=i(77246),o=i(27261),c=i(16091),u=i(17720),h=i(42e3),d=i(89980),l=i(19548),g=i(1732),A=i(48172),f=i(28006),m=i(98216),p=i(27061),y=i(35849);class P{constructor(){this.hasSimpleImages=!1,this.dailyRotationOnlySimpleImages=!1,this.shouldRerender=!0,this.stateInited=!1,this.simpleBkgdKey="simpleBkgd",this.useDefaultBackground=!1,this.enableAbstractImageFlight=!1}static getInstance(){return u.vv.get("__BackgroundStorageHelper__",()=>new P)}async initState(t){let{disableGalleryFREAndLowEnd:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,a.S)())return;if(this.stateInited)return;this.stateInited=!0,void 0===this.enableGallerySettingOnLowend&&(this.enableGallerySettingOnLowend=!e);if(await this.getBackgroundGalleryEligibilityAsync()){const e=(0,y.zP)(f.h$);if(!e)return;const i=await e.getPageSettingsStateAsync();await this.initialBackgroundPSLSetup(i);(0,d.Lg)().getItem("clean_meta_flag")||((0,d.Lg)().setItem("clean_meta_flag","1"),"focused"===i.currentLayout&&await this.resetAppliedBackgroundAndToggleStorage(i.currentLayout));const r=await this.checkAndRemoveApplicableBackgrounds(!1,i),s=await this.getBackgroundPreferences();if(s){const e={backgroundGalleryDisplayed:!1,selectedVideoSetting:s.selectedVideoSetting,backgroundSelectionMetadata:s.backgroundSelectionMetadata};null==t||t.send(e);const n=p.l.isImageOfTheDayDisabled(),a=p.l.isCustomImageDisabled();if(await this.resetGalleryStorageForPolicyCompliance(s,n,a),n||a)return;r&&"off"!==i.currentBackgroundImageType&&this.updateLayoutBasedOnBackgroundType(s)}}}async getBackgroundGalleryEligibilityAsync(){const t=this.shouldDisableGalleryFeature(),e=await A.f.isApiAvailableToUse(),i=(0,g.h_)();return this.isEligibleForTreatment=e&&(!i||Boolean(this.enableGallerySettingOnLowend))&&!t,this.isEligibleForTreatment}getBackgroundGalleryEligibility(){return!!this.isVPTest()||this.isEligibleForTreatment}setBackgroundSettingsPreferencesCache(t){this.backgroundSettingsPreferences=t}getBackgroundSettingsPreferencesCache(){return this.backgroundSettingsPreferences}getPreferenceByKeyFromFromPreferencesCache(t){const e=this.backgroundSettingsPreferences;return e?e[t]:void 0}setCurrentBackgroundPreferenceCache(t){this.currentBackgroundMetadata=t}getCurrentBackgroundPreferenceCache(){return this.currentBackgroundMetadata}setDefaultBackground(t){this.useDefaultBackground=t}getDefaultBackground(){return this.useDefaultBackground}getShouldRerender(){return this.shouldRerender}setShouldRerender(t){this.shouldRerender=t}setSimpleImagesandCMSSize(t,e){this.hasSimpleImages=t,this.cmsImageSize=e-1}setAbstractImageStartIndex(t){this.enableAbstractImageFlight=!0,this.abstractImageIndexStart=t}setRubyImageStartIndex(t){this.rubyImageIndexStart=t}getCMSImageSize(){return this.cmsImageSize}getAbstractImageStartIndex(){return this.abstractImageIndexStart}getRubyImageStartIndex(){return this.rubyImageIndexStart}async getBackgroundPreferences(){return A.f.getPreferenceSetting(r.lD,!0).then(t=>{const e=t&&t.value;if(e)return this.setBackgroundSettingsPreferencesCache(e),e;n.v.logError(`PSL: Preferences API does not have ${r.lD}.`)}).catch(t=>{n.v.logError(`Exception ${t} occurred storing background setting preferences in persistent storage layer`)})}async getBackgroundPreferenceByKey(t){return A.f.getPreferenceSetting(r.lD,!0).then(e=>{const i=e&&e.value;if(i)return i[t];n.v.logError(`PSL: Preferences API does not have ${r.lD}.`)}).catch(t=>{n.v.logError(`Exception ${t} occurred getting background setting preference by key in persistent storage layer`)})}async setBackgroundPreferences(t){return A.f.savePreferenceSetting(r.lD,t).then(e=>(e&&this.setBackgroundSettingsPreferencesCache(t),e)).catch(e=>(n.v.logError(`Exception ${e} occurred storing background settings preferences: ${t} in persistent storage layer`),!1))}async setBackgroundPreferenceByKey(t,e){const i=await A.f.getPreferenceSetting(r.lD,!0).catch(t=>(n.v.logError(`Exception ${t} occurred getting background settings preferences in persistent storage layer`),this.getNurturingErrorObject()));let s=i&&i.value;return s!==this.getNurturingErrorObject()&&(s||(s={key:r.lD,value:{}}),t==r.mR.backgroundSelectionMetadata&&(s[r.mR.changeBackgroundDaily]=!1),s[t]=e,A.f.savePreferenceSetting(r.lD,s).then(t=>(t&&this.setBackgroundSettingsPreferencesCache(s),t)).catch(i=>(n.v.logError(`Exception ${i} occurred storing background preference ${t} and value ${e} in persistent storage layer`),!1)))}async getCurrentBackgroundMetadata(){const t=window&&window.chrome&&window.chrome.ntpSettingsPrivate;if(t&&t.getPref)return new Promise(e=>{t.getPref(r.$e,function(t){e(null==t?void 0:t.value)})})}setCurrentBackgroundMetadata(t){const e=window&&window.chrome&&window.chrome.ntpSettingsPrivate;return!(!e||!e.getPref)&&(e.setPref(r.$e,t),this.setCurrentBackgroundPreferenceCache(t),!0)}setSSRBackgroundMetadata(t){this.ssrBackgroundMetadata=t}async checkAndRemoveApplicableBackgrounds(t,e,i){const r=await this.getBackgroundPreferences();if(!r)return!1;const s=this.overrideCacheAging(),n=r.changeBackgroundDaily||s||t,a=r.backgroundSelectionMetadata;if(!a)return!1;let o=-1;return s||i||(o=a.appliedTimestamp?a.appliedTimestamp+864e5:-1),!!(n&&o<Date.now())&&this.clearCachedBackground(r)}getBackgroundImageTypeFromSettings(t){return this.backgroundSettingsPreferences&&this.backgroundSettingsPreferences.backgroundSelectionMetadata?this.getProviderBackgroundType(this.backgroundSettingsPreferences.backgroundSelectionMetadata.provider):t?"off":"imageAndVideo"}async initialBackgroundPSLSetup(t){if(await this.getBackgroundPreferences())return;if(!t)return;const e=this.createInitialStateFromChromiumPageSettings(t);if(!e)return void m.YT.sendAppErrorEvent({...s.VZt,message:"Initial state for background gallery is undefined",pb:{...s.VZt.pb,customMessage:`Initial state for background gallery is undefined. Current BackgroundImageType: ${t.currentBackgroundImageType}`}});await this.setBackgroundPreferences(e)&&this.setBackgroundSettingsPreferencesCache(e)}createInitialStateFromChromiumPageSettings(t){switch(t.currentBackgroundImageType){case"off":case"custom":case"theme":return this.createInitialState(!1);case"bing":case"imageAndVideo":return this.createInitialState(!0);default:return}}createInitialState(t){return{changeBackgroundDaily:t,selectedVideoSetting:this.shouldUseEnergySaverMode()?"energySaver":"balanced"}}shouldUseEnergySaverMode(){const t=window&&window.navigator;if(!t)return!0;const e=t?t.deviceMemory:-1;return!("4g"===t.connection.effectiveType)||!(e>=4)}getProviderBackgroundType(t){switch(t){case"BrowserLocal":return"custom";case"FREBackground":case"Iris":default:return"bing";case"Theme":return"theme";case"Video":case"CMSImage":return"imageAndVideo"}}async backgroundSelectionSet(){return!!await this.getBackgroundPreferenceByKey(r.mR.backgroundSelectionMetadata)}overrideCacheAging(){return"true"===l._3.getQueryParameterByName("ageOutGalleryCache",(0,o.iA)())}async handleRotationToggling(t,e){return!!this.backgroundSettingsPreferences&&(t?(this.isCurrentAndCachedBackgroundIdentical(e.selectedFeedDisplaySetting)&&this.setShouldRerender(!1),this.checkAndRemoveApplicableBackgrounds(!0,e,!0)):!!this.backgroundSettingsPreferences.backgroundSelectionMetadata||this.getActiveBackgroundSelectionMetadata(e).then(t=>!!t&&(this.setShouldRerender(!1),this.setBackgroundPreferenceByKey(r.mR.backgroundSelectionMetadata,t))).catch(t=>!1))}isCurrentAndCachedBackgroundIdentical(t){const e=this.getVideoBackgroundProviderInfo(t);if(!e||!this.backgroundSettingsPreferences||!this.backgroundSettingsPreferences.backgroundSelectionMetadata)return!1;const i=this.backgroundSettingsPreferences.backgroundSelectionMetadata;return e.provider===i.provider&&e.configIndex===i.configIndex}async getActiveBackgroundSelectionMetadata(t){if(!t)return;if("off"===t.currentBackgroundImageType)return this.buildBackgroundSelectionMetadata("Off");let e=await this.getBackgroundPreferences();if(this.isVPTest()&&(e=h.JW),e){if(e.backgroundSelectionMetadata&&"theme"!==t.currentBackgroundImageType)return e.backgroundSelectionMetadata;if(this.useDefaultBackground)return this.buildBackgroundSelectionMetadata("CMSImage","0");switch(e.changeBackgroundDaily&&this.dailyRotationOnlySimpleImages&&"bing"===t.currentBackgroundImageType&&(t.currentBackgroundImageType="imageAndVideo"),t.currentBackgroundImageType){case"bing":case"imageAndVideo":default:return this.getVideoBackgroundProviderInfo(t.selectedFeedDisplaySetting);case"custom":return this.buildBackgroundSelectionMetadata("BrowserLocal");case"theme":return this.buildBackgroundSelectionMetadata("Theme")}}}isVideoScheduled(){const t=(0,d.Lg)().getObject("bkgdV");if(!t)return-1;const e=(new Date).getDay();return t&&t.schedule&&-1!==t.schedule[e]?t.schedule[e]:-1}isVPTest(){const t=new URLSearchParams((0,o.iA)());return"vp"===(null==t?void 0:t.get("reqsrc"))}simpleImageScheduled(){const t=(0,d.Lg)().getObject("bkgdV");if(!t)return 0;const e=(new Date).getDay();return t&&t.simpleSchedule?t.simpleSchedule[e]:-1}getVideoBackgroundProviderInfo(t){let e=this.simpleImageScheduled();if(this.enableAbstractImageFlight&&"always"==t){const t=(new Date).getDay();e=this.abstractImageIndexStart+t}return this.ssrBackgroundMetadata&&this.ssrBackgroundMetadata.configIndex&&(e=this.ssrBackgroundMetadata.configIndex),this.buildBackgroundSelectionMetadata("CMSImage",e.toString())}buildBackgroundSelectionMetadata(t,e,i){return{provider:t,configIndex:e||"-1",appliedTimestamp:i||Date.now()}}async shouldOverrideLayoutToCustom(){const t=await this.getBackgroundPreferences();return!!t&&(!!t.backgroundSelectionMetadata||!t.changeBackgroundDaily)}shouldOverrideLayoutToCustomCache(){const t=this.getBackgroundSettingsPreferencesCache();return!!t&&(!!t.backgroundSelectionMetadata||!t.changeBackgroundDaily)}async resetAppliedBackgroundAndToggleStorage(t){if("informational"===t||"inspirational"===t||"focused"===t){const e=await this.getBackgroundPreferences();if(!e)return;if(delete e[r.mR.backgroundSelectionMetadata],"focused"===t)return void this.setBackgroundPreferences(e);e[r.mR.changeBackgroundDaily]=!0,this.setBackgroundPreferences(e)}}async resetGalleryStorageForPolicyCompliance(t,e,i){return e&&i?this.resetStorageForImagesOff(t):e?this.resetStorageForImageOfTheDayDisabled(t):!i||this.resetStorageForCustomImageDisabled(t)}async resetStorageForImagesOff(t){if(!t)return!1;const e={...t,changeBackgroundDaily:!1};return delete e[r.mR.backgroundSelectionMetadata],this.setBackgroundPreferences(e)}async resetStorageForImageOfTheDayDisabled(t){if(!t)return!1;const e={...t,changeBackgroundDaily:!1},i=e.backgroundSelectionMetadata;return i&&"BrowserLocal"!==i.provider&&"Theme"!==i.provider&&delete e[r.mR.backgroundSelectionMetadata],this.setBackgroundPreferences(e)}async resetStorageForCustomImageDisabled(t){if(!t)return!1;const e=t.backgroundSelectionMetadata;return!e||("Theme"===e.provider||"BrowserLocal"===e.provider?(delete t[r.mR.backgroundSelectionMetadata],this.setBackgroundPreferences(t)):this.setBackgroundPreferences(t))}async clearCachedBackground(t){const e=t||await this.getBackgroundPreferences();return!!e&&(!e.backgroundSelectionMetadata||(delete e[r.mR.backgroundSelectionMetadata],this.setBackgroundPreferences(e)))}setToastCooldown(t,e){let i=(0,d.Lg)().getObject(h.VP);i||(i={reducedMotionNextAvailableTimestamp:0});const r=Date.now()+this.calculateToastCooldown(e);"reducedMotion"===t&&(i.reducedMotionNextAvailableTimestamp=Date.now()+r),(0,d.Lg)().setObject(h.VP,i)}toastCooldownExpired(t){const e=(0,d.Lg)().getObject(h.VP);return!e||"reducedMotion"===t&&e.reducedMotionNextAvailableTimestamp<Date.now()}calculateToastCooldown(t){return 864e5*t}getNurturingErrorObject(){return{key:r.lD,value:{isError:!0}}}shouldDisableGalleryFeature(){return"true"===l._3.getQueryParameterByName("disableBackgroundGallery",(0,o.iA)())}async updateLayoutBasedOnBackgroundType(t){if(!(t=t||await this.getBackgroundPreferences()))return;const e=this.getBackgroundImageTypeFromSettings();p.l.updateLayoutAndBackgroundImageType(e)}setDailyRotationOnlySimpleImages(t){this.dailyRotationOnlySimpleImages=t}getDailyRotationOnlySimpleImages(){return this.dailyRotationOnlySimpleImages}isRubyImage(t,e){if(!t)return!1;const i=this.getRubyImageStartIndex(),s=i+(e?r.VR.dataDark:r.VR.dataLight).length-1,n=Number(t);return n>=i&&n<=s}}const S=(0,c.G)(P)},27061:function(t,e,i){"use strict";i.d(e,{l:function(){return d}});var r=i(65022),s=i(93468),n=i(7965),a=i(43666),o=i(43434),c=i(41820),u=i(28006),h=i(35849);const d=new class{get chromiumPageSettingsConnector(){return this._chromiumPageSettingsConnector||(this._chromiumPageSettingsConnector=(0,h.zP)(u.h$)),this._chromiumPageSettingsConnector}setLayoutFromPreset(t){if(!this.chromiumPageSettingsConnector)return void(0,s.vV)(r.yHB,"EdgeChromiumPageSettingsConnector is missing in BackgroundLayoutHelper for the setLayoutFromPreset method");const e=this.chromiumPageSettingsConnector.getCurrentState(),i=(0,a.J)(e.selectedFeedDisplaySetting,t,e.greetingEnabled,e.hideDefaultTopSites);if(e.currentLayout!==i){let t;if("custom"!==i){const r=n.c_[i];t={currentBackgroundImageType:r.current_background_image_type,originalLayout:e.currentLayout,currentLayout:i,greetingEnabled:r.greeting,imageOfTheDayEnabled:"off"!==r.current_background_image_type,hideDefaultTopSites:r.hide_promoted_links,selectedFeedDisplaySetting:r.feeds_position}}else{const e=this.chromiumPageSettingsConnector.getCurrentState();t={...e,originalLayout:e.currentLayout,currentLayout:i}}this.chromiumPageSettingsConnector.updateLayout(t),(0,o.qU)(c.K5.layout_mode,n.IT[t.currentLayout])}}updateLayoutAndBackgroundImageType(t,e){this.chromiumPageSettingsConnector?(e?this.updateToCustomLayoutMode():this.setLayoutFromPreset(t),this.chromiumPageSettingsConnector.updateBackgroundImageType(t)):(0,s.vV)(r.yHB,"EdgeChromiumPageSettingsConnector is missing in BackgroundLayoutHelper for the updateLayoutAndBackgroundImageType method")}updateToCustomLayoutMode(){if(!this.chromiumPageSettingsConnector)return void(0,s.vV)(r.yHB,"EdgeChromiumPageSettingsConnector is missing in BackgroundLayoutHelper for the updateToCustomLayoutMode method");const t=this.chromiumPageSettingsConnector.getCurrentState(),e={...t,originalLayout:t.currentLayout,currentLayout:"custom"};this.chromiumPageSettingsConnector.updateLayout(e),(0,o.qU)(c.K5.layout_mode,n.IT[e.currentLayout])}isImageOfTheDayDisabled(){if(!this.chromiumPageSettingsConnector)return void(0,s.vV)(r.yHB,"EdgeChromiumPageSettingsConnector is missing in BackgroundLayoutHelper for the isImageOfTheDayDisabled method");const t=this.chromiumPageSettingsConnector.getCurrentState(),e=t.backgroundImageTypePolicy&&(3===t.backgroundImageTypePolicy||1===t.backgroundImageTypePolicy);return void 0!==e&&0!==e&&e}isCustomImageDisabled(){if(!this.chromiumPageSettingsConnector)return void(0,s.vV)(r.yHB,"EdgeChromiumPageSettingsConnector is missing in BackgroundLayoutHelper for the isCustomImageDisabled method");const t=this.chromiumPageSettingsConnector.getCurrentState(),e=t.backgroundImageTypePolicy&&(3===t.backgroundImageTypePolicy||2===t.backgroundImageTypePolicy);return void 0!==e&&0!==e&&e}}},42e3:function(t,e,i){"use strict";i.d(e,{JW:function(){return a},VP:function(){return r},hr:function(){return s}});const r="galleryToastCooldowns",s=new Set(["overlay","positioning-region"]);var n;!function(t){t.reducedMotion="reducedMotion"}(n||(n={}));new Map([["imageAndVideo",["Video","CMSImage","Iris"]],["bing",["Iris"]],["custom",["BrowserLocal"]],["theme",["Theme"]]]);const a={backgroundSelectionMetadata:{appliedTimestamp:1721339696654,configIndex:"24",provider:"CMSImage"},changeBackgroundDaily:!1,selectedVideoSetting:"balanced"}},43434:function(t,e,i){"use strict";i.d(e,{UU:function(){return u},cv:function(){return a},kc:function(){return o},qU:function(){return c}});var r=i(88294),s=i(89980),n=i(98793);async function a(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;try{if(await o()&&e){const t=await n.Q.getPreferenceSetting(e);if(t&&void 0!==t.value)return JSON.parse(t.value.toString())}if(t){const e=(0,s.Lg)().getObject(t,void 0);if(void 0!==e)return JSON.parse(e)}return i}catch(t){return r.v.logError("Failed to parse the key."),!1}}async function o(){return await n.Q.isApiAvailableToUse()}function c(t,e){const i={setting:t,source:"ntp",timestamp:(new Date).getTime(),value:e};n.Q.savePreferenceSetting(t,i)}function u(t,e){let i=1;switch(t.selectedFeedDisplaySetting){case"always":i|=8;break;case"headingsonly":i|=512;break;case"onscroll":i|=64;break;case"peek":i|=2048;break;default:i|=0}return t.imageOfTheDayEnabled&&(i|=32),t.greetingEnabled&&e&&(i|=256),"off"!==t.selectedQuickLinksDisplaySetting&&(i|=2),"custom"===t.currentLayout&&(i|=128),i}},43666:function(t,e,i){"use strict";i.d(e,{J:function(){return s}});var r=i(7965);function s(t,e,i,s){if(!i||s)return"custom";const n=r.c_.focused,a=r.c_.informational,o=r.c_.inspirational;return t===n.feeds_position&&e===n.current_background_image_type?"focused":t===a.feeds_position&&e===a.current_background_image_type?"informational":t===o.feeds_position&&e===o.current_background_image_type?"inspirational":"custom"}},55457:function(t,e,i){"use strict";i.d(e,{$e:function(){return s},VR:function(){return o},et:function(){return a},lD:function(){return r},mR:function(){return n}});const r="background_setting_preferences",s="ntp.background_image";var n;!function(t){t.changeBackgroundDaily="changeBackgroundDaily",t.selectedVideoSetting="selectedVideoSetting",t.backgroundSelectionMetadata="backgroundSelectionMetadata",t.disableRubyBackground="disableRubyBackground"}(n||(n={}));const a=850,o=(new Map([["BrowserLocal","custom"],["Iris","bing"],["Theme","theme"],["Video","imageAndVideo"],["CMSImage","imageAndVideo"]]),new Map([["imageAndVideo",["Video","CMSImage","Iris"]],["bing",["Iris"]],["custom",["BrowserLocal"]],["theme",["Theme"]]]),Object.freeze({dataDark:[{attribution:"Microsoft",image:{i100:"AA1yQQ8v",i240:"AA1yQQ8v",i720:"AA1yQIZK",i1080:"AA1yQLvP",i1440:"AA1yQLvR",i2160:"AA1yQLvU"}},{attribution:"Microsoft",image:{i100:"AA1yQSyx",i240:"AA1yQSyx",i720:"AA1yQGXp",i1080:"AA1yQNKa",i1440:"AA1yQIZM",i2160:"AA1yQGXt"}},{attribution:"Microsoft",image:{i100:"AA1yQLvQ",i240:"AA1yQLvQ",i720:"AA1yQEJm",i1080:"AA1yQNKc",i1440:"AA1yQIZP",i2160:"AA1yQEJo"}},{attribution:"Microsoft",image:{i100:"AA1yQIZL",i240:"AA1yQIZL",i720:"AA1yQQ8y",i1080:"AA1yQQ8A",i1440:"AA1yQEJn",i2160:"AA1yQNKd"}},{attribution:"Microsoft",image:{i100:"AA1yQQ8w",i240:"AA1yQQ8w",i720:"AA1yQQ8x",i1080:"AA1yQQ8z",i1440:"AA1yQLvS",i2160:"AA1yQNKb"}},{attribution:"Microsoft",image:{i100:"AA1yQIZJ",i240:"AA1yQIZJ",i720:"AA1yQC58",i1080:"AA1yQC59",i1440:"AA1yQC5a",i2160:"AA1yQC5c"}},{attribution:"Microsoft",image:{i100:"AA1yQNK9",i240:"AA1yQNK9",i720:"AA1yQGXq",i1080:"AA1yQGXs",i1440:"AA1yQGXr",i2160:"AA1yQLvT"}}],dataLight:[{attribution:"Microsoft",image:{i100:"AA1yQSwh",i240:"AA1yQSwh",i720:"AA1yQC3g",i1080:"AA1yQLta",i1440:"AA1yQLta",i2160:"AA1yQC3l"}},{attribution:"Microsoft",image:{i100:"AA1yQC3h",i240:"AA1yQC3h",i720:"AA1yQLt9",i1080:"AA1yQEG0",i1440:"AA1yQGVM",i2160:"AA1yQGVN"}},{attribution:"Microsoft",image:{i100:"AA1yQEG3",i240:"AA1yQEG3",i720:"AA1yQNHj",i1080:"AA1yQLtb",i1440:"AA1yQNHn",i2160:"AA1yQLtg"}},{attribution:"Microsoft",image:{i100:"AA1yQEG1",i240:"AA1yQEG1",i720:"AA1yQGVL",i1080:"AA1yQEG4",i1440:"AA1yQEG5",i2160:"AA1yQLtf"}},{attribution:"Microsoft",image:{i100:"AA1yQC3j",i240:"AA1yQC3j",i720:"AA1yQNHl",i1080:"AA1yQQ5s",i1440:"AA1yQNHo",i2160:"AA1yQIWR"}},{attribution:"Microsoft",image:{i100:"AA1yQGVK",i240:"AA1yQGVK",i720:"AA1yQIWO",i1080:"AA1yQC3i",i1440:"AA1yQC3k",i2160:"AA1yQLte"}},{attribution:"Microsoft",image:{i100:"AA1yQIWQ",i240:"AA1yQIWQ",i720:"AA1yQLtd",i1080:"AA1yQSwj",i1440:"AA1yQNHm",i2160:"AA1yQSwi"}}]}),Object.freeze({dataLight:[{attribution:"Microsoft",image:{i100:"AA1Ps1bp",i240:"AA1Ps1bp",i720:"AA1PsdB8",i1080:"AA1Ps6xI",i1440:"AA1PrUxg",i2160:"AA1PrUk8"}},{attribution:"Microsoft",image:{i100:"AA1Ps3Nm",i240:"AA1Ps3Nm",i720:"AA1PrX5C",i1080:"AA1PrX7n",i1440:"AA1PsglX",i2160:"AA1PrYEe"}},{attribution:"Microsoft",image:{i100:"AA1PrYKL",i240:"AA1PrYKL",i720:"AA1PrYOf",i1080:"AA1Ps3RS",i1440:"AA1Ps8Lz",i2160:"AA1Psb1q"}},{attribution:"Microsoft",image:{i100:"AA1PsgdA",i240:"AA1PsgdA",i720:"AA1Ps8Ij",i1080:"AA1Ps8Ku",i1440:"AA1Ps3T1",i2160:"AA1PrWU7"}},{attribution:"Microsoft",image:{i100:"AA1Psit8",i240:"AA1Psit8",i720:"AA1PrYOe",i1080:"AA1PsdCv",i1440:"AA1Ps3SU",i2160:"AA1PrWU5"}},{attribution:"Microsoft",image:{i100:"AA1PsdxE",i240:"AA1PsdxE",i720:"AA1Ps1eZ",i1080:"AA1PrX7m",i1440:"AA1PrNb3",i2160:"AA1Ps14B"}},{attribution:"Microsoft",image:{i100:"AA1Ps8EC",i240:"AA1Ps8EC",i720:"AA1Ps6vw",i1080:"AA1Psiy7",i1440:"AA1PsglU",i2160:"AA1PsdrS"}},{attribution:"Microsoft",image:{i100:"AA1PrYKM",i240:"AA1PrYKM",i720:"AA1Ps8Ie",i1080:"AA1Psgkp",i1440:"AA1Ps1h8",i2160:"AA1Psb1r"}},{attribution:"Microsoft",image:{i100:"AA1Ps3Nk",i240:"AA1Ps3Nk",i720:"AA1Ps8Id",i1080:"AA1Ps1go",i1440:"AA1Ps8Lv",i2160:"AA1Ps3GG"}},{attribution:"Microsoft",image:{i100:"AA1PrX1i",i240:"AA1PrX1i",i720:"AA1PrUu8",i1080:"AA1PrYQr",i1440:"AA1Ps6za",i2160:"AA1PrYEg"}},{attribution:"Microsoft",image:{i100:"AA1Ps8ED",i240:"AA1Ps8ED",i720:"AA1Psbdp",i1080:"AA1Psgks",i1440:"AA1PrX8i",i2160:"AA1Ps14y"}}],dataDark:[{attribution:"Microsoft",image:{i100:"AA1Psgdx",i240:"AA1Psgdx",i720:"AA1Ps3Qa",i1080:"AA1Psiy8",i1440:"AA1PsglW",i2160:"AA1PrUk9"}},{attribution:"Microsoft",image:{i100:"AA1PrX1g",i240:"AA1PrX1g",i720:"AA1Psgi8",i1080:"AA1Psbfr",i1440:"AA1PrYRz",i2160:"AA1Ps14A"}},{attribution:"Microsoft",image:{i100:"AA1PrN3F",i240:"AA1PrN3F",i720:"AA1PrYOg",i1080:"AA1PsdCx",i1440:"AA1PrNb4",i2160:"AA1Psg4J"}},{attribution:"Microsoft",image:{i100:"AA1Ps1br",i240:"AA1Ps1br",i720:"AA1PsiwA",i1080:"AA1Psiye",i1440:"AA1PrYRy",i2160:"AA1PrYEf"}},{attribution:"Microsoft",image:{i100:"AA1PrYKN",i240:"AA1PrYKN",i720:"AA1Ps1eX",i1080:"AA1PrN9F",i1440:"AA1PsdDw",i2160:"AA1PrSl2"}},{attribution:"Microsoft",image:{i100:"AA1Ps6qy",i240:"AA1Ps6qy",i720:"AA1Psiwy",i1080:"AA1Psiyd",i1440:"AA1Ps1ha",i2160:"AA1Ps8ym"}},{attribution:"Microsoft",image:{i100:"AA1Ps1bq",i240:"AA1Ps1bq",i720:"AA1Ps6vx",i1080:"AA1Ps8Kt",i1440:"AA1PrX8l",i2160:"AA1PsdrT"}},{attribution:"Microsoft",image:{i100:"AA1PrX1h",i240:"AA1PrX1h",i720:"AA1PrN7Q",i1080:"AA1PrYQo",i1440:"AA1PsizJ",i2160:"AA1Ps3GH"}},{attribution:"Microsoft",image:{i100:"AA1Psgdz",i240:"AA1Psgdz",i720:"AA1PrUu7",i1080:"AA1Psgkt",i1440:"AA1Ps6z8",i2160:"AA1Ps8yk"}},{attribution:"Microsoft",image:{i100:"AA1Ps6qz",i240:"AA1Ps6qz",i720:"AA1Ps3Qe",i1080:"AA1PrN9I",i1440:"AA1Psbh0",i2160:"AA1Psg4K"}},{attribution:"Microsoft",image:{i100:"AA1PrN3G",i240:"AA1PrN3G",i720:"AA1PrX5D",i1080:"AA1Psgkv",i1440:"AA1PrX8o",i2160:"AA1Ps14C"}}]}))},63592:function(){},77223:function(t,e,i){"use strict";i.d(e,{A:function(){return n}});var r=i(17254),s=i(7187);class n{constructor(){this._infoMap=new Map,this._unknown=[],this._errors=[]}static createSurfaceInfo(t,e,i,s){return{creatives:t||[],currentCreativeId:e,errors:i||[],lastUpdatedMarket:r.T3.CurrentMarket,lastUpdatedTime:(new Date).getTime(),placement:s}}static infoHasId(t){return t&&!(0,s.isNullOrUndefined)(t.placement)}static infoHasCreatives(t){return t&&!(0,s.isNullOrUndefined)(t.creatives)&&t.creatives.length>0}static infoHasErrors(t){return t&&!(0,s.isNullOrUndefined)(t.errors)&&t.errors.length>0}get(t){return!(0,s.isNullOrUndefined)(t)&&this._infoMap.has(t)?this._infoMap.get(t):null}add(t,e){t&&(e?this._infoMap.set(e,t):this._unknown.push(t))}addCreative(t,e){e&&"object"==typeof e?(0,s.isNullOrUndefined)(t)?this._unknown.push(n.createSurfaceInfo([e],null,null,null)):this.addData(t,e,!1):(0,s.isNullOrUndefined)(t)||this._infoMap.set(t,n.createSurfaceInfo(null,null,null,t))}addError(t,e){e&&"object"==typeof e&&0!==Object.keys(e).length&&((0,s.isNullOrUndefined)(t)?this._errors.push(e):this.addData(t,e,!0))}hasUnknowns(){return this._unknown.length>0}getUnknowns(){return this._unknown}hasUnclaimedErrors(){return this._errors.length>0}getUnclaimedErrors(){return this._errors}addData(t,e,i){if((0,s.isNullOrUndefined)(t)){const t=e;this._unknown.push(n.createSurfaceInfo([t],t.creativeId,null,null))}else if(this._infoMap.has(t)){this._infoMap.get(t)[i?"errors":"creatives"].push(e)}else{const r=e;this._infoMap.set(t,n.createSurfaceInfo(i?null:[r],i?null:r.creativeId,i?[e]:null,t))}}}},82356:function(t,e,i){"use strict";i.r(e),i.d(e,{IrisDataConnector:function(){return X},IrisImageHotSpotsDataValidator:function(){return W},IrisSurfaceName:function(){return f.EM},RegisterErrorTrackingCallback:function(){return P.s},ToolingInfo:function(){return Y},irisStorageUtility:function(){return w},isAadAccount:function(){return C}});var r=i(88294),s=i(65022),n=i(48172),a=i(98216);const o=new class{getAllCampaigns(){return new Promise(async t=>{try{await n.f.isApiAvailableToUse()?n.f.getPreferenceSetting("campaigns").then(e=>{const i=e&&e.value;i||r.v.logError("PSL: window.chrome.ntpSettingsPrivate.getPref does not have campaigns."),t(i||[])}):(a.YT.sendAppErrorEvent({...s.HaV,message:"PSL: Error fetching campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE"}),r.v.logError("PSL: Error fetching campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE"),t([]))}catch(e){a.YT.sendAppErrorEvent({...s.Ntn,message:`PSL fetch error. ${JSON.stringify(e)}`}),r.v.logError(e),t([])}})}persistCampaigns(t){return new Promise(async e=>{try{await n.f.isApiAvailableToUse()?(await n.f.savePreferenceSetting("campaigns",t),r.v.log(`PSL: Number of campaigns persisted: ${t.length||0}.`),e(!0)):(a.YT.sendAppErrorEvent({...s.TSj,message:"PSL: Error persisting campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE"}),r.v.logError("PSL: Error persisting campaigns due to window.chrome.ntpSettingsPrivate.getPref api not available for this version of EDGE"))}catch(t){a.YT.sendAppErrorEvent({...s.Ntn,message:`PSL persist error. ${JSON.stringify(t)}`}),r.v.logError(t)}e(!1)})}clearPersistentStorage(){return this.persistCampaigns([])}};var c=i(89980);const u=new class{constructor(){this.storageKey="irisNewsLocalStorage"}getAllCampaigns(){try{return(0,c.Lg)().getObject(this.storageKey)}catch(t){return r.v.logError(`Exception ${t} occurred retrieving user nurturing campaigns from local storage`),[]}}storeCampaigns(t){try{return(0,c.Lg)().setObject(this.storageKey,t),r.v.log(`Number of campaigns persisted in local storage: ${t.length||0}.`),!0}catch(t){return r.v.logError(`Exception ${t} occurred storing user nurturing campaigns in local storage`),!1}}clearLocalStorage(){return this.storeCampaigns([])}};var h=i(17254),d=i(19548),l=i(16507),g=i(12870),A=i(45181),f=i(98421),m=i(77246),p=i(27261),y=i(79742),P=i(84637),S=i(7187);const w=new class{constructor(){this.cachedSurfaceMap=new Map,this.enabledFeatures=[],this.irisSessionContextAttributes=new Map,this.millisecondsInADay=864e5,this.timeNow=(new Date).getTime(),(0,m.S)()&&(this.appType=h.T3&&h.T3.AppType,"edgeChromium"===this.appType&&(this.configDataPromise=this.getConfigDataAsync()),this.currentURL=(0,p.iA)())}get isEnabled(){return!!this.shouldUseCache()||!(!this.irisDataConfig||!this.irisDataConfig.enableCaching)&&this.isCookieConsentNotRequired()}set IrisDataConfig(t){this.irisDataConfig=t}clearCachedSurfaceMap(){this.isEnabled&&this.cachedSurfaceMap.clear()}async populateCachedSurfaceMap(){if(this.isEnabled)try{if(this.purgeCacheWithQsp())return await this.clearCachedSurfacesFromStorage(),void r.v.log("Cache purged!");this.clearCachedSurfaceMap();let t=[];if(t="edgeChromium"===h.T3.AppType?await o.getAllCampaigns():u.getAllCampaigns(),!t||0===t.length)return void r.v.log("Bulk read of surfaces from local/persistent storage didn't return a surface.");const{subscribers:e}=this.irisDataConfig,i=[];Object.keys(e).forEach(t=>{e[t].active||i.push(f.j$[t])}),t.forEach(t=>{t&&t.placement&&(0===i.length||-1===i.indexOf(t.placement))&&(this.cachedSurfaceMap.set(t.placement,t),r.v.log(`Populated ${t.placement} from local/persistent storage.`))})}catch(t){r.v.logError(`Bulk read of surfaces from local/persistent storage threw error: ${t}`)}}getCachedSurface(t){if(!t||0===t.length||0===this.cachedSurfaceMap.size)return null;if(!this.cachedSurfaceMap.has(t))return null;const e=this.cachedSurfaceMap.get(t);return e&&e.creatives&&0!==e.creatives.length?e:null}addSurfaceToCachedSurfaceMap(t){if(!t||!t.placement)return;const e=t.placement,i=new Map;let s;if(this.cachedSurfaceMap.has(e)&&(s=this.cachedSurfaceMap.get(e),s.creatives.forEach(t=>{i.set(t.creativeId,t)})),t.creatives&&t.creatives.length>0){const e=(0,f.EJ)()?f.EM.MSNAnaheimNewsNTPImages+f.tm:f.EM.MSNAnaheimNewsNTPImages,r=f.j$[e];if(t.placement===r){if(s&&s.imageInfo)t.imageInfo=s.imageInfo;else{const e={dislikedCreatives:[],dislikedCreativeCountCurrentPeriod:0};t.imageInfo=e}this.hasUpdateTimeExpired(r,24)&&(t.imageInfo.dislikedCreativeCountCurrentPeriod=0),i.clear(),i.set(t.creatives[0].creativeId,t.creatives[0])}t.creatives.forEach(t=>{const e=i.get(t.creativeId);if(e&&(e.content=t.content,i.set(t.creativeId,e)),!e){const e={lastAddedTime:this.timeNow,useCount:0,useTime:0};t.storageInfo=e,i.set(t.creativeId,t)}})}t.creatives=[...i.values()],this.cachedSurfaceMap.set(e,t),r.v.log(`Adding/Updating SurfaceInfo ${e} in storage.`)}async addSurfacesToStorage(t){t&&t.length>0&&(t.forEach(t=>{this.addSurfaceToCachedSurfaceMap(t)}),await this.persistAllSurfaces())}async persistAllSurfaces(){if(this.isEnabled){if("edgeChromium"===h.T3.AppType)return void await o.persistCampaigns([...this.cachedSurfaceMap.values()]);u.storeCampaigns([...this.cachedSurfaceMap.values()])}}async clearCachedSurfacesFromStorage(){this.isEnabled&&(this.clearCachedSurfaceMap(),"edgeChromium"!==h.T3.AppType?u.clearLocalStorage():await o.clearPersistentStorage())}async resetSurfaceLastUpdateTime(t){if(!this.isEnabled&&!this.cachedSurfaceMap.get(t))return;const e=this.cachedSurfaceMap.get(t);e.lastUpdatedTime=-1,this.cachedSurfaceMap.set(t,e),this.persistAllSurfaces()}getCachedSurfaceMap(){return this.cachedSurfaceMap}haveWeShownCurrentCreativeRecently(t){if((0,S.isNullOrUndefined)(t.currentCreativeId))return!0;if(this.ignoreCreativeUseTime())return!1;let e=!0;return t.creatives.forEach(i=>{i.creativeId===t.currentCreativeId&&i.storageInfo&&i.storageInfo.useTime+14*this.millisecondsInADay<this.timeNow&&(e=!1)}),e}haveWeShownCreativeTooManyTimes(t){if((0,S.isNullOrUndefined)(t)||(0,S.isNullOrUndefined)(t.currentCreativeId))return!0;if(this.ignoreMaxCapPerCreative())return!1;let e=!0;return t.creatives.forEach(i=>{t.currentCreativeId===i.creativeId&&i.storageInfo&&i.storageInfo.useCount<=2&&(e=!1)}),e}getSurfaceWithSelectedCreative(t){if((0,S.isNullOrUndefined)(t.currentCreativeId))return null;let e;return t.creatives.forEach(i=>{t.currentCreativeId===i.creativeId&&(e=i)}),{...t,creatives:[e]}}updateAction(t,e,i){if(t&&e&&this.cachedSurfaceMap.has(t)){const r=this.cachedSurfaceMap.get(t);r&&r.creatives&&r.creatives.forEach(t=>{t.creativeId===e&&t.storageInfo&&(t.storageInfo.irisAction=i)})}}markCreativeAsSeenByUser(t,e){if(t&&e&&this.cachedSurfaceMap.has(t)){const i=this.cachedSurfaceMap.get(t);i&&i.creatives&&i.creatives.forEach(t=>{t&&t.creativeId&&t.creativeId===e&&t.storageInfo&&(t.storageInfo.useCount++,t.storageInfo.lastAddedTime=this.timeNow,t.storageInfo.useTime=this.timeNow)})}}updateCreativeLatestAddedTime(t,e,i){if(!this.cachedSurfaceMap.has(t))return;const r=this.cachedSurfaceMap.get(t);r&&r.creatives&&0!==r.creatives.length&&r.creatives.forEach(t=>{t&&t.creativeId===e&&t.storageInfo&&t.storageInfo.lastAddedTime&&(t.storageInfo.lastAddedTime=i)})}purgeCacheWithQsp(){if(this.currentURL){const t=d._3.getQueryParameterByName("purgeCache",this.currentURL);if(t&&"true"===t.toLocaleLowerCase())return!0}return!1}shouldUseCache(){if(this.currentURL){const t=d._3.getQueryParameterByName("useCache",this.currentURL);if(t)return"true"===t.toLocaleLowerCase()}return!1}ignoreMaxCapPerCreative(){if(this.currentURL){const t=d._3.getQueryParameterByName("ignoreMaxCapPerCreative",this.currentURL);if(t)return"true"===t.toLocaleLowerCase()}return!1}ignoreUpdateTimeExpiration(){if(this.currentURL){const t=d._3.getQueryParameterByName("ignoreUpdateTimeExpiration",this.currentURL);if(t)return"true"===t.toLocaleLowerCase()}return!1}ignoreCreativeUseTime(){if(this.currentURL){const t=d._3.getQueryParameterByName("ignoreCreativeUseTime",this.currentURL);if(t)return"true"===t.toLocaleLowerCase()}return!1}ignoreBlackout(){if(this.currentURL){const t=d._3.getQueryParameterByName("ignoreBlackout",this.currentURL);if(t)return"true"===t.toLocaleLowerCase()}return!1}isCookieConsentNotRequired(){return A.n.get(A.Y.CookieConsentStatus)===y.z.NotRequired}async getConfigDataAsync(){return this.getConfigDataPromise=new Promise(t=>{try{(0,m.S)()&&window&&window.chrome&&window.chrome.ntpSettingsPrivate&&"function"==typeof window.chrome.ntpSettingsPrivate.getConfigData?window.chrome.ntpSettingsPrivate.getConfigData(e=>{void 0!==e?(this.profileCreationTimeInMs=e.profileCreationTime,this.enabledFeatures=e.enabledFeatures,this.configData=e,t()):(P.s.trackAppErrorEvent({...s.JwI,message:"Config data is undefined"}),t())}):(P.s.trackAppErrorEvent({...s.lW$,message:"Failed to fetch config data from chromium API"}),t())}catch(e){P.s.trackAppErrorEvent({...s.kL,message:"Exception fetching config data from chromium API",pb:{...s.kL.pb,customMessage:`Exception: ${e}`}}),t()}}),this.getConfigDataPromise}async isBlackoutPeriodOver(){if(this.ignoreBlackout())return!0;if("edgeChromium"===this.appType){if(h.T3.IsFrePage)return!1;await this.getConfigDataPromise}const t=this.irisDataConfig.blackoutPeriodInDays&&this.irisDataConfig.blackoutPeriodInDays*this.millisecondsInADay||7*this.millisecondsInADay;return!!this.profileCreationTimeInMs&&this.timeNow-this.profileCreationTimeInMs>t}async getIrisSessionContextAttribute(t){return"edgeChromium"===this.appType&&await this.getConfigDataPromise,this.irisSessionContextAttributes.has(t)?this.irisSessionContextAttributes.get(t):""}setIrisSessionContextAttributes(t){if(l.n.isNotNullOrUndefined(t)&&t.length>0){t.startsWith("&")&&t.length>=1&&(t=t.substring(1));t.split("&").map(t=>t.split("=")).forEach(t=>{this.irisSessionContextAttributes.set(t[0],t[1])})}}getConfigData(){return this.configData}hasUpdateTimeExpired(t,e){if(this.ignoreUpdateTimeExpiration())return!0;const i=this.cachedSurfaceMap.get(t);if((0,S.isNullOrUndefined)(i))return r.v.log(`IrisDataConnector: Has update time expired. placement: ${t}. Placement not in PSL.`),!0;const s=(0,S.isNullOrUndefined)(i.lastUpdatedTime)?-1:i.lastUpdatedTime;if(s<0)return r.v.log(`IrisDataConnector: Has update time expired. placement: ${t}. Invalid lastUpdatedTime.`),!0;const n=s+36e5*e;return r.v.log(`IrisDataConnector: Has update time expired. placement: ${t}. Current time: ${this.timeNow}, lastUpdatedTime: ${n}. Result: ${n<this.timeNow}`),n<this.timeNow}getDislikeList(t){return t&&t.length>0?t.join(";"):""}hasMarketChanged(t){const e=this.cachedSurfaceMap.get(t);if((0,S.isNullOrUndefined)(e))return r.v.log(`IrisDataConnector: has market changed. placement: ${t}. Placement not in PSL.`),!0;const i=!!(0,S.isNullOrUndefined)(e.lastUpdatedMarket)||e.lastUpdatedMarket!==h.T3.CurrentMarket;return r.v.log(`IrisDataConnector: has market changed. placement: ${t} - ${i}.`),i}getImageInfo(t){const e=this.cachedSurfaceMap.get(t);return e&&e.imageInfo?e.imageInfo:null}addImageCreativeToDislikeList(){const t=(0,f.EJ)()?f.j$[f.EM.MSNAnaheimNewsNTPImages+f.tm]:f.j$[f.EM.MSNAnaheimNewsNTPImages],e=this.cachedSurfaceMap.get(t),i=e.creatives[0].creativeId;if((0,S.isNullOrUndefined)(e)||(0,S.isNullOrUndefined)(e.imageInfo))return!1;if(e.imageInfo.dislikedCreativeCountCurrentPeriod>=5)return!1;if((0,S.isNullOrUndefined)(e.imageInfo.dislikedCreatives))e.imageInfo.dislikedCreatives=[i];else{const t=e.imageInfo.dislikedCreatives.length;let r=!1;if(e.imageInfo.dislikedCreatives.forEach(t=>{t!==i||(r=!0)}),r)return!0;t>=20&&e.imageInfo.dislikedCreatives.shift(),e.imageInfo.dislikedCreatives.push(i)}return e.imageInfo.dislikedCreativeCountCurrentPeriod+=1,w.persistAllSurfaces(),!0}};async function C(){await h.T3.AccountInfoPromise;const t=h.T3.ResolvedAccountInfo;return(0,S.isNullOrUndefined)(g.Rb.AadState)?"AAD"===(t&&t.account_type):g.Rb.AadState}var b,v=i(3642),I=i(94864),k=i(93468);!function(t){t[t.Unknown=0]="Unknown",t[t.MissingContext=1]="MissingContext",t[t.QueryParametersInvalid=2]="QueryParametersInvalid",t[t.FetchFailure=3]="FetchFailure",t[t.ResponseFailure=4]="ResponseFailure",t[t.Unparsable=5]="Unparsable",t[t.UnconvertableCreative=6]="UnconvertableCreative",t[t.ActionUrlInvalid=7]="ActionUrlInvalid",t[t.ActionCallFail=8]="ActionCallFail",t[t.ActionResponseInvalid=9]="ActionResponseInvalid"}(b||(b={}));class ${static create(t,e,i,r){return{appError:i,customMessage:r,errorMessage:e,irisErr:t}}static typeCheck(t){return t&&"object"==typeof t&&!(0,S.isNullOrUndefined)(t.irisErr)}}const M=()=>{const t={resolve:null,waiting:null};return t.waiting=new Promise(e=>{t.resolve=e}),t};class E{static createIrisRequestContext(t,e){return{queryParams:t,...e?{includedHeaders:e}:{}}}static async callIris(t){if((0,S.isNullOrUndefined)(t))throw $.create(b.MissingContext,"IRIS: Request context undefined or null",s.Beh,`Request context: ${JSON.stringify(t)}`);const e=this.validateQParams(t.queryParams);if(e)throw $.create(b.QueryParametersInvalid,"IRIS: Invalid query parameters",s.F$A,`Error validating query parameters: ${e} query parameters: ${JSON.stringify(t.queryParams)}`);const i=E.generateGuid();t.queryParams.asid=i;const n=this.assembleQParameters(t.queryParams),a=this.formatQParameters(n),o=new URL(f.wv+"?"+a),c=this.getHeaders(t.includedHeaders),u=this.getRequestInit(c);let h;const d=M();setTimeout(()=>{h="Timeout occurred.",d.resolve()},f.o3);const l=await Promise.race([d.waiting,fetch(o,u).catch(t=>{h=`Fetch failure caused by ${JSON.stringify(t)}`})]),g=l&&l.status;if(!l||g&&!(g>=200&&g<300))throw h&&(/^Timeout/.test(h)||/^Fetch/.test(h))&&(r.v.log(`Iris: Arc call failed due to ${h}`),(0,k.vV)(s.zWf,`Arc call failed due to ${h}`)),$.create(b.ResponseFailure,"Iris: Arc call failed.",s.VxE,`Request url: ${o} Response status code: ${g} Response: ${JSON.stringify(l)}`);let A;try{if(A=await l.text(),!A)throw"empty response body";const e=JSON.parse(A);if(!e)throw"error parsing json response";return{parsedResponse:e,reqContext:t}}catch(t){const e=A??l;throw $.create(b.ResponseFailure,`Iris: Unable to parse iris resposne due to ${t}`,s.YG1,`Request url: ${o} Response status code: ${g} Response: ${JSON.stringify(e)}`)}}static formatTelemetryActionUrl(t,e){return t&&e?t.replace(/\{ACTION\}/,e):null}static async updateIris(t,e){if((0,S.isNullOrUndefined)(t))throw $.create(b.ActionUrlInvalid,"Iris: Action beacon undefined or null",void 0,`Iris action url: ${t} headers: ${JSON.stringify(e)}`);const i=new URL(t),n=this.getHeaders(e),o=this.getRequestInit(n);let c;const u=M();setTimeout(()=>{c="Timeout occurred.",u.resolve()},f.T);const h=await Promise.race([u.waiting,fetch(i,o).catch(t=>{c=`fetch failure caused by: ${JSON.stringify(t)}`})]),d=h&&h.status;if(!h||d&&d<200&&d>=300)throw c&&(/^Timeout/.test(c)||/^Fetch/.test(c))&&(r.v.log(`Iris: Arc call failed due to ${c}`),a.YT.sendAppErrorEvent({...s.CIk,message:`Arc call failed due to ${c}`})),$.create(b.ActionResponseInvalid,"Iris: Arc call failed.",s.rUn,`Request url: ${i} Response status code: ${d} Response: ${JSON.stringify(h)}`);return h}static createPropertyBagErrorMessage(t,e,i,r){return`Placement=${t}, Asid=${e}, Market=${i}, ${r}`}static getHeaders(t){const e=new Headers;return t&&((0,S.isNullOrUndefined)(t.xSdkIaf)||e.set("x-sdk-iaf",t.xSdkIaf)),e}static formatQParameters(t){if((0,S.isNullOrUndefined)(t))return null;const e=/[^=]/,i=[];for(const r in t)!(0,S.isNullOrUndefined)(t[r])&&e.test(t[r])&&i.push(`${r}=${t[r]}`);return i.length>0?i.join("&"):null}static getDefaultAppParameters(t){if(!h.T3)return r.v.log(`Iris: Missing App Environment Object: ${h.T3}`),a.YT.sendAppErrorEvent({...s.TLG,message:`App environment undefined. Placement: ${JSON.stringify(t.placement)}`}),null;let e;const i={locale:h.T3.CurrentMarket,country:h.T3.CountryCode,muid:h.T3.UserId?h.T3.UserId.replace(/^m-/,""):null};return i.muid||(e=`UserId: ${i.muid}`),i.locale||(e=(e?", ":"")+`Market: ${i.locale}`),i.country||(e=(e?", ":"")+`CountryCode: ${i.country}`),e&&(r.v.log(`Iris: Missing ${e} from App Environment Object`),(0,k.vV)(s.zl3,`Missing App environment properties. Placement: ${JSON.stringify(t.placement)}. Error: ${e}`)),i}static getRequiredStaticParameters(){return{nct:"1",fmt:"json",nocookie:"1"}}static assembleQParameters(t){if((0,S.isNullOrUndefined)(t))return(0,k.vV)(s.DiI,"Undefined query param for ARC request."),null;const e=this.getRequiredStaticParameters(),i=this.getDefaultAppParameters(t),r=(0,f.lu)(),n=(0,f.yw)();return Object.assign({},e,i||{},r||{},n,t)}static validateQParams(t){if((0,S.isNullOrUndefined)(t))return"untargetable; no query params";if(!t.placement)return"untargetable; no placement";if(/\|/.test(t.placement)){if(!t.bcnt)return"untargetable; no bcnt for batch request";const e=t.placement.split("|").length,i=t.bcnt.split("|").length;if(e!==i)return"untargetable; batch size mismatch p="+e+" b="+i}}static getDigit(t){let e=(new Date).getTime();const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)}static generateGuid(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,E.getDigit)}static getRequestInit(t){return{method:"GET",headers:t,credentials:"include"}}}var x=i(92528);class Q{static isError(t){return!(0,S.isNullOrUndefined)(t)&&"object"==typeof t&&!(0,S.isNullOrUndefined)(t.error)||!(0,S.isNullOrUndefined)(t.code)}static handleError(t,e){if(t&&"number"==typeof t.code)if(t.code>=1e3&&t.code<=1999)this.sendAppError(s.d1n,t.code,e);else if(t.code>=3e3&&t.code<=3999)this.sendAppError(s.RLY,t.code,e);else switch(t.code){case 0:case 2e3:case 2040:break;case 2010:this.sendAppError(s.FgT,t.code,e);break;case 2020:this.sendAppError(s.L6t,t.code,e);break;default:this.sendAppError(s.fuN,t.code,e)}}static isValidSingleResponse(t){return!(0,S.isNullOrUndefined)(t)&&"object"==typeof t&&!(0,S.isNullOrUndefined)(t.prm)&&(0,x.a)(t.prm._id)&&(0,x.a)(t.prm._imp)&&!(0,S.isNullOrUndefined)(t.tracking)&&(0,x.a)(t.tracking.baseUri)&&!(0,S.isNullOrUndefined)(t.ad)&&!(0,S.isNullOrUndefined)(t.rdr)&&t.rdr.length>0&&(0,x.a)(t.rdr[0].c)&&(0,x.a)(t.rdr[0].u)&&(0,x.a)(t.f)&&(0,x.a)(t.v)}static isBatchResponse(t){return!(0,S.isNullOrUndefined)(t)&&"object"==typeof t&&!(0,S.isNullOrUndefined)(t.batchrsp)}static batchContainsItems(t){return t&&!(0,S.isNullOrUndefined)(t.items)&&"object"==typeof t.items&&t.items.length>0}static batchContainsErrors(t){return t&&!(0,S.isNullOrUndefined)(t.errors)&&"object"==typeof t.errors&&t.errors.length>0}static decodeSingleResponseString(t){if(!(0,x.a)(t))return null;try{return JSON.parse(t)}catch(e){return a.YT.sendAppErrorEvent({...s.nWp,message:"Exception parsing JSON",pb:{...s.nWp.pb,customMessage:`Error parsing json encodedString: ${t}`}}),null}}static sendAppError(t,e,i){a.YT.sendAppErrorEvent({...t,message:`err: ${e}`,pb:{...t.pb,customMessage:i&&i.queryParams?E.createPropertyBagErrorMessage(i.queryParams.placement,i.queryParams.asid,i.queryParams.locale):""}})}}var D=i(77223);class N{static async requestSurfaceInfo(t,e){if(!t)return a.YT.sendAppErrorEvent({...s.YZV,message:"Attempted iris call without any params."}),Promise.reject("Attempted iris call without any params.");const i=E.createIrisRequestContext(t,e);return await E.callIris(i).then(N.mapResponse).then(N.handleUnclaimedErrors).catch(t=>{let e,r,n;return $.typeCheck(t)&&(e=t.appError,r=t.customMessage,n=t.errorMessage),e=e||s._v6,a.YT.sendAppErrorEvent({...e,message:n||"Unhandled error encountered requesting/processing iris call",pb:{...e.pb,customMessage:r||`Error: ${JSON.stringify(t)} requestContext: ${JSON.stringify(i)}`}}),Promise.reject(t)})}static async sendActionUpdate(t,e){try{return await E.updateIris(t,e)}catch(i){let r,n,o;return $.typeCheck(i)&&(r=i.appError,n=i.customMessage,o=i.errorMessage),r=r||s._v6,a.YT.sendAppErrorEvent({...r,message:o||"Unhandled error encountered requesting/processing iris action update call",pb:{...r.pb,customMessage:n||`Error: ${JSON.stringify(i)} actionUrl: ${JSON.stringify(t)} includedHeaders: ${JSON.stringify(e)}`}}),Promise.reject(i)}}static async handleUnclaimedErrors(t){if(t&&t.collection&&t.collection.hasUnclaimedErrors()){t.collection.getUnclaimedErrors().forEach(e=>{Q.handleError(e,t.reqContext)})}return t}static async mapResponse(t){if(!t||!t.parsedResponse)return Promise.resolve(null);const e=t.parsedResponse,i=t.reqContext&&t.reqContext.queryParams&&/^[^|]*$/.test(t.reqContext.queryParams.placement)?t.reqContext.queryParams.placement:null,r=new D.A,n={collection:r,reqContext:t.reqContext};if(Q.isError(e))return r.addError(i,{...e,placement:i}),Promise.resolve(n);if(Q.isBatchResponse(e)){if(Q.batchContainsItems(e.batchrsp)){e.batchrsp.items.forEach(t=>{const e=t.placement?t.placement:i;N.extractCreativesFromItem(t,e,r)})}if(Q.batchContainsErrors(e.batchrsp)){e.batchrsp.errors.forEach(t=>{r.addError(t.placement||i,t)})}}else{const n=N.convertToCreative(e);if(r.addCreative(i,n),!n){const e=t.reqContext&&t.reqContext.queryParams&&t.reqContext.queryParams.asid;a.YT.sendAppErrorEvent({...s.tJt,message:"Iris: Attempt to convert iris response to creative failed",pb:{...s.tJt.pb,customMessage:`ASID: ${e} RequestContext: ${JSON.stringify(t.reqContext)} Response: ${JSON.stringify(t.parsedResponse)}`}})}}return Promise.resolve(n)}static convertToCreative(t){const e=t&&"string"==typeof t?Q.decodeSingleResponseString(t):t;if(e&&Q.isValidSingleResponse(e))return{creativeName:e.rdr[0].c,creativeNamespace:e.rdr[0].u,content:e.ad,creativeId:e.prm._id,telemetry:{impressionUrl:e.prm._imp,actionUrl:e.tracking.baseUri}};const i=e&&e.prm&&e.prm._id;return a.YT.sendAppErrorEvent({...s._5U,message:"Iris: Response format invalid - creativeId",pb:{...s._5U.pb,customMessage:`Error converting response into creative due to invalid format creativeId: ${i}\n                    encodedString: ${"object"==typeof t?JSON.stringify(t):t}\n                    decodedString: ${"object"==typeof e?JSON.stringify(e):e}`}}),null}static addIrisEntityToCollection(t,e,i){if(!e||!i)return;const r=N.convertToCreative(e);r&&i.addCreative(t,r)}static extractCreativesFromItem(t,e,i){i&&t&&(t.items&&t.items.length>0&&t.items.forEach(t=>{N.addIrisEntityToCollection(e,t,i)}),t.item&&N.addIrisEntityToCollection(e,t.item,i))}}var T,L=i(10610),B=i(10268),R=i(28006);!function(t){t.Android="android",t.Ios="ios",t.Linux="linux",t.Macos="macos",t.Windows="windows",t.Xbox="xbox"}(T||(T={}));const O={edge:"1",chrome:"2",internetExplorer:"3",firefox:"4",safari:"5",chromium:"6",edgeChromium:"6",[T.Android]:"12",[T.Ios]:"13"},U={homePage:"1",edgeChromiumdhp:"2",edgeChromiumntp:"3",windows:"7",windowsShell:"7",finance:"8",hub:"8",weather:"8",views:"9"},J={[T.Windows]:"WIN10",[T.Macos]:"MACOS",[T.Linux]:"LINUX",[T.Xbox]:"OTHER",[T.Android]:"ANDROID",[T.Ios]:"IOS"};var V=i(43434),G=i(63456),q=i(2462),F=i(35849);class j{static async runValidation(t,e){switch(t){case f.EM.MSNAnaheimNewsNTPImages:case f.EM.MSNAnaheimNewsNTPImages+f.tm:{const i=!(0,S.isNullOrUndefined)(e)&&e,s=f.j$[t],n=w.hasUpdateTimeExpired(s,24),a=w.hasMarketChanged(s);if(!a&&!n&&!i||h.T3.IsFrePage)return void r.v.log(`IrisDataConnector: Image surface blocked: market changed - ${a}, has image expired - ${n}, dislike triggered - ${i}, FRE - ${h.T3.IsFrePage}.`);let o=null;const c=w.getImageInfo(s);if(i&&c){o={xSdkIaf:w.getDislikeList(c.dislikedCreatives)}}const u={addToCall:!0,headers:{...o},parameters:{...await this.getCallParametersWithSessionContext(t,"1")}};return r.v.log(`IrisDataConnector: Image surface validated: market changed - ${a}, has image expired - ${n}, dislike triggered - ${i}, FRE - ${h.T3.IsFrePage}.`),u}case f.EM.MSNNewsCoachmark:case f.EM.MSNNewsCoachmark+f.tm:{const e=w.hasUpdateTimeExpired(f.j$[t],24),i=w.hasMarketChanged(f.j$[t]);if(!e&&!i)return void r.v.log(`IrisDataConnector: Coachmark surface blocked: last update time expired - ${e}, market changed - ${i}.`);const s={addToCall:!0,parameters:{...await this.getCallParametersWithSessionContext(t,"0")}};return r.v.log(`IrisDataConnector: Coachmark surface validated: last update time expired - ${e}, market changed - ${i}.`),s}case f.EM.WinHPCoachmark:case f.EM.WinHPCoachmark+f.tm:if(!t.endsWith(".int")){const e=w.hasUpdateTimeExpired(f.j$[t],24),i=w.hasMarketChanged(f.j$[t]);if(!e&&!i)return void r.v.log(`IrisDataConnector: WinHP Coachmark surface blocked: last update time expired - ${e}, market changed - ${i}.`)}return{addToCall:!0,parameters:{...await this.getCallParametersWithSessionContext(t,"0")}};case f.EM.ConditionalBanner:case f.EM.ConditionalBanner+f.tm:{const e=w.hasUpdateTimeExpired(f.j$[t],24),i=w.hasMarketChanged(f.j$[t]);if(!e&&!i)return void r.v.log(`IrisDataConnector: Conditional Banner surface blocked: last update time expired - ${e}, market changed - ${i}.`);const s={addToCall:!0,parameters:{...await this.getCallParametersWithSessionContext(t,"0"),...j.getConditionalBannerIrisCallParameters(t)}};return r.v.log(`IrisDataConnector: Conditional Banner surface validated: last update time expired - ${e}, market changed - ${i}.`),s}case f.EM.MSNewsRewards:case f.EM.MSNewsRewards+f.tm:{const e=w.hasUpdateTimeExpired(f.j$[t],24),i=w.hasMarketChanged(f.j$[t]);if(!e&&!i)return void r.v.log(`IrisDataConnector: Rewards surface blocked: last update time expired - ${e}, market changed - ${i}.`);const s={addToCall:!0,parameters:{...await this.getCallParametersWithSessionContext(t,"0")}};return r.v.log(`IrisDataConnector: Rewards surface validated: last update time expired - ${e}, market changed - ${i}.`),s}default:return void P.s.trackAppErrorEvent({...s.Q1S,message:"Subscriber validation function not found.",pb:{...s.Q1S.pb,customMessage:"Subscriber: "+t}})}}static async getCallParametersWithSessionContext(t,e){const i={},r=[];i.nocookie="0"===e||"1"===e?e:"0";if("edgeChromium"===h.T3.AppType)for(const t in f.jt){const e=await w.getIrisSessionContextAttribute(f.jt[t]);(0,S.isNullOrUndefined)(e)||""===e?f.jt[t]!==f.jt.AcquisitionPath&&f.jt[t]!==f.jt.ConsumerVsEnterprise&&f.jt[t]!==f.jt.PrimaryBrowser&&f.jt[t]!==f.jt.DefaultBrowser&&r.push(f.jt[t]):i[f.jt[t]]=e}const n=this.getPageConfiguration();return""!==n&&(i.pageConfig=n),h.T3&&"edgeChromium"===h.T3.AppType&&""===n&&r.push("pg.c"),r.length>0&&P.s.trackAppErrorEvent({...s.ac1,message:"Missing parameters for subscriber",pb:{...s.ac1.pb,customMessage:`parameters ${r.toString()} for subscriber ${t}`}}),i}static getConditionalBannerIrisCallParameters(t){var e,i;const r={nocookie:"0"},n=(0,q.Ri)(g.Rb.AnonCookieName);r.ISSIGNEDIN=n?"1":"0";const a=(0,G.A)(g.Rb,"ClientSettings.apptype"),o=(0,G.A)(g.Rb,"ClientSettings.pagetype"),c=j.mapCanvasId(a,o),u=null===h.T3||void 0===h.T3||null===(e=h.T3.CurrentRequestTargetScope)||void 0===e?void 0:e.os;c&&(r.MSN_CANVAS=c),u&&("homePage"!==a&&"views"!==a||(r.OPSYS=J[u]));const d=(0,G.A)(g.Rb,"ClientSettings.browser"),l=(0,G.A)(g.Rb,"ClientSettings.deviceFormFactor"),A="TRUE"===(null==d||null===(i=d.ismobile)||void 0===i?void 0:i.toUpperCase())||"phone"===l?"1":"0";let f;r.ISMOBILE=A,!u||"1"!==A||"homePage"!==a&&"views"!==a?d&&(f=O[d.browserType]):f=O[u],f&&(r.BROWSER=f);const m=[];return"ISSIGNEDIN"in r||m.push("ISSIGNEDIN"),"MSN_CANVAS"in r||m.push("MSN_CANVAS"),"ISMOBILE"in r||m.push("ISMOBILE"),"BROWSER"in r||m.push("BROWSER"),m.length>0&&P.s.trackAppErrorEvent({...s.g7x,message:"Missing parameters for subscriber",pb:{...s.g7x.pb,customMessage:`parameters ${m.toString()} for subscriber ${t}`}}),r}static getPageConfiguration(){if(h.T3&&"edgeChromium"!==h.T3.AppType)return"";const t=(0,F.zP)(R.h$);if(!t)return"";const e=t.getCurrentState();if(!e)return"";let i=!1;"function"==typeof t.getPrimaryAccountInfoAsync&&t.getPrimaryAccountInfoAsync().then(t=>{i="MSA"===t.accountType});const r=(0,V.UU)(e,i);return r&&!isNaN(r)?r.toString():void 0}static mapCanvasId(t,e){let i=null;if("edgeChromium"===t)i=[t+e];else i=t;return U[i]}}var H,K=i(1732);class X extends B.u{constructor(t,e){if(super(t,e),this.availableCreatives=new Map,this.headers=[void 0],this.queryParameters=[void 0],this.surfaceInfoMap=new Map,e.disableIrisCalls||!e.subscribers)return void(this.callWasMade=!1);this.irisDataPromise=new Promise(async t=>{await w.configDataPromise,w.IrisDataConfig=e,this.appType=h.T3&&h.T3.AppType,this.internalPlacementUsed=this.config.isInternal||(0,f.EJ)(),this.appType?(this.isBlackoutPeriodOver="edgeChromium"!==this.appType||await w.isBlackoutPeriodOver(),await w.populateCachedSurfaceMap(),Object.keys(this.config.subscribers).forEach(async t=>{const e=this.internalPlacementUsed?t+f.tm:t,i=f.j$[e],r=w.getCachedSurface(i);r&&r.placement&&this.surfaceInfoMap.set(i,r)}),await this.prepareCallData(),!this.queryParameters||this.queryParameters.length<1?this.callWasMade=!1:(this.callIris(),this.callWasMade=!0),t()):this.callWasMade=!1}),this.irisDataPromise;const i=this.config.subscribers;Object.keys(i).forEach(t=>{const e=i[t].captureInitialStateOfCampaigns;if(e)for(const t in e)(0,c.Lg)().getObject(t)&&a.YT.addOrUpdateTmplString(`userEligibleToSeeCoachmark_${t}:1`)})}sendActionUpdate(t,e,i,s,n){let a;t&&e&&!this.isImagePlacement(t)&&(i===I.V.Impression?w.markCreativeAsSeenByUser(t,e):w.updateAction(t,e,n),w.persistAllSurfaces()),a=i===I.V.Impression?s.impressionUrl:E.formatTelemetryActionUrl(s.actionUrl,n);try{N.sendActionUpdate(a)}catch(t){r.v.log(`IrisDataConnector: Failed to report iris action update beacon due to error: ${JSON.stringify(t)}`)}}async getImagePayload(t){return t&&(await this.prepareCallData(!0),this.callIris(),this.callWasMade=!0),await this.getPayload(f.EM.MSNAnaheimNewsNTPImages)}async tryGetPreviousImagePayload(){return await this.getPayload(f.EM.MSNAnaheimNewsNTPImages,!0)}clearPreviousImagePayload(){this.surfaceInfoMap.delete(f.j$[f.EM.MSNAnaheimNewsNTPImages+f.PR])}async getPayload(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await this.irisDataPromise,this.callWasMade&&await this.callIrisPromise;let i=this.shouldUseRequestedIrisSurface();if(i&&i===t){this.internalPlacementUsed&&(i+=f.tm);const t=f.j$[i];return await this.tryGetSurfaceInfo(t)}let s=t;if(this.internalPlacementUsed?s=t+f.tm:e&&(s=t+f.PR),!(0,S.isNullOrUndefined)(f.j$[s])){const t=f.j$[s];return await this.tryGetSurfaceInfo(t)}return r.v.log(`IrisDataConnector: Surface requested ${s} was not found. `),null}async tryGetSurfaceInfoInternal(t){if(!this.surfaceInfoMap.has(t))return r.v.log(`IrisDataConnector: Placement: ${t} was not populated by local/persistent storage nor downloaded by network call.`),null;let e=this.surfaceInfoMap.get(t);return e=w.getSurfaceWithSelectedCreative(e),e}async tryGetSurfaceInfo(t){if(!this.surfaceInfoMap.has(t))return r.v.log(`IrisDataConnector: Placement: ${t} was not populated by local/persistent storage nor downloaded by network call.`),null;let e=this.surfaceInfoMap.get(t);return f.j$[f.EM.MSNAnaheimNewsNTPImages]===t||f.j$[f.EM.MSNAnaheimNewsNTPImages+f.PR]===t||f.j$[f.EM.MSNAnaheimNewsNTPImages+f.tm]===t||this.shouldBlockPsl()?e:await C()?(r.v.log(`IrisDataConnector: This is AAD user so not returning SurfaceInfo for: ${t} to experience.`),null):w.haveWeShownCurrentCreativeRecently(e)?(r.v.log(`IrisDataConnector: Already shown a campaign within 14 days so not returning SurfaceInfo for: ${t} to experience.`),null):w.haveWeShownCreativeTooManyTimes(e)?(r.v.log(`IrisDataConnector: Already shown a campaign too many times: ${t}.`),null):(e=w.getSurfaceWithSelectedCreative(e),e.creatives.length>0&&e.creatives[0].creativeId===this.creativeToShowUser?(r.v.log(`IrisDataConnector: Returning SurfaceInfo for: ${t} to experience.`),e):(r.v.log(`IrisDataConnector: Tried to return unselected campaign: ${t}.`),null))}async prepareCallData(t){this.queryParameters=[null],this.headers=[null];const e=[],i=[];let r,n,a=[];for(const o of Object.keys(this.config.subscribers)){let c;if(!this.config.subscribers[o].active)continue;const u=this.queryParameters.length,h=this.internalPlacementUsed?o+f.tm:o,d=f.j$[h];if(!d){P.s.trackAppErrorEvent({...s.TyC,message:"Subscriber not found in iris placement dictionary",pb:{...s.TyC.pb,customMessage:`Subscriber ${h} not found in dictionary`}});continue}const g=this.isImagePlacement(d),A=!(0,S.isNullOrUndefined)(t)&&t;if(!g&&(A||!this.isBlackoutPeriodOver))continue;const{creativeCount:m,performValidation:p,staticQueryParams:y,aflights:C}=this.config.subscribers[o];let b,v,I;if(this.config.enableBackgroundGallery&&g&&!t&&(b=await L.K.getBackgroundGalleryEligibilityAsync()),b){const t=await L.K.getBackgroundPreferences();v=t&&t.changeBackgroundDaily,I=t&&t.backgroundSelectionMetadata}if(v&&I&&"Iris"===I.provider)continue;if(p&&(c=await j.runValidation(h,A),!c||!c.addToCall))continue;!g||t||w.hasMarketChanged(d)||(this.previousNtpSurfaceInfoInRotation=this.surfaceInfoMap.get(d));let k=m||1;k=c&&c.parameters&&c.parameters.bcnt?c.parameters.bcnt:k,k<=0?P.s.trackAppErrorEvent({...s.bOs,message:"Creative count value is negative or zero",pb:{...s.bOs.pb,customMessage:`Creative count value is negative or zero : ${h}`}}):(g?this.queryParameters[u]={bcnt:k,placement:d}:(i.push(k),e.push(d)),l.n.isNotNullOrUndefined(y)&&(g?this.queryParameters[u]={...this.queryParameters[u],...y}:n={...n,...y}),c&&c.parameters&&l.n.isNotNullOrUndefined(c.parameters)&&(g?this.queryParameters[u]={...this.queryParameters[u],...c.parameters}:n={...n,...c.parameters}),c&&c.headers&&l.n.isNotNullOrUndefined(c.headers)&&(g?this.headers[u]=c.headers:this.headers[0]={...this.headers[0],...c.headers}),l.n.isNotNullOrUndefined(C)&&"object"==typeof C&&(g?this.queryParameters[u].aflights=C.join(";"):a=C),f.j$[f.EM.MSNNewsCoachmark+f.tm]===d&&(r=(0,f.So)()))}if(l.n.isNotNullOrUndefined(this.config.dynamicQueryParams)){n={...n,...this.config.dynamicQueryParams};for(let t=1;t<this.queryParameters.length;t++)this.queryParameters[t]={...this.queryParameters[t],...this.config.dynamicQueryParams}}e.length>0&&(this.queryParameters[0]=n||{placement:void 0},this.queryParameters[0].placement=e.join("|"),this.queryParameters[0].bcnt=i.join("|"),this.queryParameters[0].aflights=a.join(";"),r&&parseInt(r)>-1&&(this.queryParameters[0].testingNum=r));const o=(await(0,K.Fz)()).join(";");for(let t=0;t<this.queryParameters.length;t++)this.queryParameters[t]&&(this.queryParameters[t].SCS_msNtpExp=o||"");const c=(0,f.JI)();if(c)for(let t=0;t<this.queryParameters.length;t++)this.queryParameters[t]&&(this.queryParameters[t].ocid=c)}callIris(){this.callIrisPromise=new Promise(async t=>{try{for(let t=0;t<this.queryParameters.length;t++){if((0,S.isNullOrUndefined)(this.queryParameters[t]))continue;this.surfaceCollectionContext=await N.requestSurfaceInfo(this.queryParameters[t],this.headers[t]);const e=this.getSurfacesFromCollection();await w.addSurfacesToStorage(e)}}catch(t){this.callWasMade=!1,a.YT.sendAppErrorEvent({...s.MB0,message:"IrisDataConnector: Exception requesting iris surfaces from data connector.",pb:{...s.MB0.pb,customMessage:`Error: ${JSON.stringify(t)} requestUrl: ${this.config.irisEndpoint} queryParameters: ${JSON.stringify(this.queryParameters)} headers: ${JSON.stringify(this.headers)}`}})}t()}),this.callIrisPromise}getSurfacesFromCollection(){const t=this.config.subscribers;if(!(t&&this.surfaceCollectionContext&&this.surfaceCollectionContext.collection&&this.surfaceCollectionContext.reqContext&&this.surfaceCollectionContext.reqContext.queryParams&&this.surfaceCollectionContext.reqContext.queryParams.placement))return a.YT.sendAppErrorEvent({...s.pjG,message:`Surface collection context missing parameters. Surface Context: ${JSON.stringify(this.surfaceCollectionContext)}`}),null;const e=[];Object.keys(t).forEach(i=>{const s=this.getSurfaceFromCollection(i);if(s&&s.placement){if(r.v.log(`IrisDataConnector: Parsed response for ${s.placement} from Iris network call. Now adding to map.`),e.push(s),this.surfaceInfoMap.set(s.placement,s),this.isImagePlacement(s.placement)){const t=f.j$[f.EM.MSNAnaheimNewsNTPImages+f.PR];this.previousNtpSurfaceInfoInRotation&&this.surfaceInfoMap.set(t,this.previousNtpSurfaceInfoInRotation)}this.captureInitialEligibilityStateOfCampaigns(s,t[i].captureInitialStateOfCampaigns)}});const i=this.shouldUseRequestedIrisSurface(),n=this.internalPlacementUsed&&i?i+f.tm:i;if((0,S.isNullOrUndefined)(n)){const t=Math.floor(Math.random()*(e.length-1));let i=0;this.availableCreatives.forEach((e,r)=>{t!==i?i++:this.creativeToShowUser=this.availableCreatives.get(r)})}else this.creativeToShowUser=this.availableCreatives.get(f.j$[n]);return e}getSurfaceFromCollection(t){const e=this.internalPlacementUsed?t+f.tm:t,i=f.j$[e];if(this.surfaceCollectionContext.collection.hasUnclaimedErrors()){this.surfaceCollectionContext.collection.getUnclaimedErrors().forEach(t=>{2040!=(t&&t.code?t.code:t.errors&&t.errors.length>0&&t.errors[0].code)&&P.s.trackAppErrorEvent({...s.ZEm,message:"Surface errors discovered",pb:{...s.ZEm.pb,customMessage:`Error with surface: ${e} Code: ${t.code} Message: ${t.msg} queryParams: ${JSON.stringify(this.surfaceCollectionContext.reqContext.queryParams)}`}})})}const r=this.surfaceCollectionContext.collection.get(i);return r&&r.placement&&r.creatives&&r.creatives.length>0&&!this.isImagePlacement(r.placement)&&this.availableCreatives.set(r.placement,r.creatives[0].creativeId),r}captureInitialEligibilityStateOfCampaigns(t,e){t.creatives&&e&&"object"==typeof e&&t.creatives.forEach(i=>{let r=!1;for(const s in e)if(t.placement===e[s]&&i.creativeId===s){r=!0;break}const s=(0,c.Lg)().getObject(i.creativeId);(0,S.isNullOrUndefined)(s)&&(0,c.Lg)().setObject(i.creativeId,r)})}shouldUseRequestedIrisSurface(){const t=(0,p.iA)();if(t){const e=d._3.getQueryParameterByName("irisSurface",t);if(e)return e}return null}shouldBlockPsl(){const t=(0,p.iA)();if(t){const e=d._3.getQueryParameterByName("blockPsl",t);if(e)return"true"===e.toLocaleLowerCase()}return!1}isImagePlacement(t){return f.j$[f.EM.MSNAnaheimNewsNTPImages]===t||f.j$[f.EM.MSNAnaheimNewsNTPImages+f.tm]===t}fetchedNewImage(){const t=this.internalPlacementUsed?f.EM.MSNAnaheimNewsNTPImages+f.tm:f.EM.MSNAnaheimNewsNTPImages,e=f.j$[t],i=this.surfaceCollectionContext&&this.surfaceCollectionContext.collection&&this.surfaceCollectionContext.collection.get(e);return!(0,S.isNullOrUndefined)(i)}resetImageLastUpdateTime(){const t=this.internalPlacementUsed?f.EM.MSNAnaheimNewsNTPImages+f.tm:f.EM.MSNAnaheimNewsNTPImages,e=f.j$[t];w.resetSurfaceLastUpdateTime(e)}}!function(t){t.offPageNavigation="nav-newtab",t.inPageNavigation="nav-inpage",t.executeAction="execute-action"}(H||(H={}));class W{static hasCTASupportData(t){return!(0,S.isNullOrUndefined)(t)&&this.stringHasLength(t.cta)}static hasHotSpotData(t){return!(0,S.isNullOrUndefined)(t)&&t.hs&&"object"==typeof t.hs&&t.hs.length>0}static hasImageData(t){return!(0,S.isNullOrUndefined)(t)&&this.stringHasLength(t.LANDSCAPE)&&this.stringHasLength(t.PORTRAIT)}static hasImageRefreshData(t){return!(0,S.isNullOrUndefined)(t)&&this.stringHasLength(t.update_period)}static hasMuseumData(t){return!(0,S.isNullOrUndefined)(t)&&this.stringHasLength(t.title)&&this.stringHasLength(t.copyright)}static hasPositionData(t){return this.stringHasLength(t.x_percent)&&this.stringHasLength(t.y_percent)&&t.x_percent.length<=this.MaxPositionLength&&t.y_percent.length<=this.MaxPositionLength&&/^0?\.\d{1,3}$/.test(t.x_percent)&&/^0?\.\d{1,3}$/.test(t.y_percent)}static hasPositions(t){return!(0,S.isNullOrUndefined)(t.landscape)&&this.hasPositionData(t.landscape)&&!(0,S.isNullOrUndefined)(t.portrait)&&this.hasPositionData(t.portrait)}static hasTelemetryIndex(t){return this.stringHasLength(t.hs)}static hasTextComponents(t){return this.stringHasLength(t.title)}static hasValidCTAType(t){return!((0,S.isNullOrUndefined)(t)||!this.stringHasLength(t.cta_type)||t.cta_type!==H.offPageNavigation)}static hotSpotIsValid(t){return!(0,S.isNullOrUndefined)(t)&&this.hasTelemetryIndex(t)&&this.hasTextComponents(t)&&this.hasPositions(t)}static isValidImageHotSpotsCreative(t){return W.hasImageData(t)&&W.hasImageRefreshData(t)}static isValidStoredData(t){return!(0,S.isNullOrUndefined)(t)&&!(0,S.isNullOrUndefined)(t.imgExpiration)&&this.stringHasLength(t.imgLandURL)&&this.stringHasLength(t.imgPortURL)&&this.stringHasLength(t.reqMarket)}static stringHasLength(t){return!(0,S.isNullOrUndefined)(t)&&"string"==typeof t&&t.length>0}static hasValidCTASupportData(t,e){return!(!t||!e)&&(t===H.offPageNavigation&&this.isValidOffPageNavData(e))}static isValidOffPageNavData(t){return/^((microsoft-edge:)?https:\/\/((www)|(cn)|(go))\.((msn)|(bing)|(skype)|(microsoft))\.com)|(edge:\/\/)/.test(t)}}W.MaxPositionLength=5;var _=i(63592);const Y={experienceConfigSchema:v.IrisDataConfigSchema,mockConfig:_.mockConfig}},84637:function(t,e,i){"use strict";i.d(e,{s:function(){return s}});var r=i(98216);class s{static registerTrackAppErrorEventCallback(t){t&&(this.trackAppErrorEventCallback=t)}static trackAppErrorEvent(t){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback(t)}}s.trackAppErrorEventCallback=t=>{r.YT&&r.YT.sendAppErrorEvent(t)}},92528:function(t,e,i){"use strict";i.d(e,{a:function(){return r}});const r=t=>t&&"string"==typeof t&&t.trim&&!!t.trim()},94864:function(t,e,i){"use strict";var r,s;i.d(e,{C:function(){return s},V:function(){return r}}),function(t){t.Impression="imp",t.Action="act"}(r||(r={})),function(t){t.Click="click",t.Conversion="conversion",t.Dislike="dislike",t.Dismiss="dismiss",t.Like="like",t.Hover="hover"}(s||(s={}))},98421:function(t,e,i){"use strict";i.d(e,{EJ:function(){return d},EM:function(){return u},JI:function(){return g},PR:function(){return c},So:function(){return l},T:function(){return n},j$:function(){return h},jt:function(){return m},lu:function(){return f},o3:function(){return s},tm:function(){return o},wv:function(){return a},yw:function(){return A}});var r=i(19548);const s=5e3,n=1e4,a="https://arc.msn.com/v4/api/selection",o=".int",c=".prev";var u;!function(t){t.MSNAnaheimNewsNTPImages="MSNAnaheimNewsNTPImages",t.MSNNewsCoachmark="MSNNewsCoachmark",t.WinHPCoachmark="WinHPCoachmark",t.MSNewsRewards="MSNewsRewards",t.ConditionalBanner="ConditionalBanner"}(u||(u={}));const h={[u.MSNAnaheimNewsNTPImages]:"88000244",[u.MSNAnaheimNewsNTPImages+o]:"88000245",[u.MSNAnaheimNewsNTPImages+c]:"88000246",[u.MSNNewsCoachmark]:"88000308",[u.MSNNewsCoachmark+o]:"88000309",[u.WinHPCoachmark]:"88000789",[u.WinHPCoachmark+o]:"88000788",[u.MSNewsRewards]:"88000321",[u.MSNewsRewards+o]:"88000322",[u.ConditionalBanner]:"10837393",[u.ConditionalBanner+o]:"10837394"},d=()=>{const t=location.search;return!!t&&/(\?|&)irisInternal=true/.test(t)},l=()=>{const t=location.search,e=new URLSearchParams(t);return e.has("testingNum")?e.get("testingNum"):"-1"},g=()=>{const t=location.search,e=new URLSearchParams(t);return e.has("ocid")?e.get("ocid"):""},A=()=>(()=>{const t=location.search;return!!t&&/(\?|&)irisStatic=true/.test(t)})()?{app:"anaheimstatic"}:{},f=()=>{const t=location.search;if(t&&/(\?|&)irisSegment=/.test(t)){const e=r._3.getQueryParameterByName("irisSegment",t);if(e)return{[e]:"1"}}return null};var m;!function(t){t.AcquisitionPath="AREF",t.BrowserChannel="ACHANNEL",t.BrowserVersion="ABUILD",t.Caller="clr",t.ClientID="edgeid",t.ConsumerVsEnterprise="ISU",t.DefaultBrowser="ADEFAB",t.DeviceOSVersion="devosver",t.OperatingSystem="OPSYS",t.PrimaryBrowser="APRIMB",t.TailoredExperiencesToggle="poptin",t.UITheme="UITHEME"}(m||(m={}))}}]);