"use strict";(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["libs_topics-shared-state_dist_TopicData_connector_js-libs_topics-shared-state_dist_TopicData_-62f9da"],{35320:function(t,e,i){i.d(e,{nx:function(){return a}});var s=i(19548),o=i(57842);var n;!function(t){t[t.LetterBox=1]="LetterBox",t[t.Scale=2]="Scale",t[t.Stretch=3]="Stretch",t[t.Crop=4]="Crop",t[t.FocalCrop=5]="FocalCrop",t[t.TmxResize=6]="TmxResize",t[t.AppExResize=7]="AppExResize",t[t.CustomCrop=8]="CustomCrop"}(n||(n={}));class a{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var o;(this.url=t,this.height=e,this.width=i,this.mode=n.Crop,this.quality=60,this.url=(this.url||"").replace(/http:/,"https:").replace(/\?.*/,""),null!=t&&t.includes("bing.com"))&&(this.bingId=null===(o=s._3.getParamsFromUrl(t).find(t=>"id"===t.key))||void 0===o?void 0:o.value)}static from(t){return t?new a(t.url,t.height,t.width):null}get src(){const t=[];return t.push({key:"w",value:(0,o.A)(this.width)}),t.push({key:"h",value:(0,o.A)(this.height)}),this.bingId?(t.push({key:"id",value:this.bingId}),t.push({key:"qlt",value:(0,o.A)(this.quality)})):(t.push({key:"m",value:(0,o.A)(this.mode)}),t.push({key:"q",value:(0,o.A)(this.quality)})),this.url+`?${s._3.keyValueArrayToQueryString(t)}`}resizeTo(t,e){return this.width=e,this.height=t,this}}},44692:function(t,e){e.A=function(t){return void 0===t}},48312:function(t,e,i){i.d(e,{t:function(){return C}});var s=i(65022),o=i(80900),n=i(98137),a=i(17254),c=i(12870),r=i(16507),l=i(19548),d=i(89980),u=i(56500),h=i(15003),p=i(50677),f=i(56408),w=i(75575),v=i(64334);class y{constructor(t){this.servicesMap=t}async getFollowedTopics(t,e){const i=[],s=Object.entries(this.servicesMap).map(s=>{let[o,n]=s;return n.getFollowedTopics(t,e).then(t=>(Object.values(t).forEach(t=>{t.apiSource={id:o,baseUrl:n.serviceURL}}),t)).catch(t=>(i.push({error:t,serviceId:o}),null))});return Promise.all(s).then(t=>{if((null==i?void 0:i.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(i);return Object.assign({},...t.filter(t=>t))})}async getRecommendedTopics(){const t=[],e=Object.entries(this.servicesMap).map(e=>{let[i,s]=e;return s.getRecommendedTopics().then(t=>(t.forEach(t=>{t.apiSource={id:i,baseUrl:s.serviceURL}}),t)).catch(e=>(t.push({error:e,serviceId:i}),null))});return Promise.all(e).then(e=>{if((null==t?void 0:t.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(t);return e.filter(t=>t).reduce((t,e)=>t.concat(e),[])})}async getRelatedTopics(t,e){if(null==t||!t.apiSource)return;const{id:i}=t.apiSource,s=this.servicesMap[i];return s?s.getRelatedTopics(t,e).then(t=>(t.forEach(t=>{t.apiSource={id:i,baseUrl:s.serviceURL}}),t)):void 0}async getTopics(t,e){const i=[],s=Object.entries(this.servicesMap).map(s=>{let[o,n]=s;return n.getTopics(t,e).then(t=>(Object.values(t.topicMap).forEach(t=>{t.apiSource={id:o,baseUrl:n.serviceURL}}),t)).catch(t=>(i.push({error:t,serviceId:o}),null))});return Promise.all(s).then(t=>{if((null==i?void 0:i.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(i);const e=t.filter(t=>t);return{topicGroupIds:e.map(t=>t.topicGroupIds).reduce((t,e)=>t.concat(e),[]),topicGroupMap:Object.assign({},...e.map(t=>t.topicGroupMap)),topicMap:Object.assign({},...e.map(t=>t.topicMap))}})}async getTopic(t){const e=[],i=Object.entries(this.servicesMap).map(i=>{let[s,o]=i;return o.getTopic(t).then(t=>(t.apiSource={id:s,baseUrl:o.serviceURL},t)).catch(t=>(e.push({error:t,serviceId:s}),null))});return Promise.all(i).then(t=>{if((null==e?void 0:e.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(e);return t.reduce((t,e)=>e||t)})}async updateTopicFollowingState(t,e,i,s){if(null==t||!t.apiSource){const n=this.servicesMap[o.r.consumer];return null==n?void 0:n.updateTopicFollowingState(t,e,i,s)}const{id:n}=t.apiSource,a=this.servicesMap[n];if(a)return a.updateTopicFollowingState(t,e,i,s)}async updateTopicHiddenState(t,e){return(t.apiSource&&this.servicesMap[t.apiSource.id]||this.servicesMap[o.r.consumer]).updateTopicHiddenState(t,e)}async getHiddenTopicIds(){const t=[],e=Object.entries(this.servicesMap).map(async e=>{let[i,s]=e;try{return await s.getHiddenTopicIds()}catch(e){return t.push({error:e,serviceId:i}),null}}),i=await Promise.all(e);if(t.length===Object.keys(this.servicesMap).length)throw this.combineErrors(t);const s=[];for(const t of i.filter(t=>t))s.push(...t);return s}async getTopicsById(t){const e=[],i=Object.entries(this.servicesMap).map(async i=>{let[s,o]=i;try{const e=await o.getTopicsById(t);for(const t of e)t.apiSource={id:s,baseUrl:o.serviceURL};return e}catch(t){return e.push({error:t,serviceId:s}),null}}),s=await Promise.all(i);if(e.length===Object.keys(this.servicesMap).length)throw this.combineErrors(e);const o=[];for(const t of s.filter(t=>t))o.push(...t);return o}async restoreDefaultTopics(){const t=Object.entries(this.servicesMap).map(t=>{let[e,i]=t;return i.restoreDefaultTopics()});return Promise.all(t)}combineErrors(t){const e=t.filter(t=>t).reduce((t,e)=>{var i;return`${t} serviceId: ${e.serviceId}, Message: ${null===(i=e.error)||void 0===i?void 0:i.message};`},"");return new Error(e)}setForcedApiKey(t){Object.entries(this.servicesMap).forEach(async e=>{let[i,s]=e;s.setForcedApiKey(t)})}setForcedOCID(t){for(const e in this.servicesMap)this.servicesMap[e].setForcedOCID(t)}}var m=i(7187),T=i(83542),g=i(85515),F=i(98216),b=i(69402),S=i(77246),k=i(86948),I=i(28868),$=i(53829),R=i(68613),O=i(29252);class C extends T.i{constructor(t,e,i,s,n,r,l){super(t,e,i,s,n,r,l),this.fetchedAllFollowedTopics=!1,this.fetchedAllRecommendedTopics=!1,this.fetchedAllHiddenTopics=!1,this.fetchedAllTopics=!1;const d=(0,S.S)()?window.fetch.bind(window):fetch;if(r&&r.useMultiTopicSource){const t={};t[o.r.work]=new v.B(d,a.T3.EnterpriseServiceUrlBase,!0),t[o.r.consumer]=new v.B(d,a.T3.ServiceUrlBase,!0),this.serviceClient=new y(t)}else this.serviceClient=new v.B(d);this.trackAppErrorEventCallback=F.YT?t=>F.YT.sendAppErrorEvent(t):null;const h=(0,c.Th)();this.useUserCreatedOrder=h.CurrentFlights.indexOf("prg-navfr-t")>-1,h.IsBlendedEnterprise&&(this.cardProvider=new u.f({initialRequest:{start:0,count:5,timeoutMs:3e3,disableFlatViewResponse:!0,select:"id",contentType:"article,video,slideshow,webcontent"}}))}registerTrackAppErrorEventCallback(t){this.trackAppErrorEventCallback=t}async followTopic(t,e,i,s){const o=r.n.isNotNullOrUndefined(await this.getFollowedTopic(t,e,i,s));return o&&this.invalidateCaches(),o}async getFollowedTopic(t,e,i,s){let o=null;if(t&&(o=await this.getTopic(t)),!(0,m.isNullOrUndefined)(o)&&(o.followState!==n.$.Followed||i)||e){const t=o&&o.feedType!==g.D.UserQuery?o:null,i=o&&o.feedType===g.D.UserQuery?o.name:e,a=await this.updateTopicFollowingState(t,n.$.Followed,i,!1,s);a&&(o=await this.getTopic((null==t?void 0:t.id)||a.targetId))}return(0,m.isNullOrUndefined)(o)||o.followState!==n.$.Followed?void 0:o}async getFollowedTopics(t){let e=this.getCurrentState().followedTopicIds;return this.fetchedAllFollowedTopics&&!t||(t=t||await this.gettingTopicsAfterMigration(),await this.fetchFollowedTopics(t)&&(e=this.getCurrentState().followedTopicIds,t&&!(0,I.RH)()&&(0,$.nB)())),e}async getOneServiceFollowedTopics(){try{return await this.serviceClient.getFollowedTopics(!1,this.useUserCreatedOrder)}catch(t){this.trackAppError({...s._xy,message:"Failed fetching one service followed topics",pb:{...s._xy.pb,customMessage:`Failed fetching one service followed topics. ${t&&t.message}`}})}}async getRecommendedTopics(){return this.fetchedAllRecommendedTopics||await this.fetchRecommendedTopics(),this.getCurrentState().recommendedTopics}async setTopicHiddenState(t,e){const i=await this.updateTopicHiddenState(t,e);return i&&this.invalidateCaches(),i}async getHiddenTopics(){if(!this.fetchedAllHiddenTopics){const t=await this.fetchHiddenTopics();t&&(b.Z.hiddenTopics.getActionSender(this).send(t),this.fetchedAllHiddenTopics=!0)}return this.getCurrentState().hiddenTopics}async getRelatedTopics(t,e){return this.getTopic(t).then(t=>this.serviceClient.getRelatedTopics(t,e))}async getNextTopicsInList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.getCurrentState().topicListMap[t];return!(0,m.isUndefined)(e)&&(0,m.isString)(e.nextPageUrl)&&await this.fetchTopicGroup(t)&&(e=this.getCurrentState().topicListMap[t]),e}async getTopic(t,e,i){let s=this.getCurrentState().topicMap[t];return(i||(0,m.isUndefined)(s))&&await this.fetchTopic(t,e,i)&&(s=this.getCurrentState().topicMap[t]),s}async getTopicsById(t){const e=[],i=[],s=this.getCurrentState().topicMap;for(const o of t){const t=s[o];t?e.push(t):i.push(o)}if(i.length){await this.fetchTopicsById(i);const t=this.getCurrentState().topicMap,s=i.map(e=>t[e]).filter(Boolean);e.push(...s)}return e}async getTopics(t){return this.fetchedAllTopics||await this.fetchTopics(t),this.getCurrentState().topicMap}async getFilteredFeedIds(t,e){this.fetchedAllTopics||await this.fetchTopics(e);const i=this.getCurrentState().topicListMap,s=[];return i&&Object.values(i).forEach(e=>{e.title!==t&&e.topicIds&&s.push(...e.topicIds)}),s}async unfollowTopic(t,e){const i=await this.getTopic(t),s=await this.updateTopicFollowingState(i,n.$.Unfollowed,null,e);return s&&!e&&this.invalidateCaches(),s}async isChannelIdUnfollowable(t){var e;return null===(e=await this.getCustomChannelIds())||void 0===e?void 0:e.unfollowable.has(t)}async getCustomChannelIds(){if(!this.customChannelIds){const{topStoriesChannelIds:t,unfollowableChannelIds:e}=await i.e("experiences_spotlight-card-wc_dist_ContentTemplates_RealEstate_RealEstate_styles_js-libs_feed-7a4c0e").then(i.bind(i,67946));this.customChannelIds={topStories:t,unfollowable:e}}return this.customChannelIds}async restoreDefaultTopics(){try{return await this.serviceClient.restoreDefaultTopics(),this.invalidateCaches(),await w.S.purgeCacheAsync(w.p.followedTopics),await this.getFollowedTopics(!0),!0}catch(t){return this.trackAppError({...s.lr4,message:"Failed restoring default set of followed interests",pb:{...s.lr4.pb,customMessage:`Error: ${t&&t.message}`}}),!1}}async fetchFollowedTopics(t){try{const e=await this.serviceClient.getFollowedTopics(t,this.useUserCreatedOrder);if((0,c.Th)().IsBlendedEnterprise){const t=Object.values(e).find(t=>"CompanyFeed"===t.branding);t&&await this.isLimitedFeed(t)&&delete e[t.id]}return b.Z.followedTopics.getActionSender(this).send(e,t),this.fetchedAllFollowedTopics=!0,!0}catch(t){return b.Z.followedTopicsFailed.getActionSender(this).send(),this.trackAppError({...s._xy,message:"Failed fetching followed topics",pb:{...s._xy.pb,customMessage:`Failed fetching followed topics. ${t&&t.message}`}}),!1}}async isLimitedFeed(t){try{const i={feedId:t.id};var e;if(t.apiSource)i.overwriteBaseApiURL=t.apiSource.baseUrl,i.forceEnterpriseCompliance=(null===(e=t.apiSource)||void 0===e?void 0:e.id)===o.r.work;const s=await this.cardProvider.fetch(i,!0);return!s||!s.cardMetadata||s.cardMetadata.length<5}catch(t){return this.trackAppError({...s.WR_,message:"[Enterprise] Failed to check if topic has limited data in feed",pb:{...s.WR_.pb,customMessage:t&&t.message}}),!1}}async fetchRecommendedTopics(){try{const t=await this.serviceClient.getRecommendedTopics();return b.Z.recommendedTopics.getActionSender(this).send((0,R.A)(t)),this.fetchedAllRecommendedTopics=!0,!0}catch(t){return b.Z.recommendedTopicsFailed.getActionSender(this).send(),this.trackAppError({...s.LQS,message:"Failed fetching recommended topics",pb:{...s.LQS.pb,customMessage:`Failed fetching recommended topics. ${t&&t.message}`}}),!1}}async fetchHiddenTopics(){try{const t=await this.serviceClient.getHiddenTopicIds(),e=await this.serviceClient.getTopicsById(t);return e.forEach((t,i)=>{t.followState!==n.$.Followed?t.hidden=!0:delete e[i]}),e}catch(t){return b.Z.hiddenTopicsFailed.getActionSender(this).send(),this.trackAppError({...s.mRv,message:"Failed fetching hidden topics",pb:{...s.mRv.pb,customMessage:`Failed fetching hidden topics. ${t&&t.message}`}}),null}}async fetchTopic(t,e,i){try{const s=await this.serviceClient.getTopic(t,e),o=this.getCurrentState().topicMap[t];return(i||(0,m.isUndefined)(o)||o.followState!==s.followState)&&b.Z.topic.getActionSender(this).send(s),!0}catch(e){return b.Z.followedTopicsFailed.getActionSender(this).send(),this.trackAppError({...s.QGc,message:"Failed to fetch topic.",pb:{...s.QGc.pb,customMessage:`Failed to fetch topic ${t}. ${e&&e.message}`}}),!1}}async fetchTopicsById(t){try{const e=await this.serviceClient.getTopicsById(t);(null==e?void 0:e.length)&&b.Z.topicList.getActionSender(this).send(e)}catch(e){return b.Z.followedTopicsFailed.getActionSender(this).send(),this.trackAppError({...s.QGc,message:"Failed to fetch topic.",pb:{...s.QGc.pb,customMessage:`Failed to fetch topics ${t}. ${e&&e.message}`}}),!1}return!0}async fetchTopicGroup(t){if(!t)return!1;const e=this.getCurrentState().topicListMap[t],i=(0,m.isUndefined)(e)||e.nextPageUrl;if(!(0,m.isString)(i))return!1;const o=l._3.getParamsFromUrl(i);if(null===o)return!1;try{const e=await this.serviceClient.getTopics(null,o);return b.Z.topicGroup.getActionSender(this).send(e.topicGroupMap[t],e.topicMap),!0}catch(e){return b.Z.topicGroupFailed.getActionSender(this).send(t),this.trackAppError({...s.QGc,message:"Failed to get topics list.",pb:{...s.QGc.pb,customMessage:`Failed to get topics list ${t}. ${e&&e.message}`}}),!1}}async fetchTopics(t){try{const e=await this.serviceClient.getTopics(t);return b.Z.topics.getActionSender(this).send(e),this.fetchedAllTopics=!0,!0}catch(t){return b.Z.topicsFailed.getActionSender(this).send(),this.trackAppError({...s.QGc,message:"Failed fetching topics.",pb:{...s.QGc.pb,customMessage:`Failed fetching topics. ${t&&t.message}`}}),!1}}async updateTopicFollowingState(t,e,i,o,a){try{var c;const s=e===n.$.Followed,l=await this.serviceClient.updateTopicFollowingState(t,s,i,a);var r;return o?!s||(null==l||null===(r=l.value)||void 0===r?void 0:r.length)&&(null==l?void 0:l.value[0]):(await w.S.purgeCacheAsync(w.p.followedTopics),!t&&s?await this.getFollowedTopics(!0):b.Z.updateTopicFollowedState.getActionSender(this).send(null==t?void 0:t.id,e,this.useUserCreatedOrder),!s||(null==l||null===(c=l.value)||void 0===c?void 0:c.length)&&(null==l?void 0:l.value[0]))}catch(i){return b.Z.updateTopicFollowedStateFailed.getActionSender(this).send(null==t?void 0:t.id,e),void this.trackAppError({...e?s.g07:s.PXf,message:"Failed to update topic followed state.",pb:{...e?s.g07.pb:s.PXf.pb,customMessage:`Failed to update followed state to ${e} for ${null==t?void 0:t.id}. ${i&&i.message}`}})}}async updateTopicHiddenState(t,e){const{id:i}=t||{};if(!i)return!1;try{return t.feedType==g.D.SysTag&&await this.serviceClient.updateTopicHiddenState(t,e),b.Z.updateTopicHiddenState.getActionSender(this).send(i,e),!0}catch(t){return b.Z.updateTopicHiddenStateFailed.getActionSender(this).send(i,e),this.trackAppError({...e?s.llR:s.Epe,message:"Failed to update topic hidden state.",pb:{...e?s.llR.pb:s.Epe.pb,customMessage:`Failed to update hidden state to ${e} for ${i}. ${t&&t.message}`}}),!1}}async gettingTopicsAfterMigration(){return!(!(0,d.Lg)().getItem("interests-need-refresh")||2!==await(0,k.XK)())&&((0,d.Lg)().removeItem("interests-need-refresh"),!0)}trackAppError(t){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback({...t})}invalidateCaches(){(0,p.FH)(f.u.InterestsChange),(0,h.TI)(3),(0,I.RH)()||(0,O.r8)()}setApiKey(t){this.serviceClient.setForcedApiKey(t)}}},57863:function(t,e,i){i.d(e,{al:function(){return d},XN:function(){return r},No:function(){return l}});var s=i(28868),o=i(1350);function n(t,e){if(function(t){try{return(null==t?void 0:t.needHeader)??!1}catch(t){c(`Failed to get feed needHeader Failed with exception : ${t}`)}}(t))try{const t=JSON.parse(e),i=JSON.parse((null==t?void 0:t.header)??null),s=(null==i?void 0:i["ddd-activityid"])??null;s&&async function(t){const e=window.localStorage.getItem(a);if(void 0!==e&&""!==e&&null!==e){const i=e.split(",");return void(i.length<10&&!i.includes(t)&&window.localStorage.setItem(a,`${e},${t}`))}window.localStorage.setItem(a,t)}(s)}catch(t){c(`Failed to get feed needHeader Failed with exception : ${t}`)}}const a="activityIds";function c(t){(0,s.RH)()&&function(t){new Promise((e,i)=>{!function(t,e){(0,s.lA)("logEvent",t,e)}(t,t=>{e(t)})})}({appId:o.H7,type:"Debug",name:"HP_WEBVIEW_SERVER_LOG",data:{message:t}})}function r(t){return new Promise((e,i)=>{!function(t,e){(0,s.lA)("getHttp",t,e)}(t,i=>{e(i),n(t,i)})})}function l(t){return new Promise((e,i)=>{!function(t,e){(0,s.lA)("postHttp",t,e)}(t,t=>{e(t)})})}function d(t){return new Promise((e,i)=>{!function(t,e){(0,s.lA)("deleteHttp",t,e)}(t,t=>{e(t)})})}},62140:function(t,e,i){var s;i.d(e,{U:function(){return s}}),function(t){t[t.InProgress=0]="InProgress",t[t.Loaded=1]="Loaded",t[t.Failed=2]="Failed"}(s||(s={}))},64334:function(t,e,i){i.d(e,{B:function(){return B}});var s,o=i(11177);!function(t){t.topicCardBackupImageUrl="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtCmK3.img";t.TopicCardStandardDimensions={borderWidth:4,height:250,width:250,gutterSize:o.xF},t.TopicCardImageStandardDimensions={height:242,width:242}}(s||(s={}));const n="feeds",a="msn/topics",c="Follow",r="Mute",l="Graph/Actions",d="TagBase";var u=i(85889),h=i(67387),p=i(17254),f=i(12870),w=i(74326),v=i(19993),y=i(57759),m=i(93468),T=i(65022),g=i(29252),F=i(56639),b=i(28868),S=i(64405),k=i(57863),I=i(486),$=i(86948),R=i(47372),O=i(98137),C=i(16507),M=i(94425),E=i(41667),U=i(44692),j=i(35320),P=i(88294);class H{static TranslateToTopicGroups(t,e){if(P.v.logObjects(t),!C.n.isDefined(t)||!H.isValidCompositeCardResponse(t.value))throw new Error("Topics OneService response schema validation error: no valid topic groups found!");const i={topicGroupIds:[],topicGroupMap:{},topicMap:{}};return t.value[0].subCards.forEach(t=>{if(H.isValidTopicGroup(t,!0)){const s=H.getTopics(t,e);C.n.arrayHasData(s)&&(s.forEach(t=>{i.topicMap[t.id]=t}),i.topicGroupMap[t.id]={id:t.id,nextPageUrl:t.nextPageUrl,title:t.title,topicIds:s.map(t=>t.id)},i.topicGroupIds.push(t.id))}}),i}static TranslateToTopics(t,e,i){if(P.v.logObjects(t),!C.n.isDefined(t)&&t[e])throw new Error("Topics OneService response schema validation error: no valid topic group found!");return t[e].map(t=>{const e=i(t);return H.getTopic(e,null)}).filter(t=>null!==t)}static TranslateToRecommendedTopics(t){return this.TranslateToTopics(t,"value",t=>({...t,name:t.title,feedType:null}))}static TranslateToSelectedNumberOfRecommendedTopics(t){return this.TranslateToTopics(t,"suggestions",t=>{var e,i;return{...t.content,name:null===(e=t.content)||void 0===e?void 0:e.title,feedType:null===(i=t.content)||void 0===i?void 0:i.feedType}})}static TranslateToHiddenTopicIds(t){if(P.v.logObjects(t),!C.n.isDefined(t)&&t.value)throw new Error("Topics OneService response schema validation error: no valid topic group found!");return t.value.map(t=>t.targetId)}static TranslateSingleTopicResponseToTopic(t){const e=this.TranslateTopicResponseToTopicArray(t);return e&&e.length&&e[0]}static TranslateTopicResponseToTopicArray(t){if(!C.n.isDefined(t)||!H.isValidCompositeCardResponse(t.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const e=t.value[0].subCards,i=[];return e.forEach(t=>{t.name||(t.name=t.title),i.push(H.getTopic(t,null))}),i}static TranslateToFollowedTopics(t){if(P.v.logObjects(t),!C.n.isDefined(t)||!C.n.arrayHasData(t.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const e=t.value,i={};return e.forEach(t=>{if(t&&t.id){const e={};e[t.id]=[{followState:"followed"}],t.title&&(t.name=t.title,delete t.title);const s=H.getTopic(t,e);i[s.id]=s}}),i}static getTopic(t,e,i){if(!(0,E.A)(t.id)||!(0,E.A)(t.name))return null;let o;if(o=e&&C.n.arrayHasData(e[t.id])?e[t.id][0]:{followState:O.$.Unfollowed},!C.n.isDefined(o))return null;i||(i=s.TopicCardImageStandardDimensions);const n=t.image,a=n&&n.url?j.nx.from(n).resizeTo(i.height,i.width).src:s.topicCardBackupImageUrl;return{id:t.id,name:t.name,followState:o.followState===O.$.Unfollowed||o.followState===O.$.None?O.$.Unfollowed:O.$.Followed,imgSrc:a,href:(0,M.Rq)(t.id,t.name),feedType:t.feedType,canonicalName:t.canonicalName,isInferred:t.isInferred,branding:t.branding,locale:t.locale,followersCount:t.followersCount,displayablePerPage:t.displayablePerPage}}static getTopics(t,e){const i=[];return t.subCards.forEach(s=>{const o=H.getTopic(s,t.metadata,e);i.push(o)}),i}static isValidTopicGroup(t,e){return(!e||(0,E.A)(t.id))&&!(0,U.A)(t.metadata)&&C.n.arrayHasData(t.subCards)}static isValidCompositeCardResponse(t){return C.n.arrayHasData(t)&&C.n.arrayHasData(t[0].subCards)}}var _=i(2462),q=i(42503),L=i(56988),D=i(38332),A=parseFloat,N=Math.min,G=Math.random;var x=function(t,e,i){if(i&&"boolean"!=typeof i&&(0,L.A)(t,e,i)&&(e=i=void 0),void 0===i&&("boolean"==typeof e?(i=e,e=void 0):"boolean"==typeof t&&(i=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=(0,D.A)(t),void 0===e?(e=t,t=0):e=(0,D.A)(e)),t>e){var s=t;t=e,e=s}if(i||t%1||e%1){var o=G();return N(t+o*(e-t+A("1e-"+((o+"").length-1))),e)}return(0,q.A)(t,e)};class B{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,w.pN)(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,I.wx)();this.fetchImpl=t,this.serviceURL=e,this.useEnterpriseEndpoint=i}async getFollowedTopics(t,e){var i;const s=await this.getRequestInit(),o=await this.getCommonParams(n),c=(0,u.Iv)()?null:(0,g.x5)();if(this.useEnterpriseEndpoint&&(null==s||null===(i=s.headers)||void 0===i||!i[h.aS.authorization]))return{};const r=[...o,{key:"queryType",value:"MyFeed"},{key:"$top",value:"1000"},{key:"allTopics",value:"true"},{key:"rndId",value:t?x(0,1e3).toString():null},{key:g.ei,value:c?c.toString():null},{key:"responseSchema",value:R.K.CardView},{key:"followersCount",value:"true"}];e&&r.push({key:"$orderby",value:"createdDateTime desc"});const l=this.getLocationData();l&&!(0,u.Iv)()&&r.push({key:"location",value:l});const d=(0,w.nI)(a,this.serviceURL);this.appendQs(r,d);const p=await this.sendRequest(decodeURIComponent(d.href),s,"getUserTopics");return H.TranslateToFollowedTopics(p)}async getRecommendedTopics(){const t=await this.getRequestInit(),e=[...await this.getCommonParams(n),{key:"queryType",value:"recommendations"},{key:"$select",value:"id,title,image"}],i=(0,w.nI)(a+"/me/recommendations",this.serviceURL);this.appendQs(e,i);const s=await this.sendRequest(decodeURIComponent(i.href),t,"getRecommendedTopics");return H.TranslateToRecommendedTopics(s)}async getTopRecommendedTopics(t){const[e,i]=await Promise.all([this.getRequestInit(),this.getCommonParams(n)]),s=[...i,{key:"interesttype",value:"Topic"},{key:"responseSchema",value:"cardView"},{key:"$top",value:t||"50"},{key:"TopicRecoChannel",value:"freoverlay"},{key:"ProviderRecoChannel",value:"freoverlay"}],o=new URL("https://api.msn.com/news/suggestedinterests");this.appendQs(s,o);const a=await this.sendRequest(decodeURIComponent(o.href),e);return H.TranslateToSelectedNumberOfRecommendedTopics(a)}async getHiddenTopicIds(){const t=(0,w.nI)(l,this.serviceURL),e=await this.getRequestInit(),i=await this.getCommonParams(n),s={key:"$filter",value:`actionType eq '${r}' and targetType eq '${d}'`};e.method="GET";const o=[s,{key:"$top",value:"100"},...i];this.appendQs(o,t);const a=await this.sendRequest(decodeURIComponent(t.href),e,"getHiddenTopics");return H.TranslateToHiddenTopicIds(a)}async getRelatedTopics(t,e){if(!t)return Promise.reject();const i=(0,w.nI)("news/topics/{id}/related".replace("{id}",t.id),this.serviceURL),s=await this.getCommonParams(n);e&&e>0&&s.push({key:"$top",value:e.toString()}),this.appendQs(s,i);const o=await this.getRequestInit(),a=await this.sendRequest(decodeURIComponent(i.href),o,"getRelatedTopics");return a&&0===a.length?a:H.TranslateToRecommendedTopics(a)}async getTopics(t,e){const i=await this.getRequestInit(),s=await this.getCommonParams(n),o=e||[...s,{key:"queryType",value:"Discover"},{key:"$top",value:"100"},{key:"$select",value:"id,name,image,feedType,canonicalName,branding"}],c=this.getLocationData();c&&o.push({key:"location",value:c});const r=(0,w.nI)(a,this.serviceURL);this.appendQs(o,r);const l=await this.sendRequest(decodeURIComponent(r.href),i,"getTopicGroups");return H.TranslateToTopicGroups(l,t)}async getTopic(t,e){const i=await this.getRequestInit(),s=[...await this.getCommonParams(n),{key:"ids",value:t},{key:"followersCount",value:"true"}];e&&s.push({key:"responseSchema",value:e});const o=this.getLocationData();o&&s.push({key:"location",value:o});const c=(0,w.nI)(a,this.serviceURL);this.appendQs(s,c);const r=await this.sendRequest(decodeURIComponent(c.href),i,"getTopic");return H.TranslateSingleTopicResponseToTopic(r)}async updateTopicFollowingState(t,e,i,s){const o=(0,w.nI)(l,this.serviceURL),a=await this.getRequestInit(),r=await this.getCommonParams(n),d=this.getLocationData();if(d&&r.push({key:"location",value:d}),e){const e={actionType:c};null!=t&&t.id?e.targetId=null==t?void 0:t.id:i&&(e.definitionName=i),s&&(e.Metadata={ItemdId:s.contentId||"undefined",Lineage:s.actionPosition||`${p.T3.AppType}>TopicsServiceClient>UndefinedLineage`}),a.method="POST",a.headers["Content-Type"]="text/json",a.body=JSON.stringify(e),this.appendQs(r,o)}else{const e={key:"$filter",value:`actionType eq '${c}' and (targetId eq '${null==t?void 0:t.id}')`};a.method="DELETE";const i=[e,...r];this.appendQs(i,o)}return await this.sendRequest(decodeURIComponent(o.href),a,"updateTopicFollowingState")}async updateTopicHiddenState(t,e){let{id:i}=t;const s=(0,w.nI)(l,this.serviceURL),o=await this.getRequestInit(),a=await this.getCommonParams(n),c=this.getLocationData();if(c&&a.push({key:"location",value:c}),e){const t={actionType:r,targetType:d};t.targetId=i,o.method="POST",o.headers["Content-Type"]="text/json",o.body=JSON.stringify(t),this.appendQs(a,s)}else{const t={key:"$filter",value:`actionType eq '${r}' and (targetId eq '${i}') and targetType eq '${d}'`};o.method="DELETE";const e=[t,...a];this.appendQs(e,s)}return await this.sendRequest(decodeURIComponent(s.href),o,"updateTopicHiddenState")}async restoreDefaultTopics(){const t=(0,w.nI)(l,this.serviceURL),e=await this.getRequestInit();e.method="DELETE";const i=[...await this.getCommonParams(n),{key:"$filter",value:`actionType eq '${c}'`}];this.appendQs(i,t);return await this.sendRequest(decodeURIComponent(t.href),e,"restoreDefaultTopics")}async getTopicsById(t){if(!t||t.length<1)return[];const e=await this.getRequestInit(),i=[...await this.getCommonParams(n),{key:"ids",value:t.join(",")}],s=this.getLocationData();s&&i.push({key:"location",value:s});const o=(0,w.nI)(a,this.serviceURL);this.appendQs(i,o);const c=await this.sendRequest(decodeURIComponent(o.href),e,"getTopicsById");return H.TranslateTopicResponseToTopicArray(c)}getLocationData(){const t=(0,f.Th)();return t.ClientSettings&&t.ClientSettings.geo_lat&&t.ClientSettings.geo_long?`${t.ClientSettings.geo_lat}|${t.ClientSettings.geo_long}`:null}async getCommonParams(t){if((0,u.Iv)())return this.getSapphireQueryParams();let e=!0;const i=await this.isUserSignedIn();f.Rb.IsBlendedEnterprise&&(t="entnewsntp",e=!1),"winWidgets"===p.T3.AppType&&(t="winp2",e=!1),"bingHomepage"===p.T3.AppType&&(t="Peregrine"),this.forcedApiKey&&(e=!1),(0,u.cg)()&&(e=!1),this.forcedOCID&&(t=this.forcedOCID);const s=i?v.WR.getOneServiceParamsWithAuth(p.T3.UserId,t,e):v.WR.getOneServiceParamsWithoutAuth(p.T3.UserId,t,e,null,!1,this.useEnterpriseEndpoint);if(this.forcedApiKey){s.find(t=>"apikey"==t.key).value=this.forcedApiKey}return s}getSapphireQueryParams(){const t=v.WR.getOneServiceNonDynamicParamsWithoutAuth(n),e=(0,F.cE)();return e&&(t.push({key:p.T3.OneServiceContentMarketQspKey,value:e.market}),p.T3.ShouldUseFdheadQsp&&t.push({key:"fdhead",value:e.features}),t.push({key:"activityId",value:e.activityId}),e.latitude&&e.longitude&&t.push({key:"location",value:`${e.latitude}|${e.longitude}`})),t}async getRequestInit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t&&(t={method:"GET"}),t.credentials="include",t.headers=(0,b.RH)()?await(0,S.U)():await v.WR.getOneServiceHeaders(this.useEnterpriseEndpoint),t}async isUserSignedIn(){const t=(0,f.Th)().UserIsSignedIn;if(void 0!==t)return t;const e=await(0,$.XK)();return this.validateAnaheimSignInStatus(2===e,e)}validateAnaheimSignInStatus(t,e){if("edgeChromium"===p.T3.AppType){const i=!!(0,_.Ri)("lt"),s=!!(0,_.Ri)("aace");if(!t&&i&&s)return(0,$.e9)().then(t=>{(0,m.vV)(T.XrR,"User was reported as not signed in, but aace and lt were present.",void 0,{...T.XrR.pb,customMessage:JSON.stringify({userSignInState:e,ltCookiePresent:i,aaceCookiePresent:s,resolvedSignInState:t})})}),!0}return t}async sendRequest(t,e,i){return(0,u.Iv)()?await this.sapphireRequest(decodeURIComponent(t),e):await this.networkRequest(decodeURIComponent(t),e,i)}async sapphireRequest(t,e){const i={url:t,headers:e.headers,body:e.body,refresh:!0,needHeader:!0,needCookie:!0};let s;switch(e.method){case"POST":s=await(0,k.No)(i);break;case"DELETE":s=await(0,k.al)(i);break;default:s=await(0,k.XN)(i)}return JSON.parse(s||"{}")}async networkRequest(t,e,i){const s=await(0,y.w)(async()=>await this.fetchImpl(t,e),i);if(!s.ok)throw Error(s.statusText);return 204===s.status?[]:s.json()}appendQs(t,e){t.forEach(t=>{t.value&&e.searchParams.set(t.key,t.value)})}setForcedApiKey(t){this.forcedApiKey=t}setForcedOCID(t){this.forcedOCID=t}getMockWorkTopics(){return{"@odata.context":"http://api.msn.com/msn/topics/me/$metadata#work",value:[{id:"Y_d659302d-5ac4-460a-9baa-8c8684761110",title:"Microsoft In The News",image:{width:292,height:342,quality:98,url:"http://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtK2OS.img",title:"Travel News large interest image"}},{id:"Y_a952481b-5929-4b40-83be-f2bc6edf43dd",title:"Technology",image:{width:292,height:342,quality:98,url:"http://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtJSnh.img",title:"Weather large interest image"}}]}}}},69402:function(t,e,i){i.d(e,{Z:function(){return o}});var s=i(68480);class o{}o.followedTopics=new s.P("FollowedTopics"),o.followedTopicsFailed=new s.P("FollowedTopicsFailedSignature"),o.recommendedTopics=new s.P("RecommendedTopics"),o.recommendedTopicsFailed=new s.P("RecommendedTopicsFailed"),o.hiddenTopics=new s.P("HiddenTopics"),o.hiddenTopicsFailed=new s.P("HiddenTopicsFailed"),o.topic=new s.P("Topic"),o.topicFailed=new s.P("TopicsFailed"),o.topics=new s.P("Topics"),o.topicList=new s.P("TopicList"),o.topicsFailed=new s.P("TopicsFailed"),o.topicGroup=new s.P("TopicGroup"),o.topicGroupFailed=new s.P("TopicGroupFailed"),o.updateTopicFollowedState=new s.P("UpdateTopicFollowedState"),o.updateTopicFollowedStateFailed=new s.P("UpdateTopicFollowedStateFailed"),o.updateTopicHiddenState=new s.P("UpdateTopicHiddenState"),o.updateTopicHiddenStateFailed=new s.P("UpdateTopicHiddenStateFailed")},69593:function(t,e,i){i.d(e,{E:function(){return l}});var s=i(98137),o=i(62140),n=i(44692),a=i(69927),c=i(24678),r=i(69402);class l{reduce(t,e){if(!t)return{followedTopicIds:[],followedTopicNames:[],recommendedTopics:[],hiddenTopics:[],topicListIds:[],topicListMap:{},topicMap:{},topicsFetchState:o.U.InProgress};if(!e)return t;let i,l=!1;return l=l||c.n.handleAction(e,r.Z.followedTopics,(e,s)=>{if(!e)return;const n={...t.topicMap};i={...t,topicMap:n,topicsFetchState:o.U.Loaded};const c=[];Object.keys(e).forEach(t=>{c.push(t);const i=e[t];n[t]=i}),i.followedTopicIds=s?c:(0,a.A)(i.followedTopicIds,c),i.followedTopicNames=i.followedTopicIds.map(t=>{var e;return null===(e=n[t])||void 0===e?void 0:e.name}),this.updateFollowState(i)}),l=l||c.n.handleAction(e,r.Z.recommendedTopics,e=>{if(!e)return;const s={...t.topicMap};e.forEach(t=>{s[t.id]||(s[t.id]=t)}),i={...t,recommendedTopics:e,topicMap:s,topicsFetchState:o.U.Loaded},this.updateFollowState(i)}),l=l||c.n.handleAction(e,r.Z.hiddenTopics,e=>{if(!e)return;const s={...t.topicMap};e.forEach(t=>{s[t.id]||(s[t.id]=t),s[t.id].hidden=!0}),i={...t,hiddenTopics:e,topicMap:s,topicsFetchState:o.U.Loaded}}),l=l||c.n.handleAction(e,r.Z.topic,e=>{const s={...t.topicMap};s[e.id]=e,i={...t,topicMap:s,topicsFetchState:o.U.Loaded}}),l=l||c.n.handleAction(e,r.Z.topics,e=>{if(!e)return;const s={...t.topicMap};Object.keys(e.topicMap).forEach(i=>{const o=t.topicMap[i];s[i]={...e.topicMap[i],isInferred:o&&o.isInferred}}),i={...t,topicListIds:e.topicGroupIds,topicListMap:e.topicGroupMap,topicMap:s,topicsFetchState:o.U.Loaded},this.updateFollowState(i)}),l=l||c.n.handleAction(e,r.Z.topicGroup,(e,s)=>{if(!e||!e.topicIds||0===e.topicIds.length||!s)return;const n={...t.topicListMap},c={...t.topicMap},r=n[e.id];e.nextPageUrl&&(r.nextPageUrl=e.nextPageUrl),r&&r.topicIds&&(r.topicIds=(0,a.A)(r.topicIds,e.topicIds)),e.topicIds.forEach(t=>{c[t]=s[t]}),i={...t,topicListMap:n,topicMap:c,topicsFetchState:o.U.Loaded},this.updateFollowState(i)}),l=l||c.n.handleAction(e,r.Z.updateTopicFollowedState,(e,o,a)=>{const c={...t.topicMap},r=t.followedTopicIds.slice(),l=t.followedTopicNames.slice(),d=t.topicMap[e];if(o!==s.$.Unfollowed){if((0,n.A)(d)){const t={followState:s.$.Followed,id:e,name:""};c[e]=t}else{if(d.followState===s.$.Followed&&!d.isInferred)return;d.followState===s.$.Followed&&d.isInferred&&(c[e].isInferred=!1),c[e].followState=s.$.Followed,i={...t,topicMap:c}}var u,h;if(r.indexOf(e)<0)a?l.unshift(null===(u=c[e])||void 0===u?void 0:u.name):l.push(null===(h=c[e])||void 0===h?void 0:h.name),a?r.unshift(e):r.push(e)}else{if((0,n.A)(d))return;c[e].followState=s.$.Unfollowed;const t=r.indexOf(e);t>=0&&(r.splice(t,1),l.splice(t,1))}const p=t.recommendedTopics.map(t=>({...t,followState:t.id===e?o:t.followState}));i={...t,followedTopicIds:r,followedTopicNames:l,topicMap:c,recommendedTopics:p}}),l=l||c.n.handleAction(e,r.Z.updateTopicHiddenState,(e,s)=>{const o={...t.topicMap},n=t.hiddenTopics.slice(),a=t.topicMap[e];if(a){if(s){if(a.hidden)return;o[e].hidden=!0,i={...t,topicMap:o},n.find(t=>t.id===e)||n.push(a)}else{o[e].hidden=!1;const t=n.findIndex(t=>t.id===e);t>=0&&n.splice(t,1)}i={...t,topicMap:o,hiddenTopics:n}}}),l=l||c.n.handleAction(e,r.Z.recommendedTopicsFailed,()=>{i={...t,topicsFetchState:o.U.Failed}}),l=l||c.n.handleAction(e,r.Z.hiddenTopicsFailed,()=>{i={...t,topicsFetchState:o.U.Failed}}),l=l||c.n.handleAction(e,r.Z.followedTopicsFailed,()=>{i={...t,topicsFetchState:o.U.Failed}}),l||(l=c.n.handleAction(e,r.Z.topicList,e=>{const s={...t.topicMap};e.forEach(t=>s[t.id]=t),i={...t,topicMap:s,topicsFetchState:o.U.Loaded}})),i||t}updateFollowState(t){const{followedTopicIds:e}=t;Object.keys(t.topicMap).forEach(i=>{const o=t.topicMap[i];o&&(o.followState=e.includes(i)?s.$.Followed:s.$.Unfollowed)}),t.recommendedTopics.forEach(t=>{t.followState=e.includes(t.id)?s.$.Followed:s.$.Unfollowed})}}},69927:function(t,e,i){var s=i(94560),o=i(45186),n=i(68535),a=i(76225),c=(0,o.A)(function(t){return(0,n.A)((0,s.A)(t,1,a.A,!0))});e.A=c},80900:function(t,e,i){var s;i.d(e,{r:function(){return s}}),function(t){t.consumer="consumer",t.work="work"}(s||(s={}))},85515:function(t,e,i){var s;i.d(e,{D:function(){return s}}),function(t){t.SysTag="SysTag",t.UserQuery="UserQuery"}(s||(s={}))},98137:function(t,e,i){var s;i.d(e,{$:function(){return s}}),function(t){t.Followed="followed",t.Unfollowed="unfollowed",t.Locked="locked",t.None="none"}(s||(s={}))}}]);