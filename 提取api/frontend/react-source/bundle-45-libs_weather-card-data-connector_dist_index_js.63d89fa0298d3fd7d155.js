"use strict";(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["libs_weather-card-data-connector_dist_index_js"],{23200:function(t,i,e){e.r(i),e.d(i,{ToolingInfo:function(){return z},WeatherCardDataActions:function(){return n},WeatherCardDataConnector:function(){return x},WeatherCardDataReducer:function(){return M}});var a=e(68480);class n{}n.updateLocationDisplayName=new a.P("UpdateLocationDisplayName"),n.fetchWeatherSummarySuccess=new a.P("FetchWeatherSummarySuccess"),n.fetchWeatherSummaryFailure=new a.P("FetchWeatherSummaryFailure"),n.updateCurrentLocation=new a.P("UpdateCurrentLocation"),n.updateFallbackStatus=new a.P("updateFallbackStatus"),n.updateLocationDetectionState=new a.P("UpdateLocationDetectionState"),n.updateWeatherUserProfile=new a.P("UpdateWeatherUserProfile"),n.updateHyperlocal=new a.P("updateHyperlocal"),n.updateWeatherSettings=new a.P("UpdateWeatherSettings"),n.updateOperationFailure=new a.P("updateOperationFailure"),n.hideWeatherCard=new a.P("HideWeatherCard"),n.toggleFeedbackDialog=new a.P("ToggleFeedbackDialog");var o=e(32849),s=e(12426),r=e(31317),l=e(47903),c=e(46261),h=e(48983),d=e(84688),u=e(13629),v=e(94569),w=e(18731),f=e(12870),y=e(74195),p=e(89980),m=e(17720),g=e(77246),L=e(2651),S=e(93468),D=e(65022),W=e(88294),F=e(82170),N=e(58022),b=e(18708),A=e(42992),U=e(83542),I=e(77479),P=e(36111),C=e(79426),$=e(98216),H=e(19958);class R{constructor(t){this.dc=t}async addFavorite(t){const i=await this.dc.pdpserviceClient.addFavoriteLocation(t);if(i){var e;const i=(0,r.J7)(this.dc.getCurrentState().profile,t);null===(e=n.updateWeatherUserProfile.getActionSender(this.dc))||void 0===e||e.send(i)}return i}async setHome(t){const i=[];i.push(this.dc.pdpserviceClient.setHomeLocation(t).then(t=>!!t)),i.push(this.dc.pdpserviceClient.updateUserSettings(null,2..toString()));const e=(await Promise.all(i)).every(t=>!!t);if(e){var a;let i=this.dc.getCurrentState().profile;const e=this.dc.getCurrentState().currentLocation;var s;if(!o.isSameLocationPoint(e,t)&&null!=(null==e?void 0:e.from))null==e||delete e.from,null===(s=n.updateCurrentLocation.getActionSender(this.dc))||void 0===s||s.send(e);const l=i.home;i.home=t,i.home.from=3,i.locationMode=2,l&&(delete l.from,i=(0,r.YR)(i,l),this.dc.setRecentLocations(i.recents)),null===(a=n.updateWeatherUserProfile.getActionSender(this.dc))||void 0===a||a.send((0,r.mX)(i))}return e}async updateWeather(t,i){const e=this.dc.getCurrentState().unit;return await this.fetchWeather(t,e,i)}async fetchWeather(t,i,e){!t||(0,c.fn)(t)||t.el||(W.v.log("ignore Invalid input location: "+JSON.stringify(t)),t=void 0),i&&i!==L.B.Celsius&&i!==L.B.Fahrenheit&&(i=void 0);const a=t||{},n=i,o=(e=e||{})||{},s={...o.disableFetchRegionData&&{requestInfo:{disableFetchRegionData:o.disableFetchRegionData}},...o.filterRuleValue&&{filterRule:o.filterRuleValue},...e.partialHourly&&e.partialHours&&{partialHours:e.partialHours},partialHourly:e.partialHourly,hourlyStartDay:e.hourlyStartDay,hourlyDataDays:e.hourlyDataDays,userProfileFetch:e.userProfileFetch,lifeDataDays:e.lifeDataDays};return this.fetchWeatherDataAndLocationNameWithFallback(a,n,o,s)}async fetchWeatherDataAndLocationNameWithFallback(t,i,e,a){try{if(await this.fetchWeatherDataAndLocationName(t,i,e,a))return!0;null!=e&&e.isRefresh||this.dc.sendFetchWeatherSummaryFailureAction()}catch{return this.fetchWeatherDataAndLocationNameWithBLIS(i,e,a)}}async fetchWeatherDataAndLocationName(t,i,e,a){a=a||{};const l=await new Promise((n,o)=>{let r=0,l={};const c=()=>l.forecast&&l.location?n(l):2===r?o(new Error("Failed to fetch Weather forecast or location")):void 0;this.resolveWeatherData(t,i,a).then(t=>{++r,l={...l,...t&&t.forecast&&{forecast:t.forecast},...t&&t.home&&{home:t.home},location:!e.useInputLocation&&t&&t.location||l.location,...t&&t.profile&&{profile:t.profile},...t&&t.cards&&{cards:t.cards}},c()}).catch(e=>{var n,o;let h=(0,g.S)()?D.tPd:D.f9r;"scard"===(null===(n=a)||void 0===n||null===(n=n.requestInfo)||void 0===n?void 0:n.experience)&&(h=D.WZp),null!==(o=a)&&void 0!==o&&o.preventLogExceptionOnFailure||(0,S.c_)(e,h,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Unexpected process weather summary data error",`${(0,s.mX)(t)}, unit=${i}, res=${JSON.stringify(l)}`),++r,c()}),this.resolveLocationName(t).then(t=>{++r,l.location=l.location||t,c()}).catch(i=>{(0,S.c_)(i,D.IO,"error in library [weather-card-data-connector],Unexpected process localize display name error",`${(0,s.mX)(t)}`),++r,c()})});if(l&&l.forecast&&l.location){var c,h;if((0,g.S)())l.forecast.currentCondition={...l.forecast.currentCondition,deepLink:(0,H.hL)(l.location,l.forecast.unit)};else{const t=(0,w.KP)(this.dc.requestContext.data.locationHref,"locationHref");l.forecast.currentCondition={...l.forecast.currentCondition,deepLink:(0,H.hL)(l.location,l.forecast.unit,{locationHref:t})}}l.location.displayName=o.getDisplayName(l.location),null===(c=n.fetchWeatherSummarySuccess.getActionSender(this.dc))||void 0===c||c.send(l.forecast,l.location,l.forecast.unit,void 0,e.historyFetch,l.cards);let t=this.dc.getCurrentState().profile;t.unit=l.forecast.unit;const i=l.profile&&l.profile.followedLocations&&l.profile.followedLocations.filter(t=>!!t&&(0,s.B1)(t));return i&&i.length>0&&!(t.followedLocations&&t.followedLocations.length>0)&&(t.followedLocations=(0,r.Fv)(i)),(0,g.S)()&&(e.bySearch&&(t=(0,r.YR)(t,l.location),this.dc.setRecentLocations(t.recents),t.recentsForMobile=(0,r.h0)(t,l.location)),this.dc.updateHyperlocal()),null===(h=n.updateWeatherUserProfile.getActionSender(this.dc))||void 0===h||h.send(t),!0}return!1}async fetchWeatherDataAndLocationNameWithBLIS(t,i,e){try{const a=await this.dc.getBLISLocation(),n={...e};n.readChoice=t?0:2;if(await this.fetchWeatherDataAndLocationName(a,t,i,n))return!0;null!=i&&i.isRefresh||this.dc.sendFetchWeatherSummaryFailureAction()}catch{null!=i&&i.isRefresh||this.dc.sendFetchWeatherSummaryFailureAction()}}async resolveWeatherData(t,i,e){let a=await this.getWeather(t,i,e);const r=this.dc&&this.dc.config&&this.dc.config.defaultLocation?this.dc.config.defaultLocation:void 0;if(a&&a.location&&!(0,s.ES)(a.location)&&(a.location=await this.resolveLocationName(a.location)),a&&a.location&&"{}"!==JSON.stringify(a.location)||!r){const t=a&&a.location?a.location:void 0;var l,c;if(t&&r&&!o.isSameLocationPoint(t,(0,s.iw)())&&o.isSameLocationPoint(t,r))null===(l=n.updateFallbackStatus.getActionSender(this.dc))||void 0===l||l.send(!0);else null===(c=n.updateFallbackStatus.getActionSender(this.dc))||void 0===c||c.send(!1)}else{var h;e.preventLogExceptionOnFailure=!0,a=await this.getWeather(r,i,e),a&&a.location&&(a.location=await this.resolveLocationName(a.location)),null===(h=n.updateFallbackStatus.getActionSender(this.dc))||void 0===h||h.send(!0)}return a}async resolveLocationName(t,i){let e;return o.getDisplayName(t)&&(e=t),e&&o.getDisplayName(e)||(e=(0,r.I6)(this.dc.getCurrentState().profile,t.latitude,t.longitude)),e&&o.getDisplayName(e)&&(0,s.PI)(e)||(e=await this.dc.localizeLocationService.getLocalisedLocationDetails(t,i)||e),e?(e.displayName=o.getDisplayName(e),e):t}async getWeather(t,i,e){const a=await this.dc.serviceClient.getWeather(t,i,e);return a&&a.forecast?a:null}}var T=e(3608),O=e(86948),J=e(81784),k=e(59545);class x extends U.i{static get getWeatherLocationAndUnitTime(){return m.vv.get(this.getWeatherLocationAndUnitTimeKey)}static set getWeatherLocationAndUnitTime(t){m.vv.set(this.getWeatherLocationAndUnitTimeKey,t)}constructor(t,i,e,a,n,o,s){super(t,i,e,a,n,o,s),this.isStateReady=new C.e,this.locationHyperCache=new Map,this.getWeatherLocationAndUnit=null;const r=(0,v.V)();this.url=(0,w.e9)(s),this.localizeLocationService=new P.q(r,o.weatherApi),this.autoSuggestService=(0,b.X)(o.autoSuggest),this.pdpserviceClient=new T.U,this.signInStatus=0,this.defaultConfigUnit=this.config.setDefaultUnitToCelsius?L.B.Celsius:L.B.Fahrenheit,(0,g.S)()&&(0,k.Qc)().then(()=>{(0,J.e)()}),this.serviceClient=(0,F.$)(r,o,this.url),this.operation=new R(this)}async getAutoSuggestResponse(t){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const e=await this.autoSuggestService.getAutoSuggestResponse(t,i);if(e)return e.forEach(t=>t.autoSuggestionName=o.getAutoSuggestionName(t)),e}catch(t){i&&(0,S.c_)(t,D._kG,`error in library [weather-card-data-connector],Autosuggest service call exception, useAutoSuggestionV6=${this.config.autoSuggest&&this.config.autoSuggest.useV6}`)}return null}async geocodeLocation(t){return await this.autoSuggestService.geocodeSuggestion(t)}async getLocalizedDetectedLocation(){let t=await this.getBLISLocation();return t&&!(0,s.PI)(t)&&(t=await this.localizeLocationService.getLocalisedLocationDetails(t)),t}async addFavoriteLocation(t){var i,e;var a;if(((null===(i=this.getCurrentState().profile)||void 0===i||null===(i=i.favorites)||void 0===i?void 0:i.length)||0)>=r.WP)return null===(a=n.updateOperationFailure.getActionSender(this))||void 0===a||a.send(l.Ce.exceedPinLocationLimit),!1;const o=await this.operation.addFavorite(t);return this.setRecentLocations(null===(e=this.getCurrentState().profile)||void 0===e?void 0:e.recents),o}async fetchActiveStateforWeather(t,i,e){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return!1===i?this.fetchActiveLocationAndUnit(t).then(t=>null==t?void 0:t[0]):this.fetchSettingAndUpdateWeather(t,e,a).then(t=>null==t?void 0:t[0])}isLocationAndUnitReusable(){if(this.getWeatherLocationAndUnit&&x.getWeatherLocationAndUnitTime){if(Math.trunc((Date.now()-x.getWeatherLocationAndUnitTime)/6e4)<3)return!0}return!1}async fetchSettingAndUpdateWeather(t,i){var e;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t&&this.isLocationAndUnitReusable())return this.getWeatherLocationAndUnit;if(x.getWeatherLocationAndUnitTime=Date.now(),null!==(e=this.config.weatherApi)&&void 0!==e&&e.isSegmentCall)return this.getWeatherLocationAndUnit=this.getWeatherForecastFromSegmentAPI(i),this.getWeatherLocationAndUnit;const o=this.getCurrentState().currentLocation;let s=o,l=this.defaultConfigUnit,c=!1;return this.getWeatherLocationAndUnit=new Promise(async t=>{try{var e;let t=!0;s=this.getURLLatLngLocation();const i=await this.getBLISLocation();s||(t=!1,s=i||s),await this.updateSignedInStatus();const o=await this.pdpserviceClient.read(a),d=o.followedLocations,u=this.getCurrentState().profile||{};if(u.followedLocations=(0,r.Fv)(d).slice(0,r.WP),u.detectedLocation=i,null===(e=n.updateWeatherUserProfile.getActionSender(this))||void 0===e||e.send(u),o){var h;if(!t)if(o.locationMode&&(c=1===o.locationMode),c)s=i,null===(h=n.updateLocationDetectionState.getActionSender(this))||void 0===h||h.send(1,s);else o.home&&(s=o.home);o.unit&&(l=o.unit)}}catch(t){(0,S.c_)(t,D.Va3,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Weather Location fetch failed")}o&&o.displayName&&s&&o.latitude===s.latitude&&o.longitude===s.longitude&&o.locality===s.locality&&(s.displayName=o.displayName),t([s,l]),s||(0,S.vV)(D.Va3,"Weather Location fetch failed with empty activeWeatherLocation",void 0,{...D.Va3.pb,customMessage:`Geo Latitude = ${f.Rb.ClientSettings&&f.Rb.ClientSettings.geo_lat},\n                            & Geo Longitude =  ${f.Rb.ClientSettings&&f.Rb.ClientSettings.geo_long}`}),s&&this.getWeatherForecastDataAndLocationName(s,l,i)}),this.getWeatherLocationAndUnit}async fetchActiveLocationAndUnit(t){if(this.getWeatherLocationAndUnit&&!t)return this.getWeatherLocationAndUnit;const i=this.getCurrentState();let e=i.currentLocation;const a=1===i.locationDetectionSetting;let n=this.defaultConfigUnit;return this.getWeatherLocationAndUnit=new Promise(async t=>{try{if(e=await this.getBLISLocation(a)||e,e.displayName=o.getDisplayName(e),await this.updateSignedInStatus(),this.isUserLoggedIn()){const t=await this.pdpserviceClient.read();t&&(t.home&&(e=t.home),t.unit&&(n=t.unit))}}catch(t){(0,S.c_)(t,D.Va3,"error in library [weather-card-data-connector],Weather Location fetch failed")}t([e,n]),e||(0,S.vV)(D.Va3,"Weather Location fetch failed with empty activeWeatherLocation",void 0,{...D.Va3.pb,customMessage:`Geo Latitude = ${f.Rb.ClientSettings&&f.Rb.ClientSettings.geo_lat},\n                            & Geo Longitude =  ${f.Rb.ClientSettings&&f.Rb.ClientSettings.geo_long}`}),e&&this.getWeatherForecastDataAndLocationName(e,n)}),this.getWeatherLocationAndUnit}async updateSettings(t,i,e,a,o){var r;let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=2===t&&i&&""!==i.latitude&&""!==i.longitude;const u=this.getCurrentState().locationDetectionSetting,v=!!t&&t!==u;var w,f,p,m;d&&this.getCurrentState().currentLocation&&!v&&(d=!((null===(w=i)||void 0===w?void 0:w.latitude)===(null===(f=this.getCurrentState().currentLocation)||void 0===f?void 0:f.latitude)&&(null===(p=i)||void 0===p?void 0:p.longitude)===(null===(m=this.getCurrentState().currentLocation)||void 0===m?void 0:m.longitude)));const g=!!e&&e!==this.getCurrentState().unit;e||(e=this.getCurrentState().unit||this.defaultConfigUnit),i&&""!==i.latitude&&""!==i.latitude||(i=this.getCurrentState().currentLocation);const{profile:L}=this.getCurrentState();var S;(L&&i&&(L.followedLocations=L.followedLocations?[i,...L.followedLocations.filter(t=>!(0,s.nS)(i,t))].slice(0,10):[i],h&&(L.home=i)),1===t&&(i=await this.getBLISLocation(),(0,A.BX)(i)),v)&&(null===(S=n.updateLocationDetectionState.getActionSender(this))||void 0===S||S.send(t,i,new Date));const D=[];return!1!==a&&((d||h)&&D.push(this.pdpserviceClient.setHomeLocation(i,c).then(()=>{var t,i;const e=null===(t=this.getCurrentState().profile)||void 0===t?void 0:t.home,a=null===(i=this.getCurrentState().profile)||void 0===i?void 0:i.locationMode;e&&2===a&&this.addFavoriteLocation(e)})),(g||v)&&D.push(this.pdpserviceClient.updateUserSettings(g?e.toString():null,v?t.toString():"",c))),await Promise.all(D),null===(r=n.updateWeatherSettings.getActionSender(this))||void 0===r||r.send(l.QZ.Start),o||(0,y.Q6)({id:"InvalidateWeatherPdp",type:"command"}),i}resetSocialComment(t,i,e,a){}getSocialTopicId(t,i,e){return null}async updateSettingsAndFetch(t,i,e,a,n,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return i=await this.updateSettings(t,i,e,a,!0,s,r),await this.getWeatherForecastDataAndLocationName(i,e,o),n||(0,y.Q6)({id:"InvalidateWeatherPdp",type:"command"}),i}async updateSignedInStatus(){if(0===this.signInStatus){const t=new Date;this.signInStatus=await(0,O.XK)(),I.p.signedInStatus.registerObserver(async i=>{if(!this.isUserLoggedIn()&&(this.signInStatus=await(0,O.XK)(),this.isUserLoggedIn())){const i=new Date;W.v.log(`Time of login:${JSON.stringify((i.getTime()-t.getTime())/1e3)} seconds`),this.fetchActiveStateforWeather(!0)}})}}isUserLoggedIn(){return 2===this.signInStatus}async updateLocationDisplayName(t){var i;if(t&&o.getDisplayName(t)&&(0,s.PI)(t))return void(null===(i=n.updateLocationDisplayName.getActionSender(this))||void 0===i||i.send(t));if(!(0,c.fn)(t))return void(0,S.vV)(D.Va3,"No valid User location set ");const e=await this.localizeLocationService.getLocalisedLocationDetails(t);if(e){var a,l;const t=(0,r.YR)(this.getCurrentState().profile,e);this.setRecentLocations(t.recents),t.recentsForMobile=(0,r.h0)(this.getCurrentState().profile,e),null===(a=n.updateWeatherUserProfile.getActionSender(this))||void 0===a||a.send(t),null===(l=n.updateLocationDisplayName.getActionSender(this))||void 0===l||l.send(e)}}async getWeatherForecastDataAndLocationName(t,i,e){try{const a=await this.getWeatherForecastData(t,i,e);return a&&this.updateLocationDisplayName(t),this.isStateReady.set(a),a}catch(t){var a;let i=D.tPd;return"scard"===(null==e||null===(a=e.requestInfo)||void 0===a?void 0:a.experience)&&(i=D.WZp),(0,S.c_)(t,i,"error in library [weather-card-data-connector],error in library [weather-card-data-connector],Failure to parse weather response"),this.isStateReady.set(!1),!1}}async getWeatherForecastFromSegmentAPI(t){const i=this.getCurrentState().currentLocation;let e=i,a=this.defaultConfigUnit;return new Promise(async s=>{const c=`${null==t?void 0:t.weatherDataCachePrefix}_CurrentWeather`;let h=null,d=!1;if(null!=t&&t.weatherDataCachePrefix&&(0,p.Lg)().getItem(c)){var u;const i=JSON.parse((0,p.Lg)().getItem(c));if(i&&i.storageTimestamp){const e=(new Date).getTime();d=!!i.storageTimestamp&&e-i.storageTimestamp<(t.weatherDataCacheDuration||36e5)}h=i,null===(u=h)||void 0===u||null===(u=u.forecast)||void 0===u||null===(u=u.forecast)||void 0===u||u.forEach(t=>{t&&t.day&&(t.day=new Date(t.day))}),this.serviceClient.getWeather(void 0,void 0,t).then(t=>{if(t&&t.forecast){const i={...t,storageTimestamp:(new Date).getTime()};(0,p.Lg)().setItem(c,JSON.stringify(i))}})}if(!d&&(h=await this.serviceClient.getWeather(void 0,void 0,t),h&&h.forecast&&null!=t&&t.weatherDataCachePrefix)){const t={...h,storageTimestamp:(new Date).getTime()};(0,p.Lg)().setItem(c,JSON.stringify(t))}if(h&&h.forecast){var v,w,f,y,m;const s=h.forecast;e=h.location||i,e.displayName=o.getDisplayName(e),a=s.unit||this.defaultConfigUnit;const c=(0,r.YR)(this.getCurrentState().profile,e);c.unit=a,this.setRecentLocations(c.recents),c.recentsForMobile=(0,r.h0)(this.getCurrentState().profile,e),c.sig=null===(v=h.profile)||void 0===v?void 0:v.sig,c.followedLocations=(0,r.Fv)((null===(w=h.profile)||void 0===w?void 0:w.followedLocations)||[]).slice(0,r.WP),c.detectedLocation=null===(f=h.profile)||void 0===f?void 0:f.detectedLocation,c.home=null===(y=h.profile)||void 0===y?void 0:y.home,null===(m=n.updateWeatherUserProfile.getActionSender(this))||void 0===m||m.send(c);var g,L;if(this.getCurrentState().settingUpdateStatus!=l.QZ.WCComplete)"wcardwc"===(null==t||null===(g=t.requestInfo)||void 0===g?void 0:g.experience)&&s&&(s.lastUpdated=Date.now().toString()),null===(L=n.fetchWeatherSummarySuccess.getActionSender(this))||void 0===L||L.send(s,e,a,l.QZ.WCComplete,void 0,h.cards)}s([e,a]),this.isStateReady.set(!0)})}async getWeatherForecastData(t,i,e){var a,o;if(!(0,c.fn)(t))return(0,S.vV)(D.Va3,"No valid User location set"),!1;const s=await this.getWeather(t,i,e);if(!s)return!1;const h=s.forecast,d=(0,r.YR)(this.getCurrentState().profile,t);d.unit=i,this.setRecentLocations(d.recents),d.recentsForMobile=(0,r.h0)(this.getCurrentState().profile,t),d.sig=null===(a=s.profile)||void 0===a?void 0:a.sig,null===(o=n.updateWeatherUserProfile.getActionSender(this))||void 0===o||o.send(d);var u,v;return this.getCurrentState().settingUpdateStatus!=l.QZ.WCComplete&&("wcardwc"===(null==e||null===(u=e.requestInfo)||void 0===u?void 0:u.experience)&&h&&(h.lastUpdated=Date.now().toString()),null===(v=n.fetchWeatherSummarySuccess.getActionSender(this))||void 0===v||v.send(h,t,h.unit||i,l.QZ.WCComplete,void 0,s.cards),!0)}updateWeatherDataStateFromSSR(t){var i,e,a,o;if(!t||!t.currentCondition)return;null===(i=n.updateWeatherUserProfile.getActionSender(this))||void 0===i||i.send(t.profile);const s=t,r=t.unit,c=t.locationDetectionSetting,h=t.currentLocation;null===(e=s.forecast)||void 0===e||e.forEach(t=>{t&&t.day&&"string"==typeof t.day&&(t.day=new Date(t.day))}),null===(a=n.updateLocationDetectionState.getActionSender(this))||void 0===a||a.send(c,h),null===(o=n.fetchWeatherSummarySuccess.getActionSender(this))||void 0===o||o.send(s,h,r,l.QZ.WCComplete,void 0,t.cardsMetadata),this.getWeatherLocationAndUnit||(this.getWeatherLocationAndUnit=new Promise(async t=>{t([h,r])}),x.getWeatherLocationAndUnitTime=t.lastUpdated?new Date(t.lastUpdated).getTime():Date.now())}updateWeatherDataState(t,i){var e,a,o;const s=JSON.parse(t);if(!s||!s.userProfile||!s.userProfile.location)return;const r=s.userProfile,c=(0,N.dB)(r.location),u=r.locationSettingMode?Number(r.locationSettingMode):1,v=this.getCurrentState().profile||{};v.detectedLocation=r.detectedLocation&&(0,N.dB)(r.detectedLocation),v.followedLocations=(0,h.LT)(r.followedLocations&&r.followedLocations.map(t=>(0,N.dB)(t))),v.sig=r.sig,null===(e=n.updateWeatherUserProfile.getActionSender(this))||void 0===e||e.send(v),i&&s.responses&&s.responses[0]&&s.responses[0].weather&&s.responses[0].weather[0]&&(s.responses[0].weather[0].disableFreshCheck=!0);const w={response:s,location:c,locStrResolver:d.l},f=(0,N.OW)(w);if(!f||!f.unit)return;const y=f.unit;null===(a=n.updateLocationDetectionState.getActionSender(this))||void 0===a||a.send(u,c),null===(o=n.fetchWeatherSummarySuccess.getActionSender(this))||void 0===o||o.send(f,c,y,l.QZ.WCComplete,void 0,s.cards),this.getWeatherLocationAndUnit||(this.getWeatherLocationAndUnit=new Promise(async t=>{t([c,y])}),x.getWeatherLocationAndUnitTime=Date.now())}getURLLatLngLocation(){const t=(0,w.KP)(this.requestContext.data.locationHref,"locationHref"),i=new URL(t),e={latitude:i.searchParams.get("lat")||"",longitude:i.searchParams.get("lon")||""};return(0,s.B1)(e)?e:null}async getBLISLocation(t){let i=await this.pdpserviceClient.getBLISLocation(t)||(0,s.iw)();return(0,c.fn)(i)||(i=this.config.defaultLocation),i}setRecentLocations(t){(0,p.Lg)().supported&&(0,p.Lg)().setItem(l.hL,JSON.stringify(t))}async getWeather(t,i,e){const a=await this.serviceClient.getWeather(t,i,e);return a&&a.forecast?a:null}hideWeatherCard(){var t;null===(t=n.hideWeatherCard.getActionSender(this))||void 0===t||t.send()}updateLocationDetectionState(t,i){var e;null===(e=n.updateLocationDetectionState.getActionSender(this))||void 0===e||e.send(t,i)}async upLocation(t){var i,e;let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=(null===(i=this.getCurrentState().profile)||void 0===i?void 0:i.followedLocations)||[],c=((null==l?void 0:l.filter(i=>(0,s.et)(t,i)))||[]).slice(0,r.u1-1);return null===(e=n.updateWeatherUserProfile.getActionSender(this))||void 0===e||e.send({home:t,followedLocations:[t,...c]}),a&&this.updateWeather(t),!o||await this.setLocationHome(t)}sendFetchWeatherSummaryFailureAction(){var t;null===(t=n.fetchWeatherSummaryFailure.getActionSender(this))||void 0===t||t.send(D.tPd)}async setLocationHome(t){const i=await this.operation.setHome(t);var e;i||(null===(e=n.updateOperationFailure.getActionSender(this))||void 0===e||e.send(l.Ce.setHomeFail));return i}async updateWeather(t,i){return await this.operation.updateWeather(t,i)}async updateHyperlocal(){var t,i;if(null!==(t=this.config.weatherApi)&&void 0!==t&&t.includenowcasting&&null!==(i=this.config.autoSuggest)&&void 0!==i&&i.useV6){const t=this.getCurrentState().currentLocation;this.checkLocationHyper().then(i=>{var e;null!==i&&($.YT.sendClientLogEvent({message:`Visited location with name ${o.getDisplayName(t)}, hyperlocal check: ${i}`,type:"information"}),o.isSameLocationPoint(t,this.getCurrentState().currentLocation)&&(null===(e=n.updateHyperlocal.getActionSender(this))||void 0===e||e.send(!!i)))})}}async checkLocationHyper(){const t=this.getCurrentState().currentLocation;if((0,u.pB)(t))return(0,u.Se)(t);{const i=o.getDisplayName(t);if(this.locationHyperCache.has(i))return this.locationHyperCache.get(i);this.locationHyperCache.set(i,null);const e=await this.getAutoSuggestResponse(i,!1);if(e){for(const a of e)if(o.isSameLocationPoint(a,t)||o.getDisplayName(a)===i){const t=(0,u.Se)(a);return this.locationHyperCache.set(i,t),t}this.locationHyperCache.set(i,!1)}return!1}}toggleFeedbackDialog(t){var i;null===(i=n.toggleFeedbackDialog.getGlobalActionSender())||void 0===i||i.send(t)}async setPrimaryLocation(t){return await this.setLocationHome(t)}async addFollowLocation(t){return await this.operation.addFavorite(t)}async removeNotPrimaryLocation(t){return await this.pdpserviceClient.removeLocation(t)}resolveIsStateReady(t){this.isStateReady.set(t)}}x.getWeatherLocationAndUnitTimeKey=Symbol("getWeatherLocationAndUnitTime");var G=e(24678);function _(t){if(t.currentLocation){const i=(0,r.I6)(t.profile,t.currentLocation.latitude,t.currentLocation.longitude);i&&(i.displayName=o.getDisplayName(t.currentLocation))}}class M{constructor(){this.INITIAL_STATE={locationDetectionSetting:2,unit:void 0,showLocationPanel:!0,profile:{},pollenSelectedDateIndex:0,layoutType:"",dateInfo:{},pollenCities:void 0}}reduce(t,i){if(!t)return this.INITIAL_STATE;if(!i)return t;let e=!1,a=null;return e=e||G.n.handleAction(i,n.fetchWeatherSummarySuccess,(i,e,n,o,r,l)=>{a=function(t,i,e,a,n,o){const r={...t};r.previews=i.previews,r.currentCondition=i.currentCondition,r.forecast=i.forecast,r.pollenForecast=i.pollen,r.nowcasting=i.nowcasting,r.lastUpdated=i.lastUpdated,r.alertsInfo=i.alertsInfo,r.alertsInfoList=i.alertsInfoList,r.contentData=i.contentData,r.mapsMetaData=i.mapsMetaData,r.source=i.source,r.provider=i.provider,r.aqiProvider=i.aqiProvider,r.lifeDaily=i.lifeDaily,r.activityIndexDaily=i.activityIndexDaily,r.forecastVideo=i.forecastVideo,r.lifeActivityData=i.lifeActivityData,(0,c.fn)(e)||(e=t.currentLocation);r.currentLocation={...e},_(r),r.unit=a,n&&(r.settingUpdateStatus=n);o&&(r.cardsMetadata=o);i.insights&&(r.insights=i.insights);r.currentLocation&&r.currentCondition&&r.locationWeatherMap&&(r.locationWeatherMap[(0,s.fI)(r.currentLocation)]={currentTemperature:r.currentCondition.currentTemperature,pvdrIcon:r.currentCondition.pvdrIcon,symbol:r.currentCondition.symbol,alertCount:r.currentCondition.alertCount,alertSignificance:r.currentCondition.alertSignificance,cap:r.currentCondition.shortCap});return r}(t,i,e,n,o,l)}),e=e||G.n.handleAction(i,n.updateLocationDisplayName,i=>{a={...t},o.isSameLocationPoint(t.currentLocation,i)&&(a.currentLocation={...i,displayName:o.getDisplayName(i)},_(a))}),e=e||G.n.handleAction(i,n.updateLocationDetectionState,(i,e,n)=>{a={...t},a.locationDetectionSetting=i,a.currentLocation=e,a.settingUpdatedTime=n,_(a)}),e=e||G.n.handleAction(i,n.updateWeatherSettings,i=>{a={...t},a.settingUpdateStatus=i}),e=e||G.n.handleAction(i,n.updateWeatherUserProfile,i=>{var e;a={...t},a.profile={...t.profile,...i,home:i.home||(null===(e=t.profile)||void 0===e?void 0:e.home)||void 0},a.profile.home&&t.currentLocation&&o.isSameLocationPoint(a.profile.home,t.currentLocation)&&(a.currentLocation={...a.currentLocation,from:3}),_(a)}),e=e||G.n.handleAction(i,n.updateOperationFailure,i=>{a={...t,operationFailureId:i}}),e=e||G.n.handleAction(i,n.hideWeatherCard,()=>{a={...t,weatherCardGotHiddenInFeed:!0}}),a||t}}const z={experienceConfigSchema:{}}}}]);