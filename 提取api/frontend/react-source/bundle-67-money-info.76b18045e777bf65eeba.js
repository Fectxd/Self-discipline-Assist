(self.homePageWebpackChunks=self.homePageWebpackChunks||[]).push([["cs-core-desktop_responsive-list_dist_index_js","money-info"],{4968:function(t,i,e){"use strict";e.d(i,{f:function(){return l}});var n=e(64187),s=e(74849),r=e(42792),o=e(99657),a=e(36452);const l=s.A.partial`position: relative; z-index: ${o.D};`;s.A`
    ${r.e}
    ${r.nH}

    ${(0,n.V)("grid")} :host {
        grid-template-rows: auto 1fr minMax(16px, auto);
        grid-template-columns: 100%;
        ${l}
    }

    .content {
        padding: 0 var(--sd-card-content-padding-inline, 16px);
        overflow: hidden;
    }

    ::slotted([slot="header"]) {
        grid-row: 1;
    }
    ::slotted([slot="footer"]) {
        grid-row: 3;
    }

    ::slotted([slot="image"]) {
        position: absolute;
        bottom: 0;
        right: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
    }

    /* Ensure neutral buttons have a stroke per the design */
    ::slotted(fluent-button[appearance="neutral"]),
    ::slotted(fluent-anchor[appearance="neutral"]) {
        border: 1px solid ${a.I2};
    }

    ::slotted(fluent-button[appearance="neutral"]:hover),
    ::slotted(fluent-anchor[appearance="neutral"]:hover) {
        border-color: ${a.mb};
    }

    ::slotted(fluent-button[appearance="neutral"]:active),
    ::slotted(fluent-anchor[appearance="neutral"]:active) {
        border-color: ${a.MY};
    }

    .header-overlay,
    .footer-overlay {
        position: absolute;
        background: rgba(255, 255, 255, 0.46);
        height: 100%;
        width: 100%;
        opacity: 0;
    }

    .header-overlay {
        grid-row: 1 / span 1;
    }

    .footer-overlay {
        grid-row: 3 / span 1;
    }

    .gradient {
        position: absolute;
        grid-row: 2 / span 1;
        height: 100%;
        width: 100%;
        opacity: 0;
        background: linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.46) 0%,
            rgba(255, 255, 255, 0) 22%,
            rgba(255, 255, 255, 0) 86%,
            rgba(255, 255, 255, 0.46) 100%
        );
    }

    @media (prefers-color-scheme: dark) {
        .header-overlay,
        .footer-overlay {
            background: rgba(0, 0, 0, 0.54);
        }

        .gradient {
            background: linear-gradient(
                180deg,
                rgba(0, 0, 0, 0.54) 0%,
                rgba(0, 0, 0, 0) 22%,
                rgba(0, 0, 0, 0) 86%,
                rgba(0, 0, 0, 0.54) 100%
            );
        }
    }

    :host([immersive-card]) .header-overlay,
    :host([immersive-card]) .footer-overlay,
    :host([immersive-card]) .gradient {
        opacity: 1;
    }
`.withBehaviors(r.kc)},39484:function(t,i,e){"use strict";function n(t){const i=new Map;return function(){let e=i.get(arguments.length);e||(e=arguments.length?new Map:t(...arguments),i.set(arguments.length,e));for(let i=0;i<arguments.length;i++){const n=i<0||arguments.length<=i?void 0:arguments[i];if(e.has(n))e=e.get(n);else{const s=i===arguments.length-1?t(...arguments):new Map;e.set(n,s),e=s}}return e}}e.d(i,{a:function(){return n}})},44894:function(t){t.exports='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4c0-1.1.9-2 2-2zm0 1a1 1 0 00-1 1v12a1 1 0 001 1h8a1 1 0 001-1V4a1 1 0 00-1-1H6zm7 3.5a.5.5 0 01-.41.5H7.5a.5.5 0 01-.09-1h5.09c.28 0 .5.22.5.5zm0 3.5a.5.5 0 01-.41.5H7.5a.5.5 0 01-.09-1h5.09c.28 0 .5.22.5.5zm0 3.5a.5.5 0 01-.41.5H7.5a.5.5 0 01-.09-1h5.09c.28 0 .5.22.5.5z"></path></svg>'},49704:function(t){t.exports='<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 13h11a.5.5 0 00.42-.78L13.1 8l2.82-4.22A.5.5 0 0015.5 3H4a.5.5 0 00-.5.5v14a.5.5 0 001 0V13zm0-1V4h10.07l-2.49 3.72a.5.5 0 000 .56L14.57 12H4.5z"></path></svg>'},59836:function(t,i,e){"use strict";e.d(i,{m:function(){return p}});var n=e(65614),s=e(92011);class r extends s.L{}var o=e(7896),a=e(61138),l=e(48751),h=e(74838),d=e(74849),u=e(64187),c=e(22131),v=e(50882);const f=d.A`
    ${(0,u.V)("inline-flex")} :host {
        box-sizing: border-box;
        font-family: ${o.O};
        font-size: ${a.k};
        font-weight: 400;
        line-height: ${a.F};
        align-items: center;
        color: ${l.l};
        min-height: 16px;
    }

    .content {
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        align-self: baseline;
    }

    ::slotted([slot="image"]) {
        display: flex;
        margin-inline-end: calc(${h.vR} * 2px);
    }
`.withBehaviors((0,c.mr)(d.A`
            :host,
            .content {
                color: ${v.A.ButtonText};
                fill: currentcolor;
            }
        `));const g=e(96950).qy`
    <slot name="image"></slot>
    <span part="content" class="content">
        <slot></slot>
    </span>
`,p=r.compose({name:`${n.G.prefix}-attribution`,styles:f,template:g})},60027:function(t,i,e){"use strict";e.r(i),e.d(i,{MoneyInfoTransformer:function(){return I}});var n=e(81725),s=e(84665),r=e(38346),o=e(13141),a=e(48114),l=e(92337),h=e(65022),d=e(93468),u=e(17254),c=e(18731),v=e(7087),f=e(3589),g=e(44894),p=e.n(g),m=e(17720),w=e(36090),b=e(39484);const y=[n.Rf.Movers,n.Rf.Gainers,n.Rf.Losers],T="success";class I extends n.IB{constructor(){super(...arguments),this.isPinned=!1,this.isCopilotTheme=!1,this.cardSize=r.uE._1x_2y,this.cardType="",this.fullPreviewType="",this.getTMPLKeyMemoized=(0,b.a)((t,i)=>i&&i!==n.kb.MoneyInfo?`${i}_${t}`:t),this.handleInterestSearch=async t=>{var i,e;null===(i=(e=this.transformerProvider).searchInterestsHandler)||void 0===i||i.call(e,t||"")},this.onInterestOptionClick=t=>{if(t.isFollowed)this.openFromSearchPage(t.id||"");else if(this.transformerProvider.followClickHandler&&t.id){const i=(0,v.rW)(v.AK.watchlist,this.transformerProvider.config.urls,{id:t.id});this.transformerProvider.followClickHandler(t.id||"",!0,t.interestName,i)}},this.actionMenuButtonClickHandler=t=>{this.transformerProvider.config.isDynamicFeed&&this.transformerProvider.supportedSdCardActionMenuItems&&this.toggleMoneyInfoCardActions(t)},this.settingsHandler=t=>{var i,e;"onShowSettingsEnd"===t?null===(i=(e=this.transformerProvider).openSearchViewHandler)||void 0===i||i.call(e,!0):"onHideSettingsEnd"===t&&this.openSearchViewHandler(!1)},this.addRecommendedQuoteIdsForWL=(t,i)=>{var e;if(this.getTabNameShownInUX(i)!==n.Rf.Watchlist)return t;const s=null===(e=i.get(n.Xe.MoneyInfoApiData).tabListDetails)||void 0===e||null===(e=e[n.Rf.Suggested])||void 0===e?void 0:e.quoteIds;return s?Array.from(new Set([...t,...s])):t}}static getInstance(t,i){const e=`MoneyInfoTransformer_${t}`,n=m.vv.get(e,()=>({}));return n[e]||(n[e]=new I(i)),n[e]}async transform(t){this.currentTab=t.get(n.Xe.CurrentTabId),this.telemetryBuilder=this.transformerProvider.telemetryBuilder,this.rootTelemetryObject=t.get(n.Xe.RootTelemetryObject);const i=t.get(n.Xe.MoneyInfoApiData)??{};let e,r,o;if(this.isCopilotTheme=t.get(n.Xe.IsCopilotTheme),this.fullPreviewType=t.get(n.Xe.FullPreviewType),this.widgetDimension=t.get(n.Xe.WidgetDimension),this.isPinned=t.get(n.Xe.IsPinned),this.disablePinIcon=a.F_.get(a.nz.DisablePinIcon),this.cardSize=t.get(n.Xe.CardSize),this.cardType=t.get(n.Xe.CardType),this.updateSpotlightTabData(t),this.tabNameShownInUX=this.getTabNameShownInUX(t),s.aC.safeExecute(()=>{this.setTelemetry(t)},void 0,h.b1m,"MoneyInfo - set telemetry object error"),t.get(n.Xe.IsRubyPill))return o=this.getPillViewModel(t),this.getContainerView(e,r,o);!o&&this.isCopilotTheme&&(r=this.getRubyCardData(t)),r||o||(e=this.getMoneySDCardData(i,t));const l=await s.aC.safeExecuteAsync(async()=>{const i=this.getCurrentTagName();return i&&this.tabNameShownInUX?await this.getCurrentView(t,i,this.tabNameShownInUX):Promise.resolve(this.getDefaultContentView())},this.getDefaultContentView(),h.w6o,`MoneyInfo - error when getting content view for "${this.tabNameShownInUX}" tab`);return this.getContainerView(e,r,o,l)}getCurrentTagName(){return this.isSmallWatchlistCopilotUX()?n.Ai.PriceSpotlight:this.currentTab?n.Ln[this.currentTab]:void 0}isSmallWatchlistCopilotUX(){return this.currentTab===n.Rf.Watchlist&&this.isMiniWidget()}getDefaultContentView(){return{viewTemplate:void 0}}getContainerView(t,i,e,r){return r||(r=this.getDefaultContentView()),{currentViewTemplate:r.viewTemplate,sdCardData:t,rubyCardData:i,pillViewModel:e,viewModel:{tabTelemetryTag:this.telemetryBuilder.createTelemetryObjectTag(this.tabTelemetryObject),telemetryTag:this.telemetryBuilder.createTelemetryObjectTag(this.telemetryObject)},feedsNotificationToastViewModel:{notificationToastTelemetryTag:this.telemetryBuilder.createBehaviorTelemetryTag(this.telemetryObject,{name:n.CD.MoneyNotificationToast},s.YJ.Show),navLinkTelemetryTag:this.telemetryBuilder.createNavClickTelemetryTag(this.telemetryObject,{name:n.CD.MoneyNotificationToastLink}),dismissNotificationToastTelemetryTag:this.telemetryBuilder.createBehaviorTelemetryTag(this.telemetryObject,{name:n.CD.MoneyNotificationToastDismiss},s.YJ.Cancel),telemetryTag:this.telemetryBuilder.createViewTelemetryTag(this.telemetryObject,{name:n.CD.MoneyNotificationToast})}}}setTelemetry(t){var i;const e=this.transformerProvider.telemetryBuilder,s=u.T3.AppType===f.u.WindowsNewsWidgets?this.getWidgetTelemetryExt():null===(i=this.rootTelemetryObject)||void 0===i||null===(i=i.contract)||void 0===i?void 0:i.ext,r=this.getZone(t);t.get(n.Xe.IsRubyPill)&&s&&(s.ct1s="MoneyInfoMiniWidget"),e.initTelemetryBuilder(n.CD.moneyVertical,n.CD.moneyCategory,s,r);const o=this.getTabSignature(t,this.tabNameShownInUX),a=this.isCopilotTheme?this.fullPreviewType:void 0;this.telemetryObject=e.createViewTelemetryObject(this.rootTelemetryObject,{name:n.CD.moneyCard,signature:o,previewType:a}),this.tabTelemetryObject=e.createViewTelemetryObject(this.telemetryObject,{name:this.getTabNameForTelemetry(t),signature:o,previewType:a})}setTMPL(t,i){(0,s.ao)(this.getTMPLKeyMemoized(t,this.cardType),i)}removeTMPL(t){(0,s.iJ)(this.getTMPLKeyMemoized(t,this.cardType))}getTabNameForTelemetry(t){return this.tabNameShownInUX!==n.Rf.Watchlist||this.shouldInsertSYFItem(t)||this.shouldShowTabNameByQuoteDataFrom(this.currentTab)?this.tabNameShownInUX:n.Rf.Suggested}getWidgetTelemetryExt(){var t;return(null===(t=this.rootTelemetryObject)||void 0===t||null===(t=t.contract)||void 0===t?void 0:t.ext)||this.widgetDimension}getTabSignature(t,i){var e;const s=t.get(n.Xe.MoneyInfoApiData),r=t.get(n.Xe.PreviewType),a=t.get(n.Xe.CardType);return this.isCurrentTabSpotlight(t)&&a!==n.kb.Greeting?this.getPreviewSignature(r):i?(null===(e=s.tabListDetails)||void 0===e||null===(e=e[i])||void 0===e?void 0:e.signature)??`${(0,o.Bd)()}_${i}`:(0,o.Bd)()}getPreviewSignature(t){let i=`${u.T3.AppType===f.u.WindowsNewsWidgets?o.l2:(0,o.Bd)()}_${t}`;if(this.isCopilotTheme){var e;const[t,n,s,r,o,a]=(null===(e=this.fullPreviewType)||void 0===e?void 0:e.split(/[:_]/))||[];a&&(i+=`_${a}`)}return i}async getCurrentView(t,i,e){const s=t.get(n.Xe.CurrentQuoteIds),r=t.get(n.Xe.QuoteItemDict),a=t.get(n.Xe.ChartItemDict),l=t.get(n.Xe.WatchlistIds),h=t.get(n.Xe.CardSize),d=t.get(n.Xe.MoneyInfoApiData),u=t.get(n.Xe.ExperienceName),c=this.transformToFooterData(t),f=[];switch(this.parseNotifications(d),i){case n.Ai.VerticalQuoteList:{var g;this.addQuoteItemsToArray(f,s,r);const i=this.getQuoteListTagName(d,t),o={tabName:e,experienceName:u,quoteDetails:f,chartItemDict:a,watchlistIds:l,showWatchlistButton:e===n.Rf.Suggested,cardSize:this.getQuoteListCardSize(i,h),tabData:null===(g=d.tabListDetails)||void 0===g?void 0:g[e],fullWatchlistQuoteIds:d.fullWatchlistQuoteIds,quoteNotificationDetails:d.quoteNotificationDetails,signature:this.getTabSignature(t,e),seeMoreLink:this.getNavLink(t),telemetryObject:this.tabTelemetryObject};return await this.transformerProvider.generateView(o,i)}case n.Ai.VerticalWatchlist:{var p;const i=[],o=this.isCopilotTheme?n.Ai.VerticalWatchlistV2:n.Ai.VerticalWatchlist;this.addQuoteItemsToArray(i,s,r);const c={tabName:e,experienceName:u,cardSize:h,chartItemDict:a,watchlistIds:l,watchlistItems:i,recommendTabData:null===(p=d.tabListDetails)||void 0===p?void 0:p[n.Rf.Suggested],fullWatchlistQuoteIds:d.fullWatchlistQuoteIds,quoteNotificationDetails:d.quoteNotificationDetails,signature:this.getTabSignature(t,e),seeMoreLink:this.getNavLink(t),telemetryObject:this.tabTelemetryObject};return await this.transformerProvider.generateView(c,o)}case n.Ai.SpotlightEarnings:{var m;const s=t.get(n.Xe.SpotlightTabData);if(null==s||!s.quote)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const r=this.getSpotlightEarningsTagName(t,s.quote.id),o=this.generateMetadataForSpotlight(e,r,s,t,null===(m=c.footerLink)||void 0===m?void 0:m.navigationUrl);return await this.transformerProvider.generateView(o,r)}case n.Ai.EventBrief:{const n=this.getEventBriefItem(t);if(!n)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`event brief data is not in the feed for "${e}"`);const{eventLevel:s,entityIdentifier:o}=n,a=(0,v.Cz)(s)?r[o]:void 0,l={cardSize:h,signature:this.getTabSignature(t,e),telemetryObject:this.tabTelemetryObject,tabName:e,experienceName:u,eventBriefData:n,quoteItem:a};return await this.transformerProvider.generateView(l,i)}case n.Ai.MarketMovers:{var w;(s||[]).map(t=>{const i=null==r?void 0:r[t];i&&f.push(i)});const a=(0,o.VK)(d.previewDictionary,t.get(n.Xe.PreviewType),n.tr.Indices,this.transformerProvider.config.minimumNumberOfMarketMovers),l=f.length>(this.transformerProvider.config.minimumNumberOfMarketMovers||0),h=t.get(n.Xe.SpotlightTabData);if(a&&l){var b;this.setTMPL(n.KI.moneyNotiQuoteSecurityType,n.tr.Indices);const i=this.generateMetadataForSpotlight(e,n.Ai.MarketMovers,h,t,null===(b=c.footerLink)||void 0===b?void 0:b.navigationUrl);return await this.transformerProvider.generateView(i,n.Ai.MarketMovers)}this.logSpotlightMissingErrorMessage(i,t),this.setTMPL(n.KI.moneyNotiQuoteSecurityType,n.tr.Indices);const u=this.generateMetadataForSpotlight(e,n.Ai.PriceSpotlight,h,t,null===(w=c.footerLink)||void 0===w?void 0:w.navigationUrl);return await this.transformerProvider.generateView(u,n.Ai.PriceSpotlight)}case n.Ai.PriceSpotlight:{var y,T;const s=this.getPriceMovementTabData(t);if(!s||!s.quote)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const r=this.getSpotlightTagName(s.quote);this.setTMPL(n.KI.moneyNotiQuoteSecurityType,(0,o.CX)(null===(y=s.quote)||void 0===y?void 0:y.securityType));const a=this.generateMetadataForSpotlight(e,r,s,t,null===(T=c.footerLink)||void 0===T?void 0:T.navigationUrl);return await this.transformerProvider.generateView(a,r)}case n.Ai.WatchlistSummary:{var I,C,S,$;if(!d.tabListDetails||null===(I=d.tabListDetails)||void 0===I||!I[e]||null===(C=d.tabListDetails)||void 0===C||null===(C=C[e])||void 0===C||!C.listItems)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const n={cardSize:h,experienceName:u,signature:this.getTabSignature(t,e),tabData:null===(S=d.tabListDetails)||void 0===S?void 0:S[e],tabName:e,telemetryObject:this.tabTelemetryObject,destinationUrl:(null===($=c.footerLink)||void 0===$?void 0:$.navigationUrl)||""};return await this.transformerProvider.generateView(n,i)}case n.Ai.WatchlistIdeas:{var M,k;const s=d.tabListDetails&&d.tabListDetails[e]&&d.tabListDetails[e].listItems;if(!(s&&s[0]&&s[0].quotes&&s[0].quotes.length))throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const r={cardSize:h,experienceName:u,signature:this.getTabSignature(t,e),chartData:a[n.Rf.WatchlistIdeas],tabData:null===(M=d.tabListDetails)||void 0===M?void 0:M[e],tabName:e,telemetryObject:this.tabTelemetryObject,destinationUrl:(null===(k=c.footerLink)||void 0===k?void 0:k.navigationUrl)||""};return await this.transformerProvider.generateView(r,i)}case n.Ai.SentimentSpotlight:{var x;const s=t.get(n.Xe.SpotlightTabData);if(null==s||!s.quote)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const r=null===(x=d.quoteNotificationDetails)||void 0===x?void 0:x[s.quote.id],o=this.getNewsListForSentiment(r),l={newsDetails:{chartData:null==a?void 0:a[s.quote.id],newsList:o,newsType:n.Rf.Sentiment,quoteId:s.quote.id,quoteItem:s.quote},experienceName:u,quoteNotificationDetails:d.quoteNotificationDetails,tabName:e,footerData:this.transformToFooterData(t),cardSize:h,signature:this.getTabSignature(t,e),telemetryObject:this.tabTelemetryObject};return await this.transformerProvider.generateView(l,i)}case n.Ai.EarningsQuoteList:{var D;const s=(null===(D=d.tabListDetails[n.Rf.UpcomingEarnings])||void 0===D?void 0:D.earnings)||[];if(!s.length)throw this.logSpotlightMissingErrorMessage(i,t),new Error("Upcoming earnings tab data is empty");const r={tabName:e,signature:this.getTabSignature(t,e),cardSize:h,experienceName:u,telemetryObject:this.tabTelemetryObject,seeMoreLink:this.getNavLink(t),quoteDetails:s};return await this.transformerProvider.generateView(r,i)}case n.Ai.MarketSummary:{var P;this.addQuoteItemsToArray(f,s,r);const i={tabName:e,experienceName:u,quoteDetails:f,chartItemDict:a,watchlistIds:l,showWatchlistButton:!1,cardSize:h,tabData:null===(P=d.tabListDetails)||void 0===P?void 0:P[e],fullWatchlistQuoteIds:d.fullWatchlistQuoteIds,quoteNotificationDetails:d.quoteNotificationDetails,signature:this.getTabSignature(t,e),seeMoreLink:this.getNavLink(t),telemetryObject:this.tabTelemetryObject,isCopilotTheme:this.isCopilotTheme};return await this.transformerProvider.generateView(i,n.Ai.MarketSummary)}case n.Ai.RadarGraph:{var N,F;const s=this.getTabFirstQuote(t,n.Rf.DueDiligence),r=this.getTabFirstQuoteId(d,n.Rf.DueDiligence);if(!r||null==s||null===(N=s.aggregatedInsights)||void 0===N||!N.attributeScores)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Spotlight tab data not present for "${e}"`);const o={quoteId:r,experienceName:u,attributeScores:s.aggregatedInsights.attributeScores,signature:this.getTabSignature(t,e),telemetryObject:this.tabTelemetryObject,destinationUrl:(null===(F=c.footerLink)||void 0===F?void 0:F.navigationUrl)||""};return await this.transformerProvider.generateView(o,i)}case n.Ai.Agent:{var O;const n=this.getAgentCardTabName(t)||e,s=null===(O=d.tabListDetails)||void 0===O?void 0:O[n];if(!s||!s.agentCard)throw this.logSpotlightMissingErrorMessage(i,t),new Error(`Stacked data not present for agent tab "${n??e}"`);const r={agentCard:this.parseAgentStackedData(s.agentCard,n),cardSize:h,experienceName:u,signature:this.getTabSignature(t,e),telemetryObject:this.tabTelemetryObject,tabName:e};return this.transformerProvider.generateView(r,i)}default:throw new Error(`Unexpected tag name "${i}"`)}}getPriceMovementTabData(t){return t.get(n.Xe.PreviewType)?t.get(n.Xe.SpotlightTabData):{quote:this.getTabFirstQuote(t,this.currentTab||n.Rf.PriceSpotlight),dataFrom:n.Rf.PriceSpotlight}}parseAgentStackedData(t,i){if("string"!=typeof t){if(!t||"object"!=typeof t)throw new Error(`Invalid stacked data format for agent tab "${i}"`);return t}const e=t.trim();if(!e)throw new Error(`Stacked data is empty for agent tab "${i}"`);try{const t=JSON.parse(e);if(!t||"object"!=typeof t)throw new Error(`Invalid stacked data format for agent tab "${i}"`);return t}catch(t){if(t instanceof SyntaxError)throw new Error(`Failed to parse stacked data for agent tab "${i}": ${t.message}`);throw t}}logSpotlightMissingErrorMessage(t,i){const e=i.get(n.Xe.PreviewType),s=i.get(n.Xe.MoneyInfoApiData),r=null==s?void 0:s.tabListDetails,o=(null==r?void 0:r[this.currentTab??""])||{},a=r?Object.keys(r):[],l=i.get(n.Xe.QuoteItemDict);(0,d.vV)(h.ygO,`spotlightTabData is not sufficient. PreviewType: ${e}, CurrentTab: ${this.currentTab}`,`${t} - previewType: ${e}`,{tabDataFromFeed:o,tabsFromFeed:a.join(","),quoteDict:l})}getSpotlightTagName(t){const{cryptos:i,deprecatedToNewCryptos:e}=this.transformerProvider.config;return(0,o.Mx)(t)&&!(0,o.qA)(i,e,t)?this.isCopilotTheme?n.Ai.SpotlightCurrencyV2:n.Ai.SpotlightCurrency:this.isCopilotTheme?n.Ai.PriceSpotlightV2:n.Ai.PriceSpotlight}getSpotlightEarningsTagName(t,i){var e;const s=null===(e=t.get(n.Xe.MoneyInfoApiData).quoteNotificationDetails)||void 0===e?void 0:e[i],r=null==s?void 0:s.find(t=>t.notificationType===n.Ex.EarningRelease);if(this.removeTMPL(n.KI.moneyCardEarningsType),r&&r.notification){const{EpsForecast:i,EpsReported:e}=r.notification;if(i&&e&&i.length>0&&e.length>0)return this.setTMPL(n.KI.moneyCardEarningsType,"post"),n.Ai.SpotlightEarnings;const{analystRecommendationNumber:s,numberOfAnalysts:o,recommendation:a}=t.get(n.Xe.AnalystRecommendation)||{};if(s&&o&&a)return this.setTMPL(n.KI.moneyCardEarningsType,"pre"),n.Ai.SpotlightPreEarnings}return n.Ai.PriceSpotlight}generateMetadataForSpotlight(t,i,e,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const a=s.get(n.Xe.CardSize),l=s.get(n.Xe.ExperienceName),h=s.get(n.Xe.PreviewType),d=s.get(n.Xe.MoneyInfoApiData),u=s.get(n.Xe.ChartItemDict),{quote:c}=e,v=(0,o.j$)(c,u),f=this.getTabSignature(s,t),g=s.get(n.Xe.CurrentQuoteIds),p=s.get(n.Xe.QuoteItemDict),m=[];switch(this.addQuoteItemsToArray(m,g,p),i){case n.Ai.SpotlightCurrencyV2:case n.Ai.SpotlightCurrency:return{quote:c,quoteNotificationDetails:d.quoteNotificationDetails,chartData:v,tabName:t,cardSize:a,previewType:h,signature:f,experienceName:l,destinationUrl:r,telemetryObject:this.tabTelemetryObject};case n.Ai.SpotlightEarnings:return{feedData:d,quote:e.quote,tabName:t,cardSize:a,destinationUrl:r,signature:f,telemetryObject:this.tabTelemetryObject};case n.Ai.SpotlightPreEarnings:return{quoteNotificationDetails:d.quoteNotificationDetails,quote:e.quote,tabName:t,cardSize:a,destinationUrl:r,previewType:h,signature:f,analystRecommendation:s.get(n.Xe.AnalystRecommendation),telemetryObject:this.tabTelemetryObject};case n.Ai.MarketMovers:return{cardSize:a,experienceName:l,signature:this.getTabSignature(s,t),chartData:u[m[0].id],tabName:t,telemetryObject:this.tabTelemetryObject,quoteDetails:m};default:return{quote:c,tabData:d,tabName:t,previewType:h,chartData:v,quoteNotificationDetails:d.quoteNotificationDetails,experienceName:l,telemetryObject:this.tabTelemetryObject,signature:f,footerData:this.transformToFooterData(s),cardSize:a}}}updateSpotlightTabData(t){var i;const e=t.get(n.Xe.MoneyInfoApiData);if(!e.tabListDetails)return;const s=t.get(n.Xe.PreviewType),r=t.get(n.Xe.QuoteItemDict),a=(0,o.CQ)(s,r,e.tabListDetails);t.set(n.Xe.SpotlightTabData,a);const l=t.get(n.Xe.ChartItemDict),h="object"==typeof(null==a?void 0:a.quote)?l[null==a||null===(i=a.quote)||void 0===i?void 0:i.id]:null;t.set(n.Xe.ChartDateFilterChartType,n.NB.OneDayOneMinute),t.set(n.Xe.ChartDateFilterData,{[n.NB.OneDayOneMinute]:h}),a&&(this.setTMPL(n.KI.moneyCardSpotlightDataFrom,a.dataFrom),this.setTMPL(n.KI.moneySpotlightPreviewType,s),this.setTMPL(n.KI.moneySpotlightUXTriggered,"1"))}getNewsListForSentiment(t){return t&&t.length?t.reduce((t,i)=>{var e;return null!==(e=i.notification)&&void 0!==e&&e.newsDetail&&t.push(i.notification.newsDetail),t},[]):[]}getQuoteListTagName(t,i){var e;return this.isMarketCharts2CHeroCard(i)&&this.currentTab&&!(0,o.RI)(null===(e=t.tabListDetails)||void 0===e||null===(e=e[this.currentTab])||void 0===e||null===(e=e.quoteItems)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.series)?n.Ai.HorizontalQuoteList:n.Ai.VerticalQuoteList}isMarketCharts2CHeroCard(t){return this.currentTab==n.Rf.Market&&(0,v.zy)(t.get(n.Xe.CardType))&&t.get(n.Xe.CardSize)===r.uE._2x_2y}isSpotlightHeroCard(t){return(0,o.Fm)(t.get(n.Xe.CardType))}hasFooter(t){return!this.isSpotlightHeroCard(t)&&!this.isMarketCharts2CHeroCard(t)}getQuoteListCardSize(t,i){return t===n.Ai.HorizontalQuoteList?r.uE._2x_2y:i}getRubyCardWidgetTitleForSpotlight(t){const i=this.getPriceMovementTabData(t);return null!=i&&i.quote?this.rubyResolveQuoteTitle(i.quote,i.dataFrom):""}rubyResolveQuoteTitle(t,i){return t&&i?(0,o.Mx)(t)?((0,o.ih)(t,i),t.symbol):t.displayName||t.shortName||"":""}shouldRenderRubyCardTitle(){return!(this.currentTab===n.Rf.PersonalFinance||this.currentTab===n.Rf.MIT)}getRubyCardData(t){return s.aC.safeExecute(()=>{const i=this.shouldRenderRubyCardTitle()?this.getWidgetTitle(t):void 0,e=this.getNavLink(t),s={prefixExtendMenuItems:this.generateActionMenuItems(t)},r=this.telemetryBuilder.createNavClickTelemetryTag(this.tabTelemetryObject,{name:n.CD.moneyRubyClick,signature:this.getTabSignature(t,this.tabNameShownInUX),previewType:this.fullPreviewType||void 0}),o=i?{text:i,telemetryTag:r,href:e}:void 0;return{heading:i,rootTelemetryObject:this.tabTelemetryObject,rootTelemetryTag:this.telemetryBuilder.createTelemetryObjectTag(this.tabTelemetryObject),isInDarkMode:!1,href:e,isImmersive:!0,cardActionPropsOverride:s,subtitleData:o,containerPadding:this.shouldRenderRubyCardTitle()?void 0:"padding-sm"}},void 0,h.zbv,"MoneyInfo - getRubyCardData")}getPillViewModel(t){const i=this.getRubyPillQuotes(t);if(i)return i.map(i=>{const e=i.changePcntNumber||0,s=(0,v.kB)(e,"danger",T,T,this.transformerProvider.config.swapGainLossColor),r=this.getRubyPillIconUrl(i),o=e<0?this.transformerProvider.strings.priceDownNotificationText:this.transformerProvider.strings.priceUpNotificationText,a=this.getRubyPillMainLabel(i),l=`${a} ${o} ${i.changePcnt}`;return{data:{destinationUrl:(0,v.OI)(this.transformerProvider.config.urls,i.id),labelAppearance:s,iconSize:"small",iconTitle:o,ariaLabel:l,mainLabel:a,label1:i.changePcnt,iconSrc:r},rootTelemetryTag:this.telemetryBuilder.createNavClickTelemetryTag(this.tabTelemetryObject,{name:n.CD.moneyInfoMiniWidget,signature:this.getTabSignature(t,this.tabNameShownInUX)})}})}getRubyPillMainLabel(t){var i;return(null===(i=u.T3.CurrentMarket)||void 0===i?void 0:i.startsWith("zh"))||u.T3.CurrentMarket===w.DX.JAJP||u.T3.CurrentMarket===w.DX.KOKR?t.shortName||t.displayName||"":t.symbol}getRubyPillQuotes(t){var i;const e=t.get(n.Xe.MoneyInfoApiData)||{},s=e.tabListDetails||{},r=(this.currentTab&&s[this.currentTab]||{}).quoteItems||[];if(this.cardType===n.kb.MoneyInfoMiniWidget)return r;const o=this.getTabFirstQuote(t,n.Rf.PriceSpotlight),a=r.filter(t=>t.id!==(null==o?void 0:o.id));if(a.length)return a;const l=(null===(i=s[n.Rf.Suggested])||void 0===i?void 0:i.quoteItems)||[];if(!l.length)return void(0,d.vV)(h.IfH,"MoneyInfo - ruby pill data is invalid","There is no recommended quote for fallback",{tabListDetails:s,tabs:e.tabs});const u=Math.floor(l.length*Math.random());return[...[...l].splice(u,1),...l]}getRubyPillIconUrl(t){const i=(0,v.kB)(t.changePcntNumber||0,"down","up","up"),e=(0,v.kB)(t.changePcntNumber||0,"red","green","green",this.transformerProvider.config.swapGainLossColor);return`${u.T3.AssetsUrl}/staticsb/statics/latest/finance/icon/${(0,o.jJ)()?"dark":"light"}/ruby_pill_${i}_${e}.svg`}getMoneySDCardData(t,i){var e,s,r;return{headerData:this.transformToHeaderData(i),footerData:this.hasFooter(i)?this.transformToFooterData(i):void 0,toggleInterestManager:i.get(n.Xe.toggleInterestManager),interestManagerData:{interestOptions:this.getInterestOptions(t,i),interestsSuggestionTitle:this.transformerProvider.strings.suggestedForYouText,onInterestOptionClick:this.onInterestOptionClick,onHandleSearch:this.handleInterestSearch,onDismissInterestManager:()=>{i.set(n.Xe.interestOptions,void 0),this.openSearchViewHandler(!1)},strings:{searchPlaceholder:this.transformerProvider.strings.searchPlaceholder}},contextualFeedbackData:null!==(e=i.get(n.Xe.WpoMetadata))&&void 0!==e&&e.isGA?{cFId:null===(s=i.get(n.Xe.WpoMetadata))||void 0===s?void 0:s.cfId,cFMetadataType:null===(r=i.get(n.Xe.WpoMetadata))||void 0===r?void 0:r.cFMetadataType}:null,id:"",cardSize:i.get(n.Xe.CardSize),childTemplateType:"sd-card",gridArea:"",parentTelemetryObject:this.tabTelemetryObject,onSDCardClick:this.transformerProvider.onSDCardClick}}isOnlyOneTabShown(t){if(t.get(n.Xe.MoneyInfoApiData).suppressTabControl)return!0;const i=t.get(n.Xe.CardType);return(0,o.iJ)(i)}transformToHeaderData(t){const i=this.getWidgetTitle(t),e=this.getNavLink(t),n=this.transformerProvider.config.isDynamicFeed&&u.T3.AppType!==f.u.WindowsShellV2,s=this.transformerProvider.isWidgetRegion,{addSymbolOptStr:r,interestMenuToolTip:o,pinButton:a}=this.transformerProvider.strings,h=this.isOnlyOneTabShown(t),d=this.transformerProvider.config.disableInterestMenu||h||this.isPaginationSwitchingTabs(t),c=this.getInterestMenuItems(t);return this.updateTmplProperties(c),{title:i,headerLogo:this.getHeaderLogo(t),titleNavigationLink:e,interestMenuData:d?void 0:{interestMenuItems:c,interestMenuToolTip:o,footerMenuItem:{onClick:()=>this.openSearchViewHandler(!0),text:r}},telemetryHeadlines:{title:i,logo:i},telemetryDestinationUrl:{title:e,logo:e},isWidget:n,isWidgetRegion:s,isActionMenuAvailable:this.transformerProvider.config.enableCardAction&&!this.isSpotlightHeroCard(t),isPinned:this.transformerProvider.supportedSdCardActionMenuItems&&this.transformerProvider.supportedSdCardActionMenuItems.includes(l.gx.Unpin)&&!this.disablePinIcon,onActionMenuButtonClick:this.actionMenuButtonClickHandler,isHideCardAvailable:!h,actionMenuData:n?{}:{hideCardCallback:()=>{var t,i;null===(t=(i=this.transformerProvider).hideClickHandler)||void 0===t||t.call(i,"")},moreSettingsPersonalizeCallback:()=>{var t,i;null===(t=(i=this.transformerProvider).moreSettingsClickHandler)||void 0===t||t.call(i)},turnOffWidgetsRegionCallback:()=>{var t,i;null===(t=(i=this.transformerProvider).turnOffWidgetsRegionClickHandler)||void 0===t||t.call(i)},manageWidgetsRegionCallback:()=>{var t,i;null===(t=(i=this.transformerProvider).manageWidgetsRegionClickHandler)||void 0===t||t.call(i)},items:this.generateActionMenuItems(t),isManageInterests:!1,isFollowInterests:!h,followInterestsCallback:()=>{var t,i;return null===(t=(i=this.transformerProvider).openSearchViewHandler)||void 0===t?void 0:t.call(i,!0)},strings:{followInterestsTitle:r}},strings:{pinIconToolTip:a||"Pinned"}}}updateTmplProperties(t){const i=t.length>0?t[0].id:void 0;this.setTMPL(n.KI.moneyCardFirstTab,i),this.setTMPL(n.KI.moneyCardTabsCount,String(t.length))}getZone(t){if(this.transformerProvider.config.isDynamicFeed){const i=t.get(n.Xe.IsPinned);return(0,l.Yd)(i,"MoneyInfo",this.isCurrentTabSpotlight(t))}}generateActionMenuItems(t){const i=this.transformerProvider.telemetryBuilder.createMenuDataProviderTelemetryTag(this.tabTelemetryObject,{name:n.CD.menuDataProviderClick,headline:"Data providers and disclaimers",signature:this.getTabSignature(t,this.getTabNameShownInUX(t))},this.getZone(t));return[{id:"dataProvider",title:this.transformerProvider.strings.dataProviderOptStr,glyph:p(),telemetryTag:i,onClick:()=>{window.open(this.transformerProvider.config.financeDataProviderUrl,"_blank")}}]}openSearchViewHandler(t){var i,e;let s;t?(s=n.Rf.Search,this.previousTab=this.currentTab):s=this.previousTab,null===(i=(e=this.transformerProvider).openSearchViewHandler)||void 0===i||i.call(e,t,s)}getWatchlistTitle(t){return this.shouldInsertSYFItem(t)||this.shouldShowTabNameByQuoteDataFrom(this.currentTab)?this.transformerProvider.strings.watchlistTitleText:this.transformerProvider.strings.watchlistSuggestionsText}getWidgetTitle(t){const i=this.getCurrentTagName();if(this.isCopilotTheme&&i===n.Ai.PriceSpotlight)return this.getRubyCardWidgetTitleForSpotlight(t);if(this.tabNameShownInUX===n.Rf.Watchlist&&this.currentTab===n.Rf.Watchlist)return this.getWatchlistTitle(t);const e=this.isCurrentTabSpotlight(t),s=this.getSpotlightTabNameByPreviewType(t);if(s&&this.showSpotlightTitleAndFooter(e,s)){const i=t.get(n.Xe.SpotlightTabData),e=this.getSpotlightTabTitle(t,s,i.dataFrom);if(e)return e}return this.getTabTitle(t,this.tabNameShownInUX)}showSpotlightTitleAndFooter(t,i){return!(!t||!i)&&![n.Rf.wlsummary,n.Rf.WatchlistIdeas,n.Rf.UpcomingEarnings,n.Rf.MarketMovers].includes(i)}getTabTitle(t,i){var e,s;if(i===n.Rf.Watchlist)return this.getWatchlistTitle(t);const r=`${null==i?void 0:i.valueOf()}TitleText`,o=`${null==i?void 0:i.valueOf()}TitleTextNew`;return(null===(e=this.transformerProvider.strings)||void 0===e?void 0:e[o])||(null===(s=this.transformerProvider.strings)||void 0===s?void 0:s[r])||""}getEventBriefItem(t){const i=t.get(n.Xe.MoneyInfoApiData),e=t.get(n.Xe.PreviewType),[s,r]=e.split("_"),a=s===n.Ex.EventBrief?r:"",l=(0,o.kQ)(i.tabListDetails);return(0,o.Zc)(l,a)}getCurrentPageFooter(t){var i,e;const s=this.isCurrentTabSpotlight(t),r=this.getSpotlightTabNameByPreviewType(t);if(r&&this.showSpotlightTitleAndFooter(s,r)){const i=this.getSpotlightCurrentPageFooter(t);if(i)return i}const o=`${null===(i=this.tabNameShownInUX)||void 0===i?void 0:i.valueOf()}FooterText`;return this.tabNameShownInUX!==n.Rf.Watchlist||this.shouldInsertSYFItem(t)?(null===(e=this.transformerProvider.strings)||void 0===e?void 0:e[o])||"":this.transformerProvider.strings.recommendFooterText}getSpotlightCurrentPageFooter(t){var i;const e=t.get(n.Xe.SpotlightTabData);if(e.dataFrom===n.Rf.Watchlist)return this.transformerProvider.strings.seeWatchlistTrends||"";if(e.dataFrom===n.Rf.EventBrief)return this.transformerProvider.strings.eventbriefFooterText;if(e.dataFrom===n.Rf.MarketMovers)return this.transformerProvider.strings.marketMoversFooterText;const s=(0,o.CX)(null===(i=e.quote)||void 0===i?void 0:i.securityType);if(s){const t=this.transformerProvider.strings[`spotlightFooter${s}`]||"";if(t)return t}return this.transformerProvider.strings.seeTrendingStocks||""}getHeaderLogo(t){return this.isSpotlightHeroCard(t)||(0,v.zy)(t.get(n.Xe.CardType))?"":`<img src=${(0,v.kX)(this.transformerProvider.config.urls,1,n.Ex.PriceSpike)} alt="${this.getTabTitle(t,this.tabNameShownInUX)}">`}getSpotlightTabNameByPreviewType(t){const i=t.get(n.Xe.MoneyInfoApiData),e=t.get(n.Xe.PreviewType);return(0,o.VK)(i.previewDictionary,t.get(n.Xe.PreviewType),n.tr.Indices,this.transformerProvider.config.minimumNumberOfMarketMovers)?n.Rf.MarketMovers:(0,o.N6)(e)}getMaxQuoteItemCount(t){switch((0,o.SM)(t)){case"_1x_3y":case"large":return this.transformerProvider.config.maxNumberOfQuotesLarge;case"_1x_1y":case"small":return this.transformerProvider.config.maxNumberOfQuotesSmall;case r.uE._05u:return o.wR;case r.uE._15u:return o.X9;default:return this.transformerProvider.config.maxNumberOfQuotesMedium}}getMenuItem(t,i,e){return{title:e||this.getTabTitle(t,i),id:i,onClick:()=>{var t,e;null===(t=(e=this.transformerProvider).interestMenuItemClickHandler)||void 0===t||t.call(e,i)}}}getSpotlightMenuItem(t){const i=t.get(n.Xe.SpotlightTabData);if(!i)return null;const e=this.getSpotlightTabNameByPreviewType(t);if(!e||e===n.Rf.EventBrief)return null;const s=this.getSpotlightTabTitle(t,e,i.dataFrom);return this.getMenuItem(t,e,s)}getSpotlightTabTitle(t,i,e){if(i===n.Rf.EventBrief)return this.getTabTitle(t,e);if(e===n.Rf.Watchlist)return this.transformerProvider.strings.watchlistTrends||"";if(i===n.Rf.MarketMovers)return this.transformerProvider.strings.marketMoversTitleText||"";const s=t.get(n.Xe.SpotlightTabData);return this.getTabTitleByQuoteSecurityType(null==s?void 0:s.quote)}getTabTitleByQuoteSecurityType(t){const i=(0,o.CX)(null==t?void 0:t.securityType);if(i){const t=this.transformerProvider.strings[`spotlightTitle${i}`]||"";if(t)return t}return this.transformerProvider.strings.trendingStocks||""}getInterestMenuItems(t){const i=[],e=t.get(n.Xe.MoneyInfoApiData);if(!e.tabs||!e.tabListDetails)return(0,d.vV)(h.r_l,"MoneyInfo - tab data found is empty while parsing"),[];const s=this.getSpotlightMenuItem(t);return s&&i.push(s),e.tabs.filter(i=>this.shouldShowTab(i,t)).forEach(e=>i.push(this.getMenuItem(t,e))),this.injectSFYItemIfNeeded(i,t),i}openNewTab(t){window.open(t,this.transformerProvider.config.openLinksInNewTab?"_blank":"_self")}openFromSearchPage(t){const i=(0,v.rW)(v.AK.watchlist,this.transformerProvider.config.urls,{id:t});this.openNewTab(i)}generateInterestOptions(t){var i;const e=this.cardSize===r.uE._1x_3y?this.transformerProvider.config.numberOfOptionsLarge:this.transformerProvider.config.numberOfOptions,s=(null===(i=t.tabListDetails)||void 0===i||null===(i=i[n.Rf.Suggested])||void 0===i||null===(i=i.quoteItems)||void 0===i?void 0:i.slice(0,e))||[];return null==s?void 0:s.map(i=>{var e,s;return{id:i.id||i.quoteId,label:i.exchangeName,interestName:(this.transformerProvider.config.showStockNameOnFirstLine&&(null===(e=i.securityType)||void 0===e?void 0:e.toLowerCase())!==n.tr.Currency.toLowerCase()?i.displayName:i.symbol)||"",interestType:(this.transformerProvider.config.showStockNameOnFirstLine&&(null===(s=i.securityType)||void 0===s?void 0:s.toLowerCase())!==n.tr.Currency.toLowerCase()?i.symbol:i.displayName)||"",isFollowed:(0,o.hU)(i.id||i.quoteId,t.fullWatchlistQuoteIds||[])}})}getInterestOptions(t,i){const e=i.get(n.Xe.interestOptions),s=i.get(n.Xe.interestManagerQuery);if(s&&(null==e?void 0:e.length)>0)return e||[];const o=this.cardSize===r.uE._1x_3y?this.transformerProvider.config.numberOfOptionsLarge:this.transformerProvider.config.numberOfOptions;if(!s||null==e||!e.length||(null==e?void 0:e.length)<o){const e=this.generateInterestOptions(t);return i.set(n.Xe.interestOptions,e),e}return e||[]}injectSFYItemIfNeeded(t,i){const e=t.findIndex(t=>t.id===n.Rf.Watchlist);-1!==e&&this.shouldInsertSYFItem(i)&&(this.setTMPL(n.KI.moneyCardSuggestedOnlyTabPresent,"1"),t.splice(e+1,0,this.getMenuItem(i,n.Rf.Suggested)))}shouldInsertSYFItem(t){const i=t.get(n.Xe.WatchlistIds);return!i||i.length>=this.getMaxQuoteItemCount(t)-2}getTabFirstQuoteId(t,i){var e,s,r;return i===n.Rf.UpcomingEarnings?(null===(r=t.tabListDetails)||void 0===r||null===(r=r[i])||void 0===r||null===(r=r.earnings)||void 0===r?void 0:r[0].InstrumentId)||"":(null===(e=t.tabListDetails)||void 0===e||null===(e=e[i])||void 0===e||null===(e=e.quoteItems)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.id)||(null===(s=t.tabListDetails)||void 0===s||null===(s=s[i])||void 0===s||null===(s=s.quoteIds)||void 0===s?void 0:s[0])||""}getTabFirstQuote(t,i){var e;return null===(e=t.get(n.Xe.MoneyInfoApiData).tabListDetails)||void 0===e||null===(e=e[i])||void 0===e||null===(e=e.quoteItems)||void 0===e?void 0:e[0]}getAgentCardTabName(t){const i=t.get(n.Xe.PreviewType);if(!i)return;const[e,s]=i.split("_");return n._D[s]}getNavLink(t){if(this.currentTab===n.Rf.EventBrief){const i=this.getEventBriefItem(t);if(i)return(0,v.Oq)(this.transformerProvider.config.urls,i)}if(this.currentTab===n.Rf.WatchlistIdeas)return this.getWatchlistIdeasLink(t);let i;const e=(0,o.Fm)(t.get(n.Xe.CardType));if(!e&&!this.isCopilotTheme||this.currentTab!==n.Rf.Market&&this.currentTab!==n.Rf.MarketSummary){const e=this.isCurrentTabSpotlight(t)&&this.currentTab!==n.Rf.UpcomingEarnings,s=this.isMiniWidgetPriceSpotlight();i=e||s?this.getSpotlightNavLink(t):this.getWatchlistNavLink(t)}else i=(0,v.A3)(this.transformerProvider.config.urls);return e&&(i=this.appendGemIdToUrl(i,t)),i}appendGemIdToUrl(t,i){var e;const s=null===(e=i.get(n.Xe.MoneyInfoApiData))||void 0===e?void 0:e.tabListDetails,{gemId:r}=this.currentTab&&(null==s?void 0:s[this.currentTab])||{};return null!=r&&r.trim().length?(0,v.mx)(t,r):t}getWatchlistNavLink(t){const i=t.get(n.Xe.MoneyInfoApiData),e=this.tabNameShownInUX||n.Rf.Watchlist;return(0,v.Xe)(this.transformerProvider.config.urls,e,this.getTabFirstQuoteId(i,e))}getSpotlightNavLink(t){var i,e;const s=t.get(n.Xe.PreviewType);let[r,a]=s.split("_");const l=t.get(n.Xe.MoneyInfoApiData);if(this.isMiniWidgetPriceSpotlight()){var h;const i=this.getPriceMovementTabData(t);a=null==i||null===(h=i.quote)||void 0===h?void 0:h.id,r=n.Ex.PriceMovement}const d=null===(i=l.quoteNotificationDetails)||void 0===i?void 0:i[a];let u=null==d?void 0:d.find(t=>t.notificationType===r);const c=null===(e=t.get(n.Xe.SpotlightTabData))||void 0===e?void 0:e.quote,f=r===n.Ex.PriceMovement;if((f||r===n.Ex.DefaultIndex)&&this.isCopilotTheme)return(0,v.OI)(this.transformerProvider.config.urls,a);!u&&f&&(0,o.Uj)(c,this.transformerProvider.config.pricePctNotfThresholdMarket,this.transformerProvider.config.pricePctNotfBaseline,this.transformerProvider.config.disableNotificationForVp)&&(u=(0,o.nW)(c,[],this.transformerProvider.strings));const g=this.tabNameShownInUX!==n.Rf.Watchlist&&(0,o.fX)(c)?n.Rf.Market:n.Rf.Watchlist;return(0,v.Xe)(this.transformerProvider.config.urls,g,a,u,!0)}getWatchlistIdeasLink(t){var i;const e=t.get(n.Xe.MoneyInfoApiData),s=null==e||null===(i=e.tabListDetails)||void 0===i||null===(i=i[n.Rf.WatchlistIdeas])||void 0===i||null===(i=i.listItems)||void 0===i?void 0:i[0];return s?(0,v.mq)(this.transformerProvider.config.urls,s.listId,s.listName):""}transformToFooterData(t){const i=this.getInterestMenuItems(t);t.set(n.Xe.InterestMenuItems,i);const e=this.transformerProvider.isWidgetRegion;return{footerLink:{text:this.getCurrentPageFooter(t),navigationUrl:this.getNavLink(t)},paginationData:this.shouldRenderPagination(t)?{currentPageIndex:this.getCurrentPageIndex(t),onFlipperClick:t=>{var i,e;null===(i=(e=this.transformerProvider).paginationFlipperClickHandler)||void 0===i||i.call(e,t)},onDotClick:t=>{var i,e;null===(i=(e=this.transformerProvider).paginationDotClickHandler)||void 0===i||i.call(e,t)},pageCount:this.getPaginationPageCount(t)}:void 0,telemetryHeadlines:{footerLink:this.getCurrentPageFooter(t)},isWidgetRegion:e}}getCurrentPageIndex(t){if(this.isPaginationSwitchingTabs(t)){const i=this.getInterestMenuItems(t),e=t.get(n.Xe.CurrentTabId);return i.findIndex(t=>t.id===e)+1}return 1}isPaginationSwitchingTabs(t){return(0,o.SM)(t)!==r.uE._1x_1y}parseNotifications(t){t.quoteNotificationDetails&&Object.values(t.quoteNotificationDetails).forEach(t=>{t.forEach(t=>{try{t.notification="string"==typeof t.notification?JSON.parse(t.notification):t.notification}catch{t.notification=null}})})}shouldShowTabNameByQuoteDataFrom(t){return!!t&&[n.Rf.PriceSpotlight,n.Rf.CurrencySpotlight,n.Rf.Earning,n.Rf.Sentiment].includes(t)}getTabNameShownInUX(t){if(this.shouldShowTabNameByQuoteDataFrom(this.currentTab)){const i=t.get(n.Xe.SpotlightTabData);return(null==i?void 0:i.dataFrom)||this.currentTab}return this.currentTab}toggleMoneyInfoCardActions(t){if(this.transformerProvider.supportedSdCardActionMenuItems){var i,e,n;const s={},r={menuItems:(0,l.Gf)(this.transformerProvider.supportedSdCardActionMenuItems,null===(i=this.transformerProvider.strings)||void 0===i?void 0:i.poweredByMsftFinance,s,"finance",(0,o.CP)(this.cardSize),this.settingsHandler,void 0,void 0,this.transformerProvider.switchBackToWeatherHandler),referrerButton:t.currentTarget,requestContext:new c.bb,cardSize:this.cardSize};null===(e=(n=this.transformerProvider).sdCardActionClickHandler)||void 0===e||e.call(n,r,"MoneyInfo")}}isCurrentTabSpotlight(t){const i=t.get(n.Xe.PreviewType);return(0,o.xx)(i,this.currentTab)}isMiniWidgetPriceSpotlight(){return!(!this.isMiniWidget()||!this.currentTab)&&[n.Rf.PriceSpotlight,n.Rf.CurrencySpotlight,n.Rf.Watchlist].includes(this.currentTab)}isMiniWidget(){return this.isCopilotTheme&&this.cardSize===r.uE._05u}isWatchlistedQuote(t,i){const e=t.get(n.Xe.WatchlistIds);return(null==e?void 0:e.includes(i))||!1}getCurrentTabQuotesCount(t){if(this.currentTab===n.Rf.UpcomingEarnings){var i;return(null===(i=t.get(n.Xe.MoneyInfoApiData).tabListDetails)||void 0===i||null===(i=i[n.Rf.UpcomingEarnings])||void 0===i?void 0:i.earnings.length)||0}return this.addRecommendedQuoteIdsForWL((0,o.W7)(t),t).length}shouldRenderPagination(t){return this.isPaginationSwitchingTabs(t)?!this.isOnlyOneTabShown(t):this.isCurrentTabSpotlight(t)?this.shouldRenderPaginationForSpotlight():!!this.shouldRenderPaginationInSmallCard(this.currentTab)&&this.getCurrentTabQuotesCount(t)>2}getPaginationPageCount(t){if(this.isPaginationSwitchingTabs(t))return this.getInterestMenuItems(t).length;const i=(0,o.SM)(t);let e=Math.min(this.getCurrentTabQuotesCount(t),this.getMaxQuoteItemCount(t));i===r.uE._1x_1y&&e++;const s=Math.ceil(e/2);return t.set(n.Xe.FooterMaxPages,s),s}shouldRenderPaginationForSpotlight(){const t=[n.Ai.EarningsQuoteList],i=this.currentTab?n.Ln[this.currentTab]:"";return!!(this.currentTab&&i&&t.includes(i))}shouldRenderPaginationInSmallCard(t){return!!t&&![n.Rf.wlsummary,n.Rf.WatchlistIdeas,n.Rf.EventBrief,n.Rf.MarketMovers].includes(t)}shouldShowTab(t,i){return t!==n.Rf.Portfolio&&(y.includes(t)?this.tabHasQuoteIds(t,i):this.isEventBriefDataValid(t,i)&&this.isUpcomingEarningsDataValid(t,i)&&this.isWatchlistIdeasDataValid(t,i))}tabHasQuoteIds(t,i){var e;const s=i.get(n.Xe.MoneyInfoApiData);return Boolean(null===(e=s.tabListDetails[t])||void 0===e?void 0:e.quoteIds.length)}isEventBriefDataValid(t,i){if(t!==n.Rf.EventBrief)return!0;const e=i.get(n.Xe.MoneyInfoApiData),s=i.get(n.Xe.PreviewType),[r]=s.split("_");return!(!e.tabListDetails[t]||r!==n.Ex.EventBrief)}isUpcomingEarningsDataValid(t,i){var e;const s=i.get(n.Xe.MoneyInfoApiData);return t!==n.Rf.UpcomingEarnings||Boolean(null===(e=s.tabListDetails[t])||void 0===e?void 0:e.earnings.length)}isWatchlistIdeasDataValid(t,i){var e;const s=i.get(n.Xe.MoneyInfoApiData);return t!==n.Rf.WatchlistIdeas||Boolean(null===(e=s.tabListDetails[t])||void 0===e?void 0:e.listItems.length)}addQuoteItemsToArray(t,i,e){(i||[]).map(i=>{const n=null==e?void 0:e[i];n&&t.push(n)})}}},65196:function(t,i,e){"use strict";e.d(i,{FJ:function(){return o},NQ:function(){return a},Sr:function(){return h},aU:function(){return r},br:function(){return l},cg:function(){return d},gd:function(){return s}});var n=e(55593);const s="__rubyOptOut",r="__rubyOptOutCoachmark",o="__rubyOptInCoachmark",a=()=>{const t=(0,n.a)(),i="vp"===(null==t?void 0:t.get("reqsrc"));return{isVPT:i,enableCoachmarkVPT:i&&"1"===(null==t?void 0:t.get("enableRubyCoachmark")),disableCoachmarkVPT:i&&"1"!==(null==t?void 0:t.get("enableRubyCoachmark")),disableRubyVPT:i&&"1"===(null==t?void 0:t.get("disableRuby"))}},l="__rubyReloadTimes",h=2,d=2e4},66784:function(t,i,e){"use strict";e.d(i,{h:function(){return s}});var n=e(63150);function s(){return(0,n.oh)()}},73271:function(t,i,e){"use strict";e.d(i,{Fr:function(){return d},Kg:function(){return n},M_:function(){return g},Oc:function(){return v},TF:function(){return a},YV:function(){return o},Z6:function(){return h},aV:function(){return l},bc:function(){return f},kS:function(){return s},le:function(){return c},tD:function(){return r},vr:function(){return u}});const n="14px",s="12px",r="10px",o="16px",a="20px",l="24px",h="20px",d="16px",u="22px",c="24px",v="28px",f="32px",g="600"},76864:function(t,i,e){"use strict";e.d(i,{csResponsiveList:function(){return L}});var n=e(89580),s=e(48751),r=e(4283),o=e(74089),a=e(4968),l=e(74849),h=e(22131),d=e(4126),u=e(73271);const c=l.A` .container{display:grid;grid-template-columns:1fr 1fr}.articleContent{height:max-content}`,v=l.A`
.articleHeadingInfo:hover .articleTitle{text-decoration:underline}`,f=l.A` .articleTitle{font-size:${n.Y};
        line-height: ${n.v};-webkit-line-clamp:3}cs-attribution{margin-bottom:6px}`,g=l.A` .articleContent.selected{background:#EBEBEB}.articleContent:hover{background:#F5F5F5}.articleContent:active{background:#E0E0E0}@media (prefers-color-scheme:dark){.articleContent.selected{background:#383838}.articleContent:hover{background:#3D3D3D}.articleContent:active{background:#1F1F1F}}`,p=l.A`
.articleContent:hover{background:rgba(255,255,255,0.06)}.articleContent.selected{background:#26292E}`,m=l.A`
.container{height:100%}.articleContent{border-radius:8px;color:${s.l};display:grid;gap:12px;grid-template-columns:auto var(--responsive-list-image-size,20.9%);height:33.33%;overflow:hidden;text-decoration:none;padding:0px 16px}a.articleContent:focus-visible{outline-offset:-1px}.articleContent.noImage{grid-template-columns:auto}.articleContent.selected{background:#F6F9FC}a{${a.f}}.articleContent:hover{background:rgba(0,0,0,0.04)}.articleHeadingInfo{height:fit-content;margin:auto 0px;min-height:60px;overflow:hidden}cs-attribution{display:flex;margin-bottom:4px;max-width:100%}cs-attribution::part(content){color:var(--content-color,${s.l})}cs-attribution .attribution-image{height:16px;width:16px}cs-attribution .divider{padding-inline-end:1px}cs-attribution .time{margin-inline-start:2px;unicode-bidi:embed}cs-attribution .webContentIcon{filter:invert(var(--iconInvert,0));margin:0px 2px;opacity:0.5;vertical-align:bottom}.articleTag{padding:1px 4px 3px;white-space:nowrap;border-radius:6px;background:${r.IR};
    color: ${o.l_}}.articleTag.breaking{background:#E10303}.articleTitle{display:-webkit-box;font-size:${u.Kg};
    font-weight: 600;
    line-height: ${u.Z6};
    overflow: hidden;
    -webkit-line-clamp: var(--responsive-list-title-lineheight, 2);
    -webkit-box-orient: vertical;
}

.articleImageContainer {
    display: flex;
    position: relative;
    align-items: center;
    justify-content: center;
}

.articleImage {
    aspect-ratio: 1/1;
    border-radius: 8px;
    margin: auto;
    max-width: 72px;
    width: 100%;
    object-fit: var(--responsive-list-image-object-fit, unset);
}

.articleContent.oneItemList {
    height: 100%;
}

.articleContent.twoItemList {
    --responsive-list-image-size: 35.8%;
    height: 50%;
}

.twoItemList .articleHeadingInfo {
    min-height: 92px;
}

.twoItemList .articleTitle {
    --responsive-list-title-lineheight: 3;
}

.twoItemList .articleImage {
    max-width: 116px;
}

.playIndicator {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, .2);
    border-radius: 50%;
    display: flex;
    padding: 5px;
    position: absolute;
}

.playIndicator img {
    filter: invert(1);
    width: 14px;
}

@container (width < 300px) {
    .articleHeadingInfo {
        min-height: min-content;
    }

    .articleTitle {
        --responsive-list-title-lineheight: 1;
    }
}
`.withBehaviors((0,h.G2)(p),new d.o("horizontalMode",!0,c),new d.o("useSubtleControlColors",!0,g),new d.o("useSubtleItemSize",!0,f),new d.o("underlineTitle",!0,v));var w=e(96950),b=e(91640),y=e(39957),T=e(14475),I=e(60402),C=e(79765),S=e(17254);const $=`${(0,S.rA)().StaticsUrl}/latest/fluent-icons/globe_16_regular.svg`,M=w.qy`<cs-attribution>${(0,b.z)(t=>t.attrBadge,w.qy`<span class="articleTag ${t=>{var i;return null===(i=t.attrBadge)||void 0===i?void 0:i.type}}" slot="image">${t=>{var i,e;return(null===(i=t.attrBadge)||void 0===i?void 0:i.localizedLabel)||(null===(e=t.attrBadge)||void 0===e?void 0:e.value)}}</span>`)} ${(0,b.z)(t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.logoImage},w.qy`<img alt="${t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.name}}" aria-hidden="true" class="attribution-image" decoding="${t=>t.enableLazyImage?"async":""}" loading="${t=>t.enableLazyImage?"lazy":""}" part="image" slot="image" src="${t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.logoImage}}" title="${t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.name}}" @load=${t=>t.visualReadinessCallback&&t.visualReadinessCallback(1,C.j.provider)} />`)} ${(0,b.z)(t=>t.providerData&&t.providerData.name,w.qy`<span style="unicode-bidi: embed;" class="attribution-text" title="${t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.name}}">${t=>{var i;return null===(i=t.providerData)||void 0===i?void 0:i.name}}</span>`)} ${(0,b.z)(t=>t.isWebContent&&!t.metadata.videoMetadata,w.qy`<img class="webContentIcon" src="${$}">`)} ${(0,b.z)(t=>t.publishedDateTime,w.qy`<span aria-hidden="true" class="divider" focusable="false"></span><span class="time">${t=>t.publishedDateTime}</span>`)}</cs-attribution>`,k=w.qy`<span class="playIndicator"><img aria-hidden="true" role="presentation" src="${(0,S.rA)().StaticsUrl}/latest/fluent-icons/play_16_filled.svg"></img></span>`,x=w.qy`<div class="articleImageContainer"><img class="articleImage" part="articleImage" src=${(t,i)=>{var e;return t.imageData?i.parent.getScaledListItemImage(t.imageData.source,null===(e=t.imageData)||void 0===e?void 0:e.options):""}} alt=${t=>{var i;return(null===(i=t.imageData)||void 0===i?void 0:i.altText)??""}}>${(0,b.z)((t,i)=>{var e;return(null===(e=i.parent.contentList)||void 0===e?void 0:e.length)>1&&"video"==t.contentType},k)}</div>`,D=w.qy`<a part="listContent" class=${(t,i)=>{var e;return((t,i,e)=>{let n="articleContent";return 1===t&&(n+=" oneItemList"),2===t&&(n+=" twoItemList"),i||(n+=" noImage"),e&&(n+=" selected"),n})(null===(e=i.parent.contentList)||void 0===e?void 0:e.length,!!t.imageData,t.selected||!1)}} href=${t=>t.destinationUrl} target="${(t,i)=>((t,i)=>i?T.z._self:t.openLinksInNewTab?T.z._blank:t.defaultAnchorTarget||T.z._self)(t,i.parent.config.enableOpenContentInSelf)}" title=${t=>t.title} data-t="${t=>{var i;return null===(i=t.telemetryContext)||void 0===i||null===(i=i.destination)||void 0===i?void 0:i.getMetadataTag()}}" @click="${(t,i)=>i.parent.clickHandler(t,i)}"><div class="articleHeadingInfo" part="listContentInfo">${()=>M}<span class="articleTitle" ${(0,I.K)("articleContentRef")}>${t=>t.title}</span></div>${(0,b.z)(t=>t.imageData,x)}</a>`,P=w.qy`<div class="container" data-t="${t=>{var i;return null===(i=t.listContainerTelemetry)||void 0===i?void 0:i.getMetadataTag()}}">${(0,b.z)(t=>null==t?void 0:t.contentList,w.qy` ${(0,y.ux)(t=>t.contentList,D,{positioning:!0})} `)}</div>`;var N=e(56911),F=e(92011),O=e(60815),z=e(38493),_=e(51600),E=e(37416),V=e(83003);class R extends F.L{connectedCallback(){this.config=E.D.getConfig(),this.underlineTitle=this.contentList&&this.contentList[0]&&this.contentList[0].underlineTitle,super.connectedCallback()}getScaledListItemImage(t,i){const e={width:100,height:100,enableDpiScaling:!1,...i};return(0,_.oQ)(t,e)}clickHandler(t,i){return t.useMobile&&!t.isMsnMobile?(t.mobileCardClickCallback(i.event,V.pL.Article,t,"article card"),!1):(t.contentClickCallback&&t.contentClickCallback(t,i),!0)}}(0,N.Cg)([O.sH],R.prototype,"contentList",void 0),(0,N.Cg)([O.sH],R.prototype,"listContainerTelemetry",void 0),(0,N.Cg)([(0,z.CF)({attribute:"horizontal-mode",mode:"boolean"})],R.prototype,"horizontalMode",void 0),(0,N.Cg)([(0,z.CF)({attribute:"use-subtle-control-colors",mode:"boolean"})],R.prototype,"useSubtleControlColors",void 0),(0,N.Cg)([(0,z.CF)({attribute:"use-subtle-item-size",mode:"boolean"})],R.prototype,"useSubtleItemSize",void 0),(0,N.Cg)([(0,z.CF)({attribute:"underline-title",mode:"boolean"})],R.prototype,"underlineTitle",void 0);const L=R.compose({name:"responsive-list",styles:m,template:P})},79765:function(t,i,e){"use strict";var n;e.d(i,{j:function(){return n}}),function(t){t.image="image",t.provider="provider",t.socialBar="socialBar"}(n||(n={}))},82347:function(t,i,e){"use strict";e.d(i,{l:function(){return n}});const n=new(e(38467).E)("ProngPulseState")},82825:function(t,i,e){"use strict";e.r(i),e.d(i,{MoneyInfo:function(){return It},MoneyInfoStyles:function(){return At},MoneyInfoTemplate:function(){return zt},ToolingInfo:function(){return jt},dark:function(){return Rt}});var n=e(76864),s=e(31753),r=e(59836),o=e(65614);var a=e(56911),l=e(84855),h=e(81725),d=e(84665),u=e(38346),c=e(48114),v=e(36903),f=e(72317),g=e(25752),p=e(65022),m=e(13053),w=e(89151),b=e(30817),y=e(93468),T=e(17254),I=e(12870),C=e(66784),S=e(19548),$=e(38493),M=e(60815);e(40577);let k="",x="";function D(t,i,e,n){const s=T.T3.CurrentMarket;if("number"!=typeof t||Number.isNaN(t))return"-";const r=function(t){if(x===t&&k)return k;let i=t??"en-us";return["ar","bn","fa","mr","ne"].some(t=>i.startsWith(t))&&(i="en-us"),"es-pe"===i&&(i="es"),k=i,x=t,i}(s);let o={};if("object"==typeof i)o=i;else{if("number"==typeof i)o.minimumFractionDigits=i;else{if(!n&&Math.abs(t)<2)return P(t,r);o.minimumFractionDigits=2}o.maximumFractionDigits="number"==typeof e?e:o.minimumFractionDigits}return new Intl.NumberFormat(r,o).format(t)}const P=(t,i)=>{let e="";const n=t.toFixed(20).match(/^-?\d*\.?0*\d{0,4}/);if(!n||!n[0])return e;const s=(e[0]/1).toLocaleString(i,{useGrouping:!1,maximumSignificantDigits:4}),r=(e[0]/1).toLocaleString(i,{useGrouping:!1,minimumFractionDigits:2});return e=t<1?s:"1"==s?r:s,e},N=(t,i,e)=>{if("number"!=typeof t||Number.isNaN(t))return"-";let n=((t,i,e)=>"number"!=typeof t||Number.isNaN(t)?"-":D(t,i,e,!0)+"%")(t,i,e);return t>0&&(n="+"+n),n};function F(t){const i={...t,chartType:h.NB.OneDayOneMinute,pricePreviousCloseLoc:O(t.pricePreviousClose,t.currency,t.securityType),preHoursSeries:z(t.preHoursSeries),afterHoursSeries:z(t.afterHoursSeries),series:z(t.series)};t.series&&(i.changePcntNumber=function(t,i,e){const n=t.items||[],s=n[n.length-1].close,r=e===h.NB.OneDayOneMinute&&void 0!==i?i:n[0].close;if(0===r)return 0;return 100*(s/r-1)}(i.series,i.pricePreviousClose,h.NB.OneDayOneMinute),i.changePcnt=N(i.changePcntNumber,2));const e=[],n=[];return i.series.items.forEach(t=>{e.push(t.close),n.push(t.date)}),i.chartData={series:e,dates:n,total:i.series.items.length},i}function O(t,i,e){if((null==e?void 0:e.toLowerCase())===h.tr.Cryptocurrency.toLowerCase())return"";const n=function(t,i,e){if("KRW"===i||t<0)return 0;if(t>=1)return 2;const n=e===h.tr.Currency?3:2,s=t>=.01?n:function(t){if(t>=1||0===t)return 0;return-1*Math.floor(Math.log(t)/Math.log(10)+1)}(t)+2;return Math.max(n,s)}(t,i,e);return D(t,n,n)}function z(t){var i;if(null==t||null===(i=t.timeStamps)||void 0===i||!i.length)return null;const e=[];for(let i=0;i<t.timeStamps.length;i++)e.push(V(t,i));return{priceHigh:t.priceHigh,priceLow:t.priceLow,startTime:_(t.startTime),endTime:_(t.endTime),items:e}}function _(t){return t?new Date(t):new Date}function E(t){if(!("number"!=typeof t||t<0))return t}function V(t,i){return{date:t.timeStamps&&_(t.timeStamps[i]),open:t.openPrices&&E(t.openPrices[i]),close:t.prices&&E(t.prices[i]),high:t.pricesHigh&&E(t.pricesHigh[i]),low:t.pricesLow&&E(t.pricesLow[i]),volume:t.volumes&&E(t.volumes[i])}}const R=t=>{switch(t){case h.NB.OneDayOneMinute:return 1;case h.NB.OneDayFiveMinute:return 5;case h.NB.FiveDays:case h.NB.OneWeekFifteenMinutes:return 15;case h.NB.OneMonth:return 30;case h.NB.OneMonthOneHour:return 60;case h.NB.OneYear:return 360;case h.NB.FiveYear:case h.NB.All:return 1800;default:return 1}},L=function(t,i,e){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;if(t){const s=t.series;if(s&&s.items){const t=e||s.items.length,r=[],o=[];if(s.items.forEach(t=>{o.push(t.close),r.push(t.date)}),t<=i/n)return{series:o,total:s.items.length,dates:r};{const e=Math.round(t/i*n),s=W(o,r,e),a=Math.round(i/n);return{series:s.series,dates:s.dates,total:Math.max(s.series.length,a)}}}}},W=(t,i,e)=>{const n=[],s=[];for(let r=0;r<t.length;r++)0!=r&&r!=t.length-1&&r%e!=0||(n.push(t[r]),s.push(i[r]));return{series:n,dates:s}},A=function(t,i){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t)return t;const n=t.series;if(!(n&&n.items&&n.items.length&&n.startTime&&n.endTime))return t;let s=n.endTime.getTime();const r=Date.now();s>r&&(s=r);const o=60*i*1e3,a=n.startTime.getTime(),l=(s-a)/o;if(n.items.length>=l)return t;const h=n.items;let d=[];if(e){let t=a;const i=h[0];for(;i.date.getTime()>t&&t<s;)d.push({...i,date:new Date(t)}),t+=o;let e=0;for(;e<h.length&&t<s;){const i=h[e];i.date.getTime()<=t?(d.push(i),e++):d.push({...h[e-1],date:new Date(t)}),t+=o}}else d=h.slice();return t.series={...n,items:d},t},j=(t,i)=>{if(!t||!i)return null;const e=R(i),n=i===h.NB.OneDayOneMinute||i===h.NB.FiveDays,s=i===h.NB.OneDayOneMinute,r=n?A(t,e,s):t,o=r.series;if(o&&o.items&&o.startTime&&o.endTime){const t=((t,i)=>{const e=1e3*R(i)*60;if(i===h.NB.OneDayOneMinute)return(t.endTime.getTime()-t.startTime.getTime())/e;if(i===h.NB.FiveDays){const i=t.items[t.items.length-1].date;return(t.endTime.getTime()-i.getTime())/e+t.items.length}return t.items.length})(o,i);r.chartData=L(r,120,t,3)}return r.chartData?r:null},H=t=>Promise.resolve(t),B=t=>t.get(h.Xe.MoneyTabViews)??new Map,U=t=>t.get(h.Xe.MoneyInfoApiData),q=t=>t.get(h.Xe.CardSize),Q=t=>t.get(h.Xe.QuoteItemDict)??{},G=t=>t.get(h.Xe.ChartItemDict)??{},J=t=>t.get(h.Xe.CurrentTabId),K=[h.Rf.Watchlist,h.Rf.Market,h.Rf.Crypto,h.Rf.Currencies,h.Rf.Suggested,h.Rf.Movers,h.Rf.Gainers,h.Rf.Losers];function Y(t){return t?t.id||t.quoteId||t.instrumentId:void 0}function X(t,i){if(!i||!t)return;const[,e]=t.split("_");if(!e)return;const n=[h.Rf.Watchlist,h.Rf.Suggested,h.Rf.Market,h.Rf.Currencies,h.Rf.PriceSpotlight,h.Rf.Crypto];for(const t of n){var s;const n=null===(s=i[t])||void 0===s?void 0:s.quoteItems;if(n){const i=n.find(t=>Y(t)===e);if(i)return{quote:i,dataFrom:t}}}}function Z(t){const i=t&&t.toLowerCase()||"";return i.includes("price")||i.includes("default")}function tt(t){try{if(t.id&&t.series){return j(F(t),h.Y)||void 0}}catch(i){(0,y.vV)(p.ycZ,`MoneyInfo - error while using chart from quote: ${t.id}`)}}function it(t,i,e){if(e){let r=et(e,t);const o=[],a={},l={},[d,u]=i.split("_");let c=!0;const v=et(h.Rf.Suggested,t),f=((null==v?void 0:v.quoteItems)??[]).filter(t=>t.series).length>0;if(u&&function(t){return[h.Ex.EarningRelease,h.Ex.InstitutionalHolding,h.Ex.PriceDrop,h.Ex.PriceMovement,h.Ex.PriceSpike,h.Ex.Sentiment,h.Ex.TechnicalIndicator,h.Ex.Currency].includes(t)}(d)){var n;const i=h.Zo[d],e=i&&et(i,t);null!=e&&null!==(n=e.quoteItems)&&void 0!==n&&n.length?r=e:(o.push(u),c=!1)}var s;if(c&&r&&r.quoteItems)if(r.quoteItems.forEach(t=>{if(t){o.push(t.id),a[t.id]=t;const i=tt(t);i&&(l[t.id]=i)}}),f)null==v||null===(s=v.quoteItems)||void 0===s||s.forEach(t=>{if(t){const i=tt(t);i&&(l[t.id]=i)}});return{moneyInfoApiData:t,currentTabId:e,moneyTabViews:{},currentQuoteIds:o,quoteItemDict:a,chartItemDict:l,currentPageIndex:1,footerMaxPages:1,chartDateFilterChartType:h.NB.OneDayOneMinute,chartDateFilterData:{},chartSelectedQuoteId:o[0],watchlistIds:null==t?void 0:t.fullWatchlistQuoteIds,analystRecommendation:{}}}return{}}function et(t,i){if(i&&i.tabListDetails)return i.tabListDetails[t]}function nt(t,i,e){var n;if(null==e||!e.relatedIds||!Z(t))return;const s=null===(n=e.securityType)||void 0===n?void 0:n.toLowerCase();let r=e.relatedIds.length,o=!1;if(s===h.tr.Indices.toLowerCase())o=!0,r=i.minimumNumberOfMarketMovers||r;return!o||e.relatedIds.length<Math.max(1,r)?void 0:e.relatedIds}function st(t){return(null==t?void 0:t.toLowerCase())===h.tr.Currency.toLowerCase()}function rt(t,i){return st(t)&&i<1?3:2}function ot(t){const i=t.priceNumber??0,e=rt(t.securityType,i);return t.price=D(i,e,e),t}var at=e(7087),lt=e(82347);function ht(t){return`${t.shortName||t.symbol} ${t.changePcnt}`}var dt=e(17720),ut=e(94047);class ct{constructor(t,i){this.onMoneyInfoFeedDataReady=(t,i)=>{const e=it(t,i,this.getCurrentTab(t,i));t.fullWatchlistQuoteIds&&this.state.set(h.Xe.FollowedEntities,t.fullWatchlistQuoteIds),this.state.set(h.Xe.CurrentTabId,e.currentTabId),this.state.set(h.Xe.CurrentQuoteIds,e.currentQuoteIds),this.state.set(h.Xe.ChartItemDict,e.chartItemDict),this.state.set(h.Xe.QuoteItemDict,e.quoteItemDict),this.state.set(h.Xe.WatchlistIds,e.watchlistIds),this.state.set(h.Xe.CurrentPageIndex,e.currentPageIndex),this.state.set(h.Xe.ChartDateFilterData,e.chartDateFilterData),this.state.set(h.Xe.ChartDateFilterChartType,e.chartDateFilterChartType),this.state.set(h.Xe.ChartSelectedQuoteId,e.chartSelectedQuoteId),this.state.set(h.Xe.FooterMaxPages,e.footerMaxPages),this.state.set(h.Xe.MoneyInfoApiData,t),this.state.set(h.Xe.AnalystRecommendation,e.analystRecommendation),this.onUpdateQuoteItemDict(e.quoteItemDict)},this.experienceName=t,this.state=i}static getInstance(t){if(!t)throw new Error("Could not get state for undefined experienceName");const i=`MoneyInfoAppStateConnector_${t}`,e=dt.vv.get(i,()=>({}));if(e[i])return e[i];const n=h.vP.get(t)||(0,h.pQ)(t),s=new ct(t,n);return h.vP.set(t,s.getCurrentState()),e[i]=s,s}getCurrentState(){return this.state}clearViewsCache(){this.state.set(h.Xe.MoneyTabViews,new Map)}updateCardSize(t){this.state.set(h.Xe.CardSize,t)}updateCardWidth(t){this.state.set(h.Xe.CardWidth,t)}updateSupportedSdCardActionMenuItems(t){const i=ut.wO.getInstance(this.experienceName,t);i&&(i.supportedSdCardActionMenuItems=t.supportedSdCardActionMenuItems)}updateWpoMetadata(t){this.state.set(h.Xe.WpoMetadata,t)}updateCurrentTabId(t){this.state.set(h.Xe.CurrentTabId,t),this.state.set(h.Xe.CurrentPageIndex,1)}async updateDateFilterChartType(t,i){const e=await this.getCharts([t],{},i),n=this.state.get(h.Xe.ChartDateFilterData);this.state.set(h.Xe.ChartDateFilterData,{...n,[i]:e[t]}),this.state.set(h.Xe.ChartDateFilterChartType,i),this.state.set(h.Xe.ChartSelectedQuoteId,t)}updateCurrentPageIndex(t){this.state.set(h.Xe.CurrentPageIndex,t)}updateNextPageIndex(t){const i=this.state.get(h.Xe.FooterMaxPages),e=this.state.get(h.Xe.CurrentPageIndex)??1;let n=t?e+1:e-1;return 0===n?n=i:n===i+1&&(n=1),this.updateCurrentPageIndex(n),n}updatePreviewType(t){this.state.set(h.Xe.PreviewType,t)}handleOpenInterestMenu(t,i){this.state.set(h.Xe.toggleInterestManager,t),this.state.set(h.Xe.interestManagerQuery,void 0)}async handleInterestOptionsSearch(t){try{if(this.state.set(h.Xe.interestManagerQuery,t),""===t)return void this.state.set(h.Xe.interestOptions,void 0);const i=q(this.state),e=this.state.get(h.Xe.MoneyConfig),n="_1x_3y"===i?e.numberOfOptionsLarge:e.numberOfOptions,s=await this.fetchInterestOptions(t,n);this.state.set(h.Xe.interestOptions,s.length?s:void 0)}catch(t){return H(void 0)}}async handleFlyoutOpen(t,i){let e;const n=this.state.get(h.Xe.MoneyInfoApiData);if(await d.aC.safeExecuteAsync(async()=>{if(e=this.getCurrentTab(n,t),!e)throw new Error(`Flyout open - no current tab found in feed data for preview type "${t}"`);await this.updateStateForTab(e,i.config),this.updateCurrentTabId(e),this.setTmplTelemetry(),await this.loadSpotlightData()},void 0,p.ygO,"MoneyInfo - no current tab for feed data",`previewType: ${t}`,n),!e)return H(void 0);const s=await this.generateSDContainerView(e,i,!1);return Promise.resolve(s)}clearTabsWithWlButtonFromCache(){const t=B(this.state);t.delete(`${this.state.get(h.Xe.CardSize)}:${h.Rf.Watchlist}`),t.delete(`${this.state.get(h.Xe.CardSize)}:${h.Rf.Suggested}`)}subscribe(t,i,e){return this.state.subscribe(t,i,e)}unsubscribe(t,i){return this.state.unsubscribe(t,i)}getFromState(t){return this.state.get(t)}onAddedQuoteToWatchlist(t){this.clearTabsWithWlButtonFromCache();const i=this.state.get(h.Xe.FollowedEntities);i.push(t),this.state.set(h.Xe.FollowedEntities,i)}async updateFollowedSecurities(t){await d.aC.safeExecuteAsync(async()=>{if(this.state.get(h.Xe.FollowedEntities).includes(t))return;const i=this.state.get(h.Xe.MoneyConfig);if(!await this.addToWatchlist(t,i))return;const e=this.state.get(h.Xe.interestOptions)||[];for(const i of e)i.id===t&&(i.isFollowed=!0);this.onAddedQuoteToWatchlist(t)},void 0,p.v60,`MoneyInfo - error when adding "${t}" to watchlist`)}async hideMoneyCard(t){this.state.get(h.Xe.MoneyConfig);return await(async()=>{const{enableDisableMoneyCard:t}=await e.e("money-info-service").then(e.bind(e,82486));return t(!1)})()}updateRootTelemetryObject(t){this.state.set(h.Xe.RootTelemetryObject,t)}async getInitialMoneyCardView(t){const{config:i,feedData:e,cardSize:n,previewType:s,rootTelemetryObject:r,wpoMetadata:o,isCopilotTheme:a,fullPreviewType:l,cardType:u}=t;let c;this.state.set(h.Xe.MoneyConfig,i),this.state.set(h.Xe.CardType,u),this.state.set(h.Xe.ExperienceName,this.experienceName),this.state.set(h.Xe.IsCopilotTheme,a),this.state.set(h.Xe.IsRubyPill,"pill"===n),this.state.set(h.Xe.FullPreviewType,l);let v="";if(await d.aC.safeExecuteAsync(async()=>{const t=JSON.parse(e);if(this.onMoneyInfoFeedDataReady(t,s),this.updateCardSize(n),this.updateWpoMetadata(o),this.updateRootTelemetryObject(r),c=this.getCurrentTab(t,s),this.initNotificationInterval(c,i),await this.loadSpotlightData(),!c)throw new Error(`No initial current tab found in feed data for preview type "${s}"`);this.updateCurrentTabId(c),v=this.getViewId(),this.setTmplTelemetry()},void 0,p.IZh,"MoneyInfo - feed data parsing error"),!c)return H(void 0);const f=await this.generateSDContainerView(v,t,!0);return Promise.resolve(f)}async getUpdatedViewByFeedData(t){const{feedData:i,previewType:e,cardSize:n}=t;let s,r="";if(await d.aC.safeExecuteAsync(async()=>{const t=JSON.parse(i),o=this.state.get(h.Xe.MoneyInfoApiData),a=o.scenarioId&&t.scenarioId&&o.scenarioId!==t.scenarioId,l="windowsShellV2"===T.T3.AppType&&this.state.get(h.Xe.PreviewType)!==e;if(!a&&t.dataTimestamp<=o.dataTimestamp&&!l)return!0;if(this.onMoneyInfoFeedDataReady(t,e),this.updateCardSize(n),s=this.getCurrentTab(t,e),await this.loadSpotlightData(),!s)throw new Error(`No initial current tab found in feed data for preview type "${e}"`);return this.updateCurrentTabId(s),r=this.getViewId(),this.setTmplTelemetry(),!1},!1,p.IZh,"MoneyInfo - feed data parsing error"))return this.state.get(h.Xe.MoneySDCardView);if(!s)return H(void 0);return await this.generateSDContainerView(r,t,!0)}getModifiedMoneyTmplNames(){var t;const i=this.state.get(h.Xe.CardType);if(!i||i===h.kb.MoneyInfo)return h.KI;const e={};return null===(t=Object.entries(h.KI))||void 0===t||t.forEach(t=>{let[n,s]=t;n&&s&&(e[n]=`${i}_${s}`)}),e}async loadSpotlightData(){return await d.aC.safeExecuteAsync(async()=>{const t=this.state.get(h.Xe.CurrentTabId),i=this.state.get(h.Xe.PreviewType),e=U(this.state),n=this.state.get(h.Xe.MoneyConfig),s=this.getModifiedMoneyTmplNames();if(t===h.Rf.WatchlistIdeas||i===h.Ex.WatchlistIdeas)return void await this.loadWlIdeasChart();if((0,d.ao)(s.moneySpotlightPreviewType,i),!i)return;(0,d.ao)(s.moneySpotlightUXTriggered,"1");const[r,o]=i.split("_");if(!o)return;if(r===h.Ex.Agent)return;if(r===h.Ex.EventBrief)return void this.updateStateForEventBriefTab();r===h.Ex.EarningRelease&&this.updateStateForPreEarningsTab(o);let a=[o];const l=e.previewDictionary||{},u=nt(r,n,null==l?void 0:l[i]);u&&(a=a.concat(u));const c=this.state.get(h.Xe.QuoteItemDict),v=[],f=X(i,null==e?void 0:e.tabListDetails);if(n.enableQuotesRefreshFromCharts&&!c[o]&&null!=f&&f.quote){const t=ot(f.quote);c[o]=t,this.onUpdateQuoteItemDict({quoteId:t})}else v.push(u?this.updateQuotes(a):this.getQuotes(a,c));v.push(this.updateCharts([o])),n.shouldShowAiInsight&&v.push(this.updateAiInsightData(o,r));const[g]=await Promise.allSettled(v);g&&"fulfilled"===g.status&&g.value&&this.mergeNewQuotesData(g.value)},void 0,p.YlL,"MoneyInfo - error load quote for spotlight")}async loadPostTtvrDataSDData(){this.disableLoadChartsForCurrentTab()||this.loadChartsData(),this.loadMovers()}async loadWlIdeasChart(){var t;const i=(null===(t=U(this.state).tabListDetails)||void 0===t||null===(t=t[h.Rf.WatchlistIdeas])||void 0===t||null===(t=t.listItems)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.quoteIds)||[];if(!i.length)return void this.dropChartData(h.Rf.WatchlistIdeas);const n=this.state.get(h.Xe.MoneyConfig);try{const t=await(async(t,i,n,s,r)=>{const{getChart:o,ChartPropsHelper:a}=await e.e("money-info-service").then(e.bind(e,82486)),l=await o(t,n,s,r),h=a.aggregateChart(l,i,n,!1);if(!(h&&h.series&&h.series.items||[]).length)return;const d=R(n),u=A(h,d),c=(h.series.endTime.getTime()-h.series.startTime.getTime())/(6e4*d);return u.chartData=L(u,120,c),u})(i,h.Rf.WatchlistIdeas,h.NB.OneYear,n.cryptos,n.disableChartsRetry);if(!t)return void this.dropChartData(h.Rf.WatchlistIdeas);this.mergeNewChartsData({[h.Rf.WatchlistIdeas]:t})}catch(t){return(0,y.vV)(p.u6T,`MoneyInfo - error while loading watchlist ideas chart for quoteIds: ${i}`),void this.dropChartData(h.Rf.WatchlistIdeas)}}async refreshCurrentTab(t){const i=this.state.get(h.Xe.CurrentTabId),e=await this.generateSDContainerView(i,t,!1);return Promise.resolve(e)}async getMoneyCardViewForId(t,i){const e=B(this.state),n=`${q(this.state)}:${t}`,s=e.get(n);if(this.initNotificationInterval(t,i.config),s)return this.updateCurrentTabId(t),s;await this.updateStateForTab(t,i.config),this.setTmplTelemetry();const r=await this.generateSDContainerView(n,i,!1);return Promise.resolve(r)}async updateView(t){const i=J(this.state),e=this.getViewId();await this.updateStateForTab(i,t.config);const n=await this.generateSDContainerView(e,t,!1);return Promise.resolve(n)}async updateViewWithoutQuery(t){const i=this.getViewId(),e=await this.generateSDContainerView(i,t,!1);return Promise.resolve(e)}async loadPostTTVRBundles(t,i){return await d.aC.safeExecuteAsync(async()=>{if(!t)return;const e=ut.wO.getInstance(this.experienceName,i);if(!e)throw new Error("Could not get MoneyDataTransformer instance");const n=h.Zo[t],s=n&&h.Ln[n],r=s&&e.tagNameToComponentName(s);return r?await e.loadComponentAndTransformer(r):void 0},void 0,p.Ahq,`MoneyInfo - could not post load TTVR bundle for: ${t}`)}async generateSDContainerView(t,i,e){return await d.aC.safeExecuteAsync(async()=>{const n=ut.wO.getInstance(this.experienceName,i);if(!n)throw new Error("Could not get MoneyDataTransformer instance");e&&n.updateContext(i);const s=await n.generateView(this.state,"money-sd-card");return this.onGenerateViewForCurrentTab(t,s),s},void 0,p.Bof,"MoneyInfo - generate SD card container view failed")}getCurrentTab(t,i){let e;return i&&(e=this.getTabIdFromPreviewType(t,i)),this.updatePreviewType(e?i:""),i&&e||(e=function(t){if(t.tabs&&!(t.tabs.length<1))return t.tabs[0]}(t)),e}getTabIdFromPreviewType(t,i){const e=this.state.get(h.Xe.MoneyConfig),[n]=i.split("_"),s=h.Zo[n];s||(0,y.vV)(p.trI,`MoneyInfo - getTabIdFromPreviewType spotlight card not found for this preview type: ${i}`);return function(t,i,e,n){var s,r,o;const[a]=i.split("_");return Z(a)&&(null==t||null===(s=t[i])||void 0===s||null===(s=s.securityType)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()&&!(null===(r=t[i].relatedIds)||void 0===r||!r.length)&&((null===(o=t[i].relatedIds)||void 0===o?void 0:o.length)||0)>=(n||0)}(t.previewDictionary||{},i,h.tr.Indices,e.minimumNumberOfMarketMovers)?h.Rf.MarketMovers:s}onGenerateViewForCurrentTab(t,i){if(!i)return;const e=B(this.state);e.set(t,i),this.state.set(h.Xe.MoneyTabViews,e),this.state.set(h.Xe.MoneySDCardView,i)}getViewId(){const t=this.state.get(h.Xe.CurrentTabId);return`${this.state.get(h.Xe.CardSize)}:${t}`}async getCharts(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.Y;return await d.aC.safeExecuteAsync(async()=>{const s=this.state.get(h.Xe.MoneyConfig),r=await async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.Y,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!t||!t.length)return{};const r={},{getChart:o}=await e.e("money-info-service").then(e.bind(e,82486)),a=await o(t,i,n,s);if(!a)throw new Error("No stock chart data is available");let l=null;return a.forEach(t=>{l=j(t,i),l&&(r[l.instrumentId]=l)}),Promise.resolve(r)}(t,n,s.cryptos,s.disableChartsRetry),o=i||{};return t.forEach(t=>{null!=r&&r[t]&&(o[t]=null==r?void 0:r[t])}),this.updateQuotesFromCharts(r,t),o},{},p.YlL,"MoneyInfo - error fetching charts")}async getQuotes(t,i){return await d.aC.safeExecuteAsync(async()=>{const n=this.state.get(h.Xe.MoneyConfig),s=U(this.state);if(n.enableQuotesRefreshFromCharts&&i&&null!=s&&s.tabListDetails){var r;const e=null===(r=et(J(this.state),s))||void 0===r?void 0:r.quoteItems;t.forEach(t=>{const n=null==e?void 0:e.find(i=>Y(i)==t);!i[t]&&n&&(i[t]=n)})}const o=t.filter(t=>!(null!=i&&i[t])),a=await(async t=>{if(!t||!t.length)return[];const{getQuoteSummary:i}=await e.e("money-info-service").then(e.bind(e,82486)),n=await i(t);return Promise.resolve(n)})(o);if(!a||a.length<1)return{...i};let l=!1;const d=a.reduce((t,i)=>(i&&i.id&&(t[i.id]=i,l=!0),t),{});return l&&this.onUpdateQuoteItemDict(d),{...i,...d}},{},p.YlL,"MoneyInfo - error fetching quotes")}async updateStateForTab(t,i){if(this.updateCurrentTabId(t),K.includes(t))return await this.updateStateForVerticalQuoteListTab(t,i);switch(t){case h.Rf.EventBrief:return await this.updateStateForEventBriefTab();case h.Rf.MarketMovers:return await this.updateStateForPreviewWithRelatedQuotes(t,i);case h.Rf.CurrencySpotlight:case h.Rf.PriceSpotlight:return this.updateSpotlightChart(),await this.updateStateForPreviewWithRelatedQuotes(t,i)}}async updateSpotlightChart(){const t=this.state.get(h.Xe.MoneyInfoApiData),i=X(this.state.get(h.Xe.PreviewType),t.tabListDetails),e=Y(null==i?void 0:i.quote);e&&await this.updateCharts([e])}async updateStateForVerticalQuoteListTab(t,i){const e=U(this.state),n=((t,i,e)=>{var n;const s=et(t,e),r=(null==s?void 0:s.quoteItems)??[];let o=new Set(r.map(t=>Y(t)||"").filter(t=>""!==t));return!o.size&&s&&(o=new Set(s.quoteIds)),t===h.Rf.Watchlist&&null!=e&&null!==(n=e.fullWatchlistQuoteIds)&&void 0!==n&&n.length&&e.fullWatchlistQuoteIds.forEach(t=>{o.add(t)}),Array.from(o).slice(0,i)})(t,i.maxNumberOfQuotesLarge,e);await this.updateQuotes(n),await this.updateCharts(n)}async updateStateForEventBriefTab(){const t=U(this.state),i=et(h.Rf.EventBrief,t);if(null==i||!i.events||null==i||!i.events.length)return;const e=this.state.get(h.Xe.PreviewType),[,n]=e.split("_"),{eventLevel:s,entityIdentifier:r}=function(t,i){return 1!==t.length&&i&&t.find(t=>{const{entityIdentifier:e}=t;return i===e})||t[0]}(i.events,n)||{};var o;o=s,h.LC.Company===o&&await this.updateQuotes([r])}updateQuotesFromCharts(t,i){const e=this.state.get(h.Xe.MoneyConfig),{enableQuotesRefreshFromCharts:n,quoteRefreshTimeThreshold:s}=e;if(!n||!s)return;const r=Q(this.state),o={};i.forEach(i=>{const e=null==r?void 0:r[i],n=null==t?void 0:t[i];if(null!=n&&n.timeLastUpdated&&null!=e&&e.timeLastUpdated){st(e.securityType)&&(e.priceNumber??0)<1&&(o[i]=ot(e));const t=new Date(n.timeLastUpdated),r=new Date(e.timeLastUpdated);if(t.getTime()-r.getTime()>=s){const s=n.series.items[n.series.items.length-1].close,r=n.changePcntNumber??0,a=rt(e.securityType,s),l=D(s,a,a),h=N(r,2,2);o[i]={...e,timeLastUpdated:t,changePcntNumber:r,changePcnt:h,priceNumber:s,price:l,gain:r>0}}}},void 0),Object.keys(o).length>0&&(this.mergeNewQuotesData(o),this.onUpdateQuoteItemDict(o))}resetNotificationInterval(){const t=this.state.get(h.Xe.showNotificationInterval);t&&clearInterval(t),this.state.set(h.Xe.showNotificationText,!0)}startNotificationInterval(t){const i=setInterval(()=>{const t=this.state.get(h.Xe.showNotificationText);this.state.set(h.Xe.showNotificationText,!t)},t.notificationTextShowTimeInMs);this.state.set(h.Xe.showNotificationInterval,i)}shouldStartNotificationInterval(t,i){const e=q(this.state);return Boolean("_1x_1y"===e&&i.enableRotateNotf&&K.includes(t))}initNotificationInterval(t,i){this.resetNotificationInterval(),this.shouldStartNotificationInterval(t,i)&&this.startNotificationInterval(i)}async updateStateForPreviewWithRelatedQuotes(t,i){const e=this.state.get(h.Xe.PreviewType),n=U(this.state).previewDictionary,[s,r]=e.split("_"),o=nt(s,i,null==n?void 0:n[e]);if(!o)return;const a=[this.updateQuotes([r,...o])];t===h.Rf.MarketMovers&&a.push(this.updateCharts([r])),await Promise.allSettled(a)}async updateStateForPreEarningsTab(t){const{analystRecommendationNumber:i,recommendation:n,numberOfAnalysts:s}=await(async t=>{const{getAnalystRecommendation:i}=await e.e("money-info-service").then(e.bind(e,82486));return await i(t)})(t)||{};i&&n&&s&&this.state.set(h.Xe.AnalystRecommendation,{analystRecommendationNumber:i,recommendation:n,numberOfAnalysts:s})}async updateQuotes(t){const i=Q(this.state),e=await this.getQuotes(t,i);this.state.set(h.Xe.CurrentQuoteIds,t),this.mergeNewQuotesData(e)}async updateCharts(t){const i=G(this.state),e=this.useChartsFromQuotes(t),n=await this.getCharts(this.addRecommendedQuoteIdsForWL(e),i);this.mergeNewChartsData(n)}async updateAiInsightData(t,i){var n;const s=this.state.get(h.Xe.QuoteItemDict);h.tr.Stocks.toLowerCase()===(null===(n=s[t])||void 0===n||null===(n=n.securityType)||void 0===n?void 0:n.toLowerCase())&&i===h.Ex.PriceMovement&&(s[t].aiInsightData=await(async t=>{const{getStockDueDiligence:i}=await e.e("money-info-service").then(e.bind(e,82486)),n=await i(t);return Promise.resolve(null==n?void 0:n[0])})(t))}useChartsFromQuotes(t){const i=Q(this.state),e=G(this.state);return t.filter(t=>{const n=i[t];if(!n||!n.id||!n.series)return!0;if(e[n.id])return!1;try{const t=j(F(n),h.Y);if(!t)return!0;e[n.id]=t}catch(t){return(0,y.vV)(p.ycZ,`MoneyInfo - error while using chart from quote: ${n.id}`),!0}})}mergeNewChartsData(t){const i=this.state.get(h.Xe.ChartItemDict);this.state.set(h.Xe.ChartItemDict,{...i,...t})}dropChartData(t){const i=this.state.get(h.Xe.ChartItemDict);delete i[t],this.state.set(h.Xe.ChartItemDict,{...i})}mergeNewQuotesData(t){const i=this.state.get(h.Xe.QuoteItemDict);this.state.set(h.Xe.QuoteItemDict,{...i,...t})}addRecommendedQuoteIdsForWL(t){if(!this.shouldIncludeRecoItems(J(this.state),t.length))return t;const i=U(this.state),e=et(h.Rf.Suggested,i);return e&&e.quoteIds?Array.from(new Set([...t,...e.quoteIds])):t}shouldIncludeRecoItems(t,i){if(this.isSpotlightTab(t))return!1;return i<this.state.get(h.Xe.MoneyConfig).maxNumberOfQuotesLarge&&t===h.Rf.Watchlist}disableLoadChartsForCurrentTab(){const t=J(this.state);return[h.Rf.MarketMovers,h.Rf.PriceSpotlight,h.Rf.CurrencySpotlight].includes(t)||this.isMarketCharts2CHeroCard(this.state,t)}isMarketCharts2CHeroCard(t,i){return i==h.Rf.Market&&(0,at.zy)(t.get(h.Xe.CardType))&&"_2x_2y"===t.get(h.Xe.CardSize)}async loadChartsData(){return await d.aC.safeExecuteAsync(async()=>{const t=this.addRecommendedQuoteIdsForWL(this.state.get(h.Xe.CurrentQuoteIds)??[]);const i=G(this.state),e=t.filter(t=>!i[t]);if(!e.length)return;const n=await this.getCharts(e,i);this.mergeNewChartsData(n)},void 0,p.YlL,"MoneyInfo - error load charts data")}isSpotlightTab(t){if(!t)return!1;return[h.Rf.PriceSpotlight,h.Rf.CurrencySpotlight,h.Rf.Earning,h.Rf.Sentiment,h.Rf.wlsummary,h.Rf.EventBrief,h.Rf.MarketMovers].includes(t)}async addToWatchlist(t,i){const{addToWatchlist:n}=await e.e("money-info-service").then(e.bind(e,82486));return await n(t)}async fetchInterestOptions(t,i){try{const{getAutoSuggest:n}=await e.e("money-info-service").then(e.bind(e,82486)),s=await n(t,i),r=this.state.get(h.Xe.MoneyConfig),o=null==r?void 0:r.showStockNameOnFirstLine;return s.map(t=>{var i,e,n,s;return{id:t.quoteId,label:t.exchangeName,interestName:(o&&(null===(i=t.entityType)||void 0===i?void 0:i.toLowerCase())!==h.tr.Cur.toLowerCase()?t.longName:t.equitySymbol)||"",interestType:(o&&(null===(e=t.entityType)||void 0===e?void 0:e.toLowerCase())!==h.tr.Cur.toLowerCase()?t.equitySymbol:t.longName)||"",isFollowed:(n=t.quoteId||"",s=this.state.get(h.Xe.FollowedEntities),Boolean(n)&&Boolean(s.find(t=>t===n)))}})}catch(t){return[]}}setTmplTelemetry(){var t;const i=this.getModifiedMoneyTmplNames();Object.values(i).forEach(t=>{(0,d.iJ)(t)}),(0,d.ao)(i.moneyCardCurrentTab,this.state.get(h.Xe.CurrentTabId));const e=this.state.get(h.Xe.MoneyInfoApiData),n=this.state.get(h.Xe.CardType);var s,r;(0,d.ao)(i.moneyCardCurrentSize,q(this.state)),n&&(0,d.ao)(i.moneyCardType,n),n===h.kb.MoneyInfo&&(0,d.ao)(i.moneyCardRegularCardAdded,"1"),e.userGroup&&(0,d.ao)(i.moneyUserGroup,e.userGroup),e.userCohort&&(0,d.ao)(i.moneyUserCohort,e.userCohort),null!==(t=e.fullWatchlistQuoteIds)&&void 0!==t&&t.length&&(0,d.ao)(i.moneyCardWatchlistUsers,"1"),(s=e.quoteNotificationDetails)&&(null===(r=Object.keys(s))||void 0===r?void 0:r.length)>0&&(0,d.ao)(i.moneyCardNotifications,"1"),e.isMoneyPortfolioUser&&(0,d.ao)(i.moneyPortfolioUser,"1"),this.state.get(h.Xe.IsRubyPill)&&(0,d.ao)(i.moneyRubyPillShown,"1")}async loadMovers(){if(function(t){const i=U(t);return!(!i||!i.tabs)&&(i.tabs.includes(h.Rf.Movers)||i.tabs.includes(h.Rf.Losers)||i.tabs.includes(h.Rf.Gainers))}(this.state)&&!(0,at.zy)(this.state.get(h.Xe.CardType)))return await d.aC.safeExecuteAsync(async()=>{const{activeQuoteIds:t,gainersQuoteIds:i,losersQuoteIds:n}=await(async()=>{const{getMarketMovers:t}=await e.e("money-info-service").then(e.bind(e,82486)),i=await t(),n=i.active||[],s=i.gainers||[],r=i.losers||[];return Promise.resolve({activeQuoteIds:n,gainersQuoteIds:s,losersQuoteIds:r})})(),s=U(this.state).tabListDetails;s&&(s.movers={quoteIds:t},s.gainers={quoteIds:i},s.losers={quoteIds:n}),this.state.set(h.Xe.isMoversTabAdded,!0)},void 0,p.YlL,"MoneyInfo - error fetching movers")}onUpdateQuoteItemDict(t){const i=this.state.get(h.Xe.MoneyConfig);t&&i.isDynamicFeed&&function(t,i,e){var n;const s=lt.l.get("finance");if(!s||!s.items)return;const r=(new Date).toISOString();let o=!1;const a=null===(n=s.items)||void 0===n?void 0:n.map(n=>{const s=n.id;if(!s||!t[s])return n;const a=t[s];o=!0;const l=a.changePcntNumber||0;return{...n,text:ht(a),icon:(0,at.kX)(i,l,l>0?h.Ex.PriceSpike:h.Ex.PriceDrop,e),hoverSubtitle:a.changePcnt||"",timeStamp:r}});if(!o)return;const l={type:"finance",items:a};lt.l.set("finance",l)}(t,i.urls,i.swapGainLossColor)}}var vt=e(21481),ft=e(77246),gt=e(90905),pt=e(36042),mt=e(16611),wt=e(28381),bt=e(98216);let yt=0;const Tt="Finance_Spotlight_TTR";class It extends vt.U{constructor(){super(...arguments),this.initialPreviewType="",this.shellV2PreviewType="",this.isSpotlight=!1,this.isUseResponsiveSize=!1,this.previewType="",this.currentTaskbarPreviewType="",this.explorationSettings=null,this.isCopilotTheme=!1,this.ensureObservableBeforeConnect=!0,this.widgetModelFactory=window.__com_microsoft_dsh_widgetModelApiFactory,this.ignoreSpotlight=!1,this.isFirstViewReady=!1,this.isInViewport=!1,this.enableRubyPillRotation="ruby"===T.T3.UxMode&&I.Rb.CurrentFlightSet.has("ruby-pill-rtn"),this.pillRotationControlEnabled="ruby"===T.T3.UxMode&&I.Rb.CurrentFlightSet.has("pill-rtn-ruby-c"),this.visibilityHandler=t=>{this.isFirstViewReady&&(t?this.onDashboardVisible().catch(()=>{}):this.appStateConnector.clearViewsCache())},this.currentPageIndexChangeCallBack=t=>{if(this.view&&this.view.sdCardData&&this.view.sdCardData.footerData&&this.view.sdCardData.footerData.paginationData){const i=this.view.sdCardData.footerData.paginationData;i.currentPageIndex=t;const e={...this.view.sdCardData.footerData,paginationData:{...i}},n=this.view.sdCardData;this.view={...this.view,sdCardData:{...n,footerData:e}}}},this.onMoversTabAdded=()=>{this.view&&this.updateViewWithoutQuery().catch(()=>{})},this.updateViewModelAfterFollowClick=async()=>{if(this.followClickInfo){const{itemId:t,itemName:i,follow:n,itemUrl:s}=this.followClickInfo,r=`${this.strings.isFollowedString}`.replace("{0}",`${i}`);if(this.config.useExplorationInAfterFollow)return n?(this.explorationSettings={explorationId:t,graphActionCallAppError:p.iVk,skipDismissesCountCheck:!0,cardBannerViewModelBase:{bannerType:"header-only",bannerNameForTelemetry:h.CD.MoneyAfterFollowDismiss,bannerTitle:r,autoDismissTimeoutMs:3e3,delayShowTimeoutMs:0,bannerFromClick:!0}},void await e.e("exploration-banner").then(e.bind(e,95231))):void this.hideExplorationBanner();if(await e.e("feeds-notification-toast").then(e.bind(e,38925)),!n)return void this.hideNotificationToast();const o=this.appStateConnector.getFromState(h.Xe.toggleInterestManager),a={telemetryTag:"",...this.view&&this.view.feedsNotificationToastViewModel,shouldShowNotification:!0,notificationToastHeader:r,notificationToastActionText:this.strings.watchlistConfirmationText,interestManagerOpen:o,actionTextUrl:s,cardSize:this.cardSize,onClickDismissButton:this.hideNotificationToast};this.view&&(this.view={...this.view,feedsNotificationToastViewModel:a},this.autoHideNotificationToast()),this.followClickInfo=void 0}},this.hideNotificationToast=()=>{if(clearTimeout(yt),this.view&&this.view.feedsNotificationToastViewModel){const t={...this.view.feedsNotificationToastViewModel,shouldShowNotification:!1};this.view={...this.view,feedsNotificationToastViewModel:t}}},this.hideExplorationBanner=()=>{this.explorationSettings=null},this.autoHideNotificationToast=()=>{clearTimeout(yt),yt=window.setTimeout(()=>{this.hideNotificationToast()},3e3)},this.closeActionMenu=()=>{this.config.isDynamicFeed&&this.sdCardActionClickHandler&&this.dismissActionMenu&&this.dismissActionMenu()},this.updateSuperCardHeaderData=()=>{var t;if(null!==(t=this.view)&&void 0!==t&&t.sdCardData){const t=this.appStateConnector.getFromState(h.Xe.IsPinned);this.view={...this.view,sdCardData:{...this.view.sdCardData,headerData:{...this.view.sdCardData.headerData,isPinned:t&&!c.F_.get(21)}}}}}}get isAdaptiveThemeEnabled(){return(0,C.h)()&&"pill"!==this.cardSize}shadowDomPopulated(){if(this.isAdaptiveThemeEnabled){var t;let i=(null===(t=this.moneyInfoContent)||void 0===t?void 0:t.getBoundingClientRect().width)||0;const e=t=>{i=t,this.appStateConnector.updateCardWidth(i)},n=t=>{for(const i of t){const{width:t}=i.contentRect;e(t)}};this.resizeObserver=new ResizeObserver((0,gt.A)(n,100)),this.resizeObserver.observe(this.moneyInfoContent),this.appStateConnector.updateCardWidth(i)}this.config.isDynamicFeed&&(0,c.jA)(l.ahW),(0,m.D)(()=>{const t=this.getApproxTTVRValue(l.ahW);this.isCopilotTheme?(0,w.yi)(l.ahW,!1,t,!t):(0,w.oO)(l.ahW,!1,t,!t),(0,ft.S)()&&this.config.enablePostTTVRDelay&&this.postTTVR()})}attributeChangedCallback(t,i,e){super.attributeChangedCallback(t,i,e),this.isFirstViewReady&&i!==e&&e&&("initialpreviewtype"!==t||this.ignoreSpotlight||["windowsShellV2","msnStudio"].includes(T.T3.AppType)||this.onDashboardVisible().catch(()=>{}))}cardSizeChanged(){this.isFirstViewReady&&this.adjustToHeight()}onVisuallyReady(){this.markVisuallyReadyRaf(),(0,m.D)(()=>{const t=this.getApproxTTVRValue(l.ahW);(0,w.oO)(l.ahW,!1,t,!t)})}getExperienceType(){return l._1F}async experienceConnected(){var t,i,e;if(this.hasLoadedCallback&&this.hasLoadedCallback(),this.isFirstViewReady&&this.config.isDynamicFeed)return void this.initWidgetInstance();if((0,v.lb)()){const t=(0,v.Wu)();this.ignoreSpotlight=(0,f.by)(t),c.F_.subscribe(21,this.updateSuperCardHeaderData)}this.appStateConnector=ct.getInstance(this.experienceName||this.cardType),this.initSdCardHandlers(),this.cardSize=this.cardSize??"_1x_3y",this.previewType=this.isSpotlight?this.feedPreviewType:"";const n=Math.round(performance.now());this.config.isDynamicFeed&&this.initWidgetInstance(),await this.setView(),this.addSubscriptions(),this.isFinanceSpotlight&&void 0!==n&&((0,b.ZF)()[Tt]=Math.round(performance.now())-n),this.config.enableSpotlightMismatchCheck&&this.initialSpotlightMismatchCheck(this.feedPreviewType,this.previewType),this.checkRubyPillError();const s=this.cardType&&this.cardType.includes("MiniWidget")&&this.config.enableNoHideInPA;this.enableHideActionInKumo=(null===(t=this.config)||void 0===t?void 0:t.enableHideActionInKumo)&&!(null!==(i=this.config)&&void 0!==i&&i.enableWidgetNotInterested)&&!s,this.enableWidgetNotInterested=(null===(e=this.config)||void 0===e?void 0:e.enableWidgetNotInterested)&&!s}checkRubyPillError(){var t;"pill"!==this.cardSize||null!==(t=this.view)&&void 0!==t&&null!==(t=t.pillViewModel)&&void 0!==t&&t.length||(0,y.vV)(p.SDt,"MoneyInfo - Rendering ruby pill failed","MoneyInfo - pillViewModel is empty",{feedData:this.feedData,cardType:this.cardType})}handleThemeChange(t){this.isDarkMode!==t&&(this.isDarkMode=t,this.updateView().catch(()=>{}))}initialSpotlightMismatchCheck(t,i){window.setTimeout(()=>{Boolean(this.getSplittedPreviewType(t)&&!i)&&this.logSpotlightMismatch(t)},100)}disconnectedCallback(){var t,i;super.disconnectedCallback(),null!==(t=this.config)&&void 0!==t&&t.isDynamicFeed&&(this.appStateConnector.clearViewsCache(),c.F_.unsubscribe(2,this.visibilityHandler)),(0,v.lb)()&&c.F_.unsubscribe(21,this.updateSuperCardHeaderData),this.removeSubscriptions(),null===(i=this.resizeObserver)||void 0===i||i.unobserve(this.moneyInfoContent),clearTimeout(yt),this.unsetIntersectionObserver()}removeSubscriptions(){var t;null===(t=this.appStateConnector)||void 0===t||t.unsubscribe(h.Xe.isMoversTabAdded,this.onMoversTabAddedScoped),wt.y.unsubscribeThemeChange(this)}addSubscriptions(){this.onMoversTabAddedScoped=this.onMoversTabAdded.bind(this),this.appStateConnector.subscribe(h.Xe.isMoversTabAdded,this.onMoversTabAddedScoped),this.isDarkMode=wt.y.appInDarkMode(),wt.y.subscribeThemeChange(this)}async replaceView(t){t&&t.currentViewTemplate?this.view=t:this.view||(this.previewType="",this.isSpotlight=!1,this.view=await this.appStateConnector.getInitialMoneyCardView(this.moneyInitTransformationContext))}initWidgetInstance(){d.aC.safeExecute(()=>{var t;this.shellFeedsApi||(this.shellFeedsApi=null===(t=this.widgetModelFactory)||void 0===t?void 0:t.tryGetApi("widgetshellfeeds",g.XF,g.XF));c.F_.subscribe(2,this.visibilityHandler)},void 0,this.config.isDynamicFeed?p.u6V:p.ZUy,this.config.isDynamicFeed?"MoneyInfo - Dyanmic Ranking widget instance is not available":"MoneyInfo - error initializing MoneyInfoCard widget")}async onDashboardVisible(){if(this.ignoreSpotlight)return;const t=Math.round(performance.now());if(this.previewType=await this.getFinancePreviewType(),(0,ft.S)()&&!this.isConnected)return;this.appStateConnector.updateCardSize(this.cardSize),this.appStateConnector.updateSupportedSdCardActionMenuItems(this.moneyTransformationContext);const i=await this.appStateConnector.handleFlyoutOpen(this.getSplittedPreviewType(this.previewType),this.moneyTransformationContext);if(!(0,ft.S)()||this.isConnected){if(this.hideExplorationBanner(),await this.replaceView(i),this.isFinanceSpotlight&&void 0!==t&&((0,b.ZF)()[Tt]=Math.round(performance.now())-t),this.config.enableSpotlightMismatchCheck){!(null!=i&&i.currentViewTemplate)&&window.setTimeout(()=>{this.logSpotlightMismatch(this.previewType)},100)}this.checkWidgetSizing(),this.showExplorationBanner()}}checkWidgetSizing(){this.config.isDynamicFeed&&(0,u.CE)(this.clientHeight,this.cardSize)&&(0,y.vV)(p.zBI,"Card size does not match rendered container height",`Container Height: ${this.clientHeight} Card Size: ${this.cardSize}`,{cardType:this.cardType,previewType:this.previewType})}showExplorationBanner(){var t,i,n,s;if(!this.config.enableExplorationBanner||null!==(t=this.wpoMetadata)&&void 0!==t&&t.isGA)return;const r=this.getFeedDataExplorationSettings();if(r){if(null===(i=r.data)||void 0===i||!i.title)return(0,y.vV)(p._07,"Money exploration banner data missing",`exploration id: ${r.explorationId}`,r.data),void this.hideExplorationBanner();this.explorationSettings={explorationId:r.explorationId,positiveAction:r.data.optIn,negativeAction:r.data.optOut,forceShow:"boolean"==typeof r.data.forceShow?r.data.forceShow:"true"===(null===(n=r.data.forceShow)||void 0===n||null===(s=n.toLowerCase)||void 0===s?void 0:s.call(n)),graphActionCallAppError:p.iVk,cardBannerViewModelBase:{bannerTitle:r.data.title,postActionToastViewModel:{toastMessage:this.strings.thankYouForYourFeedback}}},e.e("exploration-banner").then(e.bind(e,95231))}else this.hideExplorationBanner()}getFeedDataExplorationSettings(){const t=this.appStateConnector.getFromState(h.Xe.MoneyInfoApiData),i=this.appStateConnector.getFromState(h.Xe.PreviewType),e=null==t?void 0:t.explorationSettings;if(!i||!e)return null;const[n,s]=Object.entries(e).find(t=>{let[e,n]=t;return n.previews.find(t=>this.getSplittedPreviewType(t)===i)})||[];return n&&s?{explorationId:n,data:s}:null}logSpotlightMismatch(t){const i=this.getSplittedPreviewType(t);if(!i)return;const e=this.appStateConnector.getFromState(h.Xe.MoneyInfoApiData),n=this.appStateConnector.getTabIdFromPreviewType(e,i)||"";if(n){var s;const r={tabIdFromPreviewType:n,splittedPreviewType:i,tabData:null==e||null===(s=e.tabListDetails)||void 0===s?void 0:s[n],tabListDetailsKeys:Object.keys((null==e?void 0:e.tabListDetails)||{})};(0,y.vV)(p.GGk,"Shown tab is not matching the preview type",`PreviewType: ${t}`,r)}}get isFinanceSpotlight(){var t;return(null===(t=this.previewType)||void 0===t?void 0:t.toLocaleLowerCase().startsWith("finance"))||!1}async feedDataChanged(t,i){const e=t===i;!this.isFirstViewReady||e||!this.feedData||!this.config||(this.appStateConnector.handleOpenInterestMenu(!1),"windowsShellV2"===T.T3.AppType&&(this.previewType=this.isSpotlight?this.shellV2PreviewType:""),"function"==typeof this.updateViewWithFeedData&&await this.updateViewWithFeedData().catch(()=>{}))}async shellV2PreviewTypeChanged(t,i){t!==i&&this.isFirstViewReady&&"windowsShellV2"===T.T3.AppType&&(this.previewType=this.isSpotlight?this.shellV2PreviewType:"","function"==typeof this.updateViewWithFeedData&&await this.updateViewWithFeedData().catch(()=>{}))}async isInViewportChanged(t,i){const e=h.KI.moneyCardIsInViewPort,n=this.cardType&&this.cardType!==h.kb.MoneyInfo?`${this.cardType}_${e}`:e;i?(0,d.ao)(n,"1"):(0,d.iJ)(n)}async interestMenuItemClickHandler(t){const i=await this.appStateConnector.getMoneyCardViewForId(t,this.moneyTransformationContext);await this.replaceView(i),(0,d.j8)(this.tabElement),this.hideExplorationBanner()}async handleOpenInterestMenu(t,i){this.appStateConnector.handleOpenInterestMenu(t,i),this.updateView().catch(()=>{}),this.closeActionMenu(),this.hideExplorationBanner()}async handleInterestOptionsSearch(t){await this.appStateConnector.handleInterestOptionsSearch(t),this.updateView().catch(()=>{})}async followClickHandler(t,i,e,n){this.followClickInfo={itemId:t,follow:i,itemName:e,itemUrl:n},await this.appStateConnector.updateFollowedSecurities(t),await this.updateViewOnFollow()}async handleDateFilterChartChange(t,i){await this.appStateConnector.updateDateFilterChartType(t,i)}async updateViewOnFollow(){const t=this.appStateConnector.getFromState(h.Xe.CurrentTabId);t!==h.Rf.Watchlist&&t!==h.Rf.Search||await this.updateView(),await this.updateViewModelAfterFollowClick()}async updateViewWithFeedData(){const t=await this.appStateConnector.getUpdatedViewByFeedData(this.moneyInitTransformationContext);t!==this.view&&(this.appStateConnector.clearViewsCache(),await this.replaceView(t),(0,ft.S)()&&window.setTimeout(()=>this.postTTVR(),0))}async hideClickHandler(t){await this.appStateConnector.hideMoneyCard(t)&&this.refreshSDCardSection&&this.refreshSDCardSection()}goToPersonalizeSettingsHandler(){this.$emit("goToPersonalizeSettingsCallback")}initSdCardHandlers(){this.interestMenuItemClickHandlerScoped=this.interestMenuItemClickHandler.bind(this),this.paginationFlipperClickHandlerScoped=(0,pt.A)(this.paginationFlipperClickHandler.bind(this),this.config.flipperClickThrottleTime),this.paginationDotClickHandlerScoped=this.paginationDotClickHandler.bind(this),this.isInterestManagerOpenHandlerScoped=this.handleOpenInterestMenu.bind(this),this.interestOptionsSearchHandlerScoped=this.handleInterestOptionsSearch.bind(this),this.followClickHandlerScoped=this.followClickHandler.bind(this),this.handleDateFilterChartChangeScoped=this.handleDateFilterChartChange.bind(this),this.hideClickHandlerScoped=this.hideClickHandler.bind(this),this.goToPersonalizeSettingsHandlerScoped=this.goToPersonalizeSettingsHandler.bind(this),this.turnOffWidgetsRegionClickHandlerScoped=()=>this.turnOffWidgetsRegionCallback&&this.turnOffWidgetsRegionCallback(),this.manageWidgetsRegionClickHandlerScoped=()=>this.manageWidgetsRegionCallback&&this.manageWidgetsRegionCallback(),this.onSDCardClickScoped=()=>this.onSDCardClick&&this.onSDCardClick()}async setView(){var t,i,e;if(this.config.enableForceSpotlight){const t=S._3.getQueryParameterByName("previewType",window.location.href);this.previewType=t||this.previewType,this.isSpotlight=Boolean(this.previewType)}const n=await this.appStateConnector.getInitialMoneyCardView(this.moneyInitTransformationContext);await this.replaceView(n),this.isFirstViewReady=!0,this.onVisuallyReady&&this.onVisuallyReady(),(0,ft.S)()&&!this.config.enablePostTTVRDelay&&window.setTimeout(()=>this.postTTVR(),0),this.isUseResponsiveSize=this.isSpotlightHeroCard(this.cardType),null!==(t=this.view)&&void 0!==t&&t.sdCardData&&this.config.isDynamicFeed&&(this.view={...this.view,sdCardData:{...this.view.sdCardData,isSpotlightCard:this.isSpotlight}}),(null===(i=this.view)||void 0===i||null===(i=i.viewModel)||void 0===i?void 0:i.telemetryTag)&&(null===(e=this.onTelemetryUpdated)||void 0===e||e.call(this,void 0,this.view.viewModel.telemetryTag))}async postTTVR(){"edgeChromium"===T.T3.AppType&&await(0,mt.e1)(),await this.appStateConnector.loadPostTtvrDataSDData().catch(()=>{}),this.visualReadinessCallback&&this.visualReadinessCallback(),this.setIntersectionObserver(),this.config.enableSpotlightBundlePreload&&await this.preLoadSpotlightBundles(),this.showExplorationBanner(),this.checkWidgetSizing()}async preLoadSpotlightBundles(){const t=this.appStateConnector.getFromState(h.Xe.MoneyInfoApiData);if(!t)return;const i=t.previewTypes;i&&i.forEach(async t=>{const[,i,,]=null==t?void 0:t.split(/[:_]/);await this.appStateConnector.loadPostTTVRBundles(i,this.moneyTransformationContext)})}async updateView(){const t=await this.appStateConnector.updateView(this.moneyTransformationContext);await this.replaceView(t)}async updateViewWithoutQuery(){const t=await this.appStateConnector.updateViewWithoutQuery(this.moneyTransformationContext);await this.replaceView(t)}getNewTabIndexOnFlip(t,i){const e=this.appStateConnector.getFromState(h.Xe.CurrentTabId),n=t.findIndex(t=>t.id===e);let s=i?n+1:n-1;return-1===s?s=t.length-1:s===t.length&&(s=0),s}paginationFlipperClickHandler(t,i){if("_1x_1y"!==this.appStateConnector.getFromState(h.Xe.CardSize)){var e;const i=this.appStateConnector.getFromState(h.Xe.InterestMenuItems),n=this.getNewTabIndexOnFlip(i,t);null===(e=this.interestMenuItemClickHandler)||void 0===e||e.call(this,i[n].id)}else{var n;null===(n=this.footerFlipperClickHandler)||void 0===n||n.call(this,t)}}footerFlipperClickHandler(t){const i=this.appStateConnector.updateNextPageIndex(t);this.currentPageIndexChangeCallBack(i)}paginationDotClickHandler(t){if("_1x_1y"!==this.appStateConnector.getFromState(h.Xe.CardSize)){const e=this.appStateConnector.getFromState(h.Xe.InterestMenuItems)||[];var i;if(t<e.length)null===(i=this.interestMenuItemClickHandler)||void 0===i||i.call(this,e[t].id)}else{const i=t+1;this.appStateConnector.updateCurrentPageIndex(i),this.currentPageIndexChangeCallBack(i)}}adjustToHeight(){this.appStateConnector.getFromState(h.Xe.CardSize)!==this.cardSize&&(this.appStateConnector.updateCardSize(this.cardSize),"windowsShellV2"!==T.T3.AppType&&this.updateView().catch(()=>{}))}async getRotationalPreviews(){if(this.shellFeedsApi)return await d.aC.safeExecuteAsync(async()=>{var t;const i=await(null===(t=this.shellFeedsApi)||void 0===t?void 0:t.getRotationalPreviewIds());if(!i)throw new Error("WidgetShellFeeds.getRotationalPreviewIds returned nothing");if(i.relatedCardId===this.cardId)return i},void 0,p.QIV,"MoneyInfo - Exception at WidgetShellFeeds.getRotationalPreviewIds")}async getFinancePreviewType(){if(this.ignoreSpotlight)return"";const t=await this.getRotationalPreviews();if(!t)return"";const{previewType:i}=t;return i||""}getSplittedPreviewType(t){if(!t)return"";const[i,e,n,s,r]=t.split(/[:_]/);if([h.Ex.WatchlistSummary,h.Ex.WatchlistIdeas,h.Ex.EarningsBrief].includes(e))return e;if(e===h.Ex.Agent)return`${e}_${n}_${s}`;let o=s&&"x"!==s.toLowerCase()?s:n;return e===h.Ex.EventBrief&&o&&(o=o.split("|")[0]),"Finance"===i&&e?o?`${e}_${o}`:e:""}get feedPreviewType(){return"windowsShellV2"===T.T3.AppType?this.shellV2PreviewType:this.initialPreviewType}get moneyTransformationContext(){return{config:this.config,strings:this.strings,interestMenuItemClickHandler:this.interestMenuItemClickHandlerScoped,paginationFlipperClickHandler:this.paginationFlipperClickHandlerScoped,paginationDotClickHandler:this.paginationDotClickHandlerScoped,followClickHandler:this.followClickHandlerScoped,handleDateFilterChartChange:this.handleDateFilterChartChangeScoped,hideClickHandler:this.hideClickHandlerScoped,moreSettingsClickHandler:this.goToPersonalizeSettingsHandlerScoped,openSearchViewHandler:this.isInterestManagerOpenHandlerScoped,searchInterestsHandler:this.interestOptionsSearchHandlerScoped,supportedSdCardActionMenuItems:this.supportedSdCardActionMenuItems,sdCardActionClickHandler:this.sdCardActionClickHandler,isWidgetRegion:this.isWidgetRegion,turnOffWidgetsRegionClickHandler:this.turnOffWidgetsRegionClickHandlerScoped,manageWidgetsRegionClickHandler:this.manageWidgetsRegionClickHandlerScoped,onSDCardClick:this.onSDCardClickScoped}}get moneyInitTransformationContext(){return{...this.moneyTransformationContext,cardType:this.cardType,feedData:this.feedData,previewType:this.isSpotlight?this.getSplittedPreviewType(this.previewType):"",cardSize:this.cardSize,isCopilotTheme:this.isCopilotTheme,wpoMetadata:this.wpoMetadata,rootTelemetryObject:this.parentTelemetryObject,fullPreviewType:this.isSpotlight?this.previewType:""}}isSpotlightHeroCard(t){return null==t?void 0:t.toLowerCase().startsWith("financespotlighthero")}setIntersectionObserver(){if(this.intersectionObserver)return;this.intersectionObserver=new IntersectionObserver(t=>{if(t&&0!==t.length)for(const i of t)this.isInViewport=i.isIntersecting},{threshold:[.5]}),this.intersectionObserver.observe(this)}unsetIntersectionObserver(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=void 0)}getWrapTelemetryTag(){var t,i,e;if(!this.telemetryObject)return;let n="";var s,r,o;null!==(t=this.view)&&void 0!==t&&t.pillViewModel?(n=h.CD.heroGem,(null===(s=this.view)||void 0===s||null===(s=s.pillViewModel)||void 0===s?void 0:s.length)>1&&(this.enableRubyPillRotation||this.pillRotationControlEnabled)&&bt.YT.addOrUpdateTmplProperty("MoneyInfoPillRotation",this.enableRubyPillRotation?"1":"0")):"0.5u"===this.cardSize?n=h.kb.MoneyInfoMiniWidget:this.isCopilotTheme&&this.previewType&&(n=h.CD.moneyInfoSpotlight);return n?null===(r=(o=this.telemetryObject).addChild)||void 0===r?void 0:r.call(o,{name:n}).getMetadataTag():null===(i=(e=this.telemetryObject).getMetadataTag)||void 0===i?void 0:i.call(e)}}(0,a.Cg)([$.CF],It.prototype,"initialPreviewType",void 0),(0,a.Cg)([M.sH],It.prototype,"shellV2PreviewType",void 0),(0,a.Cg)([M.sH],It.prototype,"feedData",void 0),(0,a.Cg)([M.sH],It.prototype,"cardSize",void 0),(0,a.Cg)([M.sH],It.prototype,"cardType",void 0),(0,a.Cg)([M.sH],It.prototype,"experienceName",void 0),(0,a.Cg)([M.Jg],It.prototype,"isAdaptiveThemeEnabled",null),(0,a.Cg)([M.sH],It.prototype,"isSpotlight",void 0),(0,a.Cg)([M.sH],It.prototype,"isWidgetRegion",void 0),(0,a.Cg)([M.sH],It.prototype,"explorationSettings",void 0),(0,a.Cg)([(0,$.CF)({attribute:"is-copilot-theme",mode:"boolean"})],It.prototype,"isCopilotTheme",void 0),(0,a.Cg)([M.sH],It.prototype,"initCardAction",void 0),(0,a.Cg)([M.sH],It.prototype,"cardActionPropsOverride",void 0),(0,a.Cg)([M.sH],It.prototype,"supportedSdCardActionMenuItems",void 0),(0,a.Cg)([M.sH],It.prototype,"view",void 0),(0,a.Cg)([M.sH],It.prototype,"isFirstViewReady",void 0),(0,a.Cg)([M.sH],It.prototype,"isInViewport",void 0),(0,a.Cg)([M.Jg],It.prototype,"moneyInitTransformationContext",null);var Ct=e(96950),St=e(60402),$t=e(91640),Mt=e(56046);const kt=Ct.qy`<exploration-banner :settings="${t=>t.explorationSettings}"></exploration-banner>`,xt=Ct.qy`<feeds-notification-toast aria-live="assertive" tabindex="0" :viewModel="${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.feedsNotificationToastViewModel}}"></feeds-notification-toast>`,Dt=Ct.qy`<div class="money-info-content" slot="card-content" ${(0,St.K)("moneyInfoContent")}>${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.currentViewTemplate}}</div>`,Pt=Ct.qy`<div data-t="${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.viewModel.telemetryTag}}" class="wrap"><responsive-sd-card :data="${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.sdCardData}}" :toggleInterestManager="${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.sdCardData)||void 0===i?void 0:i.toggleInterestManager}}" data-t="${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.viewModel.tabTelemetryTag}}" size="${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.sdCardData)||void 0===i?void 0:i.cardSize}}" responsive-size=${t=>t.isUseResponsiveSize} ${(0,St.K)("tabElement")}>${Dt}</responsive-sd-card>${xt} ${(0,$t.z)(t=>t.explorationSettings,kt)}</div>`,Nt=Ct.qy`<div class="ruby-card-container" data-t="${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.rootTelemetryTag}}"><cx-ruby-widget-card :href=${t=>{var i,e;return null!==(i=t.view)&&void 0!==i&&null!==(i=i.rubyCardData)&&void 0!==i&&i.isImmersive||null===(e=t.view)||void 0===e||null===(e=e.rubyCardData)||void 0===e?void 0:e.href}} :rootTelemetryObject=${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.rootTelemetryObject}} :initCardAction=${t=>t.initCardAction} :cardActionPropsOverride=${t=>{var i;return{...t.cardActionPropsOverride,...null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.cardActionPropsOverride}}} :enableHideActionInKumo=${t=>t.enableHideActionInKumo} :enableWidgetNotInterested=${t=>t.enableWidgetNotInterested} heading="${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.heading}}" immersive="${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.isImmersive}}" :containerPadding=${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.containerPadding}} render-augment="true" size=${t=>t.cardSize} :subtitleData=${t=>{var i;return null===(i=t.view)||void 0===i||null===(i=i.rubyCardData)||void 0===i?void 0:i.subtitleData}} style="background: ${t=>{var i,e;return null!==(i=t.view)&&void 0!==i&&null!==(i=i.rubyCardData)&&void 0!==i&&i.isImmersive?null===(e=t.view)||void 0===e||null===(e=e.rubyCardData)||void 0===e?void 0:e.backgroundValue:""}}"><div slot="augment" style="background: ${t=>{var i,e;return null!==(i=t.view)&&void 0!==i&&null!==(i=i.rubyCardData)&&void 0!==i&&i.isImmersive?"":null===(e=t.view)||void 0===e||null===(e=e.rubyCardData)||void 0===e?void 0:e.backgroundValue}}">${Dt}</div></cx-ruby-widget-card></div>`,Ft=Ct.qy`<cx-ruby-pill rotate=${t=>t.enableRubyPillRotation} :data="${t=>{var i;return null===(i=t.view)||void 0===i?void 0:i.pillViewModel}}"></cx-ruby-pill>`,Ot=Ct.qy`${t=>(0,Mt.C)(`TTSR.${t.cardType}`)}`,zt=Ct.qy`<template data-t=${t=>null==t?void 0:t.getWrapTelemetryTag()}>${(0,$t.z)(t=>{var i;return t.isFirstViewReady&&(null===(i=t.view)||void 0===i?void 0:i.rubyCardData)},Nt)} ${(0,$t.z)(t=>{var i;return t.isFirstViewReady&&(null===(i=t.view)||void 0===i?void 0:i.sdCardData)},Pt)} ${(0,$t.z)(t=>{var i;return t.isFirstViewReady&&(null===(i=t.view)||void 0===i?void 0:i.pillViewModel)},Ft)} ${(0,$t.z)(()=>!(0,ft.S)(),Ot)}</template>`;var _t=e(74849),Et=e(4126),Vt=e(43103);const Rt=_t.A` :host{--quote-hover-background:rgba(255,255,255,0.1);--quote-background:#1F1F1F;--quote-active-background:#141414}`,Lt=_t.A` :host{width:100%;min-width:inherit;max-width:inherit}.ruby-card-container{width:100%}`,Wt=_t.A` :host{width:auto}`.withBehaviors(new Et.o("isAdaptiveThemeEnabled",!0,Lt)),At=_t.A` :host{--quote-background:#f5f5f5;--quote-hover-background:#ebebeb;--quote-active-background:#ebebeb}:host{display:inline-flex;width:100%}.wrap{position:relative;width:100%}.money-info-content{position:relative;overflow:hidden}cx-ruby-widget-card [slot=augment] .money-info-content{padding:16px;height:100%;box-sizing:border-box}cx-ruby-widget-card[immersive=true] [slot=augment] .money-info-content{padding:0px}cx-ruby-pill::part(icon){margin-inline-end:-4px}`.withBehaviors(new Vt.N(null,Rt),new Et.o("isCopilotTheme",!0,Wt));(0,s.o)(),n.csResponsiveList.define(o.G.registry),r.m.define(o.G.registry);const jt={experienceConfigSchema:undefined}},92337:function(t,i,e){"use strict";e.d(i,{gx:function(){return z},tb:function(){return L},Qm:function(){return j},Ds:function(){return R},Yd:function(){return A},Gf:function(){return O},nc:function(){return Q},mN:function(){return B},EM:function(){return U},m7:function(){return W}});var n=e(90429),s=e(93468),r=e(65022),o=e(30817),a=e(75874),l=e(11372),h=e(98216),d=e(48114),u=e(17254),c=e(59721),v=e(55593),f=e(89980),g=e(5419),p=e(72317),m=e(36903);const w={small:.5,medium:1,large:1.5};var b=e(49704),y=e.n(b),T=e(47149),I=e(25752);const C="thirdPartyBackingAppUninstallBanner";const S=new class{constructor(){var t,i;this.widgetModelApi=window.__com_microsoft_dsh_widgetModelApiFactory,this.is1PBackingAppInstalled=!0,this.isUninstallFeatureEnabled=!1;const e=null===(t=this.widgetModelApi)||void 0===t?void 0:t.tryGetApi("velocity",I.XF,I.XF);this.packageStateApi=null===(i=this.widgetModelApi)||void 0===i?void 0:i.tryGetApi("packagestate",I.XF,I.XF),this.isUninstallFeatureEnabled=e&&e.isFeatureEnabled("Feature_DMAEdgeUninstall")}addListenerToPackageState(t){var i;try{null===(i=this.packageStateApi)||void 0===i||i.addEventListener(t)}catch(t){h.YT.sendAppErrorEvent(Object.assign(Object.assign({},r.rs0),{message:"Error using windows package API to add event listener for package state changes",pb:Object.assign(Object.assign({},r.rs0.pb),{customMessage:t,addListener:!0})}))}}removeListenerToPackageState(t){var i;try{null===(i=this.packageStateApi)||void 0===i||i.removeEventListener(t)}catch(t){h.YT.sendAppErrorEvent(Object.assign(Object.assign({},r.rs0),{message:"Error using windows package API to remove event listener for package state changes",pb:Object.assign(Object.assign({},r.rs0.pb),{customMessage:t,addListener:!1})}))}}async isBackingAppInstalled(t){if(this.packageStateApi&&this.isUninstallFeatureEnabled)try{return await this.packageStateApi.isPackageInstalled(t)}catch(t){h.YT.sendAppErrorEvent(Object.assign(Object.assign({},r.rs0),{message:"Error Calling Windows API to get Package Install State for Edge",pb:Object.assign(Object.assign({},r.rs0.pb),{customMessage:t,addListener:!1})}))}return!0}isBackingAppInstalledFor1P(){return this.is1PBackingAppInstalled}getThirdPartyBannerStatus(){return"1"===(0,f.Lg)().getItem(C)}setThirdPartyBannerStatus(t){return(0,f.Lg)().setItem(C,t)}async fetch1PBackingAppStatus(){this.is1PBackingAppInstalled=await this.isBackingAppInstalled("Microsoft.MicrosoftEdge.Stable_8wekyb3d8bbwe")}};var $=e(88296);var M=e(87514),k=e(65196);let x,D,P;const N=`${u.T3.StaticsUrl}latest/icons-wc/icons`,F={Bullet:{lightMode:`${N}/Bullet.svg`,darkMode:`${N}/dark-mode/Bullet.svg`},Edit:{lightMode:`${N}/Edit.svg`,darkMode:`${N}/dark-mode/Edit.svg`},HideV2:{lightMode:`${N}/HideV2.svg`,darkMode:`${N}/dark-mode/HideV2.svg`},PinnedSV2:{lightMode:`${N}/PinnedSV2.svg`,darkMode:`${N}/dark-mode/PinnedSV2.svg`},UnpinSV2:{lightMode:`${N}/UnpinSV2.svg`,darkMode:`${N}/dark-mode/UnpinSV2.svg`},RemoveWBWidget:{lightMode:`${N}/RemoveWBWidget.svg`,darkMode:`${N}/dark-mode/RemoveWBWidget.svg`},ReportIssue:y(),Switch:{lightMode:`${N}/Switch.svg`,darkMode:`${N}/dark-mode/Switch.svg`},AlertOff:{lightMode:`${N}/AlertOff.svg`,darkMode:`${N}/dark-mode/AlertOff.svg`},Settings:{lightMode:`${N}/SettingIcon.svg`,darkMode:`${N}/dark-mode/SettingIcon.svg`}};function O(t,i,e,n,s,r,o,h,c){const v=[];let f=0,g=!1;if(!t||!t.length)return;const w=d.F_.get(3),b=t.includes("unpin");P=b?"pinned":"feed",x=e||{},D=n;const y=(0,a.ad)();let T;const I=(0,m.Wu)(),C=(0,p.by)(I)&&p.EV.isWidgetHeaderUpdatesEnabled()?w.removeWidget||"Remove widget":w.unpinCard||"Unpin widget",S=(0,p.by)(I)&&p.EV.isWidgetHeaderUpdatesEnabled()?F.RemoveWBWidget:F.UnpinSV2;if(t.forEach(t=>{switch(t){case"small":f++,x.height=146,v.push({id:"small",glyphUrls:s===t?F.Bullet:void 0,title:w.small||"Small",ariaLabel:w.small||"Small",telemetryTag:V("size_small",w.small,l.MS.Customize),checked:s===t,role:"menuitemradio"});break;case"medium":f++,x.height=304,v.push({id:"medium",glyphUrls:s===t?F.Bullet:void 0,title:w.medium||"Medium",ariaLabel:w.medium||"Medium",telemetryTag:V("size_medium",w.medium,l.MS.Customize),checked:s===t,role:"menuitemradio"});break;case"large":f++,x.height=462,v.push({id:"large",glyphUrls:s===t?F.Bullet:void 0,title:w.large||"Large",ariaLabel:w.large||"Large",telemetryTag:V("size_large",w.large,l.MS.Customize),checked:s===t,role:"menuitemradio"});break;case"switchTaskBarView":f++,v.push({id:"switchTaskBarView",glyphUrls:F.Switch,title:w.switchBackToWeather||"Switch back to weather",ariaLabel:w.switchBackToWeather||"Switch back to weather",telemetryTag:V("moneycardcustomizationswitchback",w.switchBackToWeather,l.MS.Hide),onClick:c?()=>c():void 0});break;case"pin":v.push({id:"pinCard",glyphUrls:F.PinnedSV2,title:w.pinCard||"Pin widget",ariaLabel:w.pinCard||"Pin widget",telemetryTag:V("pinwidget",w.pinCard,l.MS.Pin)});break;case"customize":g=!0,f>1&&(null==v?void 0:v.length)>0&&v.push({isDivider:!0}),v.push({id:"customize",glyphUrls:F.Edit,title:w.customize||"Customize widget",ariaLabel:w.customize||"Customize widget",onClick:()=>r("onShowSettingsEnd"),telemetryTag:V("editwidget",w.customize,l.MS.Customize)});break;case"unpin":!g&&f>1&&(null==v?void 0:v.length)>0&&v.push({isDivider:!0}),v.push({id:"unpinCard",glyphUrls:S,title:C,ariaLabel:C,telemetryTag:V("unpinwidget",w.unpinCard,l.MS.Unpin)});break;case"poweredBy":(0,M.Cr)().then(t=>{const e=u.T3&&u.T3.CurrentRequestTargetScope&&u.T3.CurrentRequestTargetScope.pageExperiments||[];T=e.includes("prg-pr2-newbrand")?t?i:w.signedInByMSN||"Signed in by MSN":t?i:w.signedInByMicrosoftStart||"Signed in by MSN",(null==v?void 0:v.length)>0&&v.push({isDivider:!0}),v.push({id:"poweredBy",isText:!0,title:T,ariaLabel:T})});break;case"removeWidget":v.push({id:"removeWidget",glyphUrls:F.HideV2,title:w.hideWidget,ariaLabel:w.hideWidget,telemetryTag:V("removewidget",w.hideWidget,l.MS.Hide)});break;case"reportIssue":v.push({id:"reportIssue",glyph:F.ReportIssue,title:w.reportIssue,ariaLabel:w.reportIssue,telemetryTag:V("reportIssue",w.reportIssue,l.MS.Report)});break;case"muteNotification":v.push({id:"muteNotification",glyphUrls:F.AlertOff,title:w.muteNotification,ariaLabel:w.muteNotification,telemetryTag:V("mutenotification",w.muteNotification,l.MS.Mute)});break;case"notificationSettings":v.push({id:"notificationSettings",glyphUrls:F.Settings,title:w.notificationSettings,ariaLabel:w.notificationSettings,telemetryTag:V("notificationsettings",w.notificationSettings,l.MS.Customize)})}}),y){if(o&&o.length){o.push({isDivider:!0});const t=v.findIndex(t=>t.id===(b?"customize":"removeWidget"));v.splice(t,0,...o)}if(h&&h.length&&b){const t=v.findIndex(t=>"customize"===t.id);v.splice(t,1,...h)}}return v}var z,_,E;function V(t,i,e){if(a.ZU.getPolicyCompliance(3)&&"editwidget"!==t&&!(0,m.lb)())return;return new T.$({name:`${D}>customization_${t}`,type:l.MJ.ActionButton,action:l.EG.Click,behavior:e,zone:P,content:{headline:i,type:l.b5.StructuredData,vertical:D,category:D},destinationUrl:location.href,ext:x}).getMetadataTag()}function R(t){switch(t){case"_1x_1y":case"half":return"small";case"_1x_3y":case"tall":return"large";default:return"medium"}}function L(t,i,e){t&&(i&&e&&i(new CustomEvent("CardResized",{detail:{cardType:e,size:"medium"}})),t.style.zIndex=c.P.Above.toString(),t.style.height="304px")}function W(t,i,e,n){t&&(i&&e&&i(new CustomEvent("CardResized",{detail:{cardType:e,size:"small"}})),t.style.zIndex="",t.style.height="")}!function(t){t.Customize="customize",t.Large="large",t.Medium="medium",t.MuteNotification="muteNotification",t.NotificationSettings="notificationSettings",t.Pin="pin",t.PoweredBy="poweredBy",t.RemoveWidget="removeWidget",t.ReportIssue="reportIssue",t.Small="small",t.SwitchTaskBarView="switchTaskBarView",t.Unpin="unpin"}(z||(z={})),function(t){t.HOME="home",t.CONSUMPTION="consumption"}(_||(_={})),function(t){t.OnIdentityChanged="onIdentityChanged",t.SyncMuid="syncMUID",t.PcsReload="pcsReload",t.FlightChange="flightChange",t.BuildVersionChanged="buildVersionChanged",t.StalePage="stalePage",t.Undefined="undefinedReason"}(E||(E={}));function A(t,i,e){if(e)return"spotlight";if(t)return"pinned";if("startfeed"!==(null===(n=u.T3.CurrentRequestTargetScope)||void 0===n?void 0:n.pageType)&&"1.0"!==d.F_.get(12))return"feed";var n;return(d.F_.get(6)||[]).find(t=>t===i||t.startsWith("3pwidget")&&t.substring(9)===i)?"pinned":"feed"}async function j(t,i,e,o,l,h,u,c,f,g,w){let b;e||(e={ocid:"winp2",pageScenario:"dashboard4",duotone:!0,flightData:"prg-bngimg-t,1s-brcolors,prg-rctns_v1,prg-1sw-diswgt",muidFallback:!0,isXfeed:!0});const y=[],T={},C=d.F_.get(22),M=d.F_.get(12),k="3.0"===M||"2.0"===M;if(C&&!k&&C.forEach(t=>y.push(t)),t){const i=t.tryGetApi("geolocation",I.XF,I.XF);i&&await i.initialize();const e=t.tryGetApi("model",I.XF,I.XF),o=t.tryGetApi("widgetpinning",I.XF,I.XF),a=[];a.push(i?i.getLocation():Promise.resolve(void 0)),a.push(!e||C||k?Promise.resolve(void 0):e.getWidgetRegistrations());const l=o&&"function"==typeof o.isMigrationCompleteAsync;a.push(l?o.isMigrationCompleteAsync("pinned"):Promise.resolve(void 0)),a.push(l?o.isMigrationCompleteAsync("Muted"):Promise.resolve(void 0));const h=o&&"function"==typeof o.getUserSettingsAsync;let d,u,c,v,f;a.push(h?o.getUserSettingsAsync("pinned"):Promise.resolve(void 0)),a.push(h?o.getUserSettingsAsync("Muted"):Promise.resolve(void 0));const g=await Promise.allSettled(a);if([b,d,u,v,c,f]=g.map(t=>"fulfilled"===(null==t?void 0:t.status)?t.value:void 0),d){const t=Object.keys(n.Ml);d.forEach(i=>{const e=t.find(t=>n.Ml[t]&&n.Ml[t].widgetId===i.id);y.push(e||i.id)})}if(u)if(c&&c.length){const t=new Set(y),i=[];for(const e of c.split("|")){const n=e.split(",")[0];t.has(n)&&(i.push(e),t.delete(n))}T.Widgets=[...i,...t].join("|")}else T.Widgets=`${y.join("|")}`;if((v||(null==f?void 0:f.length)>=0)&&(T.Muted=f),c&&c.length>0&&0===u){const t=new URLSearchParams(window.location.href),i=t&&t.get("aver")||void 0;(0,s.vV)(r.IKI,"API returning incorrect pin migration state.",void 0,Object.assign(Object.assign({},r.IKI.pb),{isPinMigrationComplete:u,pinnedPreferences:c,muteMigrationUpercaseMuteKey:v,mutePreferences:f,appVersion:i}))}const p=t.tryGetApi("velocity",I.XF,I.XF);(null==p?void 0:p.isFeatureEnabled("Feature_AEPEvolvedNotifications"))&&(T.Velocity="48064775")}const x=d.F_.get(1)?"dark":"light";let D;const P=(0,$.TU)().currentColumnArrangement.toUpperCase();D="2.0"===M||"1.0"===M||"3.0"===M?function(t){switch(t.toLowerCase()){case"c4":return"C3";case"c3":return"C2";case"c2":case"c1":return"C1";default:return(0,s.vV)(r.yrQ,"Error in updating layout for rail model",`current layout: ${t}`),t}}(P):d.F_.get(14)?P:void 0;const N=window?`${window.innerWidth}x${window.innerHeight}`:void 0,F=!S.isBackingAppInstalledFor1P(),O=p.EV.getFeedRegistrations(),z=O&&0==O.length,_=!p.EV.containsStartFeed()&&!(0,m.J9)(),E=!(0,a.J_)(),V=!(0,a.$5)(),R="1"===(0,v.a)().get("disable3P"),L="1"===(0,v.a)().get("defaultWidgets"),W=e.sendFRESeenCount?e.sendFRESeenCount:c,A=e.enableFREOverlayMyFeed?e.enableFREOverlayMyFeed:f;return Object.assign(Object.assign({},e),{installedWidgets:y,geolocation:b,layout:D,theme:x,clientLayoutVersion:M,nextPageUrl:o,refreshType:i,refreshCnt:l,timeoutMs:h,viewportSize:N,additionalHeaders:T,doNotTriggerFREInSession:u,isEdgeUninstalled:F,allFeedsDisabled:z,firstPartyFeedDisabled:_,rotationDisabled:E,badgingDisabled:V,disable3P:R,defaultWidgets:L,sendFRESeenCount:W,enableFREOverlayMyFeed:A,enableRuby:!!g,msnup:w})}class H{constructor(){this.ttvrRowCount=3,this.getWaterfallCardRow=t=>{const i=n.yS[null==t?void 0:t.height];return w[i]||1},this.getTemplateCardRow=t=>{const i=n.WA[null==t?void 0:t.layoutTemplate];return w[i]||1};const t=(0,o.ZF)();this.ttvrRowCount=H.getTtvrRowCountByHeight(),t.ttvrRowCount=this.ttvrRowCount}}function B(t){var i,e;let n=!0;const s=function(){var t,i;if("undefined"!=typeof URLSearchParams){const e=(0,m.J9)()?"hver":"aver",n=null===(i=new URLSearchParams(null===(t=window.location)||void 0===t?void 0:t.search))||void 0===i?void 0:i.get(e);if(n)return{version:n,versionArr:n.split(".").map(t=>t.trim())}}return}();if((null===(i=null==s?void 0:s.versionArr)||void 0===i?void 0:i.length)>=3){const t=s.versionArr[0];n=!(3===t.length&&(t.startsWith("52")||t.startsWith("62"))&&"0"===s.versionArr[2])}return t?t("widgetsIsRetail",n?"1":"0"):null===(e=null===h.YT||void 0===h.YT?void 0:h.YT.addOrUpdateTmplProperty)||void 0===e||e.call(h.YT,"widgetsIsRetail",n?"1":"0"),n}function U(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e,n,s;const r=["feedback-hub://?contextid=1214&tabid=2"],o=null===(e=null===h.YT||void 0===h.YT?void 0:h.YT.getPageMetadata)||void 0===e?void 0:e.call(h.YT),a=null===(s=null===(n=null==o?void 0:o.contract)||void 0===n?void 0:n.page)||void 0===s?void 0:s.name;for(const t of["muid","rid","debugId","flights","pageName"]){if("pageName"===t&&a)continue;const i=(0,f.Lg)().getItem(`mee-${t}`);i&&r.push(`&${t}=${i}`)}if(a&&r.push(`&pageName=${a}`),t&&(r.push("&WidgetBoard=true"),i)){const t="1"===(0,f.Lg)().getItem(k.gd);r.push("&rubyOptOut="+(t?"1":"0"))}window.dispatchEvent(new CustomEvent("FeedbackClicked")),window.location.href=r.join("")}H.getTtvrRowCountByHeight=()=>{const t=window.outerHeight||document.documentElement.clientHeight;return t<=596?1:t<=912?2:3};const q="widgets-internal-user-state";function Q(){try{const t=(0,g.t)();t&&(0,f.Lg)().setItem(q,"1");const i="1"===(0,f.Lg)().getItem(q);return t||i}catch(t){return!1}}}}]);