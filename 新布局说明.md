# 新的无缝融合布局

## 📱 整体结构

```
┌─────────────────────────────────┐
│     AI 日程      [今天] [清空]  │  ← AppBar（固定）
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │  2025年11月24日 星期日      │ │  ← 日期选择器（固定）
│ │  🟢 休息日                  │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ ╔═══════════════════════════╗   │  ← 审批卡片（固定，有操作时显示）
│ ║ 📝 创建每天9:30的起床日程 ║   │
│ ║ [忽略] [拒绝] [接受]      ║   │
│ ╚═══════════════════════════╝   │
├─────────────────────────────────┤
│                                 │
│ ⬆️ 向上滑动查看日程              │
│ ⬇️ 向下滑动查看 AI 对话          │
│                                 │
│ ┌────────────────────────────┐  │
│ │  ⬜ 8:00  晨跑             │  │  ← 日程列表
│ │  ☑️ 10:00 健身 (已完成)   │  │    （可滚动）
│ │  ⬜ 14:00 学习             │  │
│ │                            │  │
│ │  [空白时显示]              │  │
│ │  📅 暂无日程               │  │
│ │  往下滑，跟 AI 助手聊聊吧~  │  │
│ └────────────────────────────┘  │
│                                 │
│ ──── 🤖 AI 助手 ────           │  ← 分隔线
│                                 │
│  🤖 嗨！我是你的智能助手        │  ← AI 对话列表
│                                 │    （可滚动）
│          还没睡呢 👤            │
│                                 │
│  🤖 都凌晨2点了...              │
│                                 │
│  [加载时显示]                   │
│  ⏳ 正在思考...                │
│                                 │
│  [底部留白 80px]                │
│                                 │
├─────────────────────────────────┤
│ [随便聊聊...          ] [发送]  │  ← 输入框（固定底部）
└─────────────────────────────────┘
```

## ✨ 核心特性

### 1. **无缝滚动体验**
- 使用 `CustomScrollView` + `Sliver` 组件
- 日程和对话在同一个滚动容器中
- 一个滚轮/手指滑动，流畅切换内容

### 2. **固定区域**
- **AppBar**：标题 + 今天按钮 + 清空按钮
- **日期选择器**：显示当前日期、星期、日期类型
- **审批卡片**：有待审批操作时显示，橙色背景
- **输入框**：始终固定在底部

### 3. **滚动区域**
```
CustomScrollView {
  SliverList: 日程列表
  SliverToBoxAdapter: 分隔线 "🤖 AI 助手"
  SliverList: AI 对话列表
  SliverToBoxAdapter: 加载指示器
  SliverToBoxAdapter: 底部留白 80px
}
```

### 4. **视觉层次**
- 日程区域：白色背景
- 分隔线：灰色虚线 + "🤖 AI 助手" 图标文字
- 对话区域：白色背景，与日程无缝连接
- 审批卡片：橙色背景，橙色边框，突出显示

### 5. **交互逻辑**

**向上滚动：**
```
查看更早的日程
    ↓
到达顶部
    ↓
无法继续滚动
```

**向下滚动：**
```
查看日程列表
    ↓
经过分隔线 "🤖 AI 助手"
    ↓
进入对话区域
    ↓
查看历史对话
    ↓
到达底部留白
```

**发送消息后：**
```
自动滚动到最底部
    ↓
显示最新对话
```

## 🎯 优势

✅ **无边界融合**：日程和对话没有明显分隔，自然过渡  
✅ **统一滚动**：一个手势控制所有内容  
✅ **空间高效**：没有固定比例限制，日程多就多显示，对话多就多显示  
✅ **视觉引导**：分隔线清晰标识 AI 助手区域开始  
✅ **避免遮挡**：底部留白 80px，确保最后一条消息不被输入框遮挡  

## 📐 技术实现

### CustomScrollView 结构
```dart
CustomScrollView(
  controller: _scheduleScrollController,
  slivers: [
    // 日程列表
    _schedules.isEmpty 
      ? SliverFillRemaining(空状态提示)
      : SliverList(日程列表),
    
    // 分隔线
    SliverToBoxAdapter(
      Row("──── 🤖 AI 助手 ────")
    ),
    
    // 对话列表
    SliverList(
      _messages (对话气泡)
    ),
    
    // 加载指示器
    if (_isLoading) SliverToBoxAdapter(⏳),
    
    // 底部留白
    SliverToBoxAdapter(SizedBox(height: 80)),
  ],
)
```

### 滚动到底部
```dart
_scrollToBottom() {
  _scheduleScrollController.animateTo(
    maxScrollExtent, // 滚动到最底部
    duration: 300ms,
  );
}
```

## 🎨 样式细节

- **审批卡片**：`Colors.orange.shade50` 背景
- **分隔线**：`Colors.grey.shade300`，1px 粗细
- **AI 图标**：`Icons.smart_toy`，灰色
- **输入框阴影**：向上投影，模糊 4px
- **日期选择器阴影**：向下投影，模糊 4px

现在运行测试吧！🚀
