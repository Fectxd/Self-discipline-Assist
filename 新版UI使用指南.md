# 新版 UI 使用指南

## 🎨 界面布局

### 📱 底部导航栏（2个标签）
```
┌────────────────────────────┐
│  🤖 AI 日程  │  📅 日历   │
└────────────────────────────┘
```

---

## 📋 AI 日程页面

### 布局结构
```
┌─────────────────────────────┐
│    AI 日程    [今天] [清空] │  ← AppBar
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │  2025年11月24日 星期日  │ │  ← 日期选择器
│ │  🟢 休息日              │ │
│ └─────────────────────────┘ │
│                             │
│  ⬜ 8:00  晨跑              │  ← 日程列表
│  ☑️ 10:00 健身 (已完成)    │    (上方 3/5)
│  ⬜ 14:00 学习              │
│                             │
│ ─────────────────────────── │
│ ╔═══════════════════════╗   │
│ ║ 📝 创建工作日模板     ║   │  ← 审批卡片
│ ║ [忽略] [拒绝] [接受]  ║   │    (需要时显示)
│ ╚═══════════════════════╝   │
│                             │
│  🤖 嗨！我是你的智能助手   │  ← 聊天区
│                             │    (下方 2/5)
│  (旧消息渐变半透明)         │    1/4 处开始渐变
│                             │
│          还没睡呢 👤        │
│                             │
│  🤖 都凌晨2点了...          │
│                             │
├─────────────────────────────┤
│ [随便聊聊...      ] [发送]  │  ← 输入框
└─────────────────────────────┘
```

### 核心功能

**1. 日程管理**
- ✅ 查看当天日程
- ✅ 勾选完成状态
- ✅ 点击日期切换日期
- ✅ 点击"今天"快速返回

**2. AI 对话**
- ✅ 自动保存对话历史（本地持久化）
- ✅ 旧消息渐变半透明（从 1/4 处开始）
- ✅ 发送消息与 AI 交互

**3. 审批流程**（重要！）

当 AI 建议修改日程时，会弹出审批卡片：

| 按钮 | 功能 | 效果 |
|------|------|------|
| **忽略** | 关闭卡片，继续聊天 | 卡片消失，对话继续，历史保留 |
| **拒绝** | 拒绝操作 | 记录拒绝消息，卡片消失 |
| **接受** | 执行操作 | 执行操作 + **清空聊天记录** |

**接受后清空的原因：**
- 避免混淆：旧对话可能引用已执行的操作
- 重新开始：新的任务从干净的状态开始
- 保持简洁：聊天记录不会越积越多

**手动清空：**
- 点击右上角垃圾桶图标 🗑️
- 确认后清空所有对话和待审批操作

---

## 📅 日历页面

### 功能

**1. 查看日历**
- 显示整月日历
- 颜色标识：
  - 🔵 工作日：蓝色背景
  - 🟢 休息日：绿色背景
  - 🔴 节假日：红色背景

**2. 点击跳转**
```
点击任意日期
    ↓
自动跳转到 AI 日程页面
    ↓
显示该日期的日程列表
```

**3. 长按修改**
- 长按日期弹出对话框
- 设置休假/加班
- 覆盖工作制默认设置

**4. 工作制设置**
- 右上角三点菜单
- 选择：单休/双休/大小周

---

## 🎯 使用场景

### 场景 1：快速查看日程
```
1. 打开 App → 默认在 AI 日程页
2. 查看今天的日程列表
3. 勾选完成的日程
```

### 场景 2：从日历跳转
```
1. 切换到日历页面
2. 点击某个日期（如 11月30日）
3. 自动跳转到 AI 日程页面
4. 显示 11月30日 的日程
```

### 场景 3：AI 创建日程
```
你: "明天8点开会"

AI: 好的！我建议创建一个日程：
    开会
    ⏰ 2025-11-25 08:00
    
[审批卡片弹出]
┌────────────────────────┐
│ ✅ 创建日程            │
│ 开会                   │
│ 2025-11-25 08:00       │
│ [忽略] [拒绝] [接受]   │
└────────────────────────┘

你点击"接受"
    ↓
✅ 日程创建成功
✅ 聊天记录清空
✅ 日程列表刷新

新的对话：
AI: ✅ 已执行：创建日程
    
    有其他需要帮忙的吗？
```

### 场景 4：忽略建议
```
你: "每天晚上10点记账"

AI: 好的！我建议创建每天重复的日程...

[审批卡片弹出]

你点击"忽略"
    ↓
卡片消失，可以继续聊天

你: "算了，我想改成9点"

AI: 明白了，那我重新建议...
```

---

## 📊 对话持久化

### 保存机制
- 每次发送/接收消息后自动保存
- 使用 SharedPreferences 本地存储
- 格式：JSON 数组

### 清空时机
1. **手动清空**：点击垃圾桶图标
2. **接受操作**：点击"接受"按钮执行操作
3. **从不自动清空**：除非上述两种情况

### 恢复机制
- 重启 App 后自动加载历史对话
- 如果加载失败，显示欢迎消息

---

## 🎨 视觉效果

### 渐变半透明
```
消息列表从上到下：

[第 1 条]  ← 30% 不透明度 ┐
[第 2 条]  ← 40% 不透明度 │ 1/4 处
[第 3 条]  ← 50% 不透明度 │ 开始渐变
[第 4 条]  ← 60% 不透明度 ┘
[第 5 条]  ← 100% 不透明度
[第 6 条]  ← 100% 不透明度  ← 最新消息
```

**目的：**
- 突出最新对话
- 节省视觉空间
- 保持历史可见性

### 顶部渐变遮罩
- 聊天区顶部有白色渐变遮罩
- 从不透明到透明
- 与背景融合，视觉更柔和

---

## 🔧 技术细节

### 布局比例
```dart
Column(
  children: [
    Expanded(flex: 3, child: 日程列表区),  // 3/5
    Expanded(flex: 2, child: 聊天区),      // 2/5
  ],
)
```

### 聊天区内部
```dart
Column(
  children: [
    审批卡片(最多 120px),
    Expanded(聊天消息列表),
    加载指示器,
    输入框,
  ],
)
```

### 导航跳转
```dart
// 日历 → AI 日程
Navigator.pushReplacement(
  MaterialPageRoute(
    builder: (context) => ScheduleScreen(initialDate: selectedDay),
  ),
);
```

---

## 💡 最佳实践

### 1. 日程查看
- 使用"今天"按钮快速返回当天
- 从日历点击跳转到特定日期

### 2. AI 交互
- 自然对话，无需记忆命令
- 忽略不需要的建议
- 接受后清空，保持聊天简洁

### 3. 审批决策
- **忽略**：暂时不需要，以后可能需要
- **拒绝**：明确不要这个操作
- **接受**：立即执行并清空历史

### 4. 对话管理
- 定期点击垃圾桶清空旧对话
- 接受操作会自动清空
- 历史会自动保存，不用担心丢失

---

## 🎉 新功能亮点

| 功能 | 说明 |
|------|------|
| 🎯 **二合一页面** | 日程 + AI 助手在一个页面，无需切换 |
| 💾 **对话持久化** | 本地保存，重启不丢失 |
| 🎨 **渐变效果** | 旧消息半透明，突出最新对话 |
| ✅ **智能审批** | 忽略/拒绝/接受，灵活控制 |
| 📅 **快速跳转** | 日历点击直达日程详情 |
| 🗑️ **一键清空** | 手动清空或接受后自动清空 |

现在开始使用吧！🚀
